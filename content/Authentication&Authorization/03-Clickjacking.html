<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clickjacking (ç‚¹å‡»åŠ«æŒ) ä¸é˜²å¾¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../../global.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <style>
        /* Minimal inline styles - Rely on global.css and Tailwind */
        /* Ensure styles from global.css like .page-container, .local-side-nav, .content-main, .content-card etc. are loaded */

        /* --- Base & Layout Adjustments --- */
        html {
            scroll-padding-top: 6rem;
            /* Adjust based on potential sticky nav height */
        }

        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: var(--bg-color-lighter);
            /* From global.css */
            color: var(--text-color-default);
            /* From global.css */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- Typography --- */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            scroll-margin-top: 6rem;
            /* Offset for sticky nav */
        }

        /* Use heading styles from global.css if defined (e.g., .head1, .head2) */
        /* Otherwise, define basic styles */
        h1.head1 {
            /* Assumes .head1 is defined in global.css */
        }

        h2.head2 {
            /* Assumes .head2 is defined in global.css */
        }

        h3.head3 {
            /* Assumes .head3 is defined in global.css */
        }

        /* Add margin to paragraphs within content cards for better readability */
        .content-card>p {
            margin-bottom: 1rem;
            /* Equivalent to mb-4 */
        }

        .content-card>p:last-child {
            margin-bottom: 0;
            /* Remove margin from last paragraph in a card */
        }

        .content-card>ul,
        .content-card>ol {
            margin-bottom: 1rem;
            /* Add margin to lists as well */
        }

        .content-card>ul:last-child,
        .content-card>ol:last-child {
            margin-bottom: 0;
        }

        .content-card>pre:last-child {
            margin-bottom: 0;
        }

        .content-card>div:last-child {
            /* Target last div like mermaid or notes */
            margin-bottom: 0;
        }


        /* Ensure code blocks are styled correctly */
        article pre {
            font-family: var(--font-family-mono);
            border-radius: 0.375rem;
            margin: 1rem 0;
            padding: 1em;
            overflow: auto;
            background-color: var(--bg-color-light);
            /* From global.css */
            border: 1px solid var(--border-color-light);
            /* From global.css */
        }

        article pre code[class*="language-"] {
            background: none;
            color: inherit;
            padding: 0;
            font-size: inherit;
            font-family: inherit;
            line-height: inherit;
            white-space: pre;
            display: block;
        }

        *:not(pre)>code {
            /* Inline code style */
            background-color: var(--primary-color-light);
            color: var(--primary-color-dark);
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
        }

        /* --- Fade-in Animation --- */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-section {
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* --- Tooltip Styling (if needed, copy from example.html or global.css) --- */
        .tooltip-term {
            border-bottom: 1px dotted var(--primary-color);
            cursor: help;
            position: relative;
            color: var(--primary-color);
            font-weight: 500;
        }

        .tooltip-term::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 0.4rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
            z-index: 10;
        }

        .tooltip-term::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(0px);
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.85) transparent transparent transparent;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
            z-index: 10;
        }

        .tooltip-term:hover::before,
        .tooltip-term:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Mermaid styling from global.css or example.html */
        .mermaid {
            margin: 1.5rem 0;
            text-align: center;
            background-color: var(--bg-color-light);
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid var(--border-color-light);
        }

        .mermaid svg {
            max-width: 100%;
            height: auto;
            display: block;
            margin: auto;
        }

        /* --- Card Hover Effect --- */
        .content-card {
            transition: box-shadow 0.2s ease-in-out;
            /* Add transition for smooth effect */
        }

        .content-card:hover {
            /* Slightly increase shadow - Tailwind shadow-lg equivalent */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        /* --- Quiz Card Styling (Ensure styles from global.css are sufficient) --- */
        /* Add ripple effect if desired and implemented in JS */
        .quiz-toggle {
            /* Apply to the button that toggles the answer */
            position: relative;
            overflow: hidden;
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(var(--primary-color-rgb, 59, 130, 246), 0.4);
            /* Use RGB for opacity */
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        .quiz-toggle .material-icons {
            font-size: 1.1rem;
            transition: transform 0.3s ease-in-out;
            vertical-align: middle;
            /* Align icon better */
        }

        .quiz-toggle .icon-arrow.rotated {
            transform: rotate(180deg);
        }

        .quiz-answer {
            max-height: 0;
            opacity: 0;
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out, padding-top 0.5s ease-in-out, padding-bottom 0.5s ease-in-out, margin-top 0.5s ease-in-out;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            border-top: 1px solid var(--border-color-default);
            /* Add border top */
            background-color: var(--bg-color-lighter);
            border-radius: 0 0 0.375rem 0.375rem;
            /* Round bottom corners */
            color: var(--text-color-default);
        }

        .quiz-answer.visible {
            max-height: 1000px;
            /* Adjust if needed for very long answers */
            opacity: 1;
            padding-top: 1rem;
            padding-bottom: 1rem;
            margin-top: 1rem;
            /* Add margin when visible */
            overflow: auto;
        }

        /* Ensure quiz options have appropriate styling from global.css */
        /* Add specific styles if global.css is missing them */
        .quiz-option {
            display: flex;
            /* Use flex for alignment */
            align-items: center;
            /* Center items vertically */
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color-default);
            border-radius: 0.375rem;
            background-color: white;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .quiz-option:hover {
            background-color: var(--quiz-option-hover-bg, rgba(59, 130, 246, 0.1));
            border-color: var(--primary-color);
        }

        .quiz-option input[type="radio"] {
            margin-right: 0.75rem;
            /* space between radio and text */
            flex-shrink: 0;
            /* Prevent radio button from shrinking */
            accent-color: var(--primary-color);
            /* Style the radio button itself */
        }

        .quiz-option span {
            /* The text label */
            flex-grow: 1;
        }

        .quiz-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(59, 130, 246, 0.15);
        }

        .quiz-option.correct {
            border-color: var(--success-color, #10b981);
            background-color: var(--success-color-light, #ecfdf5);
        }

        .quiz-option.incorrect {
            border-color: var(--danger-color, #ef4444);
            background-color: var(--danger-color-light, #fee2e2);
        }

        .quiz-feedback {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            display: none;
            /* Initially hidden */
            border: 1px solid transparent;
        }

        .quiz-feedback.correct {
            background-color: var(--quiz-feedback-correct-bg, #ecfdf5);
            color: var(--quiz-feedback-correct-text, #10b981);
            border-color: var(--success-color, #10b981);
            display: block;
        }

        .quiz-feedback.incorrect {
            background-color: var(--quiz-feedback-incorrect-bg, #fee2e2);
            color: var(--quiz-feedback-incorrect-text, #ef4444);
            border-color: var(--danger-color, #ef4444);
            display: block;
        }

        .quiz-feedback.warning {
            background-color: var(--warning-color-light, #fff7ed);
            color: var(--warning-color, #f97316);
            border-color: var(--warning-color, #f97316);
            display: block;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="page-container">

        <aside class="local-side-nav">
            <h4 class="head4">Clickjacking é˜²å¾¡</h4>
            <ul id="local-toc">
                <li><a href="#introduction" class="active"><span class="material-icons nav-icon">security</span>ç®€ä»‹</a>
                </li>
                <li><a href="#what-is-clickjacking"><span class="material-icons nav-icon">ads_click</span>ä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒ</a>
                </li>
                <li><a href="#how-it-works"><span class="material-icons nav-icon">visibility_off</span>æ”»å‡»åŸç†</a></li>
                <li><a href="#defense-overview"><span class="material-icons nav-icon">shield</span>é˜²å¾¡æœºåˆ¶æ¦‚è¿°</a></li>
                <li><a href="#x-frame-options"><span
                            class="material-icons nav-icon">web_asset_off</span>X-Frame-Options</a></li>
                <li><a href="#csp-frame-ancestors"><span class="material-icons nav-icon">policy</span>CSP
                        frame-ancestors</a></li>
                <li><a href="#implementation"><span class="material-icons nav-icon">code</span>å®ç°ç¤ºä¾‹</a></li>
                <li><a href="#summary"><span class="material-icons nav-icon">summarize</span>æ€»ç»“</a></li>
            </ul>
            <a href="../../index.html" class="back-link">
                &larr; è¿”å›å¤§çº²ç›®å½•
            </a>
        </aside>

        <main class="content-main">
            <article>
                <section id="introduction" class="content-section fade-in-section" style="animation-delay: 0s;">
                    <h1 class="head1 flex items-center gap-2">
                        <span class="material-icons text-3xl text-blue-600">security</span>Clickjacking (ç‚¹å‡»åŠ«æŒ) ä¸é˜²å¾¡
                    </h1>
                    <p class="mb-4">ç‚¹å‡»åŠ«æŒæ˜¯ä¸€ç§å¸¸è§çš„ Web å®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…é€šè¿‡è¯±éª—ç”¨æˆ·ç‚¹å‡»ä¸å¯è§çš„å…ƒç´ æ¥æ‰§è¡Œéé¢„æœŸçš„æ“ä½œã€‚ç†è§£å…¶åŸç†å’Œé˜²å¾¡æ–¹æ³•å¯¹äºå‰ç«¯å’Œå…¨æ ˆå¼€å‘è€…è‡³å…³é‡è¦ã€‚</p>
                    <p class="mt-4 bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md text-sm">ğŸ’¡
                        <strong>æç¤º:</strong> æœ¬é¡µå°†è¯¦ç»†ä»‹ç»ç‚¹å‡»åŠ«æŒçš„æ¦‚å¿µã€æ”»å‡»æ–¹å¼ä»¥åŠä¸»è¦çš„é˜²å¾¡æ‰‹æ®µ <code>X-Frame-Options</code> å’Œ
                        <code>Content-Security-Policy</code>ã€‚
                    </p>
                </section>

                <section id="what-is-clickjacking" class="content-section fade-in-section"
                    style="animation-delay: 0.05s;">
                    <h2 class="head2 flex items-center"><span class="material-icons">ads_click</span>ä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒ
                        (Clickjacking)</h2>
                    <div class="content-card">
                        <h3 class="head3">æ¦‚å¿µå®šä¹‰</h3>
                        <p class="mb-4">ç‚¹å‡»åŠ«æŒ (Clickjacking)ï¼Œä¹Ÿç§°ä¸ºâ€œ<strong class="text-red-600"><span class="tooltip-term"
                                    data-tooltip="User Interface Redress Attackï¼Œç”¨æˆ·ç•Œé¢ä¼ªè£…æ”»å‡»">UI
                                    ä¼ªè£…æ”»å‡»</span></strong>â€ï¼Œæ˜¯ä¸€ç§è§†è§‰æ¬ºéª—æŠ€æœ¯ã€‚</p>
                        <p class="mb-4">æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªæ¶æ„ç½‘ç«™ï¼Œå¹¶ä½¿ç”¨é€æ˜æˆ–åŠé€æ˜çš„ <code>&lt;iframe&gt;</code>
                            æˆ–ç±»ä¼¼å…ƒç´ è¦†ç›–åœ¨ç›®æ ‡ç½‘ç«™ï¼ˆå—å®³è€…ç½‘ç«™ï¼‰ä¹‹ä¸Šã€‚ç„¶åï¼Œæ”»å‡»è€…è®¾è®¡è¯±å¯¼æ€§çš„å†…å®¹ï¼ˆå¦‚æŒ‰é’®ã€é“¾æ¥ã€æ¸¸æˆï¼‰ï¼Œè®©ç”¨æˆ·ä»¥ä¸ºåœ¨ä¸æ¶æ„ç½‘ç«™äº¤äº’ï¼Œä½†å®é™…ä¸Šç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶è¢«â€œåŠ«æŒâ€ï¼Œä½œç”¨åœ¨äº†éšè—çš„ç›®æ ‡ç½‘ç«™é¡µé¢ä¸Šã€‚
                        </p>
                        <p class="mt-2 mb-4">è¿™å¯èƒ½å¯¼è‡´ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼Œä¾‹å¦‚ï¼š</p>
                        <ul>
                            <li>åœ¨ç¤¾äº¤åª’ä½“ä¸Šç‚¹èµã€åˆ†äº«æˆ–å…³æ³¨ã€‚</li>
                            <li>æ›´æ”¹è´¦æˆ·è®¾ç½®æˆ–å¯†ç ã€‚</li>
                            <li>è¿›è¡Œè´­ä¹°æˆ–è½¬è´¦ã€‚</li>
                            <li>æˆæƒæ¶æ„åº”ç”¨è®¿é—®æƒé™ã€‚</li>
                        </ul>
                    </div>
                </section>

                <section id="how-it-works" class="content-section fade-in-section" style="animation-delay: 0.1s;">
                    <h2 class="head2 flex items-center"><span class="material-icons">visibility_off</span>æ”»å‡»åŸç†</h2>
                    <div class="content-card">
                        <h3 class="head3">åˆ©ç”¨ Iframe è¿›è¡Œè¦†ç›–</h3>
                        <p class="mb-4">æ ¸å¿ƒåœ¨äºåˆ©ç”¨ <code>&lt;iframe&gt;</code> å°†ç›®æ ‡ç½‘ç«™åµŒå…¥åˆ°æ”»å‡»è€…æ§åˆ¶çš„é¡µé¢ä¸­ï¼Œå¹¶é€šè¿‡ CSS è®¾ç½®
                            <code>iframe</code> çš„æ ·å¼ï¼Œä½¿å…¶ï¼š</p>
                        <ul>
                            <li><strong>é€æ˜åº¦ (Opacity):</strong> è®¾ç½®ä¸º 0 æˆ–æ¥è¿‘ 0ï¼Œä½¿å…¶å®Œå…¨ä¸å¯è§ã€‚</li>
                            <li><strong>å®šä½ (Positioning):</strong> ä½¿ç”¨ç»å¯¹å®šä½ (<code>position: absolute</code>) å’Œ
                                <code>z-index</code> å°†é€æ˜ <code>iframe</code> ç²¾ç¡®åœ°è¦†ç›–åœ¨æ”»å‡»è€…é¡µé¢ä¸Šå¯è§çš„è¯±å¯¼å…ƒç´ ï¼ˆå¦‚æŒ‰é’®ï¼‰ä¹‹ä¸Šã€‚</li>
                            <li><strong>å°ºå¯¸å’Œæ»šåŠ¨ (Size & Scrolling):</strong> å¯èƒ½è°ƒæ•´ <code>iframe</code>
                                çš„å¤§å°å’Œæ»šåŠ¨ä½ç½®ï¼Œä½¿å¾—ç›®æ ‡ç½‘ç«™ä¸Šçš„å…³é”®æŒ‰é’®ï¼ˆå¦‚â€œç¡®è®¤â€ã€â€œè´­ä¹°â€ï¼‰æ­£å¥½ä½äºç”¨æˆ·å°†è¦ç‚¹å‡»çš„ä½ç½®ã€‚</li>
                        </ul>
                        <div class="mermaid">
                            graph LR
                            subgraph "ç”¨æˆ·è§†è§’ (Attacker's Site)"
                            direction TB
                            A["çœ‹ä¼¼æ— å®³çš„æŒ‰é’®<br>(ä¾‹å¦‚ 'é¢†å–å¥–åŠ±')"]
                            end
                            subgraph "å®é™…ç»“æ„ (HTML)"
                            direction TB
                            B["æ”»å‡»è€…é¡µé¢å†…å®¹<br><button>é¢†å–å¥–åŠ±</button>"] -- Zè½´è¦†ç›– --> C["é€æ˜ Iframe<br><iframe src='ç›®æ ‡ç½‘ç«™é¡µé¢'
                                style='opacity:0; position:absolute; ...'></iframe>"];
                            C -- åŒ…å« --> D["ç›®æ ‡ç½‘ç«™çš„å…³é”®æŒ‰é’®<br>(ä¾‹å¦‚ 'ç¡®è®¤è½¬è´¦')"];
                            end
                            A -- ç”¨æˆ·ç‚¹å‡» --> B;
                            B -- ç‚¹å‡»ç©¿é€ --> D;

                            style A fill:#ccf,stroke:#333
                            style B fill:#eee,stroke:#333
                            style C fill:#f99,stroke:#f00,stroke-dasharray: 5 5
                            style D fill:#fcc,stroke:#f00
                        </div>
                        <p class="mt-4 mb-0">å½“ç”¨æˆ·ç‚¹å‡»â€œé¢†å–å¥–åŠ±â€æŒ‰é’®æ—¶ï¼Œä»–ä»¬çš„ç‚¹å‡»äº‹ä»¶å®é™…ä¸Šè½åœ¨äº†é€æ˜ <code>iframe</code>
                            ä¸­ç›¸åŒä½ç½®çš„â€œç¡®è®¤è½¬è´¦â€æŒ‰é’®ä¸Šï¼Œä»è€Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å®Œæˆäº†è½¬è´¦æ“ä½œã€‚</p>
                    </div>
                </section>

                <section id="defense-overview" class="content-section fade-in-section" style="animation-delay: 0.15s;">
                    <h2 class="head2 flex items-center"><span class="material-icons">shield</span>é˜²å¾¡æœºåˆ¶æ¦‚è¿°</h2>
                    <div class="content-card">
                        <p class="mb-4">é˜²å¾¡ç‚¹å‡»åŠ«æŒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>æ§åˆ¶ä½ çš„ç½‘é¡µæ˜¯å¦å…è®¸è¢«å…¶ä»–ç½‘é¡µé€šè¿‡ <code>&lt;iframe&gt;</code>
                                ç­‰æ–¹å¼åµŒå…¥</strong>ã€‚</p>
                        <p class="mb-4">ä¸»è¦çš„é˜²å¾¡æ‰‹æ®µæ˜¯é€šè¿‡è®¾ç½® HTTP å“åº”å¤´æ¥å®ç°ï¼š</p>
                        <ol class="mb-4">
                            <li><strong>X-Frame-Options:</strong> è¾ƒæ—©çš„ã€å¹¿æ³›æ”¯æŒçš„å“åº”å¤´ã€‚</li>
                            <li><strong>Content-Security-Policy (CSP) çš„ <code>frame-ancestors</code> æŒ‡ä»¤:</strong>
                                æ›´ç°ä»£ã€æ›´çµæ´»çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ˜¯ CSP æ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚</li>
                        </ol>
                        <p class="mb-4">æ¨èä¼˜å…ˆä½¿ç”¨ CSP çš„ <code>frame-ancestors</code> æŒ‡ä»¤ï¼Œå› ä¸ºå®ƒæä¾›äº†æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¹¶ä¸”æ˜¯ W3C
                            çš„æ ‡å‡†ã€‚ä½†ä¸ºäº†å…¼å®¹æ€§ï¼Œå¯ä»¥åŒæ—¶è®¾ç½® <code>X-Frame-Options</code>ã€‚</p>
                        <p class="text-sm text-gray-600 mb-0">æ­¤å¤–ï¼Œå†å²ä¸Šä¹Ÿå­˜åœ¨ä½¿ç”¨ JavaScript è¿›è¡Œé˜²å¾¡çš„å°è¯•ï¼ˆç§°ä¸º <strong
                                class="text-gray-500">Frame Busting</strong>ï¼‰ï¼Œä¾‹å¦‚æ£€æŸ¥
                            <code>top === self</code>ï¼Œå¦‚æœä¸åœ¨é¡¶å±‚çª—å£å°±å°è¯•è·³è½¬ã€‚ä½†è¿™ç§æ–¹æ³•å®¹æ˜“è¢«æ”»å‡»è€…ç»•è¿‡ï¼Œ<strong
                                class="text-red-600">ä¸åº”ä½œä¸ºä¸»è¦çš„é˜²å¾¡æ‰‹æ®µ</strong>ã€‚</p>
                    </div>
                </section>

                <section id="x-frame-options" class="content-section fade-in-section" style="animation-delay: 0.2s;">
                    <h2 class="head2 flex items-center"><span class="material-icons">web_asset_off</span>X-Frame-Options
                        å“åº”å¤´</h2>
                    <div class="content-card mb-6">
                        <h3 class="head3">ä½œç”¨ä¸ç›®çš„</h3>
                        <p class="mb-4"><code>X-Frame-Options</code> æ˜¯ä¸€ä¸ª HTTP å“åº”å¤´ï¼Œç”¨äºæŒ‡ç¤ºæµè§ˆå™¨æ˜¯å¦å…è®¸ä¸€ä¸ªé¡µé¢åœ¨
                            <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;embed&gt;</code>, æˆ–
                            <code>&lt;object&gt;</code> ä¸­å±•ç¤ºã€‚</p>
                        <p class="mb-0">é€šè¿‡æ­£ç¡®è®¾ç½®æ­¤å“åº”å¤´ï¼Œç½‘ç«™å¯ä»¥æœ‰æ•ˆé˜²æ­¢è‡ªå·±çš„é¡µé¢è¢«æ¶æ„ç½‘ç«™åµŒå…¥ï¼Œä»è€Œé˜²å¾¡ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚</p>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">æœ‰æ•ˆå€¼</h3>
                        <ul>
                            <li>
                                <strong><code>DENY</code></strong>
                                <p class="text-sm text-gray-600 ml-4 mb-2">è¡¨ç¤ºè¯¥é¡µé¢ä¸å…è®¸åœ¨ä»»ä½• <code>frame</code>
                                    ä¸­å±•ç¤ºï¼Œå³ä½¿æ˜¯åœ¨ç›¸åŒåŸŸåçš„é¡µé¢ä¸­ä¹Ÿä¸è¡Œã€‚è¿™æ˜¯æœ€ä¸¥æ ¼çš„è®¾ç½®ã€‚</p>
                                <pre><code class="language-http">X-Frame-Options: DENY</code></pre>
                            </li>
                            <li class="mt-4">
                                <strong><code>SAMEORIGIN</code></strong>
                                <p class="text-sm text-gray-600 ml-4 mb-2">è¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨<strong class="text-red-600"><span
                                            class="tooltip-term" data-tooltip="åè®®ã€åŸŸåå’Œç«¯å£éƒ½ç›¸åŒ">åŒæº</span></strong>åŸŸåä¸‹çš„
                                    <code>frame</code> ä¸­å±•ç¤ºã€‚è¿™æ˜¯æœ€å¸¸ç”¨å’Œæ¨èçš„è®¾ç½®ï¼Œå…è®¸è‡ªèº«ç½‘ç«™å†…éƒ¨çš„åµŒå…¥ï¼Œä½†é˜»æ­¢å¤–éƒ¨ç½‘ç«™åµŒå…¥ã€‚</p>
                                <pre><code class="language-http">X-Frame-Options: SAMEORIGIN</code></pre>
                            </li>
                            <li class="mt-4">
                                <strong><code>ALLOW-FROM uri</code></strong> (âš ï¸ <strong
                                    class="text-orange-600">å·²è¿‡æ—¶ï¼Œä¸æ¨èä½¿ç”¨</strong>)
                                <p class="text-sm text-gray-600 ml-4 mb-2">è¡¨ç¤ºè¯¥é¡µé¢åªå…è®¸åœ¨æŒ‡å®šçš„æ¥æº (uri) çš„ <code>frame</code>
                                    ä¸­å±•ç¤ºã€‚ä¾‹å¦‚
                                    <code>ALLOW-FROM https://example.com/</code>ã€‚ç„¶è€Œï¼Œè¿™ä¸ªæŒ‡ä»¤çš„æ”¯æŒæ€§å¹¶ä¸å¥½ï¼Œå°¤å…¶åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œä¸”ä¸èƒ½æŒ‡å®šå¤šä¸ªæ¥æºã€‚<strong>åº”ä¼˜å…ˆä½¿ç”¨
                                        CSP çš„ <code>frame-ancestors</code></strong>ã€‚</p>
                                <pre><code class="language-http">X-Frame-Options: ALLOW-FROM https://trusted.example.com/</code></pre>
                            </li>
                        </ul>
                    </div>
                    <div class="quiz-card mt-6" id="quiz-xfo">
                        <div class="quiz-question"><span class="material-icons mr-1">quiz</span>X-Frame-Options æµ‹éªŒï¼šå“ªä¸ª
                            <code>X-Frame-Options</code> å€¼å¯ä»¥é˜»æ­¢é¡µé¢è¢«ä»»ä½•æ¥æºï¼ˆåŒ…æ‹¬åŒæºï¼‰åµŒå…¥ï¼Ÿ</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q_xfo" value="a">
                                <span>SAMEORIGIN</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q_xfo" value="b">
                                <span>DENY</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q_xfo" value="c">
                                <span>ALLOW-FROM *</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q_xfo" value="d">
                                <span>NONE</span>
                            </label>
                        </div>
                        <div class="quiz-feedback mt-4" id="feedback-q_xfo"></div>
                        <button class="quiz-toggle button button-secondary mt-4" onclick="checkAnswer('q_xfo', 'b')">
                            <span class="material-icons icon-arrow">expand_more</span><span
                                class="button-text">æ£€æŸ¥ç­”æ¡ˆ</span>
                        </button>
                        <div class="quiz-answer" style="display: none;">
                            <p><strong>ç­”æ¡ˆ:</strong> B. DENY</p>
                            <p><strong>è§£æ:</strong> <code>DENY</code> æŒ‡ä»¤å®Œå…¨ç¦æ­¢é¡µé¢åœ¨ä»»ä½• frame
                                ä¸­æ˜¾ç¤ºï¼Œæä¾›äº†æœ€å¼ºçš„ä¿æŠ¤ã€‚<code>SAMEORIGIN</code> åªå…è®¸åŒæºåµŒå…¥ã€‚<code>ALLOW-FROM</code>
                                å·²è¿‡æ—¶ä¸”ä¸æ¥å—é€šé…ç¬¦ã€‚<code>NONE</code> ä¸æ˜¯ <code>X-Frame-Options</code> çš„æœ‰æ•ˆå€¼ï¼ˆå®ƒæ˜¯ CSP
                                <code>frame-ancestors</code> çš„å€¼ï¼‰ã€‚</p>
                        </div>
                    </div>
                </section>

                <section id="csp-frame-ancestors" class="content-section fade-in-section"
                    style="animation-delay: 0.25s;">
                    <h2 class="head2 flex items-center"><span class="material-icons">policy</span>CSP frame-ancestors æŒ‡ä»¤
                    </h2>
                    <div class="content-card mb-6">
                        <h3 class="head3">ç°ä»£æ›¿ä»£æ–¹æ¡ˆ</h3>
                        <p class="mb-4">å†…å®¹å®‰å…¨ç­–ç•¥ (Content Security Policy, CSP) æ˜¯ä¸€å¥—æ›´å…¨é¢çš„å®‰å…¨æœºåˆ¶ï¼Œé€šè¿‡ HTTP å“åº”å¤´æ¥å£°æ˜æµè§ˆå™¨å…è®¸åŠ è½½çš„èµ„æºæ¥æºç­‰ç­–ç•¥ã€‚
                        </p>
                        <p class="mb-0">å…¶ä¸­çš„ <code>frame-ancestors</code> æŒ‡ä»¤ä¸“é—¨ç”¨äºæ›¿ä»£
                            <code>X-Frame-Options</code>ï¼Œæ§åˆ¶å“ªäº›æ¥æºå¯ä»¥åµŒå…¥å½“å‰é¡µé¢ã€‚</p>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">ä¼˜åŠ¿ä¸è¯­æ³•</h3>
                        <ul class="mb-4">
                            <li><strong>æ›´çµæ´»ï¼š</strong>å¯ä»¥æŒ‡å®šå¤šä¸ªå…è®¸çš„æ¥æºï¼ˆåŒ…æ‹¬é€šé…ç¬¦ã€åè®®ç­‰ï¼‰ã€‚</li>
                            <li><strong>æ ‡å‡†åŒ–ï¼š</strong>æ˜¯ W3C çš„ CSP æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œæœªæ¥æ”¯æŒæ€§æ›´å¥½ã€‚</li>
                        </ul>
                        <p class="mt-2 mb-4"><strong>å¸¸ç”¨å€¼ï¼š</strong></p>
                        <ul>
                            <li>
                                <strong><code>'none'</code></strong>
                                <p class="text-sm text-gray-600 ml-4 mb-2">ç­‰åŒäº
                                    <code>X-Frame-Options: DENY</code>ã€‚ä¸å…è®¸ä»»ä½•æ¥æºåµŒå…¥ã€‚</p>
                                <pre><code class="language-http">Content-Security-Policy: frame-ancestors 'none';</code></pre>
                            </li>
                            <li class="mt-4">
                                <strong><code>'self'</code></strong>
                                <p class="text-sm text-gray-600 ml-4 mb-2">ç­‰åŒäº
                                    <code>X-Frame-Options: SAMEORIGIN</code>ã€‚åªå…è®¸åŒæºåµŒå…¥ã€‚</p>
                                <pre><code class="language-http">Content-Security-Policy: frame-ancestors 'self';</code></pre>
                            </li>
                            <li class="mt-4">
                                <strong><code>&lt;source&gt;</code></strong>
                                <p class="text-sm text-gray-600 ml-4 mb-2">æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå…è®¸çš„æ¥æº (URL æˆ–åŸŸå)ï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚å¯ä»¥ä½¿ç”¨é€šé…ç¬¦
                                    <code>*</code>ã€‚</p>
                                <pre><code class="language-http">Content-Security-Policy: frame-ancestors 'self' https://trusted.example.com https://*.partner.com;</code></pre>
                                <p class="text-xs text-gray-500 ml-4 mb-0">ä¸Šè¿°ç¤ºä¾‹å…è®¸åŒæºåµŒå…¥ï¼Œä»¥åŠæ¥è‡ª
                                    <code>https://trusted.example.com</code> å’Œæ‰€æœ‰ <code>partner.com</code> çš„ HTTPS
                                    å­åŸŸåçš„åµŒå…¥ã€‚</p>
                            </li>
                        </ul>
                        <p
                            class="mt-4 bg-yellow-50 border-l-4 border-yellow-500 text-yellow-700 p-3 rounded-md text-sm mb-0">
                            âš ï¸ <strong>æ³¨æ„:</strong> å¦‚æœåŒæ—¶è®¾ç½®äº† <code>X-Frame-Options</code> å’Œ CSP
                            <code>frame-ancestors</code>ï¼Œ<code>frame-ancestors</code> æŒ‡ä»¤é€šå¸¸ä¼šè¦†ç›–
                            <code>X-Frame-Options</code> (å…·ä½“è¡Œä¸ºå¯èƒ½å› æµè§ˆå™¨è€Œå¼‚ï¼Œä½†ç°ä»£æµè§ˆå™¨å€¾å‘äº CSP)ã€‚å»ºè®®ä¼˜å…ˆä½¿ç”¨ CSPã€‚</p>
                    </div>
                    <div class="quiz-card mt-6" id="quiz-csp">
                        <div class="quiz-question"><span class="material-icons mr-1">quiz</span>CSP æµ‹éªŒï¼šå“ªä¸ª CSP
                            <code>frame-ancestors</code> è®¾ç½®å…è®¸é¡µé¢è¢«è‡ªèº«åŸŸåå’Œ `https://partner.site` åµŒå…¥ï¼Ÿ</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q_csp" value="a">
                                <span><code>frame-ancestors 'self';</code></span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q_csp" value="b">
                                <span><code>frame-ancestors https://partner.site;</code></span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q_csp" value="c">
                                <span><code>frame-ancestors 'self' https://partner.site;</code></span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q_csp" value="d">
                                <span><code>frame-ancestors 'none';</code></span>
                            </label>
                        </div>
                        <div class="quiz-feedback mt-4" id="feedback-q_csp"></div>
                        <button class="quiz-toggle button button-secondary mt-4" onclick="checkAnswer('q_csp', 'c')">
                            <span class="material-icons icon-arrow">expand_more</span><span
                                class="button-text">æ£€æŸ¥ç­”æ¡ˆ</span>
                        </button>
                        <div class="quiz-answer" style="display: none;">
                            <p><strong>ç­”æ¡ˆ:</strong> C. <code>frame-ancestors 'self' https://partner.site;</code></p>
                            <p><strong>è§£æ:</strong> CSP <code>frame-ancestors</code>
                                æŒ‡ä»¤å…è®¸æŒ‡å®šå¤šä¸ªæ¥æºï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚<code>'self'</code> å…³é”®å­—ä»£è¡¨åŒæºï¼Œåé¢å¯ä»¥è·Ÿå…¶ä»–å…è®¸çš„ URL
                                æˆ–åŸŸåã€‚å› æ­¤ï¼Œ<code>'self' https://partner.site;</code> åŒæ—¶å…è®¸äº†åŒæºå’Œæ¥è‡ª
                                <code>https://partner.site</code> çš„åµŒå…¥ã€‚</p>
                        </div>
                    </div>
                </section>

                <section id="implementation" class="content-section fade-in-section" style="animation-delay: 0.3s;">
                    <h2 class="head2 flex items-center"><span class="material-icons">code</span>å®ç°ç¤ºä¾‹</h2>
                    <p class="mb-4">è®¾ç½®è¿™äº› HTTP å“åº”å¤´é€šå¸¸åœ¨ Web æœåŠ¡å™¨æˆ–åº”ç”¨ç¨‹åºå±‚é¢å®Œæˆã€‚</p>
                    <div class="content-card mb-6">
                        <h3 class="head3">Nginx é…ç½®</h3>
                        <pre><code class="language-nginx"># æ¨èä½¿ç”¨ CSP frame-ancestors
add_header Content-Security-Policy "frame-ancestors 'self' https://trusted.example.com;" always;

# æˆ–è€…ä½¿ç”¨ X-Frame-Options (å¦‚æœéœ€è¦å…¼å®¹æ—§æµè§ˆå™¨æˆ–ä½œä¸ºå¤‡é€‰)
# add_header X-Frame-Options "SAMEORIGIN" always;</code></pre>
                        <p class="text-xs text-gray-500 mt-1 mb-0"><code>always</code> å‚æ•°ç¡®ä¿ Nginx åœ¨æ‰€æœ‰å“åº”ç ï¼ˆåŒ…æ‹¬é”™è¯¯é¡µé¢ï¼‰ä¸­éƒ½æ·»åŠ è¯¥å¤´ã€‚
                        </p>
                    </div>
                    <div class="content-card mb-6">
                        <h3 class="head3">Apache é…ç½® (.htaccess æˆ– httpd.conf)</h3>
                        <pre><code class="language-apacheconf"># æ¨èä½¿ç”¨ CSP frame-ancestors
Header always set Content-Security-Policy "frame-ancestors 'self'"

# æˆ–è€…ä½¿ç”¨ X-Frame-Options
# Header always set X-Frame-Options "SAMEORIGIN"</code></pre>
                        <p class="text-xs text-gray-500 mt-1 mb-0">éœ€è¦ç¡®ä¿ <code>mod_headers</code> æ¨¡å—å·²å¯ç”¨ã€‚</p>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">Node.js (Express ç¤ºä¾‹)</h3>
                        <p class="text-sm text-gray-600 mb-2">å¯ä»¥ä½¿ç”¨ <code>helmet</code> ä¸­é—´ä»¶ç®€åŒ–è®¾ç½®ã€‚</p>
                        <pre><code class="language-javascript">const express = require('express');
const helmet = require('helmet');

const app = express();

// ä½¿ç”¨ helmet è®¾ç½® CSP frame-ancestors (æ¨è)
app.use(
  helmet.contentSecurityPolicy({
    directives: {
      ...helmet.contentSecurityPolicy.getDefaultDirectives(), // ä¿ç•™å…¶ä»–é»˜è®¤æŒ‡ä»¤
      "frame-ancestors": ["'self'", "https://trusted.example.com"], // è®¾ç½®å…è®¸çš„æ¥æº
      // æˆ–è€…ä¸å…è®¸ä»»ä½•åµŒå…¥:
      // "frame-ancestors": ["'none'"],
    },
  })
);

// æˆ–è€…å•ç‹¬è®¾ç½® X-Frame-Options (å¦‚æœä¸ç”¨ helmet çš„ CSP)
// app.use(helmet.frameguard({ action: 'sameorigin' })); // è®¾ç½® X-Frame-Options: SAMEORIGIN
// app.use(helmet.frameguard({ action: 'deny' }));      // è®¾ç½® X-Frame-Options: DENY

// ... å…¶ä»–è·¯ç”±å’Œä¸­é—´ä»¶ ...

app.listen(3000, () => console.log('Server running on port 3000'));</code></pre>
                    </div>
                </section>

                <section id="summary" class="content-section fade-in-section" style="animation-delay: 0.35s;">
                    <h2 class="head2 flex items-center"><span class="material-icons">summarize</span>æ€»ç»“</h2>
                    <div class="content-card">
                        <ul>
                            <li>ç‚¹å‡»åŠ«æŒæ˜¯ä¸€ç§ UI ä¼ªè£…æ”»å‡»ï¼Œé€šè¿‡é€æ˜ <code>iframe</code> è¦†ç›–ç›®æ ‡ç½‘ç«™ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ã€‚</li>
                            <li>é˜²å¾¡æ ¸å¿ƒæ˜¯é˜»æ­¢æ¶æ„ç½‘ç«™åµŒå…¥ä½ çš„é¡µé¢ã€‚</li>
                            <li>ä½¿ç”¨ HTTP å“åº”å¤´ <code>X-Frame-Options</code> æˆ– CSP çš„ <code>frame-ancestors</code> æŒ‡ä»¤è¿›è¡Œæ§åˆ¶ã€‚
                            </li>
                            <li><strong>æ¨èä½¿ç”¨ <code>Content-Security-Policy: frame-ancestors 'self';</code> æˆ–
                                    <code>'none';</code></strong> ä½œä¸ºç°ä»£ã€çµæ´»ä¸”æ ‡å‡†çš„é˜²å¾¡æ–¹æ³•ã€‚</li>
                            <li>æ ¹æ®éœ€æ±‚ï¼Œå¯ä»¥å…è®¸ç‰¹å®šçš„å¯ä¿¡æ¥æºåµŒå…¥ã€‚</li>
                            <li>ç¡®ä¿åœ¨ Web æœåŠ¡å™¨æˆ–åº”ç”¨å±‚æ­£ç¡®é…ç½®è¿™äº›å“åº”å¤´ã€‚</li>
                            <li>JavaScript Frame Busting æ˜¯ä¸€ç§è¿‡æ—¶ä¸”ä¸å¯é çš„è¾…åŠ©æ‰‹æ®µã€‚</li>
                        </ul>
                    </div>
                </section>

            </article>
        </main>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });

        // --- Ripple Effect Logic ---
        function createRipple(event) {
            const button = event.currentTarget;
            // Check if the target is a button or has the .button class
            if (!button || !(button.tagName === 'BUTTON' || button.classList.contains('button')) || typeof button.getBoundingClientRect !== 'function') return;

            const circle = document.createElement("span");
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;
            // Attempt to get primary color RGB from CSS variable, fallback to default blue
            const primaryColorRgb = getComputedStyle(document.documentElement).getPropertyValue('--primary-color-rgb').trim() || '59, 130, 246';

            circle.style.width = circle.style.height = `${diameter}px`;
            const rect = button.getBoundingClientRect();
            circle.style.left = `${event.clientX - rect.left - radius}px`;
            circle.style.top = `${event.clientY - rect.top - radius}px`;
            circle.style.backgroundColor = `rgba(${primaryColorRgb}, 0.4)`; // Use the determined RGB
            circle.classList.add("ripple");

            const existingRipple = button.querySelector(".ripple");
            if (existingRipple) existingRipple.remove();

            button.appendChild(circle);
            // Clean up ripple element after animation
            setTimeout(() => circle.remove(), 600);
        }

        // --- Quiz Toggle Logic ---
        function toggleAnswer(quizId, buttonElement) {
            const quizCard = document.getElementById(quizId);
            if (!quizCard) return;
            const answer = quizCard.querySelector('.quiz-answer');
            const icon = buttonElement.querySelector('.icon-arrow');
            const buttonTextSpan = buttonElement.querySelector('.button-text'); // Get the span containing the text
            if (!answer || !icon || !buttonTextSpan) return;

            const isVisible = answer.classList.contains('visible');

            if (isVisible) {
                // Start hiding transition
                answer.style.maxHeight = '0';
                answer.style.opacity = '0';
                answer.style.marginTop = '0';
                answer.style.paddingTop = '0';
                answer.style.paddingBottom = '0';
                answer.classList.remove('visible');
                icon.classList.remove('rotated');
                buttonTextSpan.textContent = ' æ£€æŸ¥ç­”æ¡ˆ'; // Change text back

                // After transition, set display to none for accessibility and layout
                setTimeout(() => {
                    // Double check it's still hidden before setting display:none
                    if (!answer.classList.contains('visible')) {
                        answer.style.display = 'none';
                        // Clean up inline styles set during transition
                        answer.style.removeProperty('max-height');
                        answer.style.removeProperty('opacity');
                        answer.style.removeProperty('margin-top');
                        answer.style.removeProperty('padding-top');
                        answer.style.removeProperty('padding-bottom');
                    }
                }, 500); // Match transition duration
            } else {
                // Prepare to show
                answer.style.display = 'block'; // Make it visible to measure scrollHeight
                // Set styles for the expanded state *before* adding 'visible' class for transition
                answer.style.paddingTop = '1rem';
                answer.style.paddingBottom = '1rem';
                answer.style.marginTop = '1rem';

                // Force reflow to ensure display:block is applied before transition starts
                requestAnimationFrame(() => {
                    answer.style.maxHeight = answer.scrollHeight + 'px';
                    answer.style.opacity = '1';
                    answer.classList.add('visible');
                    icon.classList.add('rotated');
                    buttonTextSpan.textContent = ' éšè—ç­”æ¡ˆ'; // Change text
                });
            }
        }

        // --- Quiz Check Answer Logic ---
        function checkAnswer(questionName, correctAnswerValue) {
            const options = document.querySelectorAll(`input[name="${questionName}"]`);
            const feedbackElement = document.getElementById(`feedback-${questionName}`);
            const quizCard = feedbackElement ? feedbackElement.closest('.quiz-card') : null;
            let selectedValue = null;
            let selectedLabel = null;

            if (!feedbackElement || !quizCard) {
                console.error("Quiz feedback element or card not found for", questionName);
                return;
            }

            // Clear previous feedback and styles
            feedbackElement.style.display = 'none';
            feedbackElement.textContent = '';
            feedbackElement.className = 'quiz-feedback'; // Reset class
            quizCard.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));

            // Find selected option
            options.forEach(option => {
                if (option.checked) {
                    selectedValue = option.value;
                    selectedLabel = option.closest('.quiz-option');
                    if (selectedLabel) selectedLabel.classList.add('selected');
                }
            });

            // Check if an option was selected
            if (!selectedValue) {
                feedbackElement.textContent = "è¯·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹ï¼";
                feedbackElement.className = 'quiz-feedback warning'; // Use warning style
                feedbackElement.style.display = 'block';
                return; // Stop processing if no selection
            }

            // Find the correct answer label
            let correctAnswerLabel = null;
            options.forEach(opt => { if (opt.value === correctAnswerValue) correctAnswerLabel = opt.closest('.quiz-option'); });

            // Provide feedback
            if (selectedValue === correctAnswerValue) {
                feedbackElement.textContent = "å›ç­”æ­£ç¡®ï¼";
                feedbackElement.className = 'quiz-feedback correct';
                if (selectedLabel) selectedLabel.classList.add('correct');
            } else {
                let correctAnswerText = '';
                if (correctAnswerLabel) {
                    correctAnswerText = correctAnswerLabel.querySelector('span')?.textContent || `é€‰é¡¹ ${correctAnswerValue}`;
                    correctAnswerLabel.classList.add('correct'); // Highlight the correct one
                }
                feedbackElement.textContent = `å›ç­”é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯: "${correctAnswerText}"`;
                feedbackElement.className = 'quiz-feedback incorrect';
                if (selectedLabel) selectedLabel.classList.add('incorrect'); // Mark the wrong selection
            }
            feedbackElement.style.display = 'block'; // Show the feedback

            // --- Automatically toggle the answer section visibility ---
            const toggleButton = quizCard.querySelector('.quiz-toggle'); // Find the toggle button for this quiz
            const answerSection = quizCard.querySelector('.quiz-answer');

            if (toggleButton && answerSection && !answerSection.classList.contains('visible')) {
                // If answer is hidden, show it
                toggleAnswer(quizCard.id, toggleButton);
            }
            // Optional: If you want to hide the answer again if the user clicks check while it's visible, add an else condition here.
            // else if (toggleButton && answerSection && answerSection.classList.contains('visible')) {
            //      // If answer is visible, maybe hide it? Or do nothing.
            //      // toggleAnswer(quizCard.id, toggleButton);
            // }
        }


        document.addEventListener('DOMContentLoaded', () => {
            // --- TOC Highlighting Logic ---
            const sections = document.querySelectorAll('main section[id]');
            const tocLinks = document.querySelectorAll('#local-toc a');
            let lastActiveTocLink = null;

            const tocObserverOptions = {
                root: null,
                rootMargin: '-20% 0px -60% 0px',
                threshold: 0
            };

            const tocObserverCallback = (entries) => {
                let bestVisibleEntry = null;
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        if (!bestVisibleEntry || entry.boundingClientRect.top < bestVisibleEntry.boundingClientRect.top) {
                            bestVisibleEntry = entry;
                        }
                    }
                });

                if (bestVisibleEntry) {
                    const id = bestVisibleEntry.target.getAttribute('id');
                    const activeLink = document.querySelector(`#local-toc a[href="#${id}"]`);

                    if (activeLink && activeLink !== lastActiveTocLink) {
                        if (lastActiveTocLink) {
                            lastActiveTocLink.classList.remove('active');
                        }
                        activeLink.classList.add('active');
                        lastActiveTocLink = activeLink;
                    }
                }
            };

            const tocObserver = new IntersectionObserver(tocObserverCallback, tocObserverOptions);
            sections.forEach(section => tocObserver.observe(section));

            // Initial active link check
            const currentHash = window.location.hash;
            if (currentHash) {
                const initialActiveLink = document.querySelector(`#local-toc a[href="${currentHash}"]`);
                if (initialActiveLink) {
                    tocLinks.forEach(link => link.classList.remove('active'));
                    initialActiveLink.classList.add('active');
                    lastActiveTocLink = initialActiveLink;
                }
            } else if (tocLinks.length > 0 && !lastActiveTocLink) {
                tocLinks.forEach(link => link.classList.remove('active'));
                tocLinks[0].classList.add('active');
                lastActiveTocLink = tocLinks[0];
            }

            // --- Fade-in Animation Logic ---
            const mainContentSections = document.querySelectorAll('main > article > section.content-section');
            const fadeObserverOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
            const fadeObserverCallback = (entries, observer) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const delayIndex = Array.from(mainContentSections).indexOf(entry.target);
                        entry.target.style.animationDelay = `${delayIndex * 0.05}s`;
                        entry.target.classList.add('fade-in-section');
                        observer.unobserve(entry.target);
                    }
                });
            };
            const fadeObserver = new IntersectionObserver(fadeObserverCallback, fadeObserverOptions);
            mainContentSections.forEach(section => fadeObserver.observe(section));

            // --- Attach Ripple Effect to Buttons ---
            // Apply to elements with class 'button' or 'quiz-toggle' which acts like a button
            document.querySelectorAll('.button, .quiz-toggle').forEach(button => {
                button.addEventListener('click', createRipple);
            });

            // --- Initialize Quiz Answer Sections (Hide them initially) ---
            document.querySelectorAll('.quiz-answer').forEach(answer => {
                answer.style.display = 'none'; // Ensure they are hidden on load
            });

        });
    </script>
</body>

</html>