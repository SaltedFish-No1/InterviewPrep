<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web æ€§èƒ½ä¸å®è·µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono&family=Fira+Code&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../../global.css">
    <link rel="stylesheet" href="./style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <style>
        /* Minimal inline styles - Prioritize global.css and style.css */

        /* Level Tag Styles (Keep if specific) */
        .level-tag {
            display: inline-block;
            margin-left: 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.1rem 0.5rem;
            border-radius: 0.25rem;
            vertical-align: middle;
            border: 1px solid transparent;
        }

        .level-tag-high {
            background-color: var(--danger-color-light, #fee2e2);
            color: var(--danger-color, #ef4444);
            border-color: var(--danger-color, #ef4444);
        }

        .level-tag-medium {
            background-color: var(--warning-color-light, #fff7ed);
            color: var(--warning-color, #f97316);
            border-color: var(--warning-color, #f97316);
        }

        .level-tag-low {
            background-color: var(--secondary-color-light, #ecfdf5);
            color: var(--secondary-color, #10b981);
            border-color: var(--secondary-color, #10b981);
        }

        .level-tag-base {
            background-color: var(--bg-color-lighter, #f3f4f6);
            color: var(--text-color-light, #6b7280);
            border-color: var(--border-color-default, #d1d5db);
        }

        .level-tag-advanced {
            background-color: var(--primary-color-light, #eff6ff);
            color: var(--primary-color-dark, #2563eb);
            border-color: var(--primary-color, #3b82f6);
        }

        /* Ensure heading scroll margin */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            scroll-margin-top: 5rem;
        }

        /* Wrapper for consistent padding inside sections */
        .section-content-wrapper {
            padding-left: calc(1rem + 4px);
            /* Match h2 pl-4 + border-l-4 */
            margin-top: 1.5rem;
            /* mt-6 */
        }

        .section-content-wrapper>*+* {
            margin-top: 1.5rem;
        }

        /* Ensure lists inside wrapper have correct styling */
        .section-content-wrapper ul {
            list-style: disc;
            padding-left: 1.5em;
            margin-bottom: 1em;
        }

        .section-content-wrapper ol {
            list-style: decimal;
            padding-left: 1.5em;
            margin-bottom: 1em;
        }

        .section-content-wrapper li {
            margin-bottom: 0.5em;
        }

        /* Consistent margins for diagrams/code blocks */
        .mermaid {
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }

        pre:not(.mermaid) {
            margin-top: 1rem;
            margin-bottom: 1.5rem;
        }

        /* --- Refined Quiz UI/UX Styles --- */
        /* Ensure quiz container matches card style */
        .section-quiz-container {
            margin-top: 2.5rem;
            padding: var(--card-padding, 1.5rem);
            /* Use card padding variable */
            background-color: var(--quiz-bg, var(--primary-color-light));
            /* Use quiz bg variable */
            border: 1px solid var(--border-color-default);
            border-left-width: 4px;
            border-radius: 0.5rem;
            /* rounded-lg */
            box-shadow: var(--card-shadow-default);
            /* Use card shadow */
            /* border-left-color is set dynamically by JS */
        }

        .quiz-card-title {
            font-weight: 600;
            /* font-semibold */
            color: var(--text-color-dark);
            /* Use dark text color */
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .quiz-card-title i {
            margin-right: 0.5rem;
            /* color is set dynamically by JS */
        }

        .quiz-card {
            background-color: transparent;
            /* Make card transparent inside container */
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color-light);
            /* Lighter separator */
        }

        .quiz-card:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .quiz-card p {
            /* Question text */
            font-weight: 500;
            /* font-medium */
            margin-bottom: 1rem;
            color: var(--text-color-default);
            font-size: 1rem;
            /* text-base */
        }

        /* Option styling - make them look more like selectable items */
        .quiz-options label {
            display: flex;
            /* Align radio and text */
            align-items: center;
            margin-bottom: 0.75rem;
            cursor: pointer;
            padding: 0.75rem 1rem;
            /* Consistent padding */
            border-radius: 0.375rem;
            /* rounded-md */
            transition: background-color 0.2s ease, border-color 0.2s ease;
            border: 1px solid var(--border-color-default);
            background-color: var(--bg-color-white);
            /* White background for options */
        }

        .quiz-options label:hover:not(.disabled) {
            /* Hover effect only if not disabled */
            background-color: var(--bg-color-light);
            border-color: var(--primary-color-dark);
        }

        .quiz-options input[type="radio"] {
            margin-right: 0.75rem;
            accent-color: var(--primary-color);
            width: 1rem;
            /* w-4 */
            height: 1rem;
            /* h-4 */
            flex-shrink: 0;
        }

        .quiz-options input[type="radio"]:checked+span {
            font-weight: 600;
            /* font-semibold */
            color: var(--primary-color-dark);
        }

        .quiz-options input[type="radio"]:disabled+span {
            color: var(--text-color-light);
            /* Lighter text when disabled */
        }

        .quiz-options label.disabled {
            /* Style for disabled label after answering */
            cursor: not-allowed;
            background-color: var(--bg-color-lighter);
            border-color: var(--border-color-light);
            opacity: 0.8;
        }

        /* Specific styling for correct/incorrect labels after selection */
        .quiz-options label.correct-answer {
            border-color: var(--success-color, var(--secondary-color));
            background-color: var(--success-color-light, var(--secondary-color-light));
        }

        .quiz-options label.incorrect-selection {
            border-color: var(--danger-color);
            background-color: var(--danger-color-light);
        }

        /* Feedback area styling */
        .quiz-feedback {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            /* Consistent padding */
            border-radius: 0.375rem;
            /* rounded-md */
            font-size: 0.9rem;
            min-height: 40px;
            /* Adjust min height */
            display: none;
            animation: feedbackFadeIn 0.5s ease-out;
            border-width: 1px;
            border-style: solid;
        }

        @keyframes feedbackFadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback-correct {
            background-color: var(--success-color-light, var(--secondary-color-light));
            border-color: var(--success-color, var(--secondary-color));
            color: var(--success-color, var(--secondary-color));
        }

        .feedback-incorrect {
            background-color: var(--danger-color-light);
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .quiz-feedback strong {
            font-weight: 600;
        }

        .feedback-explanation {
            margin-top: 0.5rem;
            font-style: normal;
            /* Remove italic */
            color: var(--text-color-default);
            /* Default text color */
            font-size: 0.85rem;
            /* Slightly smaller */
            border-top: 1px dashed var(--border-color-light);
            /* Separator */
            padding-top: 0.5rem;
        }

        /* Add check/cross icons to feedback */
        .feedback-correct::before {
            content: 'âœ“ ';
            /* Checkmark */
            font-weight: bold;
            margin-right: 0.3em;
        }

        .feedback-incorrect::before {
            content: 'âœ— ';
            /* Cross mark */
            font-weight: bold;
            margin-right: 0.3em;
        }
    </style>
</head>

<body class="bg-slate-50">
    <button id="toc-toggle-btn" aria-label="Toggle Table of Contents" class="lg:hidden">
        <i class="fas fa-bars text-xl"></i>
    </button>

    <div class="page-container">
        <aside id="toc-aside" class="local-side-nav">
            <nav id="table-of-contents" class="h-full overflow-y-auto py-4">
                <h4 class="head4 px-6 mb-3">Web æ€§èƒ½ä¸å®è·µ</h4>
                <ul class="space-y-1"></ul>
                <a href="../../index.html" class="back-link">
                    &larr; è¿”å›å¤§çº²ç›®å½•
                </a>
            </nav>

        </aside>

        <main id="main-content" class="content-main">
            <article>
                <section id="intro" class="content-section fade-in-section">
                    <h2 id="intro-title" class="head2">
                        <span class="material-icons text-3xl text-sky-600 mr-3">rocket_launch</span>(å››) Web æ€§èƒ½ä¸å®è·µ
                    </h2>
                    <div class="section-content-wrapper">
                        <p class="text-slate-600 leading-relaxed">Web æ€§èƒ½æ˜¯è¡¡é‡ç”¨æˆ·ä½“éªŒçš„å…³é”®æŒ‡æ ‡ï¼Œç›´æ¥å½±å“ç”¨æˆ·ç•™å­˜å’Œè½¬åŒ–ã€‚æœ¬èŠ‚å°†æ·±å…¥æ¢è®¨ HTTP
                            ç¼“å­˜æœºåˆ¶ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€è¿æ¥ä¼˜åŒ–æŠ€æœ¯ä»¥åŠç›¸å…³çš„ Web æŠ€æœ¯å¦‚ WebSockets å’Œ API è®¾è®¡é£æ ¼ã€‚</p>
                        <p class="mt-4 bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md text-sm">ğŸ’¡
                            <strong>æç¤º:</strong> ç‚¹å‡»å·¦ä¾§å¯¼èˆªå¯ä»¥å¿«é€Ÿè·³è½¬åˆ°ç›¸åº”ä¸»é¢˜ã€‚æ‹¬å·å†…æ ‡æ³¨äº†é¢è¯•ä¸­çš„è€ƒå¯Ÿé¢‘ç‡å’ŒåŸºç¡€/è¿›é˜¶ç¨‹åº¦ã€‚å°†é¼ æ ‡æ‚¬åœåœ¨ <span
                                class="tooltip-trigger" data-tooltip="å°±åƒè¿™æ ·ï¼">å¸¦ä¸‹åˆ’çº¿çš„æœ¯è¯­</span> ä¸Šå¯æŸ¥çœ‹è§£é‡Šã€‚
                        </p>
                    </div>
                </section>

                <section id="http-cache" class="content-section fade-in-section">
                    <h2 id="http-cache-title" class="head2">
                        <span class="material-icons">inventory_2</span>HTTP ç¼“å­˜æœºåˆ¶
                    </h2>
                    <div class="section-content-wrapper">
                        <p class="mb-4 text-slate-600">HTTP ç¼“å­˜æ˜¯ Web æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ‰‹æ®µï¼Œé€šè¿‡å¤ç”¨å·²è·å–çš„èµ„æºï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚ï¼Œé™ä½å»¶è¿Ÿï¼ŒèŠ‚çœå¸¦å®½ã€‚</p>

                        <div class="content-card">
                            <h3 id="cache-location" class="font-semibold text-lg text-teal-700 mb-2">ğŸ—‚ï¸ ç¼“å­˜ä½ç½®</h3>
                            <p class="text-slate-600">æµè§ˆå™¨ç¼“å­˜èµ„æºå¯ä»¥å­˜å‚¨åœ¨ä¸åŒçš„ä½ç½®ï¼ŒæŸ¥æ‰¾é¡ºåºé€šå¸¸ä¸ºï¼š</p>
                            <ol>
                                <li><strong>Service Worker Cache:</strong> Service Worker è„šæœ¬å¯ä»¥æ‹¦æˆªç½‘ç»œè¯·æ±‚å¹¶ç®¡ç†è‡ªå·±çš„ç¼“å­˜ã€‚ä¼˜å…ˆçº§æœ€é«˜ï¼Œæœ€çµæ´»ã€‚
                                </li>
                                <li><strong>å†…å­˜ç¼“å­˜ (Memory Cache):</strong> å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦æœ€å¿«ï¼Œä½†<span class="tooltip-trigger"
                                        data-tooltip="å…³é—­æ ‡ç­¾é¡µæˆ–æµè§ˆå™¨è¿›ç¨‹åï¼Œå†…å­˜ç¼“å­˜é€šå¸¸ä¼šä¸¢å¤±ã€‚">æµè§ˆå™¨/æ ‡ç­¾é¡µå…³é—­åå¤±æ•ˆ</span>ã€‚é€šå¸¸ç¼“å­˜ä½“ç§¯è¾ƒå°ã€ä½¿ç”¨é¢‘ç¹çš„èµ„æºã€‚
                                </li>
                                <li><strong>ç¡¬ç›˜ç¼“å­˜ (Disk Cache):</strong> å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œå®¹é‡å¤§ï¼ŒæŒä¹…æ€§å¼ºã€‚æµè§ˆå™¨å…³é—­åä¾ç„¶å­˜åœ¨ï¼ˆé™¤éæ‰‹åŠ¨æ¸…é™¤æˆ–è¿‡æœŸï¼‰ã€‚</li>
                                <li><strong>æ¨é€ç¼“å­˜ (Push Cache, HTTP/2):</strong> HTTP/2 æœåŠ¡å™¨æ¨é€çš„èµ„æºä¼šæš‚æ—¶å­˜å‚¨åœ¨è¿™é‡Œã€‚</li>
                                <li><strong>ç½‘ç»œè¯·æ±‚:</strong> å¦‚æœä»¥ä¸Šç¼“å­˜éƒ½æœªå‘½ä¸­ï¼Œåˆ™å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚</li>
                            </ol>
                            <p class="text-xs text-slate-500 mt-2">æ³¨æ„ï¼šä¸Šè¿°é¡ºåºå¹¶éç»å¯¹ï¼Œå…·ä½“å®ç°å¯èƒ½å› æµè§ˆå™¨è€Œå¼‚ï¼Œä½†å¤§ä½“é€»è¾‘å¦‚æ­¤ã€‚</p>
                        </div>

                        <div class="content-card">
                            <h3 id="strong-vs-negotiation" class="font-semibold text-lg text-teal-700 mb-2">âš–ï¸ å¼ºç¼“å­˜ vs
                                åå•†ç¼“å­˜
                                <span class="level-tag level-tag-high">é«˜é¢‘</span>
                                <span class="level-tag level-tag-base">åŸºç¡€</span>
                            </h3>
                            <p class="mb-4 text-slate-600">HTTP ç¼“å­˜ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼šå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ã€‚æµè§ˆå™¨åœ¨è¯·æ±‚èµ„æºæ—¶ï¼Œä¼šå…ˆæ£€æŸ¥å¼ºç¼“å­˜ã€‚</p>
                            <div id="cache-flow-diagram" class="diagram">
                                <h4 class="head4">å›¾ç¤ºï¼šæµè§ˆå™¨ç¼“å­˜å†³ç­–æµç¨‹ (ç®€åŒ–)</h4>
                                <pre class="mermaid">graph TD
    A["è¯·æ±‚èµ„æº"] --> B{"æœ¬åœ°æœ‰ç¼“å­˜å—ï¼Ÿ"}
    B -- "å¦" --> C["å‘æœåŠ¡å™¨è¯·æ±‚èµ„æº"]
    C --> D["æœåŠ¡å™¨è¿”å› 200 OK + èµ„æº + ç¼“å­˜å¤´"]
    D --> E["ç¼“å­˜èµ„æº + ä½¿ç”¨"]
    B -- "æ˜¯" --> F{"ç¼“å­˜æ˜¯å¦æ–°é²œï¼Ÿ(max-age/Expires)"}
    F -- "æ˜¯ (æ–°é²œ)" --> G["ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼ˆå¼ºç¼“å­˜ï¼‰"]
    F -- "å¦ (é™ˆæ—§/éœ€éªŒè¯)" --> H["å‘é€æ¡ä»¶è¯·æ±‚ (If-None-Match/If-Modified-Since)"]
    H --> I{"æœåŠ¡å™¨éªŒè¯èµ„æºæ˜¯å¦å˜æ›´"}
    I -- "å¦ (æœªå˜æ›´)" --> J["æœåŠ¡å™¨è¿”å› 304 Not Modified"]
    J --> K["æ›´æ–°ç¼“å­˜æœ‰æ•ˆæœŸ + ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼ˆåå•†ç¼“å­˜ï¼‰"]
    I -- "æ˜¯ (å·²å˜æ›´)" --> L["æœåŠ¡å™¨è¿”å› 200 OK + æ–°èµ„æº + æ–°ç¼“å­˜å¤´"]
    L --> E
                                </pre>
                            </div>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-4">
                                <li><strong>å¼ºç¼“å­˜ (Strong Cache):</strong> æµè§ˆå™¨ç›´æ¥æ£€æŸ¥æœ¬åœ°ç¼“å­˜çš„<span class="tooltip-trigger"
                                        data-tooltip="ç”± Expires (ç»å¯¹æ—¶é—´) æˆ– Cache-Control: max-age (ç›¸å¯¹æ—¶é—´) å†³å®šã€‚">è¿‡æœŸæ—¶é—´</span>ã€‚å¦‚æœèµ„æºæœªè¿‡æœŸï¼Œåˆ™ç›´æ¥ä½¿ç”¨ç¼“å­˜å‰¯æœ¬ï¼Œ<strong>ä¸å‘æœåŠ¡å™¨å‘é€ä»»ä½•è¯·æ±‚</strong>ã€‚HTTP
                                    çŠ¶æ€ç é€šå¸¸æ˜¯ <code>200 OK (from memory cache / from disk cache)</code>ã€‚</li>
                                <li><strong>åå•†ç¼“å­˜ (Negotiation Cache / Weak Cache):</strong>
                                    å¼ºç¼“å­˜å¤±æ•ˆåï¼ˆæˆ–è¢«è®¾ç½®ä¸ºä¸ä½¿ç”¨å¼ºç¼“å­˜ï¼‰ï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª<span class="tooltip-trigger"
                                        data-tooltip="æºå¸¦ If-Modified-Since æˆ– If-None-Match è¯·æ±‚å¤´ã€‚">æ¡ä»¶è¯·æ±‚</span>ã€‚æœåŠ¡å™¨æ ¹æ®è¿™äº›æ ‡è¯†åˆ¤æ–­èµ„æºæ˜¯å¦æœ‰æ›´æ–°ã€‚
                                    <ul>
                                        <li>å¦‚æœèµ„æº<strong>æœªæ›´æ–°</strong>ï¼ŒæœåŠ¡å™¨è¿”å› <code>304 Not Modified</code> çŠ¶æ€ç ï¼Œå“åº”ä½“ä¸ºç©ºã€‚æµè§ˆå™¨æ”¶åˆ°
                                            304 åï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚</li>
                                        <li>å¦‚æœèµ„æº<strong>å·²æ›´æ–°</strong>ï¼ŒæœåŠ¡å™¨è¿”å› <code>200 OK</code> çŠ¶æ€ç å’Œæ–°çš„èµ„æºå†…å®¹ã€‚æµè§ˆå™¨ä½¿ç”¨æ–°èµ„æºå¹¶æ›´æ–°ç¼“å­˜ã€‚
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                            <p class="mt-4 font-medium text-slate-700"><strong>åˆ¤æ–­æµç¨‹ï¼š</strong>
                                æµè§ˆå™¨å…ˆåˆ¤æ–­å¼ºç¼“å­˜æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœå‘½ä¸­åˆ™ç›´æ¥ä½¿ç”¨ï¼›å¦‚æœå¼ºç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™è¿›è¡Œåå•†ç¼“å­˜åˆ¤æ–­ã€‚</p>
                        </div>

                        <div class="content-card">
                            <h3 id="strong-cache-impl" class="font-semibold text-lg text-teal-700 mb-2">âš¡ å¼ºç¼“å­˜å®ç°: Expires
                                & Cache-Control (max-age)
                                <span class="level-tag level-tag-high">é«˜é¢‘</span>
                                <span class="level-tag level-tag-base">åŸºç¡€</span>
                            </h3>
                            <p class="text-slate-600">æ§åˆ¶å¼ºç¼“å­˜ä¸»è¦é€šè¿‡ä¸¤ä¸ª HTTP å“åº”å¤´å­—æ®µï¼š</p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong><code>Expires</code> (HTTP/1.0):</strong> æŒ‡å®šä¸€ä¸ª<strong>ç»å¯¹çš„è¿‡æœŸæ—¶é—´</strong> (GMT
                                    æ ¼å¼)ã€‚ä¾‹å¦‚ï¼š<code>Expires: Wed, 21 Oct 2025 07:28:00 GMT</code>ã€‚
                                    <br><strong>ç¼ºç‚¹ï¼š</strong> ä¾èµ–äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ—¶é—´åŒæ­¥ã€‚
                                </li>
                                <li><strong><code>Cache-Control: max-age=&lt;seconds&gt;</code> (HTTP/1.1):</strong>
                                    æŒ‡å®šä¸€ä¸ª<strong>ç›¸å¯¹çš„æœ‰æ•ˆæ—¶é•¿</strong> (å•ä½ï¼šç§’)ã€‚ä¾‹å¦‚ï¼š<code>Cache-Control: max-age=3600</code>
                                    è¡¨ç¤ºèµ„æºåœ¨ 1 å°æ—¶å†…æœ‰æ•ˆã€‚
                                    <br><strong>ä¼˜ç‚¹ï¼š</strong> ä¸ä¾èµ–æœ¬åœ°æ—¶é—´ï¼Œæ›´ç²¾ç¡®ã€‚<strong>ä¼˜å…ˆçº§é«˜äº <code>Expires</code></strong>ã€‚
                                </li>
                            </ul>
                            <pre><code class="language-http"># å“åº”å¤´ç¤ºä¾‹: è®¾ç½®å¼ºç¼“å­˜1å°æ—¶
Cache-Control: public, max-age=3600
Expires: Wed, 24 Apr 2025 23:59:59 GMT  # ä½œä¸ºå…¼å®¹</code></pre>
                        </div>

                        <div class="content-card">
                            <h3 id="negotiation-cache-impl" class="font-semibold text-lg text-teal-700 mb-2">ğŸ¤ åå•†ç¼“å­˜å®ç°:
                                Last-Modified & ETag
                                <span class="level-tag level-tag-high">é«˜é¢‘</span>
                                <span class="level-tag level-tag-base">åŸºç¡€</span>
                            </h3>
                            <p class="text-slate-600">åå•†ç¼“å­˜é€šè¿‡ä¸¤å¯¹è¯·æ±‚/å“åº”å¤´å­—æ®µå®ç°ï¼š</p>
                            <ol class="list-decimal list-inside space-y-3 text-sm text-slate-600 mt-2">
                                <li>
                                    <strong>åŸºäºä¿®æ”¹æ—¶é—´ï¼š</strong>
                                    <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                                        <li><strong><code>Last-Modified</code> (å“åº”å¤´):</strong> æœåŠ¡å™¨èµ„æºæœ€åä¿®æ”¹æ—¶é—´ã€‚</li>
                                        <li><strong><code>If-Modified-Since</code> (è¯·æ±‚å¤´):</strong> æµè§ˆå™¨å¸¦ä¸Šä¸Šæ¬¡çš„
                                            <code>Last-Modified</code> å€¼è¯¢é—®ã€‚
                                        </li>
                                        <li><strong>ç¼ºç‚¹ï¼š</strong> ç²¾åº¦åˆ°ç§’ï¼›å†…å®¹æœªå˜ä½†æ—¶é—´å˜äº†ï¼›åˆ†å¸ƒå¼æ—¶é—´åŒæ­¥é—®é¢˜ã€‚</li>
                                    </ul>
                                </li>
                                <li>
                                    <strong>åŸºäºå†…å®¹æ ‡è¯†ï¼š</strong>
                                    <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                                        <li><strong><code>ETag</code> (å“åº”å¤´):</strong> æœåŠ¡å™¨èµ„æºå†…å®¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ (å¦‚ Hash)ã€‚</li>
                                        <li><strong><code>If-None-Match</code> (è¯·æ±‚å¤´):</strong> æµè§ˆå™¨å¸¦ä¸Šä¸Šæ¬¡çš„
                                            <code>ETag</code> å€¼è¯¢é—®ã€‚
                                        </li>
                                        <li><strong>ä¼˜ç‚¹ï¼š</strong> æ›´ç²¾ç¡®å¯é ã€‚<strong>æœåŠ¡å™¨ä¼˜å…ˆéªŒè¯ <code>ETag</code></strong>ã€‚</li>
                                    </ul>
                                </li>
                            </ol>
                            <p class="mt-4 font-medium text-slate-700"><strong>æµç¨‹ï¼š</strong>æµè§ˆå™¨å‘é€æ¡ä»¶è¯·æ±‚ -> æœåŠ¡å™¨æ¯”è¾ƒæ ‡è¯† -> æœªä¿®æ”¹è¿”å›
                                <code>304</code> -> å·²ä¿®æ”¹è¿”å› <code>200</code> + æ–°èµ„æº + æ–°æ ‡è¯†ã€‚
                            </p>
                        </div>
                        <div class="quiz-placeholder" data-section-id="caching"></div>
                    </div>
                </section>

                <section id="cache-control-details" class="content-section fade-in-section">
                    <h2 id="cache-control-title"  class="head2">
                        <span class="material-icons">tune</span>Cache-Control æŒ‡ä»¤è¯¦è§£
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="section-content-wrapper">
                        <div class="content-card">
                            <p class="text-slate-600"><code>Cache-Control</code> å“åº”å¤´å¯ä»¥åŒ…å«å¤šä¸ªæŒ‡ä»¤ï¼Œç”¨äºæ›´ç²¾ç»†åœ°æ§åˆ¶ç¼“å­˜è¡Œä¸ºï¼š</p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong><code>public</code>:</strong> å“åº”å¯è¢«ä»»ä½•<span class="tooltip-trigger"
                                        data-tooltip="å¦‚ CDNã€ä»£ç†æœåŠ¡å™¨ç­‰">ä¸­é—´ç¼“å­˜</span>ç¼“å­˜ã€‚</li>
                                <li><strong><code>private</code>:</strong> å“åº”åªèƒ½è¢«æœ€ç»ˆç”¨æˆ·çš„<span class="tooltip-trigger"
                                        data-tooltip="é€šå¸¸æŒ‡æµè§ˆå™¨ç¼“å­˜">ç§æœ‰ç¼“å­˜</span>ç¼“å­˜ã€‚</li>
                                <li><strong><code>no-cache</code>:</strong> <span
                                        class="font-semibold">å¼ºåˆ¶åå•†ç¼“å­˜</span>ã€‚ä½¿ç”¨ç¼“å­˜å‰å¿…é¡»å‘æœåŠ¡å™¨éªŒè¯ã€‚</li>
                                <li><strong><code>no-store</code>:</strong> <span
                                        class="font-semibold">å®Œå…¨ç¦æ­¢ç¼“å­˜</span>ã€‚ä¸å¾—å­˜å‚¨å“åº”ä»»ä½•éƒ¨åˆ†ã€‚</li>
                                <li><strong><code>max-age=&lt;seconds&gt;</code>:</strong> å¼ºç¼“å­˜æœ‰æ•ˆæ—¶é•¿ (ç›¸å¯¹æ—¶é—´)ã€‚</li>
                                <li><strong><code>s-maxage=&lt;seconds&gt;</code>:</strong> å…±äº«ç¼“å­˜çš„ <code>max-age</code>
                                    (ä¼˜å…ˆçº§æ›´é«˜)ã€‚</li>
                                <li><strong><code>must-revalidate</code>:</strong> ç¼“å­˜è¿‡æœŸå<span
                                        class="font-semibold">å¿…é¡»</span>å‘æºæœåŠ¡å™¨éªŒè¯ï¼Œä¸èƒ½ç”¨æ—§å‰¯æœ¬ã€‚</li>
                                <li><strong><code>proxy-revalidate</code>:</strong> ä»…å¯¹å…±äº«ç¼“å­˜çš„
                                    <code>must-revalidate</code>ã€‚
                                </li>
                                <li><strong><code>immutable</code>:</strong> æç¤ºèµ„æºåœ¨æ–°é²œæœŸå†…<span
                                        class="font-semibold">ä¸ä¼šæ”¹å˜</span>ï¼Œå¯ä¼˜åŒ–éªŒè¯ã€‚</li>
                            </ul>
                            <pre><code class="language-http"># ç¤ºä¾‹1: ç¼“å­˜1å°æ—¶ï¼Œå…¬å…±ç¼“å­˜
Cache-Control: public, max-age=3600

# ç¤ºä¾‹2: å¼ºåˆ¶åå•†ç¼“å­˜
Cache-Control: no-cache

# ç¤ºä¾‹3: å®Œå…¨ç¦æ­¢ç¼“å­˜
Cache-Control: no-store

# ç¤ºä¾‹4: ç§æœ‰ç¼“å­˜1å¤©ï¼Œè¿‡æœŸåå¿…é¡»éªŒè¯
Cache-Control: private, max-age=86400, must-revalidate

# ç¤ºä¾‹5: å¸¦å“ˆå¸Œçš„èµ„æºï¼Œé•¿æœŸç¼“å­˜ä¸”ä¸å¯å˜
Cache-Control: public, max-age=31536000, immutable</code></pre>
                            <p class="mt-4 font-medium text-slate-700"><strong><code>no-cache</code> vs
                                    <code>no-store</code> çš„åŒºåˆ« (é¢è¯•å¸¸é—®):</strong></p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><code>no-cache</code>: ç¼“å­˜è¿˜åœ¨ï¼Œä½†ç”¨å‰å¿…é—®æœåŠ¡å™¨ã€‚</li>
                                <li><code>no-store</code>: å®Œå…¨ä¸ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½é‡æ–°ä¸‹è½½ã€‚</li>
                            </ul>
                        </div>
                        <div class="quiz-placeholder" data-section-id="cache_control"></div>
                    </div>
                </section>

                <section id="cache-busting" class="content-section fade-in-section">
                    <h2 id="cache-busting-title"  class="head2">
                        <span class="material-icons">restart_alt</span>ç¼“å­˜å¤±æ•ˆç­–ç•¥ (Cache Busting)
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-base">åŸºç¡€</span>
                    </h2>
                    <div class="section-content-wrapper">
                        <div class="content-card">
                            <p class="text-slate-600">å½“é™æ€èµ„æºï¼ˆJS, CSS, å›¾ç‰‡ï¼‰æ›´æ–°åï¼Œéœ€è¦ç¡®ä¿ç”¨æˆ·è·å–æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æ—§çš„å¼ºç¼“å­˜ã€‚</p>
                            <p class="text-slate-600"><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>é€šè¿‡æ”¹å˜èµ„æºçš„ URLï¼Œè®©æµè§ˆå™¨è®¤ä¸ºå®ƒæ˜¯æ–°èµ„æºã€‚</p>
                            <p class="text-slate-600"><strong>å¸¸è§æ–¹æ³•ï¼š</strong></p>
                            <ul class="list-disc list-inside space-y-2 text-sm text-slate-600 mt-2">
                                <li><strong>æ–‡ä»¶åå“ˆå¸Œ (Filename Hashing):</strong> (æ¨è) æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆå“ˆå¸Œå€¼åŠ å…¥æ–‡ä»¶å
                                    (<code>bundle.[contenthash].js</code>)ã€‚å†…å®¹å˜ï¼ŒURL å˜ã€‚
                                    <br><strong>ä¼˜ç‚¹ï¼š</strong> ç²¾ç¡®ï¼Œæœ€å¤§åŒ–åˆ©ç”¨ç¼“å­˜ï¼Œæ„å»ºå·¥å…·è‡ªåŠ¨åŒ–ã€‚
                                </li>
                                <li><strong>æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬å· (Query String Versioning):</strong> URL ååŠ ç‰ˆæœ¬å·
                                    (<code>style.css?v=1.1</code>)ã€‚
                                    <br><strong>ç¼ºç‚¹ï¼š</strong> éƒ¨åˆ†ä»£ç†/CDN å¯èƒ½ä¸ç¼“å­˜å¸¦å‚æ•° URLã€‚
                                </li>
                                <li><strong>è·¯å¾„ç‰ˆæœ¬å· (Path Versioning):</strong> ç‰ˆæœ¬å·æ”¾è·¯å¾„ä¸­ (<code>/v1.1/style.css</code>)ã€‚
                                    <br><strong>ç¼ºç‚¹ï¼š</strong> å¯èƒ½éœ€æœåŠ¡å™¨é…ç½®ï¼Œéƒ¨ç½²ç¨å¤æ‚ã€‚
                                </li>
                            </ul>
                            <pre><code class="language-html">&lt;!-- æ–‡ä»¶åå“ˆå¸Œ (æ¨è) --&gt;
&lt;script src="/static/js/app.a1b2c3d4.js"&gt;&lt;/script&gt;

&lt;!-- æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬å· --&gt;
&lt;link rel="stylesheet" href="/css/style.css?v=1.2.0"&gt;

&lt;!-- è·¯å¾„ç‰ˆæœ¬å· --&gt;
&lt;script src="/v1.2/js/script.js"&gt;&lt;/script&gt;</code></pre>
                            <p class="mt-4 font-medium text-slate-700">
                                <strong>æœ€ä½³å®è·µï¼š</strong>å¯¹é™æ€èµ„æºä½¿ç”¨<strong>æ–‡ä»¶åå“ˆå¸Œ</strong> + é•¿æ—¶é—´çš„
                                <code>Cache-Control: public, max-age=31536000, immutable</code>ã€‚
                            </p>
                        </div>
                        <div class="quiz-placeholder" data-section-id="cache_busting"></div>
                    </div>
                </section>

                <section id="http-perf-opt" class="content-section fade-in-section">
                    <h2 id="http-perf-title" class="head2">
                        <span class="material-icons">speed</span>HTTP æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-base">åŸºç¡€</span>
                    </h2>
                    <div class="section-content-wrapper">
                        <p class="mb-4 text-slate-600">ä¼˜åŒ– HTTP æ€§èƒ½æ—¨åœ¨å‡å°‘åŠ è½½æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚ä¸»è¦ä»åè®®ã€è¯·æ±‚æ•°ã€ä½“ç§¯ã€CDNã€è¿æ¥ç­‰æ–¹é¢å…¥æ‰‹ã€‚</p>

                        <div class="content-card">
                            <h3 id="protocol-upgrade" class="font-semibold text-lg text-orange-700 mb-2">ğŸš€ åè®®å‡çº§ (H2/H3)
                            </h3>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>HTTP/1.1 é—®é¢˜:</strong> <span class="tooltip-trigger"
                                        data-tooltip="åŒä¸€ TCP è¿æ¥ä¸Šï¼Œå“åº”å¿…é¡»æŒ‰è¯·æ±‚é¡ºåºè¿”å›ï¼Œæ…¢å“åº”é˜»å¡åç»­ã€‚">åº”ç”¨å±‚é˜Ÿå¤´é˜»å¡</span>ã€æ–‡æœ¬å¤´éƒ¨å†—ä½™ã€å¤šè¿æ¥å¼€é”€ã€‚</li>
                                <li><strong>HTTP/2 æ”¹è¿›:</strong> <span class="tooltip-trigger"
                                        data-tooltip="å• TCP è¿æ¥å¹¶å‘æµï¼Œå¸§å¯äº¤é”™ä¼ è¾“ã€‚">å¤šè·¯å¤ç”¨</span>ã€<span class="tooltip-trigger"
                                        data-tooltip="HPACK ç®—æ³•å‹ç¼©é‡å¤å¤´éƒ¨ã€‚">å¤´éƒ¨å‹ç¼©</span>ã€æœåŠ¡å™¨æ¨é€ (å°‘ç”¨)ã€äºŒè¿›åˆ¶åˆ†å¸§ã€‚</li>
                                <li><strong>HTTP/3 æ”¹è¿›:</strong> åŸºäº <span class="tooltip-trigger"
                                        data-tooltip="åŸºäº UDP çš„ç°ä»£ä¼ è¾“åè®®ã€‚">QUIC</span>ï¼Œå½»åº•è§£å†³<span class="tooltip-trigger"
                                        data-tooltip="QUIC æµç‹¬ç«‹ï¼Œä¸¢åŒ…ä¸å½±å“å…¶ä»–æµã€‚">ä¼ è¾“å±‚é˜Ÿå¤´é˜»å¡</span>ã€<span class="tooltip-trigger"
                                        data-tooltip="ç»“åˆ TLS 1.3ï¼Œé¦–æ¬¡ 1-RTTï¼Œé‡è¿ 0-RTTã€‚">æ›´å¿«è¿æ¥å»ºç«‹</span>ã€<span
                                        class="tooltip-trigger" data-tooltip="åŸºäºè¿æ¥ IDï¼Œåˆ‡æ¢ç½‘ç»œä¸ä¸­æ–­ã€‚">è¿æ¥è¿ç§»</span>ã€å¼ºåˆ¶åŠ å¯†ã€‚</li>
                            </ul>
                            <p class="mt-2 font-medium text-slate-700"><strong>ç­–ç•¥ï¼š</strong>å°½å¯èƒ½å¯ç”¨ HTTP/2 æˆ– HTTP/3ã€‚</p>
                        </div>

                        <div class="content-card">
                            <h3 id="reduce-requests" class="font-semibold text-lg text-orange-700 mb-2">ğŸ“‰ å‡å°‘è¯·æ±‚æ•°</h3>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>åˆå¹¶æ–‡ä»¶ (Bundling):</strong> JS/CSS åˆå¹¶ (æ„å»ºå·¥å…·)ã€‚</li>
                                <li><strong>CSS Sprites (é›ªç¢§å›¾):</strong> å°å›¾æ ‡åˆå¹¶å¤§å›¾ã€‚</li>
                                <li><strong>å†…è”èµ„æº (Inlining):</strong> Data URI (å°å›¾ç‰‡/å­—ä½“)ã€Inline SVG/CSS/JS (è°¨æ…ä½¿ç”¨)ã€‚</li>
                                <li><strong>å­—ä½“å›¾æ ‡ (Icon Fonts):</strong> ç”¨å­—ä½“æ–‡ä»¶å±•ç¤ºå›¾æ ‡ã€‚</li>
                            </ul>
                        </div>

                        <div class="content-card">
                            <h3 id="reduce-size" class="font-semibold text-lg text-orange-700 mb-2">ğŸ“¦ å‡å°èµ„æºä½“ç§¯</h3>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>å‹ç¼© (Compression):</strong> æœåŠ¡å™¨å¯ç”¨ Gzip / Brotliã€‚</li>
                                <li><strong>ç²¾ç®€ä»£ç  (Minification):</strong> JS/CSS/HTML ç§»é™¤ç©ºç™½ã€æ³¨é‡Šã€‚</li>
                                <li><strong>å›¾ç‰‡ä¼˜åŒ–:</strong> åˆé€‚æ ¼å¼ (WebP/AVIF)ã€å‹ç¼©ã€å“åº”å¼å›¾ç‰‡ (<code>srcset</code>)ã€æ‡’åŠ è½½ã€‚</li>
                                <li><strong>Tree Shaking:</strong> ç§»é™¤æœªä½¿ç”¨çš„ JS ä»£ç ã€‚</li>
                                <li><strong>ä»£ç åˆ†å‰² (Code Splitting):</strong> JS åŒ…æ‹†åˆ†ï¼ŒæŒ‰éœ€åŠ è½½ã€‚</li>
                            </ul>
                        </div>

                        <div class="content-card">
                            <h3 id="use-cdn" class="font-semibold text-lg text-orange-700 mb-2">ğŸŒ ä½¿ç”¨ CDN</h3>
                            <p class="text-slate-600"><strong>å†…å®¹åˆ†å‘ç½‘ç»œ (CDN):</strong> å°†é™æ€èµ„æºéƒ¨ç½²åˆ°å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹ã€‚</p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>ä¼˜ç‚¹ï¼š</strong> é™ä½å»¶è¿Ÿ (å°±è¿‘è®¿é—®)ã€æé«˜å¯ç”¨æ€§ (åˆ†æ‹…è´Ÿè½½)ã€å¸¦å®½ä¼˜åŒ–ã€‚</li>
                                <li><strong>ç­–ç•¥ï¼š</strong>å°†é™æ€èµ„æºæ‰˜ç®¡åˆ° CDNã€‚</li>
                            </ul>
                        </div>
                        <div class="quiz-placeholder" data-section-id="http_perf"></div>
                    </div>
                </section>

                <section id="connection-opt" class="content-section fade-in-section">
                    <h2 id="connection-opt-title" class="head2">
                        <span class="material-icons">link</span>è¿æ¥ä¼˜åŒ–
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="section-content-wrapper">
                        <p class="mb-4 text-slate-600">æµè§ˆå™¨å»ºç«‹è¿æ¥éœ€è¦æ—¶é—´ï¼ˆDNS æŸ¥è¯¢ã€TCP æ¡æ‰‹ã€TLS æ¡æ‰‹ï¼‰ã€‚é€šè¿‡é¢„å…ˆæ‰§è¡Œè¿™äº›æ­¥éª¤ï¼Œå¯ä»¥å‡å°‘åç»­èµ„æºè¯·æ±‚çš„å»¶è¿Ÿã€‚</p>
                        <div class="content-card">
                            <p class="text-slate-600">ä½¿ç”¨ <code>&lt;link rel="..."&gt;</code> æ ‡ç­¾æç¤ºæµè§ˆå™¨è¿›è¡Œè¿æ¥ä¼˜åŒ–ï¼š</p>
                            <ul class="list-disc list-inside space-y-3 text-sm text-slate-600 mt-2">
                                <li>
                                    <strong><code>dns-prefetch</code>:</strong> <strong>é¢„è§£æ DNSã€‚</strong> æå‰å¯¹æŒ‡å®šåŸŸåè¿›è¡Œ DNS
                                    æŸ¥è¯¢ã€‚
                                    <pre><code class="language-html">&lt;link rel="dns-prefetch" href="//third-party.com"&gt;</code></pre>
                                </li>
                                <li>
                                    <strong><code>preconnect</code>:</strong> <strong>é¢„è¿æ¥ã€‚</strong> DNS æŸ¥è¯¢ + TCP æ¡æ‰‹ +
                                    TLS æ¡æ‰‹ã€‚ç”¨äºå¾ˆå¿«ä¼šè¯·æ±‚çš„å…³é”®åŸŸåã€‚
                                    <pre><code class="language-html">&lt;link rel="preconnect" href="https://api.example.com" crossorigin&gt;</code></pre>
                                </li>
                                <li>
                                    <strong><code>preload</code>:</strong> <strong>é¢„åŠ è½½<span
                                            class="font-semibold">å½“å‰é¡µå¿…éœ€</span>èµ„æºã€‚</strong> é«˜ä¼˜å…ˆçº§è·å–ï¼Œé˜»å¡
                                    <code>window.onload</code>ã€‚
                                    <pre><code class="language-html">&lt;link rel="preload" href="critical.css" as="style"&gt;
&lt;link rel="preload" href="/fonts/font.woff2" as="font" type="font/woff2" crossorigin&gt;</code></pre>
                                    <p class="text-xs text-slate-500"><code>as</code> å±æ€§å¿…éœ€ï¼ŒæŒ‡å®šèµ„æºç±»å‹ã€‚</p>
                                </li>
                                <li>
                                    <strong><code>prefetch</code>:</strong> <strong>é¢„è·å–<span
                                            class="font-semibold">æœªæ¥å¯¼èˆªå¯èƒ½ç”¨</span>çš„èµ„æºã€‚</strong> ä½ä¼˜å…ˆçº§ï¼Œæµè§ˆå™¨ç©ºé—²æ—¶ä¸‹è½½ã€‚
                                    <pre><code class="language-html">&lt;link rel="prefetch" href="/next-page.js" as="script"&gt;</code></pre>
                                </li>
                            </ul>
                            <p class="mt-4 font-medium text-slate-700"><strong>æ€»ç»“ä¸é€‰æ‹©ï¼š</strong></p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li>ä¸ç¡®å®šé©¬ä¸Šç”¨ï¼š<code>dns-prefetch</code>ã€‚</li>
                                <li>ç¡®å®šå¾ˆå¿«ç”¨ï¼š<code>preconnect</code>ã€‚</li>
                                <li>å½“å‰é¡µå¿…éœ€ï¼š<code>preload</code>ã€‚</li>
                                <li>æœªæ¥å¯¼èˆªç”¨ï¼š<code>prefetch</code>ã€‚</li>
                            </ul>
                            <p class="text-sm text-red-500 mt-2"><strong>æ³¨æ„ï¼š</strong>è¿‡åº¦ä½¿ç”¨ <code>preconnect</code> å’Œ
                                <code>preload</code> å¯èƒ½æµªè´¹èµ„æºæˆ–é˜»å¡æ›´é‡è¦çš„åŠ è½½ã€‚
                            </p>
                        </div>
                        <div class="quiz-placeholder" data-section-id="connection_opt"></div>
                    </div>
                </section>

                <section id="websockets" class="content-section fade-in-section">
                    <h2 id="websockets-title" class="head2">
                        <span class="material-icons">lan</span>WebSockets
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="section-content-wrapper">
                        <div class="content-card">
                            <h3 id="ws-vs-polling" class="font-semibold text-lg text-pink-700 mb-2">ğŸ†š ä¸ HTTP è½®è¯¢å¯¹æ¯”</h3>
                            <p class="text-slate-600">ä¼ ç»Ÿå®æ—¶é€šä¿¡ä¾èµ– HTTP è½®è¯¢ï¼š</p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>çŸ­è½®è¯¢:</strong> å®šæœŸè¯·æ±‚ã€‚ç¼ºç‚¹ï¼šå»¶è¿Ÿé«˜ï¼Œæ— æ•ˆè¯·æ±‚å¤šã€‚</li>
                                <li><strong>é•¿è½®è¯¢:</strong> æœåŠ¡å™¨ hold è¿æ¥ã€‚ç¼ºç‚¹ï¼šä»æœ‰å¼€é”€å’Œå»¶è¿Ÿã€‚</li>
                                <li><strong>SSE (Server-Sent Events):</strong> HTTP å•å‘æ¨é€ (æœåŠ¡å™¨->å®¢æˆ·ç«¯)ã€‚</li>
                            </ul>
                            <p class="mt-2 font-medium text-slate-700"><strong>WebSocket ä¼˜åŠ¿ï¼š</strong></p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><span class="tooltip-trigger" data-tooltip="å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯åœ¨åŒä¸€è¿æ¥ä¸ŠåŒæ—¶åŒå‘å‘é€æ•°æ®ã€‚">å…¨åŒå·¥é€šä¿¡</span>ã€‚
                                </li>
                                <li>ä½å»¶è¿Ÿ (æ—  HTTP å¤´éƒ¨å¼€é”€)ã€‚</li>
                                <li>æŒä¹…è¿æ¥ã€‚</li>
                            </ul>
                        </div>

                        <div class="content-card">
                            <h3 id="ws-mechanism" class="font-semibold text-lg text-pink-700 mb-2">ğŸ¤ å·¥ä½œæœºåˆ¶ (åè®®å‡çº§)</h3>
                            <p class="text-slate-600">åˆ©ç”¨ HTTP å»ºç«‹è¿æ¥ï¼š</p>
                            <ol class="list-decimal list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li>å®¢æˆ·ç«¯å‘ HTTP GET è¯·æ±‚ï¼Œå« <code>Upgrade: websocket</code>,
                                    <code>Connection: Upgrade</code>, <code>Sec-WebSocket-Key</code> ç­‰å¤´ã€‚
                                </li>
                                <li>æœåŠ¡å™¨è‹¥åŒæ„ï¼Œè¿”å› <code>101 Switching Protocols</code>ï¼Œå« <code>Upgrade: websocket</code>,
                                    <code>Connection: Upgrade</code>, <code>Sec-WebSocket-Accept</code> (åŸºäº Key è®¡ç®—)ã€‚
                                </li>
                                <li>æ¡æ‰‹æˆåŠŸï¼ŒTCP è¿æ¥è½¬ä¸º WebSocket æ•°æ®å¸§ä¼ è¾“ã€‚</li>
                            </ol>
                            <pre><code class="language-http"># Client Request (Simplified)
GET /chat HTTP/1.1
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: ...

# Server Response (Simplified)
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: ...</code></pre>
                        </div>

                        <div class="content-card">
                            <h3 id="ws-features-usecases" class="font-semibold text-lg text-pink-700 mb-2">âœ¨ ç‰¹æ€§ä¸åº”ç”¨åœºæ™¯
                            </h3>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>ç‰¹æ€§ï¼š</strong> äº‹ä»¶é©±åŠ¨ (<code>onopen</code>,
                                    <code>onmessage</code>...)ã€æ”¯æŒæ–‡æœ¬/äºŒè¿›åˆ¶å¸§ã€Ping/Pong å¿ƒè·³ã€‚
                                </li>
                                <li><strong>åœºæ™¯ï¼š</strong> å®æ—¶èŠå¤©ã€åä½œç¼–è¾‘ã€å®æ—¶æ•°æ®æ¨é€ (è‚¡ç¥¨ã€æ¯”åˆ†)ã€åœ¨çº¿æ¸¸æˆç­‰ã€‚</li>
                            </ul>
                            <pre><code class="language-javascript">// Frontend WebSocket API Example
const socket = new WebSocket('wss://server.example.com/chat');

socket.onopen = () => { socket.send('Hello!'); };
socket.onmessage = (event) => { console.log('Server:', event.data); };
socket.onclose = (event) => { console.log('Closed:', event.code); };
socket.onerror = (error) => { console.error('Error:', error); };</code></pre>
                        </div>
                        <div class="quiz-placeholder" data-section-id="websockets"></div>
                    </div>
                </section>

                <section id="api-design" class="content-section fade-in-section">
                    <h2 id="api-design-title" class="head2">
                        <span class="material-icons">api</span>API è®¾è®¡é£æ ¼ç®€ä»‹
                        <span class="level-tag level-tag-low">ä½é¢‘</span>
                        <span class="level-tag level-tag-base">åŸºç¡€</span>
                    </h2>
                    <div class="section-content-wrapper">
                        <p class="mb-4 text-slate-600">ä¸åŒçš„ API è®¾è®¡é£æ ¼é€‚ç”¨äºä¸åŒçš„åœºæ™¯å’Œéœ€æ±‚ã€‚</p>
                        <div class="content-card">
                            <h3 id="rest-style"class="head3">REST
                                (Representational State Transfer)</h3>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>æ ¸å¿ƒï¼š</strong> é¢å‘<span class="tooltip-trigger"
                                        data-tooltip="å¦‚ç”¨æˆ·ã€è®¢å•ã€äº§å“ç­‰">èµ„æº</span>ï¼Œé€šè¿‡æ ‡å‡† HTTP æ–¹æ³• (GET/POST/PUT/DELETE) æ“ä½œã€‚</li>
                                <li><strong>ç‰¹ç‚¹ï¼š</strong> æ— çŠ¶æ€ã€URI æ ‡è¯†èµ„æºã€JSON/XML è¡¨ç¤ºã€åˆ©ç”¨ HTTP ç¼“å­˜ã€‚</li>
                                <li><strong>ä¼˜ç¼ºç‚¹ï¼š</strong> ç®€å•æ ‡å‡†åŒ– / å¯èƒ½ Over/Under-fetchingã€‚</li>
                                <li><strong>ç¤ºä¾‹ï¼š</strong> <code>GET /users/123</code>, <code>POST /users</code>ã€‚</li>
                            </ul>
                        </div>
                        <div class="content-card">
                            <h3 id="rpc-style"class="head3">RPC (Remote Procedure
                                Call)</h3>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>æ ¸å¿ƒï¼š</strong> åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹<span class="tooltip-trigger"
                                        data-tooltip="å¦‚ getUserInfo, placeOrder ç­‰">è¿‡ç¨‹/æ–¹æ³•</span>ã€‚å…³æ³¨åŠ¨ä½œã€‚</li>
                                <li><strong>ç‰¹ç‚¹ï¼š</strong> åè®®å¤šæ · (gRPC/JSON-RPC)ã€é€šå¸¸ POST è¯·æ±‚ä½“å«æ–¹æ³•å+å‚æ•°ã€‚</li>
                                <li><strong>ä¼˜ç¼ºç‚¹ï¼š</strong> åŠ¨ä½œç›´è§‚ï¼Œæ€§èƒ½å¯èƒ½é«˜ (gRPC) / é£æ ¼ä¸ç»Ÿä¸€ï¼Œä¸æ˜“ç¼“å­˜ã€‚</li>
                                <li><strong>ç¤ºä¾‹ (JSON-RPC):</strong> <code>{"method": "getUser", "params": [123]}</code>ã€‚
                                </li>
                            </ul>
                        </div>
                        <div class="content-card">
                            <h3 id="graphql-style"class="head3">GraphQL</h3>
                            <ul class="list-disc list-inside space-y-1 text-sm text-slate-600 mt-2">
                                <li><strong>æ ¸å¿ƒï¼š</strong> API <span class="tooltip-trigger"
                                        data-tooltip="å®¢æˆ·ç«¯ç²¾ç¡®æè¿°éœ€è¦çš„æ•°æ®ç»“æ„ã€‚">æŸ¥è¯¢è¯­è¨€</span>ã€‚å®¢æˆ·ç«¯é©±åŠ¨ã€‚</li>
                                <li><strong>ç‰¹ç‚¹ï¼š</strong> å¼ºç±»å‹ Schemaã€å•ä¸€å…¥å£ç‚¹ (<code>/graphql</code>)ã€è§£å†³
                                    Over/Under-fetchingã€‚</li>
                                <li><strong>ä¼˜ç¼ºç‚¹ï¼š</strong> çµæ´»é«˜æ•ˆ / å­¦ä¹ æ›²çº¿ï¼Œç¼“å­˜/æœåŠ¡ç«¯å®ç°å¤æ‚ã€‚</li>
                                <li><strong>ç¤ºä¾‹ (æŸ¥è¯¢):</strong>
                                    <pre><code class="language-graphql">query { user(id:"1") { name posts { title } } }</code></pre>
                                </li>
                            </ul>
                        </div>
                        <div class="quiz-placeholder" data-section-id="api_styles"></div>
                    </div>
                </section>

                <footer class="mt-16 pt-8 border-t border-slate-200 text-center text-slate-500 text-sm">
                    Web æ€§èƒ½ä¸å®è·µ - å­¦ä¹ æŒ‡å—
                </footer>

            </article>
        </main>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        /* script.js content embedded here */
        console.log('Embedded script.js loaded');
        document.addEventListener('DOMContentLoaded', () => {

            const tocContainer = document.getElementById('table-of-contents');
            const mainContent = document.getElementById('main-content');
            const tocAside = document.getElementById('toc-aside');
            const tocToggleBtn = document.getElementById('toc-toggle-btn');
            const sections = mainContent?.querySelectorAll('section[id]');
            const quizPlaceholders = document.querySelectorAll('.quiz-placeholder');
            let activeTocLink = null;
            let tocScrollDebounceTimer;

            // --- Quiz Data ---
            const quizzes = {
                caching: [
                    { question: "å¼ºç¼“å­˜ä¸»è¦ä¾èµ–äºä»¥ä¸‹å“ªäº› HTTP å“åº”å¤´ï¼Ÿ", options: ["ETag å’Œ If-None-Match", "Last-Modified å’Œ If-Modified-Since", "Cache-Control: max-age å’Œ Expires", "Cache-Control: no-cache å’Œ Pragma"], correctAnswer: 2, explanation: "å¼ºç¼“å­˜é€šè¿‡è®¾ç½®èµ„æºçš„æœ‰æ•ˆæœŸæ¥å·¥ä½œã€‚HTTP/1.1 ä½¿ç”¨ `Cache-Control: max-age=<seconds>` (ç›¸å¯¹æ—¶é—´)ï¼ŒHTTP/1.0 ä½¿ç”¨ `Expires` (ç»å¯¹æ—¶é—´)ã€‚ETag å’Œ Last-Modified ç”¨äºåå•†ç¼“å­˜ã€‚" },
                    { question: "å½“æœåŠ¡å™¨è¿”å› 304 Not Modified çŠ¶æ€ç æ—¶ï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ", options: ["èµ„æºå·²æ°¸ä¹…ç§»åŠ¨", "è¯·æ±‚æˆåŠŸï¼Œä½†æ— å†…å®¹è¿”å›", "åå•†ç¼“å­˜å‘½ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„å‰¯æœ¬", "å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨"], correctAnswer: 2, explanation: "304 Not Modified æ˜¯åå•†ç¼“å­˜æˆåŠŸçš„æ ‡å¿—ã€‚æœåŠ¡å™¨é€šè¿‡æ¯”è¾ƒå®¢æˆ·ç«¯å‘é€çš„ `If-None-Match` (ETag) æˆ– `If-Modified-Since` (Last-Modified) å‘ç°èµ„æºæœªæ”¹å˜ï¼Œå‘ŠçŸ¥æµè§ˆå™¨å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œæ— éœ€é‡æ–°ä¸‹è½½èµ„æºä½“ã€‚" }
                ],
                cache_control: [
                    { question: "Cache-Control: no-cache æŒ‡ä»¤çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ", options: ["å®Œå…¨ç¦æ­¢æµè§ˆå™¨ç¼“å­˜è¯¥èµ„æº", "å…è®¸ç¼“å­˜ï¼Œä½†æ¯æ¬¡ä½¿ç”¨å‰å¿…é¡»å‘æœåŠ¡å™¨éªŒè¯å…¶æœ‰æ•ˆæ€§", "åªå…è®¸ç§æœ‰ç¼“å­˜ï¼ˆæµè§ˆå™¨ï¼‰ç¼“å­˜", "è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸º 0 ç§’"], correctAnswer: 1, explanation: "`no-cache` å¹¶ä¸æ„å‘³ç€ä¸ç¼“å­˜ï¼Œè€Œæ˜¯æŒ‡ç¤ºç¼“å­˜å‰¯æœ¬åœ¨ä½¿ç”¨å‰å¿…é¡»å…ˆä¸æœåŠ¡å™¨ç¡®è®¤ï¼ˆé‡æ–°éªŒè¯ï¼‰ï¼Œå³å¼ºåˆ¶è¿›è¡Œåå•†ç¼“å­˜ã€‚å¦‚æœæƒ³å®Œå…¨ç¦æ­¢ç¼“å­˜ï¼Œåº”ä½¿ç”¨ `no-store`ã€‚" }
                ],
                cache_busting: [
                    { question: "å“ªç§ç¼“å­˜å¤±æ•ˆç­–ç•¥é€šå¸¸è¢«è®¤ä¸ºæ˜¯æœ€ä½³å®è·µï¼Œå°¤å…¶é€‚ç”¨äºæ„å»ºå·¥å…·è‡ªåŠ¨åŒ–çš„åœºæ™¯ï¼Ÿ", options: ["æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬å· (e.g., style.css?v=1.1)", "è·¯å¾„ç‰ˆæœ¬å· (e.g., /v1.1/style.css)", "æ–‡ä»¶åå“ˆå¸Œ (e.g., bundle.[contenthash].js)", "è®¾ç½® Cache-Control: no-store"], correctAnswer: 2, explanation: "æ–‡ä»¶åå“ˆå¸Œï¼ˆé€šå¸¸åŸºäºæ–‡ä»¶å†…å®¹ç”Ÿæˆï¼‰æ˜¯æœ€ç²¾ç¡®çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥ã€‚åªæœ‰å½“æ–‡ä»¶å†…å®¹å®é™…æ”¹å˜æ—¶ï¼Œæ–‡ä»¶åï¼ˆURLï¼‰æ‰ä¼šæ”¹å˜ï¼Œä»è€Œç¡®ä¿æµè§ˆå™¨è¯·æ±‚æ–°ç‰ˆæœ¬ï¼ŒåŒæ—¶æœ€å¤§åŒ–åˆ©ç”¨æœªæ”¹å˜èµ„æºçš„ç¼“å­˜ã€‚æ„å»ºå·¥å…·å¯ä»¥è½»æ¾å®ç°è‡ªåŠ¨åŒ–ã€‚" }
                ],
                http_perf: [
                    { question: "HTTP/2 ç›¸æ¯” HTTP/1.1 çš„ä¸»è¦æ€§èƒ½ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ", options: ["å¼ºåˆ¶ä½¿ç”¨ UDP åè®®", "é€šè¿‡å¤šè·¯å¤ç”¨æ¶ˆé™¤äº†åº”ç”¨å±‚é˜Ÿå¤´é˜»å¡", "å®Œå…¨æ¶ˆé™¤äº†æ‰€æœ‰ç±»å‹çš„é˜Ÿå¤´é˜»å¡", "å¼•å…¥äº†æ›´å¼ºå¤§çš„ç¼“å­˜æ§åˆ¶æŒ‡ä»¤"], correctAnswer: 1, explanation: "HTTP/2 æœ€å¤§çš„æ”¹è¿›ä¹‹ä¸€æ˜¯å¼•å…¥äº†å¤šè·¯å¤ç”¨ï¼Œå…è®¸åœ¨å•ä¸ª TCP è¿æ¥ä¸Šå¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚/å“åº”æµï¼Œè§£å†³äº† HTTP/1.1 ä¸­å› å“åº”å¿…é¡»æŒ‰åºè¿”å›è€Œé€ æˆçš„åº”ç”¨å±‚é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚ä½†å®ƒä»ç„¶è¿è¡Œåœ¨ TCP ä¸Šï¼Œä¼šå— TCP é˜Ÿå¤´é˜»å¡çš„å½±å“ã€‚" }
                ],
                connection_opt: [
                    { question: "ä½¿ç”¨ `<link rel=\"preconnect\" href=\"...\">` çš„ä¸»è¦ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ", options: ["ä»…é¢„å…ˆè§£ææŒ‡å®šåŸŸåçš„ DNS", "é¢„å…ˆä¸‹è½½æŒ‡å®šèµ„æºåˆ°ç¼“å­˜", "é¢„å…ˆå®Œæˆ DNS è§£æã€TCP æ¡æ‰‹å’Œ TLS æ¡æ‰‹", "å¼ºåˆ¶æµè§ˆå™¨ä½¿ç”¨ HTTP/3 è¿æ¥"], correctAnswer: 2, explanation: "`preconnect` æŒ‡ä»¤æç¤ºæµè§ˆå™¨ï¼Œç”¨æˆ·å¾ˆå¯èƒ½ä¼šè®¿é—®æŒ‡å®šæ¥æºï¼Œå¹¶å»ºè®®æµè§ˆå™¨é¢„å…ˆå»ºç«‹è¿æ¥ã€‚è¿™åŒ…æ‹¬ DNS æŸ¥è¯¢ã€TCP æ¡æ‰‹ä»¥åŠ TLS åå•†ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ï¼Œä»è€Œå‡å°‘åç»­å®é™…è¯·æ±‚æ—¶çš„è¿æ¥å»ºç«‹å»¶è¿Ÿã€‚" }
                ],
                websockets: [
                    { question: "WebSocket åè®®ä¸ä¼ ç»Ÿçš„ HTTP é•¿è½®è¯¢ç›¸æ¯”ï¼Œæœ€æ ¸å¿ƒçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ", options: ["WebSocket ä½¿ç”¨ UDPï¼Œé•¿è½®è¯¢ä½¿ç”¨ TCP", "WebSocket æ”¯æŒæœåŠ¡å™¨æ¨é€ï¼Œé•¿è½®è¯¢ä¸æ”¯æŒ", "WebSocket æä¾›çœŸæ­£çš„å…¨åŒå·¥ã€ä½å¼€é”€çš„æŒä¹…è¿æ¥", "WebSocket åªèƒ½ä¼ è¾“æ–‡æœ¬æ•°æ®"], correctAnswer: 2, explanation: "WebSocket é€šè¿‡ä¸€æ¬¡ HTTP æ¡æ‰‹å‡çº§åè®®åï¼Œå»ºç«‹çš„æ˜¯ä¸€ä¸ªçœŸæ­£çš„å…¨åŒå·¥ TCP è¿æ¥ï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éšæ—¶åŒå‘å‘é€æ•°æ®ï¼Œä¸”åç»­æ•°æ®å¸§å¼€é”€å¾ˆå°ã€‚é•¿è½®è¯¢æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç³»åˆ— HTTP è¯·æ±‚-å“åº”ï¼Œå­˜åœ¨è¿æ¥å»ºç«‹/ä¿æŒå’Œå¤´éƒ¨çš„å¼€é”€ã€‚" }
                ],
                api_styles: [
                    { question: "GraphQL ä¸»è¦è§£å†³äº† REST API ä¸­çš„ä»€ä¹ˆé—®é¢˜ï¼Ÿ", options: ["ç¼ºä¹å®‰å…¨æ€§", "ä¸æ”¯æŒç¼“å­˜", "æ•°æ®å†—ä½™ (Over-fetching) å’Œæ•°æ®ä¸è¶³ (Under-fetching)", "åªèƒ½ä½¿ç”¨ JSON æ ¼å¼"], correctAnswer: 2, explanation: "GraphQL å…è®¸å®¢æˆ·ç«¯åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ç²¾ç¡®æŒ‡å®šéœ€è¦å“ªäº›æ•°æ®ä»¥åŠæ•°æ®çš„ç»“æ„ï¼ŒæœåŠ¡å™¨åªè¿”å›æ‰€éœ€çš„æ•°æ®ã€‚è¿™é¿å…äº† REST API ä¸­å¸¸è§çš„ Over-fetchingï¼ˆè¿”å›è¿‡å¤šä¸éœ€è¦çš„æ•°æ®ï¼‰å’Œ Under-fetchingï¼ˆéœ€è¦å¤šæ¬¡è¯·æ±‚æ‰èƒ½è·å–æ‰€æœ‰æ•°æ®ï¼‰çš„é—®é¢˜ã€‚" }
                ]
            };

            // --- Initialization Functions ---
            function initTOC() {
                if (!tocContainer || !mainContent || !sections || sections.length === 0) {
                    console.warn("TOC elements missing."); return;
                }
                const navElement = tocContainer.querySelector('nav') || tocContainer;
                const existingList = navElement.querySelector('ul'); // Find existing list if any
                if (existingList) {
                    existingList.innerHTML = ''; // Clear only the list items
                } else {
                    navElement.innerHTML = ''; // Clear everything if no list found
                    // Add title back
                    const tocTitle = document.createElement('h4'); // Use h4 like global.css
                    tocTitle.className = 'head4 px-6 mb-3'; // Use head4 class
                    tocTitle.textContent = 'Web æ€§èƒ½ä¸å®è·µ';
                    navElement.appendChild(tocTitle);
                }

                const tocList = existingList || document.createElement('ul'); // Reuse or create UL
                if (!existingList) {
                    tocList.className = 'space-y-1'; // Add spacing if new list
                    navElement.appendChild(tocList);
                }

                const headings = mainContent.querySelectorAll('section[id] > h2[id]');

                headings.forEach(heading => {
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    // Use classes from global.css for TOC links
                    // link.className = 'flex items-center gap-2 px-6 py-2 text-sm rounded-md text-slate-500 hover:bg-slate-100 hover:text-slate-800';
                    link.href = `#${heading.id}`;
                    link.dataset.targetId = heading.id;

                    const iconElement = heading.querySelector('.material-icons');
                    const iconName = iconElement ? iconElement.textContent.trim() : 'article';
                    const iconSpan = document.createElement('span');
                    iconSpan.className = 'material-icons nav-icon'; // Class from global.css
                    iconSpan.textContent = iconName;
                    link.appendChild(iconSpan);

                    const headingText = heading.textContent.replace(iconName, '').trim();
                    link.appendChild(document.createTextNode(headingText));

                    link.addEventListener('click', (e) => {
                        if (window.innerWidth < 1024 && tocAside?.classList.contains('open')) {
                            tocAside.classList.remove('open');
                            tocToggleBtn?.querySelector('i')?.classList.replace('fa-times', 'fa-bars');
                        }
                    });

                    listItem.appendChild(link);
                    tocList.appendChild(listItem);
                });

                window.addEventListener('scroll', handleTocScrollHighlight);
                handleTocScrollHighlight();
            }

            function handleTocScrollHighlight() {
                clearTimeout(tocScrollDebounceTimer);
                tocScrollDebounceTimer = setTimeout(() => {
                    if (!sections || sections.length === 0 || !tocContainer) return;
                    let currentSectionId = null;
                    const scrollPosition = window.scrollY;
                    const offset = window.innerHeight * 0.3;

                    sections.forEach(section => {
                        const headerHeight = 0;
                        const sectionTop = section.offsetTop - headerHeight - 10;
                        if (scrollPosition >= sectionTop - offset) {
                            const h2 = section.querySelector('h2[id]');
                            if (h2) currentSectionId = h2.id;
                        }
                    });

                    const navLinks = tocContainer.querySelectorAll('nav a');
                    let foundActive = false;
                    navLinks.forEach(link => {
                        link.classList.remove('active'); // Use class from global.css
                        if (link.dataset.targetId === currentSectionId) {
                            link.classList.add('active');
                            activeTocLink = link;
                            foundActive = true;
                        }
                    });

                    // If no section is active (scrolled to top), activate the first link
                    if (!foundActive && navLinks.length > 0) {
                        navLinks[0].classList.add('active');
                        activeTocLink = navLinks[0];
                    }

                }, 50);
            }

            function initTocToggle() {
                if (!tocToggleBtn || !tocAside) {
                    console.warn("TOC toggle elements missing."); return;
                }
                tocToggleBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const icon = tocToggleBtn.querySelector('i');
                    tocAside.classList.toggle('open'); // Class defined in style.css for mobile overlay
                    if (tocAside.classList.contains('open')) {
                        icon?.classList.replace('fa-bars', 'fa-times');
                    } else {
                        icon?.classList.replace('fa-times', 'fa-bars');
                    }
                });
                document.addEventListener('click', (event) => {
                    if (window.innerWidth < 1024 && tocAside?.classList.contains('open')) {
                        const isClickInsideToc = tocAside.contains(event.target);
                        const isClickOnToggleBtn = tocToggleBtn.contains(event.target);
                        if (!isClickInsideToc && !isClickOnToggleBtn) {
                            tocAside.classList.remove('open');
                            tocToggleBtn.querySelector('i')?.classList.replace('fa-times', 'fa-bars');
                        }
                    }
                });
            }

            function initFadeInSection() {
                if (!('IntersectionObserver' in window)) {
                    console.warn("Intersection Observer not supported.");
                    document.querySelectorAll('.fade-in-section').forEach(el => el.classList.add('is-visible'));
                    return;
                }
                const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
                const sectionsToFade = document.querySelectorAll('.fade-in-section');
                const observerCallback = (entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('is-visible'); // Class from style.css
                            observer.unobserve(entry.target);
                        }
                    });
                };
                const observer = new IntersectionObserver(observerCallback, observerOptions);
                sectionsToFade.forEach(el => observer.observe(el));
            }

            function initMermaid() {
                if (typeof mermaid !== 'undefined' && mermaid?.initialize) {
                    try {
                        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });
                        mermaid.run({ nodes: document.querySelectorAll('.mermaid') })
                            .catch(err => console.error('Mermaid rendering error:', err));
                    } catch (error) {
                        console.error('Error initializing or running Mermaid:', error);
                    }
                } else {
                    console.warn('Mermaid library not found.');
                }
            }

            function initQuizzes() {
                if (!quizPlaceholders || quizPlaceholders.length === 0) return;
                quizPlaceholders.forEach(placeholder => {
                    const sectionId = placeholder.dataset.sectionId;
                    const sectionQuizzes = quizzes[sectionId];
                    if (sectionQuizzes && sectionQuizzes.length > 0) {
                        renderQuiz(placeholder, sectionId, sectionQuizzes);
                    } else {
                        placeholder.remove();
                    }
                });
            }

            function renderQuiz(container, sectionId, quizData) {
                const quizContainer = document.createElement('div');
                quizContainer.className = 'section-quiz-container'; // Use refined class
                const sectionH2 = document.getElementById(`${sectionId}-title`);
                const sectionColor = sectionH2 ? sectionH2.style.borderLeftColor : 'var(--sky-500)';
                quizContainer.style.borderLeftColor = sectionColor || 'var(--sky-500)';

                const title = document.createElement('h4');
                title.className = 'quiz-card-title'; // Use refined class
                title.innerHTML = `<i class="fas fa-question-circle" style="color: ${sectionColor || 'var(--sky-500)'};"></i> ç« èŠ‚æµ‹éªŒï¼šå·©å›ºçŸ¥è¯†`;
                quizContainer.appendChild(title);

                quizData.forEach((quizItem, index) => {
                    const quizCard = document.createElement('div');
                    quizCard.className = 'quiz-card'; // Use refined class
                    quizCard.dataset.quizIndex = index;

                    const questionText = document.createElement('p');
                    questionText.textContent = `${index + 1}. ${quizItem.question}`;
                    quizCard.appendChild(questionText);

                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'quiz-options'; // Use refined class

                    quizItem.options.forEach((option, optionIndex) => {
                        const label = document.createElement('label'); // Label itself is the container now
                        const input = document.createElement('input');
                        input.type = 'radio';
                        input.name = `quiz-${sectionId}-${index}`;
                        input.value = optionIndex;
                        input.dataset.correct = (optionIndex === quizItem.correctAnswer);
                        const span = document.createElement('span');
                        span.textContent = option;
                        label.appendChild(input);
                        label.appendChild(span);
                        optionsDiv.appendChild(label);
                        input.addEventListener('change', handleQuizAnswer);
                    });

                    quizCard.appendChild(optionsDiv);
                    const feedbackDiv = document.createElement('div');
                    feedbackDiv.className = 'quiz-feedback'; // Use refined class
                    quizCard.appendChild(feedbackDiv);
                    quizContainer.appendChild(quizCard);
                });
                container.replaceWith(quizContainer);
            }

            function handleQuizAnswer(event) {
                const selectedInput = event.target;
                const quizCard = selectedInput.closest('.quiz-card');
                if (!quizCard) return;
                const feedbackDiv = quizCard.querySelector('.quiz-feedback');
                const optionsDiv = quizCard.querySelector('.quiz-options');
                if (!feedbackDiv || !optionsDiv) return;

                const allLabels = optionsDiv.querySelectorAll('label'); // Target labels for styling
                const nameParts = selectedInput.name.split('-');
                if (nameParts.length < 3) return;
                const sectionId = nameParts[1];
                const questionIndex = parseInt(nameParts[2], 10);
                if (isNaN(questionIndex) || !quizzes[sectionId] || !quizzes[sectionId][questionIndex]) {
                    console.error("Could not find quiz data for", sectionId, questionIndex);
                    return;
                }
                const quizItem = quizzes[sectionId][questionIndex];

                feedbackDiv.className = 'quiz-feedback'; // Reset classes
                feedbackDiv.innerHTML = '';
                const isCorrect = selectedInput.dataset.correct === 'true';

                if (isCorrect) {
                    feedbackDiv.classList.add('feedback-correct');
                    feedbackDiv.innerHTML = `<strong>å›ç­”æ­£ç¡®ï¼</strong><div class="feedback-explanation">${quizItem.explanation}</div>`;
                } else {
                    feedbackDiv.classList.add('feedback-incorrect');
                    const correctOptionText = quizItem.options[quizItem.correctAnswer];
                    feedbackDiv.innerHTML = `<strong>å›ç­”é”™è¯¯ã€‚</strong> æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š<strong>${correctOptionText}</strong><div class="feedback-explanation">${quizItem.explanation}</div>`;
                }
                feedbackDiv.style.display = 'block';

                // Disable all inputs and style labels
                allLabels.forEach(label => {
                    const input = label.querySelector('input[type="radio"]');
                    if (input) {
                        input.disabled = true;
                        label.classList.add('disabled');
                        if (input.dataset.correct === 'true') {
                            label.classList.add('correct-answer'); // Add class for correct answer styling
                        } else if (input === selectedInput) {
                            label.classList.add('incorrect-selection'); // Add class for incorrect selection styling
                        }
                    }
                });
            }

            // --- Execute Initialization Functions ---
            if (tocContainer && mainContent && sections) initTOC();
            else console.error("TOC elements missing.");

            if (tocToggleBtn && tocAside) initTocToggle();
            else console.error("TOC toggle elements missing.");

            initFadeInSection();
            initMermaid();
            if (quizPlaceholders.length > 0) initQuizzes();

        }); // End DOMContentLoaded
    </script>

</body>

</html>