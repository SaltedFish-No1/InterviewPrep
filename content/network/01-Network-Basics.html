<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç»œåŸºç¡€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../../global.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <style>
        /* Minimal inline styles - Primarily rely on global.css and Tailwind */

        /* --- Base & Layout Adjustments --- */
        html {
            scroll-padding-top: 6rem;
            /* Adjust based on sticky nav height */
        }

        body {
            /* Base font, bg, color assumed from global.css */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: #f8fafc;
            /* Light gray background */
        }

        /* --- Typography --- */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            scroll-margin-top: 6rem;
            /* Offset for sticky nav */
        }

        h2 {
            border-bottom: 1px solid var(--border-color-light);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            /* Consistent spacing */
        }

        h3 {
            margin-top: 0;
            /* Reset top margin as card handles spacing */
            margin-bottom: 1rem;
            color: var(--primary-color-dark);
            /* Use a distinct color for card titles */
            font-size: 1.25rem;
            /* Ensure size consistency */
        }

        h4 {
            /* Sub-heading for visualizations or inner sections */
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-color-dark);
        }

        h5 {
            /* Smaller sub-heading */
            font-size: 1rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-color-default);
        }


        /* Style for frequency/level tags */
        .level-tag {
            display: inline-block;
            margin-left: 0.5rem;
            font-size: 0.75rem;
            /* text-xs */
            font-weight: 500;
            /* font-medium */
            padding: 0.1rem 0.5rem;
            border-radius: 0.25rem;
            /* rounded-sm */
            vertical-align: middle;
            border: 1px solid transparent;
        }

        .level-tag-high {
            background-color: var(--danger-color-light);
            color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .level-tag-medium {
            background-color: var(--warning-color-light);
            color: var(--warning-color);
            border-color: var(--warning-color);
        }

        .level-tag-low {
            background-color: var(--secondary-color-light);
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .level-tag-base {
            background-color: var(--bg-color-lighter);
            color: var(--text-color-light);
            border-color: var(--border-color-default);
        }

        .level-tag-advanced {
            background-color: var(--primary-color-light);
            color: var(--primary-color-dark);
            border-color: var(--primary-color);
        }

        /* --- Fade-in Animation --- */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-section {
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* --- Content Card Adjustments --- */
        .content-card {
            margin-bottom: 1.5rem;
            /* Ensure spacing between cards */
        }

        .content-card:last-child {
            margin-bottom: 0;
        }

        .content-section>.content-card+.content-card {
            margin-top: 1.5rem;
            /* Space between cards within the same section */
        }

        /* --- List Styling within Content --- */
        article ul {
            list-style: disc;
            padding-left: 1.5em;
            margin-bottom: 1em;
        }

        article ol {
            list-style: decimal;
            padding-left: 1.5em;
            margin-bottom: 1em;
        }

        article li {
            margin-bottom: 0.5em;
        }

        article ul ul,
        article ol ol,
        article ul ol,
        article ol ul {
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }

        /* --- Code Block Styling --- */
        pre code {
            display: block;
            padding: 1rem;
            background-color: #1a202c;
            /* Darker background */
            color: #e2e8f0;
            /* Lighter text */
            border-radius: 8px;
            font-family: 'Roboto Mono', monospace;
            /* Use mono font */
            font-size: 0.875em;
            overflow-x: auto;
            position: relative;
            border: 1px solid #2d3748;
        }

        /* Inline code */
        *:not(pre)>code {
            background-color: rgba(17, 24, 39, 0.05);
            /* Light gray background */
            color: #DC2626;
            /* Reddish text color */
            padding: 0.1em 0.3em;
            border-radius: 0.25rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9em;
            /* Slightly smaller */
        }

        /* --- Table Styling --- */
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1rem;
        }

        th,
        td {
            border: 1px solid var(--border-color-default);
            padding: 0.5rem 0.75rem;
            text-align: left;
        }

        th {
            background-color: var(--bg-color-lighter);
            font-weight: 600;
        }

        tbody tr:nth-child(odd) {
            background-color: var(--bg-color-light);
        }

        tbody tr:hover {
            background-color: #eff6ff;
        }

        /* blue-50 */

        /* --- Mermaid Diagram Styling --- */
        .mermaid {
            transition: opacity 0.5s ease-in-out;
            margin: 1.5rem 0;
            text-align: center;
            background-color: var(--bg-color-light);
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid var(--border-color-light);
        }

        .mermaid svg {
            max-width: 100%;
            height: auto;
            display: block;
            margin: auto;
        }

        /* --- Interactive Handshake/Wave Steps --- */
        .interactive-step {
            opacity: 0.4;
            transition: opacity 0.5s ease-in-out, transform 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            padding: 0.75rem;
            border-left: 4px solid transparent;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            background-color: #f8fafc;
            /* Default background */
        }

        .interactive-step.active {
            opacity: 1;
            border-left-color: #4299e1;
            /* Blue */
            background-color: #ebf8ff;
            transform: scale(1.02);
        }

        .interactive-step code {
            background-color: rgba(219, 234, 254, 0.8);
            /* Light blue background for code */
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 0.85em;
            border: 1px solid #bfdbfe;
        }

        .interactive-step.active code {
            background-color: rgba(255, 255, 255, 0.8);
        }

        /* --- State Tags (Copied from ä¼ è¾“å±‚.html) --- */
        .state-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 8px;
            border: 1px solid;
        }

        .state-closed {
            background-color: #e2e8f0;
            color: #4a5568;
            border-color: #cbd5e0;
        }

        .state-listen {
            background-color: #f0f9ff;
            color: #075985;
            border-color: #bae6fd;
        }

        /* Added Listen */
        .state-syn-sent {
            background-color: #fffbeb;
            color: #b45309;
            border-color: #fcd34d;
        }

        .state-syn-rcvd {
            background-color: #fef3c7;
            color: #92400e;
            border-color: #fde68a;
        }

        .state-established {
            background-color: #dcfce7;
            color: #166534;
            border-color: #86efac;
        }

        .state-fin-wait-1 {
            background-color: #ffedd5;
            color: #9a3412;
            border-color: #fed7aa;
        }

        .state-fin-wait-2 {
            background-color: #fee2e2;
            color: #991b1b;
            border-color: #fecaca;
        }

        .state-close-wait {
            background-color: #f3e8ff;
            color: #6b21a8;
            border-color: #e9d5ff;
        }

        .state-last-ack {
            background-color: #fae8ff;
            color: #86198f;
            border-color: #f5d0fe;
        }

        .state-time-wait {
            background-color: #e0e7ff;
            color: #3730a3;
            border-color: #c7d2fe;
        }

        /* --- Header Field Visualization (Copied from ä¼ è¾“å±‚.html) --- */
        .header-field {
            transition: background-color 0.2s ease;
        }

        .header-info-display {
            margin-top: 10px;
            font-size: 0.9em;
            background-color: #f7fafc;
            padding: 10px;
            border-radius: 4px;
            border: 1px dashed #cbd5e0;
            min-height: 40px;
            transition: background-color 0.3s ease;
        }

        .header-info-display:empty {
            background-color: transparent;
            border-style: solid;
        }

        /* --- TCP Reliability Simulation (Copied & Prefixed from ä¼ è¾“å±‚.html) --- */
        .tcpRelSim_packet,
        .tcpRelSim_ack {
            transition: all 2.8s ease-in-out, background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
            position: absolute;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem;
            border-radius: 0.25rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-size: 0.7rem;
            font-weight: 500;
            min-width: 40px;
            height: 24px;
        }

        .tcpRelSim_packet {
            border: 1px solid #60a5fa;
            background-color: #dbeafe;
            color: #1e40af;
        }

        .tcpRelSim_ack {
            border: 1px solid #34d399;
            background-color: #d1fae5;
            color: #065f46;
        }

        .tcpRelSim_packet-losing {
            border-color: #ef4444 !important;
            background-color: #fee2e2 !important;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .tcpRelSim_packet-lost {
            opacity: 0;
            transform: scale(0.5) !important;
            transition: all 0.8s ease-in !important;
        }

        .tcpRelSim_packet-arrived-cue {
            border-color: #10b981 !important;
            transform: scale(1.1);
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
        }

        .tcpRelSim_packet-buffered {
            background-color: #fde68a;
            border-color: #facc15;
            transform: scale(0.9);
            position: static !important;
            margin: 1px;
        }

        .tcpRelSim_packet-delivered {
            background-color: #dcfce7;
            border-color: #22c55e;
            position: static !important;
            margin: 1px;
        }

        .tcpRelSim_packet-retransmitted {
            border-style: dashed;
            border-color: #f87171;
            background-color: #fef2f2;
        }

        .tcpRelSim_highlight-window {
            border: 2px solid #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
            transition: all 0.5s ease-in-out;
        }

        .tcpRelSim_buffer-slot {
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tcpRelSim_app-layer-area {
            min-height: 50px;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            justify-content: center;
            align-items: center;
        }

        .tcpRelSim_status-text {
            min-height: 1.5em;
            transition: opacity 0.5s ease-in-out;
        }

        .tcpRelSim_rto-timer {
            font-size: 0.7rem;
            color: #6b7280;
            display: inline-block;
            margin-left: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tcpRelSim_rto-timer.active {
            opacity: 1;
        }

        .tcpRelSim_rto-timer.expired {
            color: #ef4444;
            font-weight: bold;
            opacity: 1;
        }

        #tcpRelSim_network-path {
            position: absolute;
            bottom: 48%;
            left: 7%;
            width: 86%;
            height: 2px;
            background-image: linear-gradient(to right, #9ca3af 50%, transparent 50%);
            background-size: 10px 2px;
            z-index: 1;
        }

        /* --- TCP Flow Control Simulation (Copied & Prefixed from ä¼ è¾“å±‚.html) --- */
        .tcpFlowSim_packet {
            width: 30px;
            height: 30px;
            border: 1px solid #9CA3AF;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 0.25rem;
            margin: 2px;
            transition: background-color 0.5s ease-in-out, border-color 0.5s ease-in-out, opacity 0.5s ease-in-out;
            position: absolute;
            background-color: #E5E7EB;
            color: #374151;
        }

        .tcpFlowSim_packet.tcpFlowSim_sent {
            background-color: #BFDBFE;
            border-color: #93C5FD;
        }

        .tcpFlowSim_packet.tcpFlowSim_acked {
            background-color: #A7F3D0;
            border-color: #6EE7B7;
        }

        .tcpFlowSim_packet.tcpFlowSim_received {
            background-color: #FDE68A;
            border-color: #FCD34D;
        }

        .tcpFlowSim_packet.tcpFlowSim_buffered {
            background-color: #FBCFE8;
            border-color: #F9A8D4;
        }

        .tcpFlowSim_buffer {
            display: flex;
            flex-wrap: wrap;
            border: 2px dashed #D1D5DB;
            padding: 5px;
            min-height: 50px;
            position: relative;
            background-color: #F9FAFB;
            border-radius: 0.375rem;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .tcpFlowSim_window-segment {
            position: absolute;
            border: 2px solid;
            pointer-events: none;
            box-sizing: border-box;
            border-radius: 0.25rem;
            opacity: 0.8;
            transition: all 0.3s ease-in-out;
        }

        .tcpFlowSim_send-window-segment {
            border-color: #3B82F6;
            background-color: rgba(59, 130, 246, 0.15);
        }

        .tcpFlowSim_recv-window-segment {
            border-color: #F59E0B;
            background-color: rgba(245, 158, 11, 0.15);
        }

        .tcpFlowSim_control-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            transition: background-color 0.2s;
            cursor: pointer;
            margin: 0 0.25rem;
            border: 1px solid transparent;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tcpFlowSim_control-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tcpFlowSim_control-button.tcpFlowSim_send {
            background-color: #3B82F6;
            color: white;
            border-color: #2563EB;
        }

        .tcpFlowSim_control-button.tcpFlowSim_send:hover:not(:disabled) {
            background-color: #2563EB;
        }

        .tcpFlowSim_control-button.tcpFlowSim_process {
            background-color: #10B981;
            color: white;
            border-color: #059669;
        }

        .tcpFlowSim_control-button.tcpFlowSim_process:hover:not(:disabled) {
            background-color: #059669;
        }

        .tcpFlowSim_control-button.tcpFlowSim_reset {
            background-color: #6B7280;
            color: white;
            border-color: #4B5563;
        }

        .tcpFlowSim_control-button.tcpFlowSim_reset:hover:not(:disabled) {
            background-color: #4B5563;
        }

        .tcpFlowSim_arrow {
            position: absolute;
            width: auto;
            height: auto;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 1.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 3px;
            z-index: 5;
            color: white;
            white-space: nowrap;
            min-width: 40px;
        }

        .tcpFlowSim_arrow.tcpFlowSim_data {
            background-color: #60A5FA;
        }

        .tcpFlowSim_arrow.tcpFlowSim_ack {
            background-color: #FCD34D;
            color: #78350F;
            min-width: 50px;
        }

        .tcpFlowSim_arrow.tcpFlowSim_probe {
            background-color: #F87171;
            color: white;
        }

        .tcpFlowSim_tooltip {
            position: absolute;
            background-color: #1F2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
            z-index: 10;
            bottom: 105%;
            left: 50%;
            transform: translateX(-50%);
        }

        .tcpFlowSim_has-tooltip:hover .tcpFlowSim_tooltip {
            visibility: visible;
            opacity: 1;
        }

        #tcpFlowSim_message-area {
            height: 4.5em;
            overflow: hidden;
            position: relative;
            background-color: #E0F2FE;
            border: 1px solid #7DD3FC;
            padding: 0.75rem;
            border-radius: 0.375rem;
            color: #0369A1;
            font-weight: 500;
            line-height: 1.5;
        }

        #tcpFlowSim_message-content {
            position: absolute;
            width: calc(100% - 1.5rem);
            transition: top 0.5s ease-in-out;
            top: 0;
            text-align: center;
        }

        .tcpFlowSim_explanation code {
            background-color: rgba(17, 24, 39, 0.05);
            color: #DC2626;
            padding: 0.1em 0.3em;
            border-radius: 0.25rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9em;
        }

        /* --- TCP Congestion Control Simulation (Copied & Prefixed from ä¼ è¾“å±‚.html) --- */
        .tcpCongestionSim_status-indicator {
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid transparent;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .tcpCongestionSim_status-slow-start {
            background-color: #e0f2fe;
            color: #0c4a6e;
            border-color: #bae6fd;
        }

        .tcpCongestionSim_status-congestion-avoidance {
            background-color: #dcfce7;
            color: #166534;
            border-color: #bbf7d0;
        }

        .tcpCongestionSim_status-fast-recovery {
            background-color: #fef9c3;
            color: #854d0e;
            border-color: #fde68a;
        }

        .tcpCongestionSim_status-timeout {
            background-color: #fee2e2;
            color: #991b1b;
            border-color: #fecaca;
        }

        .tcpCongestionSim_highlight-state-change {
            animation: tcpCongestionSim_highlight 1s ease-out;
        }

        @keyframes tcpCongestionSim_highlight {
            0% {
                box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.4);
            }

            70% {
                box-shadow: 0 0 0 7px rgba(59, 130, 246, 0);
            }

            100% {
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            }
        }

        .tcpCongestionSim_packet {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            display: inline-block;
            margin: 1px;
            background-color: #60a5fa;
            opacity: 0;
            transition: opacity 0.4s ease, transform 0.4s ease, background-color 0.3s ease;
        }

        .tcpCongestionSim_packet.tcpCongestionSim_sent {
            opacity: 1;
            transform: translateY(-10px);
        }

        .tcpCongestionSim_packet.tcpCongestionSim_ack {
            background-color: #34d399;
            transform: translateY(0px);
        }

        .tcpCongestionSim_packet.tcpCongestionSim_lost {
            background-color: #f87171;
            opacity: 0.3;
            transform: scale(0.8);
        }

        .tcpCongestionSim_packet.tcpCongestionSim_duplicate-ack {
            background-color: #fbbf24;
            transform: translateY(0px);
        }

        .tcpCongestionSim_control-button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            margin: 0 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tcpCongestionSim_control-button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .tcpCongestionSim_control-button:active {
            transform: translateY(0px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .tcpCongestionSim_control-button:disabled {
            background-color: #d1d5db;
            color: #6b7280;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        #tcpCongestionSim_start-button {
            background-color: #3b82f6;
            color: white;
        }

        #tcpCongestionSim_start-button:hover:not(:disabled) {
            background-color: #2563eb;
        }

        #tcpCongestionSim_loss-button {
            background-color: #ef4444;
            color: white;
        }

        #tcpCongestionSim_loss-button:hover:not(:disabled) {
            background-color: #dc2626;
        }

        #tcpCongestionSim_dup-ack-button {
            background-color: #f59e0b;
            color: white;
        }

        #tcpCongestionSim_dup-ack-button:hover:not(:disabled) {
            background-color: #d97706;
        }

        #tcpCongestionSim_reset-button {
            background-color: #6b7280;
            color: white;
        }

        #tcpCongestionSim_reset-button:hover:not(:disabled) {
            background-color: #4b5563;
        }

        .tcpCongestionSim_explanation {
            background-color: #f9fafb;
            border-left: 5px solid #3b82f6;
            padding: 12px 16px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #374151;
            border-radius: 6px;
            line-height: 1.7;
        }

        .tcpCongestionSim_explanation strong {
            color: #1d4ed8;
            font-weight: 600;
        }

        .tcpCongestionSim_explanation .tcpCongestionSim_interview-point {
            color: #be123c;
            font-weight: 700;
        }

        .tcpCongestionSim_explanation .tcpCongestionSim_phase-goal {
            color: #059669;
            font-style: italic;
            display: block;
            margin-top: 5px;
        }

        /* --- TCP HOL Blocking Simulation (Copied & Prefixed from ä¼ è¾“å±‚.html) --- */
        .tcpHolSim_packet,
        .tcpHolSim_ack {
            transition: all 2.8s ease-in-out, background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
            position: absolute;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem;
            border-radius: 0.25rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-size: 0.7rem;
            font-weight: 500;
            min-width: 40px;
            height: 24px;
        }

        .tcpHolSim_packet {
            border: 1px solid #60a5fa;
            background-color: #dbeafe;
            color: #1e40af;
        }

        .tcpHolSim_ack {
            border: 1px solid #34d399;
            background-color: #d1fae5;
            color: #065f46;
        }

        .tcpHolSim_packet-losing {
            border-color: #ef4444 !important;
            background-color: #fee2e2 !important;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .tcpHolSim_packet-lost {
            opacity: 0;
            transform: scale(0.5) !important;
            transition: all 0.8s ease-in !important;
        }

        .tcpHolSim_packet-arrived-cue {
            border-color: #10b981 !important;
            transform: scale(1.1);
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
        }

        .tcpHolSim_packet-buffered {
            background-color: #fde68a;
            border-color: #facc15;
            transform: scale(0.9);
            position: static !important;
            margin: 1px;
        }

        .tcpHolSim_packet-delivered {
            background-color: #dcfce7;
            border-color: #22c55e;
            position: static !important;
            margin: 1px;
        }

        .tcpHolSim_packet-retransmitted {
            border-style: dashed;
            border-color: #f87171;
            background-color: #fef2f2;
        }

        .tcpHolSim_highlight-window {
            border: 2px solid #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
            transition: all 0.5s ease-in-out;
        }

        .tcpHolSim_buffer-slot {
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 40px;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            background-color: #e5e7eb;
            color: #6b7280;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .tcpHolSim_app-layer-area {
            min-height: 50px;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            justify-content: center;
            align-items: center;
        }

        .tcpHolSim_status-text {
            min-height: 1.5em;
            transition: opacity 0.5s ease-in-out;
        }

        .tcpHolSim_rto-timer {
            font-size: 0.7rem;
            color: #6b7280;
            display: inline-block;
            margin-left: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tcpHolSim_rto-timer.active {
            opacity: 1;
        }

        .tcpHolSim_rto-timer.expired {
            color: #ef4444;
            font-weight: bold;
            opacity: 1;
        }

        #tcpHolSim_network-path {
            position: absolute;
            bottom: 48%;
            left: 7%;
            width: 86%;
            height: 2px;
            background-image: linear-gradient(to right, #9ca3af 50%, transparent 50%);
            background-size: 10px 2px;
            z-index: 1;
        }
    </style>

</head>

<body class="bg-gray-100">
    <div class="page-container">

        <aside class="local-side-nav">
            <h4 class="head4">ç½‘ç»œåŸºç¡€</h4>
            <ul id="local-toc">
                <li><a href="#intro" class="active"><span class="material-icons nav-icon">lan</span>ç®€ä»‹</a></li>
                <li><a href="#tcp-ip-osi"><span class="material-icons nav-icon">layers</span>TCP/IP & OSI</a></li>
                <li><a href="#tcp-connection"><span class="material-icons nav-icon">handshake</span>TCP è¿æ¥ç®¡ç†</a></li>
                <li><a href="#tcp-reliability"><span class="material-icons nav-icon">verified_user</span>TCP å¯é æ€§</a>
                </li>
                <li><a href="#tcp-flow-control"><span class="material-icons nav-icon">traffic</span>TCP æµé‡æ§åˆ¶</a></li>
                <li><a href="#tcp-congestion-control"><span class="material-icons nav-icon">speed</span>TCP æ‹¥å¡æ§åˆ¶</a>
                </li>
                <li><a href="#tcp-hol"><span class="material-icons nav-icon">block</span>TCP é˜Ÿå¤´é˜»å¡</a></li>
                <li><a href="#udp"><span class="material-icons nav-icon">rocket_launch</span>UDP</a></li>
                <li><a href="#quic"><span class="material-icons nav-icon">bolt</span>QUIC</a></li>
                <li><a href="#dns"><span class="material-icons nav-icon">dns</span>DNS è§£æ</a></li>
                <li><a href="#kernel-user"><span class="material-icons nav-icon">memory</span>ç”¨æˆ·æ€/å†…æ ¸æ€</a></li>
            </ul>
            <a href="../../index.html" class="back-link"> &larr; è¿”å›å¤§çº²ç›®å½•
            </a>
        </aside>

        <main class="content-main">
            <article>
                <section id="intro" class="content-section fade-in-section" style="animation-delay: 0s;">
                    <h1 class="head1 flex items-center gap-2">
                        <span class="material-icons text-3xl text-blue-600">lan</span>(ä¸€) ç½‘ç»œåŸºç¡€
                    </h1>
                    <p>ç½‘ç»œåŸºç¡€æ˜¯å‰ç«¯å’Œå…¨æ ˆå¼€å‘é¢è¯•ä¸­çš„é‡è¦ç¯èŠ‚ï¼Œè€ƒå¯Ÿå¯¹ç½‘ç»œåè®®ã€æ•°æ®ä¼ è¾“å’Œç½‘ç»œé€šä¿¡åŸç†çš„ç†è§£ã€‚æœ¬èŠ‚æ¢³ç†äº† TCP/IP æ¨¡å‹ã€TCP/UDP åè®®ç»†èŠ‚ã€QUICã€DNS ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚</p>
                    <p class="mt-4 bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md text-sm">ğŸ’¡
                        <strong>æç¤º:</strong> ç‚¹å‡»å·¦ä¾§å¯¼èˆªå¯ä»¥å¿«é€Ÿè·³è½¬åˆ°ç›¸åº”ä¸»é¢˜ã€‚æ‹¬å·å†…æ ‡æ³¨äº†çŸ¥è¯†ç‚¹çš„é‡è¦ç¨‹åº¦å’Œéš¾åº¦çº§åˆ«ã€‚éƒ¨åˆ†ç« èŠ‚åŒ…å«äº¤äº’å¼æ¨¡æ‹Ÿã€‚
                    </p>
                </section>

                <section id="tcp-ip-osi" class="content-section fade-in-section" style="animation-delay: 0.05s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">layers</span>TCP/IP ä¸ OSI æ¨¡å‹
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-base">åŸºç¡€</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">åˆ†å±‚æ¨¡å‹æ¦‚è¿°</h3>
                        <p>ç½‘ç»œåè®®æ¨¡å‹å°†å¤æ‚çš„ç½‘ç»œé€šä¿¡è¿‡ç¨‹åˆ’åˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œæ¯å±‚è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ï¼Œä¸‹å±‚ä¸ºä¸Šå±‚æä¾›æœåŠ¡ã€‚è¿™ç§åˆ†å±‚ç»“æ„æœ‰åŠ©äºæ ‡å‡†åŒ–ã€æ¨¡å—åŒ–å’Œç®€åŒ–ç½‘ç»œè®¾è®¡ä¸å®ç°ã€‚</p>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">OSI ä¸ƒå±‚æ¨¡å‹ (ç†è®ºæ¨¡å‹)</h3>
                        <p>OSI (Open Systems Interconnection) æ¨¡å‹æ˜¯ä¸€ä¸ªç†è®ºä¸Šå®Œå–„ä½†å®é™…åº”ç”¨è¾ƒå°‘çš„ä¸ƒå±‚å‚è€ƒæ¨¡å‹ï¼š</p>
                        <ol class="list-decimal list-inside space-y-1 text-sm">
                            <li><strong>ç‰©ç†å±‚ (Physical Layer):</strong> è´Ÿè´£ä¼ è¾“åŸå§‹æ¯”ç‰¹æµï¼Œå®šä¹‰ç‰©ç†æ¥å£ã€ç”µå‹ã€çº¿ç¼†ç­‰ã€‚</li>
                            <li><strong>æ•°æ®é“¾è·¯å±‚ (Data Link Layer):</strong> åœ¨ç‰©ç†é“¾è·¯ä¸Šæä¾›å¯é çš„æ•°æ®ä¼ è¾“ï¼ˆå¸§ï¼‰ï¼Œè¿›è¡Œç‰©ç†å¯»å€ (MAC)ã€é”™è¯¯æ£€æµ‹å’Œæµé‡æ§åˆ¶ã€‚
                            </li>
                            <li><strong>ç½‘ç»œå±‚ (Network Layer):</strong> è´Ÿè´£é€»è¾‘å¯»å€ (IPåœ°å€)ã€è·¯ç”±é€‰æ‹©å’Œåˆ†ç»„è½¬å‘ï¼Œå®ç°ä¸åŒç½‘ç»œé—´çš„é€šä¿¡ã€‚</li>
                            <li><strong>ä¼ è¾“å±‚ (Transport Layer):</strong> æä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡æœåŠ¡ï¼Œè¿›è¡Œç«¯å£å¯»å€ã€åˆ†æ®µ/é‡ç»„ã€è¿æ¥ç®¡ç†ã€å¯é ä¼ è¾“ (TCP) æˆ–ä¸å¯é ä¼ è¾“
                                (UDP)ã€‚</li>
                            <li><strong>ä¼šè¯å±‚ (Session Layer):</strong> å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢ä¼šè¯ï¼ˆè¿æ¥ï¼‰ã€‚</li>
                            <li><strong>è¡¨ç¤ºå±‚ (Presentation Layer):</strong> å¤„ç†æ•°æ®æ ¼å¼è½¬æ¢ã€åŠ å¯†/è§£å¯†ã€å‹ç¼©/è§£å‹ç¼©ã€‚</li>
                            <li><strong>åº”ç”¨å±‚ (Application Layer):</strong> ä¸ºåº”ç”¨ç¨‹åºæä¾›ç½‘ç»œæœåŠ¡æ¥å£ï¼Œå¦‚ HTTP, FTP, DNS ç­‰ã€‚</li>
                        </ol>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">TCP/IP å››å±‚/äº”å±‚æ¨¡å‹ (äº‹å®æ ‡å‡†)</h3>
                        <p>TCP/IP æ¨¡å‹æ˜¯äº’è”ç½‘å®é™…ä½¿ç”¨çš„åè®®æ ˆæ¨¡å‹ï¼Œé€šå¸¸æè¿°ä¸ºå››å±‚æˆ–äº”å±‚ï¼š</p>
                        <div class="mermaid text-center my-4 p-2 border rounded bg-white shadow-sm">
                            graph TD
                            subgraph "OSI æ¨¡å‹ (7å±‚)"
                            A[åº”ç”¨å±‚] --> B[è¡¨ç¤ºå±‚] --> C[ä¼šè¯å±‚] --> D[ä¼ è¾“å±‚] --> E[ç½‘ç»œå±‚] --> F[æ•°æ®é“¾è·¯å±‚] --> G[ç‰©ç†å±‚]
                            end
                            subgraph "TCP/IP æ¨¡å‹ (4å±‚)"
                            H[åº”ç”¨å±‚] --> I[ä¼ è¾“å±‚] --> J[ç½‘é™…å±‚/ç½‘ç»œå±‚] --> K[ç½‘ç»œæ¥å£å±‚/é“¾è·¯å±‚]
                            end
                            subgraph "TCP/IP æ¨¡å‹ (5å±‚)"
                            L[åº”ç”¨å±‚] --> M[ä¼ è¾“å±‚] --> N[ç½‘ç»œå±‚] --> O[æ•°æ®é“¾è·¯å±‚] --> P[ç‰©ç†å±‚]
                            end

                            style A fill:#fecaca, stroke:#b91c1c
                            style B fill:#fee2e2, stroke:#b91c1c
                            style C fill:#ffedd5, stroke:#c2410c
                            style D fill:#fef3c7, stroke:#a16207
                            style E fill:#dcfce7, stroke:#15803d
                            style F fill:#dbeafe, stroke:#1d4ed8
                            style G fill:#e0e7ff, stroke:#3730a3

                            style H fill:#fecaca, stroke:#b91c1c
                            style I fill:#fef3c7, stroke:#a16207
                            style J fill:#dcfce7, stroke:#15803d
                            style K fill:#dbeafe, stroke:#1d4ed8

                            style L fill:#fecaca, stroke:#b91c1c
                            style M fill:#fef3c7, stroke:#a16207
                            style N fill:#dcfce7, stroke:#15803d
                            style O fill:#dbeafe, stroke:#1d4ed8
                            style P fill:#e0e7ff, stroke:#3730a3
                        </div>
                        <ul class="list-disc list-inside space-y-1 text-sm">
                            <li><strong>åº”ç”¨å±‚ (Application Layer):</strong> å¯¹åº” OSI åº”ç”¨å±‚ã€è¡¨ç¤ºå±‚ã€ä¼šè¯å±‚ã€‚è´Ÿè´£åº”ç”¨ç¨‹åºé—´çš„é€šä¿¡ (HTTP, DNS, FTP
                                ç­‰)ã€‚</li>
                            <li><strong>ä¼ è¾“å±‚ (Transport Layer):</strong> å¯¹åº” OSI ä¼ è¾“å±‚ã€‚è´Ÿè´£ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“ (TCP, UDP)ã€‚</li>
                            <li><strong>ç½‘ç»œå±‚/ç½‘é™…å±‚ (Internet Layer):</strong> å¯¹åº” OSI ç½‘ç»œå±‚ã€‚è´Ÿè´£æ•°æ®åŒ…çš„è·¯ç”±å’Œè½¬å‘ (IP, ICMP, ARP)ã€‚</li>
                            <li><strong>ç½‘ç»œæ¥å£å±‚/é“¾è·¯å±‚ (Network Interface/Link Layer):</strong> å¯¹åº” OSI
                                æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ã€‚è´Ÿè´£ç‰©ç†ç½‘ç»œæ¥å£å’Œå¸§çš„ä¼ è¾“ (Ethernet, Wi-Fi)ã€‚(äº”å±‚æ¨¡å‹ä¼šå°†å…¶æ‹†åˆ†ä¸ºæ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚)</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">å¯¹åº”å…³ç³»ä¸æ€»ç»“</h3>
                        <p>TCP/IP æ¨¡å‹æ˜¯ OSI æ¨¡å‹çš„ä¸€ä¸ªç®€åŒ–å’Œå®è·µç‰ˆæœ¬ã€‚ç†è§£åˆ†å±‚æ€æƒ³æ˜¯å…³é”®ï¼šæ¯å±‚ä¸“æ³¨è‡ªèº«åŠŸèƒ½ï¼Œé€šè¿‡æ¥å£ä¸ä¸Šä¸‹å±‚äº¤äº’ï¼Œå®ç°äº†ç½‘ç»œçš„æ¨¡å—åŒ–å’Œæ ‡å‡†åŒ–ã€‚</p>
                    </div>
                </section>

                <section id="tcp-connection" class="content-section fade-in-section" style="animation-delay: 0.1s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">handshake</span>TCP è¿æ¥ç®¡ç†
                        <span class="level-tag level-tag-high">é«˜é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">TCP æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>å…¨ç§°: Transmission Control Protocol (ä¼ è¾“æ§åˆ¶åè®®)ï¼Œå±äº <b>ä¼ è¾“å±‚</b> åè®®ã€‚</li>
                            <li>æ ¸å¿ƒç‰¹ç‚¹: å¯é ã€é¢å‘è¿æ¥ã€å­—èŠ‚æµã€å…¨åŒå·¥é€šä¿¡ã€‚</li>
                            <li>ä¸»è¦ç›®æ ‡: åœ¨ä¸å¯é çš„ IP ç½‘ç»œï¼ˆåº•å±‚å¯èƒ½ä¸¢åŒ…ã€ä¹±åºï¼‰ä¸Šæä¾› å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚</li>
                            <li>åº”ç”¨åœºæ™¯: HTTP/HTTPS, FTP, SMTP, SSH ç­‰è¦æ±‚æ•°æ®å®Œæ•´æ€§å’Œé¡ºåºæ€§çš„åº”ç”¨ã€‚</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">TCP æŠ¥æ–‡æ®µç»“æ„</h3>
                        <p class="text-sm text-gray-600 mb-3"> TCP å¤´éƒ¨åŒ…å«äº†å®ç°å…¶å¯é æ€§ã€æµé‡æ§åˆ¶ç­‰åŠŸèƒ½çš„å…³é”®å­—æ®µã€‚æ ‡å‡†å¤´éƒ¨æœ€å°ä¸º 20 å­—èŠ‚ï¼ˆ5 ä¸ª 32
                            ä½å­—ï¼‰ã€‚ç‚¹å‡»ä¸‹æ–¹å­—æ®µæŸ¥çœ‹è¯´æ˜ï¼š </p>
                        <div id="tcp-header-vis"
                            class="border border-gray-300 rounded overflow-hidden shadow-md select-none">
                            <div class="flex w-full">
                                <div class="header-field flex-1 p-2 text-center border-r border-b border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="æºç«¯å£ (16ä½): æ ‡è¯†å‘é€æ–¹åº”ç”¨ç¨‹åºç«¯å£å·ã€‚"> æºç«¯å£ (16) </div>
                                <div class="header-field flex-1 p-2 text-center border-b border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="ç›®çš„ç«¯å£ (16ä½): æ ‡è¯†æ¥æ”¶æ–¹åº”ç”¨ç¨‹åºç«¯å£å·ã€‚"> ç›®çš„ç«¯å£ (16) </div>
                            </div>
                            <div class="flex w-full">
                                <div class="header-field flex-auto p-2 text-center border-b border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="åºåˆ—å· (SEQ, 32ä½): ç”¨äºæ ‡è¯†TCPæŠ¥æ–‡æ®µä¸­æ•°æ®éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ç¡®ä¿æ•°æ®æŒ‰åºåˆ°è¾¾å’Œé‡ä¼ ã€‚"> åºåˆ—å· (SEQ) (32)
                                </div>
                            </div>
                            <div class="flex w-full">
                                <div class="header-field flex-auto p-2 text-center border-b border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="ç¡®è®¤å· (ACK, 32ä½): æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚åªæœ‰å½“ACKæ ‡å¿—ä½ä¸º1æ—¶æ‰æœ‰æ•ˆã€‚"> ç¡®è®¤å· (ACK) (32) </div>
                            </div>
                            <div class="flex w-full">
                                <div class="header-field w-[12.5%] p-2 text-center border-r border-b border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="æ•°æ®åç§» (4ä½): TCPå¤´éƒ¨çš„é•¿åº¦ï¼Œä»¥4å­—èŠ‚ä¸ºå•ä½ã€‚æŒ‡ç¤ºæ•°æ®éƒ¨åˆ†çš„èµ·å§‹ä½ç½®ã€‚"> åç§»(4) </div>
                                <div class="header-field w-[18.75%] p-2 text-center border-r border-b border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="ä¿ç•™ (6ä½): æœªä½¿ç”¨ï¼Œå¿…é¡»ä¸º0ã€‚"> ä¿ç•™(6) </div>
                                <div class="header-field w-[18.75%] p-2 text-center border-r border-b border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="æ ‡å¿—ä½ (6ä½): URG(ç´§æ€¥)/ACK(ç¡®è®¤)/PSH(æ¨é€)/RST(å¤ä½)/SYN(åŒæ­¥)/FIN(ç»“æŸ)ã€‚æ§åˆ¶TCPè¿æ¥çŠ¶æ€ã€‚">
                                    æ ‡å¿—ä½(6) </div>
                                <div class="header-field w-1/2 p-2 text-center border-b border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="çª—å£å¤§å° (Window, 16ä½): ç”¨äºæµé‡æ§åˆ¶ï¼ŒæŒ‡ç¤ºæ¥æ”¶æ–¹å½“å‰å¯ç”¨çš„ç¼“å†²åŒºå¤§å°ã€‚"> çª—å£ (16) </div>
                            </div>
                            <div class="flex w-full">
                                <div class="header-field flex-1 p-2 text-center border-r border-gray-400 bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="æ ¡éªŒå’Œ (16ä½): ç”¨äºæ£€æµ‹TCPå¤´éƒ¨å’Œæ•°æ®éƒ¨åˆ†åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºé”™ã€‚"> æ ¡éªŒå’Œ (16) </div>
                                <div class="header-field flex-1 p-2 text-center bg-blue-100 hover:bg-blue-300 cursor-pointer text-sm font-mono"
                                    data-info="ç´§æ€¥æŒ‡é’ˆ (UrgPtr, 16ä½): åªæœ‰URGæ ‡å¿—ä½ä¸º1æ—¶æœ‰æ•ˆï¼ŒæŒ‡ç¤ºç´§æ€¥æ•°æ®åœ¨æŠ¥æ–‡æ®µä¸­çš„ç»“æŸä½ç½®ã€‚"> ç´§æ€¥æŒ‡é’ˆ (16) </div>
                            </div>
                            <div class="header-field w-full p-2 text-center bg-yellow-100 hover:bg-yellow-300 cursor-pointer text-gray-700 text-sm font-mono border-t border-gray-400"
                                data-info="å¯é€‰é¡¹ (é•¿åº¦å¯å˜): å¦‚æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦(MSS), çª—å£ç¼©æ”¾å› å­, æ—¶é—´æˆ³, é€‰æ‹©æ€§ç¡®è®¤(SACK)ç­‰ã€‚å¤´éƒ¨æ€»é•¿åº¦(Data Offset)ä¼šæŒ‡ç¤ºæ˜¯å¦åŒ…å«å¯é€‰é¡¹ã€‚">
                                å¯é€‰é¡¹ (Options) (å˜é•¿, 32ä½å¯¹é½) </div>
                            <div
                                class="w-full p-4 text-center bg-green-100 text-gray-700 text-sm border-t border-gray-400">
                                æ•°æ® (Payload) - å¯å˜é•¿åº¦ </div>
                        </div>
                        <div id="tcp-header-info" class="header-info-display"> ç‚¹å‡»ä¸Šæ–¹å­—æ®µæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯...</div>
                    </div>
                    <div class="content-card mb-6 p-4 border border-green-300 rounded-lg bg-green-50">
                        <h4 class="font-medium text-lg mb-3 text-green-800">ğŸ¤ ä¸‰æ¬¡æ¡æ‰‹ (å»ºç«‹è¿æ¥)</h4>
                        <p class="text-sm text-gray-600 mb-4">ç¡®ä¿åŒæ–¹éƒ½å…·å¤‡æ”¶å‘èƒ½åŠ›ï¼Œå¹¶åŒæ­¥åˆå§‹åºåˆ—å· (ISN)ã€‚</p>
                        <div class="flex flex-col md:flex-row gap-4 items-start">
                            <div class="w-full md:w-2/5 space-y-2">
                                <div id="handshake-step-1" class="interactive-step">
                                    <p><strong>æ­¥éª¤ 1:</strong> å®¢æˆ·ç«¯ <span class="state-tag state-closed">CLOSED</span> â†’
                                        æœåŠ¡å™¨ <span class="state-tag state-listen">LISTEN</span></p>
                                    <p class="text-sm">å®¢æˆ·ç«¯å‘é€ SYN åŒ… (<code>SYN=1, Seq=x</code>) è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œè¿›å…¥ <span
                                            class="state-tag state-syn-sent">SYN_SENT</span> çŠ¶æ€ã€‚</p>
                                </div>
                                <div id="handshake-step-2" class="interactive-step">
                                    <p><strong>æ­¥éª¤ 2:</strong> æœåŠ¡å™¨ <span class="state-tag state-listen">LISTEN</span> â†’
                                        å®¢æˆ·ç«¯ <span class="state-tag state-syn-sent">SYN_SENT</span></p>
                                    <p class="text-sm">æœåŠ¡å™¨æ”¶åˆ° SYNï¼Œå›å¤ SYN+ACK åŒ…
                                        (<code>SYN=1, ACK=1, Seq=y, Ack=x+1</code>)ï¼Œè¿›å…¥ <span
                                            class="state-tag state-syn-rcvd">SYN_RCVD</span> çŠ¶æ€ã€‚</p>
                                </div>
                                <div id="handshake-step-3" class="interactive-step">
                                    <p><strong>æ­¥éª¤ 3:</strong> å®¢æˆ·ç«¯ <span class="state-tag state-syn-sent">SYN_SENT</span>
                                        â†’ æœåŠ¡å™¨ <span class="state-tag state-syn-rcvd">SYN_RCVD</span></p>
                                    <p class="text-sm">å®¢æˆ·ç«¯æ”¶åˆ° SYN+ACKï¼Œå‘é€ ACK åŒ… (<code>ACK=1, Ack=y+1</code>)ï¼Œè¿›å…¥ <span
                                            class="state-tag state-established">ESTABLISHED</span> çŠ¶æ€ã€‚æœåŠ¡å™¨æ”¶åˆ° ACK åä¹Ÿè¿›å…¥
                                        <span class="state-tag state-established">ESTABLISHED</span> çŠ¶æ€ã€‚è¿æ¥å»ºç«‹ï¼
                                    </p>
                                </div>
                            </div>
                            <div class="w-full md:w-3/5 flex flex-col items-center">
                                <div id="mermaid-handshake-diagram"
                                    class="mermaid mb-4 border rounded p-2 bg-white shadow-sm w-full">
                                </div>
                                <button id="next-handshake-step"
                                    class="button button-secondary bg-green-500 hover:bg-green-600 text-white">
                                    <i class="fas fa-play mr-1"></i> ä¸‹ä¸€æ­¥ (æ¡æ‰‹)
                                </button>
                            </div>
                        </div>
                        <div class="mt-6 p-4 border border-yellow-300 rounded-lg bg-yellow-50">
                            <h5 class="font-semibold text-yellow-800 mb-2"><i
                                    class="fas fa-exclamation-triangle mr-1"></i> ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</h5>
                            <p class="text-sm text-gray-700">å¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼ˆå®¢æˆ·ç«¯å‘ SYNï¼ŒæœåŠ¡å™¨å› SYN+ACK å°±å»ºç«‹è¿æ¥ï¼‰ï¼š</p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-gray-700 mt-2">
                                <li><strong>æ— æ³•é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚ï¼š</strong> å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘çš„ SYN
                                    å¯èƒ½å› ç½‘ç»œå»¶è¿Ÿï¼Œåœ¨è¿æ¥é‡Šæ”¾åæ‰åˆ°è¾¾æœåŠ¡å™¨ã€‚å¦‚æœæ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡å™¨ä¼šç«‹å³å»ºç«‹è¿æ¥å¹¶ç­‰å¾…æ•°æ®ï¼Œé€ æˆèµ„æºæµªè´¹ï¼ˆåŠè¿æ¥ï¼‰ã€‚</li>
                                <li><strong>æœåŠ¡å™¨æ— æ³•ç¡®è®¤å®¢æˆ·ç«¯çš„æ¥æ”¶èƒ½åŠ›ï¼š</strong> ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨ SYN çš„ç¡®è®¤ï¼Œè¯æ˜å®¢æˆ·ç«¯èƒ½æ”¶åˆ°æœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚</li>
                                <li><strong>æ˜“å— SYN Flood æ”»å‡»ï¼š</strong> æ”»å‡»è€…ä¼ªé€ å¤§é‡ IP å‘é€ SYNï¼ŒæœåŠ¡å™¨å›å¤ SYN+ACK å¹¶ç­‰å¾…æœ€ç»ˆ
                                    ACKï¼Œè€—å°½èµ„æºã€‚ä¸‰æ¬¡æ¡æ‰‹è™½ç„¶ä¸èƒ½å®Œå…¨æœç»ï¼Œä½†å¢åŠ äº†æ”»å‡»æˆæœ¬ã€‚</li>
                            </ul>
                            <p class="text-sm font-medium text-gray-800 mt-2">ğŸ¯ æ ¸å¿ƒï¼šä¸‰æ¬¡æ¡æ‰‹æ˜¯ç¡®ä¿åŒæ–¹éƒ½ç¡®è®¤å¯¹æ–¹æ”¶å‘èƒ½åŠ›ã€åŒæ­¥åˆå§‹åºåˆ—å·çš„æœ€å°å¯é æ­¥éª¤ã€‚
                            </p>
                        </div>
                    </div>

                    <div class="content-card mb-6 p-4 border border-red-300 rounded-lg bg-red-50">
                        <h4 class="font-medium text-lg mb-3 text-red-800">ğŸ‘‹ å››æ¬¡æŒ¥æ‰‹ (æ–­å¼€è¿æ¥)</h4>
                        <p class="text-sm text-gray-600 mb-4">ç”±äº TCP æ˜¯å…¨åŒå·¥ï¼Œè¿æ¥çš„å…³é—­éœ€è¦åŒæ–¹å„è‡ªç‹¬ç«‹åœ°å…³é—­å‘é€é€šé“ã€‚</p>
                        <div class="flex flex-col md:flex-row gap-4 items-start">
                            <div class="w-full md:w-2/5 space-y-2">
                                <div id="wave-step-1" class="interactive-step">
                                    <p><strong>æ­¥éª¤ 1:</strong> å®¢æˆ·ç«¯ <span
                                            class="state-tag state-established">ESTABLISHED</span> â†’ æœåŠ¡å™¨ <span
                                            class="state-tag state-established">ESTABLISHED</span></p>
                                    <p class="text-sm">å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­ï¼Œå‘é€ FIN åŒ… (<code>FIN=1, Seq=u</code>)ï¼Œè¡¨ç¤ºä¸å†å‘é€æ•°æ®ï¼Œè¿›å…¥ <span
                                            class="state-tag state-fin-wait-1">FIN_WAIT_1</span> çŠ¶æ€ã€‚</p>
                                </div>
                                <div id="wave-step-2" class="interactive-step">
                                    <p><strong>æ­¥éª¤ 2:</strong> æœåŠ¡å™¨ <span
                                            class="state-tag state-established">ESTABLISHED</span> â†’ å®¢æˆ·ç«¯ <span
                                            class="state-tag state-fin-wait-1">FIN_WAIT_1</span></p>
                                    <p class="text-sm">æœåŠ¡å™¨æ”¶åˆ° FINï¼Œå›å¤ ACK åŒ… (<code>ACK=1, Ack=u+1</code>)ï¼Œè¡¨ç¤ºæ”¶åˆ°å…³é—­è¯·æ±‚ã€‚å®¢æˆ·ç«¯è¿›å…¥
                                        <span class="state-tag state-fin-wait-2">FIN_WAIT_2</span>ã€‚æœåŠ¡å™¨è¿›å…¥ <span
                                            class="state-tag state-close-wait">CLOSE_WAIT</span>ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä»å¯å‘é€æ•°æ®ã€‚
                                    </p>
                                </div>
                                <div id="wave-step-3" class="interactive-step">
                                    <p><strong>æ­¥éª¤ 3:</strong> æœåŠ¡å™¨ <span
                                            class="state-tag state-close-wait">CLOSE_WAIT</span> â†’ å®¢æˆ·ç«¯ <span
                                            class="state-tag state-fin-wait-2">FIN_WAIT_2</span></p>
                                    <p class="text-sm">æœåŠ¡å™¨æ•°æ®å‘é€å®Œæ¯•ï¼Œä¹Ÿå‘é€ FIN åŒ… (<code>FIN=1, Seq=v</code>)ï¼Œè¡¨ç¤ºè‡ªå·±ä¹Ÿè¦å…³é—­è¿æ¥ï¼Œè¿›å…¥
                                        <span class="state-tag state-last-ack">LAST_ACK</span> çŠ¶æ€ã€‚
                                    </p>
                                </div>
                                <div id="wave-step-4" class="interactive-step">
                                    <p><strong>æ­¥éª¤ 4:</strong> å®¢æˆ·ç«¯ <span
                                            class="state-tag state-fin-wait-2">FIN_WAIT_2</span> â†’ æœåŠ¡å™¨ <span
                                            class="state-tag state-last-ack">LAST_ACK</span></p>
                                    <p class="text-sm">å®¢æˆ·ç«¯æ”¶åˆ° FINï¼Œå‘é€ ACK åŒ… (<code>ACK=1, Ack=v+1</code>)ï¼Œè¿›å…¥ <span
                                            class="state-tag state-time-wait">TIME_WAIT</span> çŠ¶æ€ï¼ˆç­‰å¾… 2*MSLï¼‰ã€‚æœåŠ¡å™¨æ”¶åˆ° ACK
                                        åè¿›å…¥ <span class="state-tag state-closed">CLOSED</span> çŠ¶æ€ã€‚å®¢æˆ·ç«¯ç­‰å¾…ç»“æŸåä¹Ÿè¿›å…¥ <span
                                            class="state-tag state-closed">CLOSED</span>ã€‚</p>
                                </div>
                            </div>
                            <div class="w-full md:w-3/5 flex flex-col items-center">
                                <div id="mermaid-wave-diagram"
                                    class="mermaid mb-4 border rounded p-2 bg-white shadow-sm w-full">
                                </div>
                                <button id="next-wave-step"
                                    class="button button-secondary bg-red-500 hover:bg-red-600 text-white">
                                    <i class="fas fa-play mr-1"></i> ä¸‹ä¸€æ­¥ (æŒ¥æ‰‹)
                                </button>
                            </div>
                        </div>
                        <div class="mt-6 p-4 border border-purple-300 rounded-lg bg-purple-50">
                            <h5 class="font-semibold text-purple-800 mb-2"><i class="fas fa-hourglass-half mr-1"></i>
                                TIME_WAIT çŠ¶æ€ (2*MSL) çš„æ„ä¹‰ï¼Ÿ</h5>
                            <p class="text-sm text-gray-700">å®¢æˆ·ç«¯æœ€åå‘é€ ACK åè¿›å…¥ TIME_WAIT çŠ¶æ€ï¼Œç­‰å¾… 2 å€çš„æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´ï¼ˆMaximum
                                Segment Lifetimeï¼‰ã€‚</p>
                            <ul class="list-disc list-inside space-y-1 text-sm text-gray-700 mt-2">
                                <li><strong>ç¡®ä¿æœ€åçš„ ACK åˆ°è¾¾æœåŠ¡å™¨ï¼š</strong> å¦‚æœè¿™ä¸ª ACK ä¸¢å¤±ï¼ŒæœåŠ¡å™¨ä¼šè¶…æ—¶é‡ä¼  FINã€‚å®¢æˆ·ç«¯åœ¨ TIME_WAIT
                                    çŠ¶æ€å¯ä»¥å“åº”è¿™ä¸ªé‡ä¼ çš„ FINï¼Œå†æ¬¡å‘é€ ACKï¼Œç¡®ä¿æœåŠ¡å™¨èƒ½æ­£å¸¸å…³é—­ã€‚</li>
                                <li><strong>é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µå‡ºç°åœ¨æ–°è¿æ¥ä¸­ï¼š</strong> ç­‰å¾… 2*MSL
                                    å¯ä»¥ç¡®ä¿æœ¬æ¬¡è¿æ¥ä¸­äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œé¿å…å¹²æ‰°åç»­ä½¿ç”¨ç›¸åŒç«¯å£çš„æ–°è¿æ¥ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section id="tcp-reliability" class="content-section fade-in-section" style="animation-delay: 0.15s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">verified_user</span>TCP å¯é æ€§æœºåˆ¶
                        <span class="level-tag level-tag-high">é«˜é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">æ ¸å¿ƒæœºåˆ¶</h3>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li><strong>åºåˆ—å· (SEQ) ä¸ ç¡®è®¤å· (ACK):</strong> æ¯ä¸ªå­—èŠ‚éƒ½è¢«ç¼–å·ï¼ŒACK ç¡®è®¤æ”¶åˆ°çš„è¿ç»­å­—èŠ‚æµçš„æœ€é«˜åºå·+1ã€‚</li>
                            <li><strong>ç´¯ç§¯ç¡®è®¤:</strong> ACK N è¡¨ç¤º N ä¹‹å‰çš„æ‰€æœ‰å­—èŠ‚éƒ½å·²æ”¶åˆ°ã€‚</li>
                            <li><strong>è¶…æ—¶é‡ä¼  (RTO):</strong> å‘é€æ–¹ç»´æŠ¤ä¸€ä¸ªé‡ä¼ å®šæ—¶å™¨ï¼Œå¦‚æœåœ¨ RTO å†…æœªæ”¶åˆ° ACKï¼Œåˆ™é‡ä¼ æ•°æ®æ®µã€‚RTO åŸºäº RTT (å¾€è¿”æ—¶å»¶)
                                åŠ¨æ€è°ƒæ•´ã€‚</li>
                            <li><strong>å¿«é€Ÿé‡ä¼ :</strong> æ”¶åˆ° 3 ä¸ªæˆ–ä»¥ä¸Šé‡å¤çš„ ACK æ—¶ï¼Œè®¤ä¸ºè¯¥ ACK æŒ‡ç¤ºçš„ä¸‹ä¸€ä¸ªåŒ…å·²ä¸¢å¤±ï¼Œç«‹å³é‡ä¼ ï¼Œæ— éœ€ç­‰å¾… RTO è¶…æ—¶ã€‚</li>
                            <li><strong>é€‰æ‹©æ€§ç¡®è®¤ (SACK, å¯é€‰é¡¹):</strong> å…è®¸æ¥æ”¶æ–¹å‘ŠçŸ¥å‘é€æ–¹å“ªäº›éè¿ç»­çš„æ•°æ®å—å·²æ”¶åˆ°ï¼Œä½¿å‘é€æ–¹åªéœ€é‡ä¼ çœŸæ­£ä¸¢å¤±çš„éƒ¨åˆ†ã€‚</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h4 class="head4">å¯é ä¼ è¾“æ¨¡æ‹Ÿ (é˜Ÿå¤´é˜»å¡ç¤ºä¾‹)</h4>
                        <p class="text-sm text-gray-600 mb-4">ä»¥ä¸‹æ¨¡æ‹Ÿå±•ç¤ºäº† TCP å¦‚ä½•å¤„ç†ä¸¢åŒ…å’Œä¹±åºï¼Œä»¥åŠé˜Ÿå¤´é˜»å¡ç°è±¡ã€‚å‘é€æ–¹çª—å£å¤§å°ä¸º 4ã€‚</p>
                        <div id="tcpRelSim_animation-area"
                            class="mt-6 p-4 border border-blue-200 rounded-lg bg-gradient-to-b from-blue-50 to-white relative overflow-hidden min-h-[450px] shadow-inner">
                            <div class="flex justify-between items-start mb-4 relative z-20">
                                <div class="w-2/5 border border-gray-300 rounded-lg p-3 bg-gray-50 shadow">
                                    <h5 class="font-medium text-center mb-2 text-gray-700 text-base">å‘é€æ–¹ (Sender)</h5>
                                    <div class="text-xs mb-2 text-center text-gray-600">çª—å£å¤§å° (W) = 4</div>
                                    <div id="tcpRelSim_sender-window"
                                        class="relative border border-dashed border-gray-400 p-2 rounded tcpRelSim_highlight-window min-h-[60px]">
                                        <span id="tcpRelSim_sender-window-label"
                                            class="absolute -top-2 -left-2 bg-blue-100 text-blue-700 px-1 py-0.5 text-xs rounded shadow-sm">å‘é€çª—å£
                                            [1-4]</span>
                                        <div class="flex space-x-1 justify-center items-center mt-2 flex-wrap">
                                            <div id="tcpRelSim_sender-seq-1"
                                                class="p-1 border border-gray-400 rounded bg-white text-xs text-center relative shadow-sm">
                                                SEQ 1 <span class="tcpRelSim_rto-timer" id="tcpRelSim_timer-1"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpRelSim_sender-seq-2"
                                                class="p-1 border border-gray-400 rounded bg-white text-xs text-center relative shadow-sm">
                                                SEQ 2 <span class="tcpRelSim_rto-timer" id="tcpRelSim_timer-2"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpRelSim_sender-seq-3"
                                                class="p-1 border border-gray-400 rounded bg-white text-xs text-center relative shadow-sm">
                                                SEQ 3 <span class="tcpRelSim_rto-timer" id="tcpRelSim_timer-3"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpRelSim_sender-seq-4"
                                                class="p-1 border border-gray-400 rounded bg-white text-xs text-center relative shadow-sm">
                                                SEQ 4 <span class="tcpRelSim_rto-timer" id="tcpRelSim_timer-4"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpRelSim_sender-seq-5"
                                                class="p-1 border border-gray-400 rounded bg-gray-300 text-xs text-center opacity-50 shadow-sm">
                                                SEQ 5 <span class="tcpRelSim_rto-timer" id="tcpRelSim_timer-5"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpRelSim_sender-seq-6"
                                                class="p-1 border border-gray-400 rounded bg-gray-300 text-xs text-center opacity-50 shadow-sm">
                                                SEQ 6 <span class="tcpRelSim_rto-timer" id="tcpRelSim_timer-6"><i
                                                        class="fas fa-clock"></i></span> </div>
                                        </div>
                                    </div>
                                    <div id="tcpRelSim_sender-status"
                                        class="tcpRelSim_status-text text-xs text-center mt-2 text-blue-600 font-medium">
                                        å‡†å¤‡å‘é€...</div>
                                </div>
                                <div class="w-2/5 border border-gray-300 rounded-lg p-3 bg-gray-50 shadow">
                                    <h5 class="font-medium text-center mb-1 text-gray-700 text-base">æ¥æ”¶æ–¹ (Receiver)</h5>
                                    <div class="border border-green-300 rounded p-2 mb-2 bg-green-50 shadow-inner">
                                        <h6 class="text-sm font-medium text-center text-green-800 mb-1">åº”ç”¨å±‚ (å·²æ¥æ”¶æ•°æ®)</h6>
                                        <div id="tcpRelSim_app-layer" class="tcpRelSim_app-layer-area min-h-[40px]">
                                        </div>
                                    </div>
                                    <div class="border border-purple-300 rounded p-2 bg-purple-50 shadow-inner">
                                        <h6 class="text-sm font-medium text-center text-purple-800 mb-1">TCP åè®®å±‚</h6>
                                        <div class="text-xs text-center mb-2 text-gray-600">æœŸæœ›: <span
                                                id="tcpRelSim_expected-seq" class="font-bold text-purple-700">SEQ
                                                1</span></div>
                                        <div id="tcpRelSim_receiver-buffer"
                                            class="flex space-x-1 justify-center border border-dashed border-gray-400 p-2 rounded min-h-[60px] bg-white flex-wrap">
                                            <div class="tcpRelSim_buffer-slot">ç©º</div>
                                            <div class="tcpRelSim_buffer-slot">ç©º</div>
                                            <div class="tcpRelSim_buffer-slot">ç©º</div>
                                            <div class="tcpRelSim_buffer-slot">ç©º</div>
                                        </div>
                                    </div>
                                    <div id="tcpRelSim_receiver-status"
                                        class="tcpRelSim_status-text text-xs text-center mt-2 text-purple-600 font-medium">
                                        ç­‰å¾…æ•°æ®...</div>
                                </div>
                            </div>
                            <div id="tcpRelSim_network-path"></div>
                            <div id="tcpRelSim_channel" class="absolute top-0 left-0 w-full h-full pointer-events-none">
                            </div>
                            <div id="tcpRelSim_explanation"
                                class="absolute bottom-14 left-1/2 transform -translate-x-1/2 w-11/12 text-center text-sm text-gray-700 bg-white bg-opacity-80 p-2 rounded shadow z-20">
                                ç‚¹å‡» "ä¸‹ä¸€æ­¥" å¼€å§‹æ¨¡æ‹Ÿã€‚
                            </div>
                        </div>
                        <div class="mt-6 flex justify-center space-x-4">
                            <button id="tcpRelSim_next-step" class="button button-primary"> <i
                                    class="fas fa-forward mr-1"></i> ä¸‹ä¸€æ­¥ </button>
                            <button id="tcpRelSim_reset" class="button button-secondary"> <i
                                    class="fas fa-undo mr-1"></i> é‡ç½® </button>
                        </div>
                    </div>
                </section>

                <section id="tcp-flow-control" class="content-section fade-in-section" style="animation-delay: 0.2s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">traffic</span>TCP æµé‡æ§åˆ¶
                        <span class="level-tag level-tag-high">é«˜é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">ç›®çš„ä¸æœºåˆ¶</h3>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li><strong>ç›®çš„:</strong> é˜²æ­¢å‘é€æ–¹å‘é€é€Ÿåº¦è¿‡å¿«ï¼Œå¯¼è‡´æ¥æ”¶æ–¹ç¼“å†²åŒºæº¢å‡ºè€Œæ¥ä¸åŠå¤„ç†ã€‚è¿™æ˜¯ <strong>ç«¯åˆ°ç«¯</strong> çš„æ§åˆ¶ã€‚</li>
                            <li><strong>æœºåˆ¶: æ»‘åŠ¨çª—å£ (Sliding Window)</strong></li>
                            <li>æ¥æ”¶æ–¹é€šè¿‡ TCP å¤´éƒ¨çš„ <b>çª—å£ (Window)</b> å­—æ®µå‘ŠçŸ¥å‘é€æ–¹è‡ªå·±å½“å‰å¯ç”¨çš„ç¼“å†²åŒºå¤§å° (rwnd, Receive Window)ã€‚</li>
                            <li>å‘é€æ–¹æ ¹æ®æ¥æ”¶æ–¹çš„ rwnd è°ƒæ•´è‡ªå·±çš„å‘é€é€Ÿç‡ï¼Œç¡®ä¿å‘é€çš„æ•°æ®é‡ä¸è¶…è¿‡æ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›ã€‚</li>
                            <li>çª—å£å¤§å°å¯ä»¥åŠ¨æ€å˜åŒ–ã€‚å¦‚æœæ¥æ”¶æ–¹çª—å£ä¸º 0 (é›¶çª—å£)ï¼Œå‘é€æ–¹ä¼šåœæ­¢å‘é€æ•°æ®ï¼ˆé™¤é›¶çª—å£æ¢æµ‹æŠ¥æ–‡å¤–ï¼‰ã€‚</li>
                            <li><strong>ä¸æ‹¥å¡æ§åˆ¶çš„åŒºåˆ«:</strong> æµé‡æ§åˆ¶å…³å¿ƒæ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›ï¼›æ‹¥å¡æ§åˆ¶å…³å¿ƒç½‘ç»œçš„æ‰¿è½½èƒ½åŠ›ã€‚</li>
                        </ul>
                    </div>
                    <div class="content-card max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-lg">
                        <h4 class="head4 text-center mb-6 text-gray-800"> <i
                                class="fas fa-network-wired mr-2 text-blue-600"></i>äº¤äº’å¼ TCP æµé‡æ§åˆ¶æ¨¡æ‹Ÿ </h4>
                        <div id="tcpFlowSim_message-area" class="mb-6 text-sm">
                            <div id="tcpFlowSim_message-content">æ¬¢è¿ï¼ç‚¹å‡» "å‘é€æ•°æ®åŒ…" å¼€å§‹æ¨¡æ‹Ÿ TCP æµé‡æ§åˆ¶ã€‚</div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="border border-gray-200 rounded-lg p-4 bg-blue-50">
                                <h5 class="text-lg font-semibold mb-3 text-blue-800 flex items-center"> <i
                                        class="fas fa-paper-plane mr-2"></i>å‘é€æ–¹ (Sender) </h5>
                                <div class="mb-2"> <span class="font-medium text-sm text-gray-700">å‘é€ç¼“å†²åŒº (ç°è‰²:å¾…å‘é€,
                                        è“è‰²:å·²å‘é€æœªç¡®è®¤, ç»¿è‰²:å·²ç¡®è®¤):</span>
                                    <div id="tcpFlowSim_sender-buffer"
                                        class="tcpFlowSim_buffer mt-1 relative h-20 tcpFlowSim_has-tooltip">
                                        <div class="tcpFlowSim_tooltip top-0 left-0 mt-1 ml-1">è“è‰²æ¡†è¡¨ç¤ºå‘é€çª—å£ (Send
                                            Window)<br>å¤§å°: <span id="tcpFlowSim_send-window-size-tooltip">0</span></div>
                                    </div>
                                </div>
                                <div class="text-sm space-y-1 text-gray-700">
                                    <p class="tcpFlowSim_has-tooltip relative inline-block">SND.NXT: <strong
                                            id="tcpFlowSim_snd-nxt" class="text-blue-600">1</strong><span
                                            class="tcpFlowSim_tooltip bottom-full mb-1">ä¸‹ä¸€ä¸ªè¦å‘é€çš„æ•°æ®åŒ…çš„åºå·</span></p>
                                    <p class="tcpFlowSim_has-tooltip relative inline-block ml-4">SND.UNA: <strong
                                            id="tcpFlowSim_snd-una" class="text-blue-600">1</strong><span
                                            class="tcpFlowSim_tooltip bottom-full mb-1">æœ€æ—©æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…åºå· (å‘é€çª—å£å·¦è¾¹ç•Œ)</span>
                                    </p>
                                    <p class="tcpFlowSim_has-tooltip relative block mt-1">å‘é€çª—å£å¤§å°: <strong
                                            id="tcpFlowSim_send-window-size" class="text-blue-600">0</strong><span
                                            class="tcpFlowSim_tooltip bottom-full mb-1">å‘é€æ–¹å½“å‰è®¤ä¸ºå¯ä»¥å‘é€çš„æ€»é‡
                                            (ç®€åŒ–=<code>rwnd</code>)</span></p>
                                    <p class="tcpFlowSim_has-tooltip relative block">å¯ç”¨çª—å£å¤§å°: <strong
                                            id="tcpFlowSim_usable-window-size" class="text-blue-600">0</strong><span
                                            class="tcpFlowSim_tooltip bottom-full mb-1">å‘é€æ–¹è¿˜èƒ½ç«‹å³å‘é€çš„æ•°æ®é‡ = å‘é€çª—å£ - (SND.NXT
                                            - SND.UNA)</span></p>
                                    <p class="tcpFlowSim_has-tooltip relative block">æœ€æ–°è·çŸ¥çš„ <code>rwnd</code>: <strong
                                            id="tcpFlowSim_advertised-rwnd" class="text-amber-600">0</strong><span
                                            class="tcpFlowSim_tooltip bottom-full mb-1">ä»æ¥æ”¶æ–¹ACKä¸­å¾—çŸ¥çš„æœ€æ–°æ¥æ”¶çª—å£å¤§å°</span></p>
                                </div>
                            </div>
                            <div class="border border-gray-200 rounded-lg p-4 bg-amber-50">
                                <h5 class="text-lg font-semibold mb-3 text-amber-800 flex items-center"> <i
                                        class="fas fa-inbox mr-2"></i>æ¥æ”¶æ–¹ (Receiver) </h5>
                                <div class="mb-2"> <span class="font-medium text-sm text-gray-700">æ¥æ”¶ç¼“å†²åŒº (ç²‰è‰²:
                                        å·²æ¥æ”¶æœªè¢«åº”ç”¨å¤„ç†):</span>
                                    <div id="tcpFlowSim_receiver-buffer-container" class="relative">
                                        <div id="tcpFlowSim_receiver-buffer"
                                            class="tcpFlowSim_buffer mt-1 relative h-20 tcpFlowSim_has-tooltip">
                                            <div class="tcpFlowSim_tooltip top-0 left-0 mt-1 ml-1">æ©™è‰²æ¡†è¡¨ç¤ºæ¥æ”¶çª—å£ (Receive
                                                Window)<br>å¤§å° (<code>rwnd</code>): <span
                                                    id="tcpFlowSim_recv-window-size-tooltip">0</span></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-sm space-y-1 text-gray-700">
                                    <p class="tcpFlowSim_has-tooltip relative inline-block">RCV.NXT: <strong
                                            id="tcpFlowSim_rcv-nxt" class="text-amber-600">1</strong><span
                                            class="tcpFlowSim_tooltip bottom-full mb-1">æœŸæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªæ•°æ®åŒ…åºå· (æ¥æ”¶çª—å£å·¦è¾¹ç•Œ)</span>
                                    </p>
                                    <p class="tcpFlowSim_has-tooltip relative inline-block ml-4">ç¼“å†²åŒºæ€»å®¹é‡: <strong
                                            id="tcpFlowSim_buffer-capacity" class="text-amber-600">10</strong><span
                                            class="tcpFlowSim_tooltip bottom-full mb-1">æ¥æ”¶ç¼“å†²åŒºèƒ½å®¹çº³çš„æœ€å¤§æ•°æ®åŒ…æ•°</span></p>
                                    <p class="tcpFlowSim_has-tooltip relative block mt-1">å½“å‰æ¥æ”¶çª—å£ (<code>rwnd</code>):
                                        <strong id="tcpFlowSim_current-rwnd" class="text-amber-600">10</strong><span
                                            class="tcpFlowSim_tooltip bottom-full mb-1">å½“å‰å®é™…å¯ç”¨ç¼“å†²åŒºç©ºé—´ = æ€»å®¹é‡ - å·²å ç”¨</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 text-center space-x-2"> <button id="tcpFlowSim_send-packet-btn"
                                class="tcpFlowSim_control-button tcpFlowSim_send"> <i class="fas fa-arrow-right"></i>
                                å‘é€æ•°æ®åŒ… (Send) </button> <button id="tcpFlowSim_process-packet-btn"
                                class="tcpFlowSim_control-button tcpFlowSim_process" disabled> <i
                                    class="fas fa-cogs"></i> åº”ç”¨å¤„ç†æ•°æ®åŒ… (Process) </button> <button
                                id="tcpFlowSim_reset-btn" class="tcpFlowSim_control-button tcpFlowSim_reset"> <i
                                    class="fas fa-redo"></i> é‡ç½®æ¨¡æ‹Ÿ (Reset) </button> </div>
                        <div id="tcpFlowSim_transmission-channel" class="relative h-16 mt-4"> </div>
                        <div class="mt-8 p-4 border border-gray-200 rounded-lg bg-gray-50 tcpFlowSim_explanation">
                            <h5 class="font-semibold mb-2 text-gray-700"><i
                                    class="fas fa-info-circle mr-1 text-blue-500"></i> å…³é”®æ¦‚å¿µè§£é‡Š (é¢è¯•è¦ç‚¹)</h5>
                            <ul class="list-disc list-inside space-y-2 text-sm text-gray-700">
                                <li><strong>æµé‡æ§åˆ¶ (Flow Control) ç›®çš„:</strong> <span
                                        class="font-semibold">æ ¸å¿ƒç›®æ ‡æ˜¯é˜²æ­¢å‘é€æ–¹å‘é€è¿‡å¿«ï¼Œå¯¼è‡´æ¥æ”¶æ–¹çš„ç¼“å†²åŒºæº¢å‡ºï¼Œç¡®ä¿æ¥æ”¶æ–¹æœ‰è¶³å¤Ÿçš„æ—¶é—´å¤„ç†æ•°æ®ã€‚</span> è¿™æ˜¯ç«¯åˆ°ç«¯
                                    (ç‚¹å¯¹ç‚¹) çš„æ§åˆ¶ã€‚</li>
                                <li><strong>æ»‘åŠ¨çª—å£ (Sliding Window):</strong> <span
                                        class="font-semibold">å®ç°æµé‡æ§åˆ¶çš„æ ¸å¿ƒæœºåˆ¶ã€‚</span> æ¥æ”¶æ–¹æ ¹æ®è‡ªå·±ç¼“å†²åŒºçš„ä½¿ç”¨æƒ…å†µï¼Œè®¡ç®—å‡ºè¿˜èƒ½æ¥æ”¶å¤šå°‘æ•°æ®ï¼Œè¿™ä¸ªå€¼å°±æ˜¯
                                    <span class="font-semibold text-amber-600">æ¥æ”¶çª—å£ (<code>rwnd</code>)</span>ã€‚
                                </li>
                                <li><strong><code>rwnd</code> (Receive Window):</strong> <span
                                        class="font-semibold">æ¥æ”¶æ–¹é€šè¿‡ TCP æŠ¥æ–‡æ®µå¤´éƒ¨çš„ "çª—å£" å­—æ®µï¼Œå°† <code>rwnd</code> å‘ŠçŸ¥å‘é€æ–¹ã€‚</span>
                                    å®ƒåŠ¨æ€åæ˜ äº†æ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›ã€‚</li>
                                <li><strong>å‘é€çª—å£ (Send Window):</strong> å‘é€æ–¹æ ¹æ®è‡ªå·±æ”¶åˆ°çš„ <code>rwnd</code> å’Œå½“å‰ç½‘ç»œçš„æ‹¥å¡æƒ…å†µ (ç”±<span
                                        class="font-semibold text-red-600">æ‹¥å¡çª—å£ <code>cwnd</code></span> åæ˜ ï¼Œæœ¬åŠ¨ç”»ç®€åŒ–å¤„ç†)
                                    æ¥å…±åŒå†³å®šè‡ªå·±å½“å‰å¯ä»¥å‘é€å¤šå°‘æ•°æ®ã€‚å‘é€çª—å£å¤§å° = min(<code>rwnd</code>, <code>cwnd</code>)ã€‚<span
                                        class="font-semibold">å‘é€æ–¹ä»»ä½•æ—¶åˆ»å·²å‘é€ä½†æœªç¡®è®¤çš„æ•°æ®é‡ä¸èƒ½è¶…è¿‡å‘é€çª—å£çš„å¤§å°ã€‚</span></li>
                                <li><strong>SND.UNA / SND.NXT / RCV.NXT:</strong> è¿™äº›æŒ‡é’ˆå…±åŒå®šä¹‰äº†çª—å£çš„ä½ç½®å’ŒçŠ¶æ€ã€‚<code>SND.UNA</code>
                                    æ˜¯å‘é€çª—å£çš„å·¦è¾¹ç•Œ (å·²ç¡®è®¤)ï¼Œ<code>SND.NXT</code> æ˜¯ä¸‹ä¸€ä¸ªè¦å‘é€çš„åºå·ï¼Œ(<code>SND.NXT</code> -
                                    <code>SND.UNA</code>) æ˜¯å·²å‘é€æœªç¡®è®¤çš„æ•°æ®é‡ã€‚<code>RCV.NXT</code> æ˜¯æ¥æ”¶çª—å£çš„å·¦è¾¹ç•Œ (æœŸæœ›æ¥æ”¶)ã€‚
                                </li>
                                <li><strong>å¯ç”¨çª—å£ (Usable Window):</strong> å‘é€æ–¹<span
                                        class="font-semibold">å®é™…è¿˜èƒ½ç«‹å³å‘é€</span>çš„æ•°æ®é‡ï¼Œç­‰äº `å‘é€çª—å£å¤§å° - (<code>SND.NXT</code> -
                                    <code>SND.UNA</code>)`ã€‚
                                </li>
                                <li><strong>é›¶çª—å£ (Zero Window):</strong> å½“æ¥æ”¶æ–¹ç¼“å†²åŒºæ»¡æ—¶ï¼Œå®ƒä¼šé€šå‘Š <code>rwnd = 0</code>ã€‚<span
                                        class="font-semibold">å‘é€æ–¹æ”¶åˆ°é›¶çª—å£é€šçŸ¥åï¼Œå¿…é¡»åœæ­¢å‘é€æ•°æ®</span> (é™¤äº†é›¶çª—å£æ¢æµ‹æŠ¥æ–‡)ï¼Œç›´åˆ°æ”¶åˆ°ä¸€ä¸ª
                                    <code>rwnd > 0</code> çš„ ACKã€‚
                                </li>
                                <li><strong>é›¶çª—å£æ¢æµ‹ (Zero Window Probe):</strong> <span
                                        class="font-semibold">ä¸ºäº†æ‰“ç ´å‘é€æ–¹å› ç­‰å¾…çª—å£æ›´æ–°è€Œå¯èƒ½äº§ç”Ÿçš„æ­»é”</span>ï¼Œå‘é€æ–¹åœ¨æ”¶åˆ°é›¶çª—å£åä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå‘¨æœŸæ€§åœ°å‘é€ä¸€ä¸ªå°çš„æ¢æµ‹æŠ¥æ–‡
                                    (é€šå¸¸åªåŒ…å« 1 å­—èŠ‚æ•°æ®æˆ–ä»…æ˜¯å¤´éƒ¨)ã€‚æ¥æ”¶æ–¹æ”¶åˆ°æ¢æµ‹æŠ¥æ–‡åï¼Œå¿…é¡»å›å¤å½“å‰çš„ <code>rwnd</code>ï¼Œå³ä½¿å®ƒä»ç„¶æ˜¯ 0ã€‚</li>
                                <li><strong>ä¸æ‹¥å¡æ§åˆ¶çš„åŒºåˆ«:</strong> æµé‡æ§åˆ¶å…³å¿ƒçš„æ˜¯<span class="font-semibold">æ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›
                                        (ç‚¹å¯¹ç‚¹)</span>ï¼Œé˜²æ­¢å‹å®æ¥æ”¶æ–¹ï¼›æ‹¥å¡æ§åˆ¶å…³å¿ƒçš„æ˜¯<span class="font-semibold">æ•´ä¸ªç½‘ç»œçš„æ‰¿è½½èƒ½åŠ›
                                        (ç«¯åˆ°ç½‘)</span>ï¼Œé˜²æ­¢ç½‘ç»œæ‹¥å¡ã€‚ä¸¤è€…å…±åŒå†³å®šå‘é€æ–¹çš„æœ€ç»ˆå‘é€é€Ÿç‡ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section id="tcp-congestion-control" class="content-section fade-in-section"
                    style="animation-delay: 0.25s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">speed</span>TCP æ‹¥å¡æ§åˆ¶
                        <span class="level-tag level-tag-high">é«˜é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">ç›®çš„ä¸æœºåˆ¶</h3>
                        <p class="text-sm text-gray-600 mb-3">é˜²æ­¢è¿‡å¤šæ•°æ®æ³¨å…¥ç½‘ç»œå¯¼è‡´è·¯ç”±å™¨æˆ–é“¾è·¯è¿‡è½½ã€‚TCP é€šè¿‡ç»´æŠ¤ä¸€ä¸ª <b>æ‹¥å¡çª—å£ (cwnd, Congestion
                                Window)</b> æ¥åŠ¨æ€è°ƒæ•´å‘é€é€Ÿç‡ã€‚å®é™…å‘é€çª—å£ = min(cwnd, rwnd)ã€‚</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                            <div class="p-3 border rounded bg-white shadow-sm">
                                <h4 class="font-medium text-blue-800 mb-1">æ…¢å¯åŠ¨ (Slow Start)</h4>
                                <p>è¿æ¥åˆå§‹æˆ–è¶…æ—¶é‡ä¼ åï¼Œcwnd è®¾ä¸º 1 MSSã€‚æ¯æ”¶åˆ°ä¸€ä¸ª ACKï¼Œcwnd å¢åŠ  1 MSS (æŒ‡æ•°å¢é•¿)ã€‚</p>
                            </div>
                            <div class="p-3 border rounded bg-white shadow-sm">
                                <h4 class="font-medium text-blue-800 mb-1">æ‹¥å¡é¿å… (Congestion Avoidance)</h4>
                                <p>å½“ cwnd è¾¾åˆ°æ…¢å¯åŠ¨é˜ˆå€¼ (ssthresh) åï¼Œå¢é•¿å˜ä¸ºçº¿æ€§ï¼šæ¯ä¸ª RTT å¢åŠ  1 MSSã€‚</p>
                            </div>
                            <div class="p-3 border rounded bg-white shadow-sm">
                                <h4 class="font-medium text-blue-800 mb-1">å¿«é€Ÿé‡ä¼ /æ¢å¤</h4>
                                <p>æ”¶åˆ° 3 ä¸ªé‡å¤ ACK æ—¶ï¼Œssthresh è®¾ä¸º cwnd/2ï¼Œcwnd è®¾ä¸º ssthresh + 3 MSS (æˆ–ç›´æ¥å‡åŠ)ï¼Œè¿›å…¥æ‹¥å¡é¿å…ï¼Œé¿å…å®Œå…¨æ…¢å¯åŠ¨ã€‚
                                </p>
                            </div>
                            <div class="p-3 border rounded bg-white shadow-sm">
                                <h4 class="font-medium text-blue-800 mb-1">è¶…æ—¶é‡ä¼ </h4>
                                <p>å‘ç”Ÿ RTO è¶…æ—¶ï¼Œè®¤ä¸ºç½‘ç»œä¸¥é‡æ‹¥å¡ã€‚ssthresh è®¾ä¸º cwnd/2ï¼Œcwnd ç›´æ¥é™ä¸º 1 MSSï¼Œé‡æ–°è¿›å…¥æ…¢å¯åŠ¨ã€‚</p>
                            </div>
                        </div>
                    </div>
                    <div class="content-card max-w-[80vw] mx-auto bg-white p-6 rounded-lg shadow-md">
                        <h4 class="head4 text-center mb-6 text-gray-800"> <i
                                class="fas fa-traffic-light mr-1 text-blue-500"></i>äº¤äº’å¼ TCP æ‹¥å¡æ§åˆ¶æ¨¡æ‹Ÿ </h4>
                        <p class="text-sm text-gray-600 mb-3"> æ¨¡æ‹Ÿ TCP å¦‚ä½•æ ¹æ®ç½‘ç»œåé¦ˆï¼ˆACKã€ä¸¢åŒ…ã€é‡å¤ ACKï¼‰åŠ¨æ€è°ƒæ•´æ‹¥å¡çª—å£ (cwnd) å’Œæ…¢å¯åŠ¨é˜ˆå€¼
                            (ssthresh)ã€‚ </p>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6 text-center items-center">
                            <div class="md:col-span-2"> <span
                                    class="text-sm font-medium text-gray-500 block mb-1">å½“å‰çŠ¶æ€</span>
                                <div id="tcpCongestionSim_status-indicator"
                                    class="tcpCongestionSim_status-indicator tcpCongestionSim_status-slow-start mx-auto">
                                </div>
                            </div>
                            <div> <span class="text-sm font-medium text-gray-500">æ‹¥å¡çª—å£ (cwnd)</span>
                                <div id="tcpCongestionSim_cwnd-value" class="text-xl font-semibold text-blue-600 mt-1">1
                                    MSS</div>
                            </div>
                            <div> <span class="text-sm font-medium text-gray-500">æ…¢å¯åŠ¨é˜ˆå€¼ (ssthresh)</span>
                                <div id="tcpCongestionSim_ssthresh-value"
                                    class="text-xl font-semibold text-green-600 mt-1">64 MSS</div>
                            </div>
                            <div> <span class="text-sm font-medium text-gray-500">è½®æ¬¡ (RTT)</span>
                                <div id="tcpCongestionSim_rtt-counter" class="text-xl font-semibold text-gray-600 mt-1">
                                    0</div>
                            </div>
                        </div>
                        <div class="mb-6 p-4 border rounded-md bg-gray-50 min-h-[60px]">
                            <h5 class="text-sm font-medium text-gray-600 mb-2 text-center">æ•°æ®åŒ…çª—å£ (å¤§å° = cwnd, æœ€å¤šæ˜¾ç¤º 30 ä¸ª)
                            </h5>
                            <div id="tcpCongestionSim_packet-area"
                                class="flex flex-wrap justify-center items-center gap-1"></div>
                        </div>
                        <div class="flex flex-wrap justify-center items-center mb-6 gap-3"> <button
                                id="tcpCongestionSim_start-button" class="tcpCongestionSim_control-button">å¼€å§‹/ä¸‹ä¸€æ­¥
                                (ACK)</button> <button id="tcpCongestionSim_loss-button"
                                class="tcpCongestionSim_control-button bg-red-500 hover:bg-red-600">æ¨¡æ‹Ÿä¸¢åŒ… (è¶…æ—¶)</button>
                            <button id="tcpCongestionSim_dup-ack-button"
                                class="tcpCongestionSim_control-button bg-yellow-500 hover:bg-yellow-600">æ¨¡æ‹Ÿé‡å¤ACK (<span
                                    id="tcpCongestionSim_dup-ack-display">0</span>/3)</button> <button
                                id="tcpCongestionSim_reset-button"
                                class="tcpCongestionSim_control-button bg-gray-500 hover:bg-gray-600">é‡ç½®</button>
                        </div>
                        <div class="mt-8 h-64"> <canvas id="tcpCongestionSim_congestionChart"></canvas> </div>
                        <div id="tcpCongestionSim_explanation-area" class="tcpCongestionSim_explanation"> ç‚¹å‡» "å¼€å§‹/ä¸‹ä¸€æ­¥"
                            æŒ‰é’®å¯åŠ¨æ¨¡æ‹Ÿã€‚åˆå§‹çŠ¶æ€ä¸ºæ…¢å¯åŠ¨ï¼Œcwnd = 1 MSSã€‚ </div>
                    </div>
                </section>

                <section id="tcp-hol" class="content-section fade-in-section" style="animation-delay: 0.3s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">block</span>TCP é˜Ÿå¤´é˜»å¡ (Head-of-Line
                        Blocking)
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-base">åŸºç¡€</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">åŸç†</h3>
                        <p class="text-sm text-gray-700">ç”±äº TCP å¿…é¡»ä¿è¯å­—èŠ‚æµçš„ <b>ä¸¥æ ¼æœ‰åºäº¤ä»˜</b>ï¼Œå¦‚æœä¸€ä¸ª TCP
                            æŠ¥æ–‡æ®µä¸¢å¤±ï¼Œå³ä½¿åç»­çš„æŠ¥æ–‡æ®µå·²ç»åˆ°è¾¾æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹çš„ TCP åè®®æ ˆä¹Ÿå¿…é¡»ç¼“å­˜å®ƒä»¬ï¼Œ<b>ç­‰å¾…ä¸¢å¤±çš„æŠ¥æ–‡æ®µè¢«æˆåŠŸé‡ä¼ </b>
                            åï¼Œæ‰èƒ½æŒ‰é¡ºåºå°†æ•°æ®äº¤ä»˜ç»™åº”ç”¨å±‚ã€‚è¿™ä¸ªç­‰å¾…è¿‡ç¨‹å°±é€ æˆäº†é˜Ÿå¤´é˜»å¡ã€‚</p>
                        <p class="text-sm text-gray-700 mt-2">è¿™æ˜¯ HTTP/1.x æ€§èƒ½ç“¶é¢ˆçš„ä¸»è¦åŸå› ä¹‹ä¸€ï¼ˆå³ä½¿ä½¿ç”¨å¤šè¿æ¥ä¹Ÿå—é™äºè¿æ¥æ•°ï¼‰ï¼Œä¹Ÿæ˜¯ HTTP/2 å’Œ HTTP/3
                            (QUIC) è¯•å›¾è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€‚</p>
                    </div>
                    <div class="content-card">
                        <h4 class="head4">é˜Ÿå¤´é˜»å¡æ¨¡æ‹Ÿ</h4>
                        <p class="text-sm text-gray-600 mb-4">ä»¥ä¸‹æ¨¡æ‹Ÿå±•ç¤ºäº†å½“ SEQ 2 ä¸¢å¤±åï¼Œåç»­åˆ°è¾¾çš„ SEQ 3 å’Œ SEQ 4 æ— æ³•ç«‹å³äº¤ä»˜ç»™åº”ç”¨å±‚ï¼Œå¿…é¡»ç­‰å¾… SEQ
                            2 é‡ä¼ æˆåŠŸåæ‰èƒ½æŒ‰åºäº¤ä»˜çš„è¿‡ç¨‹ã€‚</p>
                        <div id="tcpHolSim_animation-area"
                            class="mt-6 p-4 border border-blue-200 rounded-lg bg-gradient-to-b from-blue-50 to-white relative overflow-hidden min-h-[450px] shadow-inner">
                            <div class="flex justify-between items-start mb-4 relative z-20">
                                <div class="w-2/5 border border-gray-300 rounded-lg p-3 bg-gray-50 shadow">
                                    <h5 class="font-medium text-center mb-2 text-gray-700 text-base">å‘é€æ–¹ (Sender)</h5>
                                    <div class="text-xs mb-2 text-center text-gray-600">çª—å£å¤§å° (W) = 4</div>
                                    <div id="tcpHolSim_sender-window"
                                        class="relative border border-dashed border-gray-400 p-2 rounded tcpHolSim_highlight-window min-h-[60px]">
                                        <span id="tcpHolSim_sender-window-label"
                                            class="absolute -top-2 -left-2 bg-blue-100 text-blue-700 px-1 py-0.5 text-xs rounded shadow-sm">å‘é€çª—å£
                                            [1-4]</span>
                                        <div class="flex space-x-1 justify-center items-center mt-2 flex-wrap">
                                            <div id="tcpHolSim_sender-seq-1"
                                                class="p-1 border border-gray-400 rounded bg-white text-xs text-center relative shadow-sm">
                                                SEQ 1 <span class="tcpHolSim_rto-timer" id="tcpHolSim_timer-1"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpHolSim_sender-seq-2"
                                                class="p-1 border border-gray-400 rounded bg-white text-xs text-center relative shadow-sm">
                                                SEQ 2 <span class="tcpHolSim_rto-timer" id="tcpHolSim_timer-2"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpHolSim_sender-seq-3"
                                                class="p-1 border border-gray-400 rounded bg-white text-xs text-center relative shadow-sm">
                                                SEQ 3 <span class="tcpHolSim_rto-timer" id="tcpHolSim_timer-3"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpHolSim_sender-seq-4"
                                                class="p-1 border border-gray-400 rounded bg-white text-xs text-center relative shadow-sm">
                                                SEQ 4 <span class="tcpHolSim_rto-timer" id="tcpHolSim_timer-4"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpHolSim_sender-seq-5"
                                                class="p-1 border border-gray-400 rounded bg-gray-300 text-xs text-center opacity-50 shadow-sm">
                                                SEQ 5 <span class="tcpHolSim_rto-timer" id="tcpHolSim_timer-5"><i
                                                        class="fas fa-clock"></i></span> </div>
                                            <div id="tcpHolSim_sender-seq-6"
                                                class="p-1 border border-gray-400 rounded bg-gray-300 text-xs text-center opacity-50 shadow-sm">
                                                SEQ 6 <span class="tcpHolSim_rto-timer" id="tcpHolSim_timer-6"><i
                                                        class="fas fa-clock"></i></span> </div>
                                        </div>
                                    </div>
                                    <div id="tcpHolSim_sender-status"
                                        class="tcpHolSim_status-text text-xs text-center mt-2 text-blue-600 font-medium">
                                        å‡†å¤‡å‘é€...</div>
                                </div>
                                <div class="w-2/5 border border-gray-300 rounded-lg p-3 bg-gray-50 shadow">
                                    <h5 class="font-medium text-center mb-1 text-gray-700 text-base">æ¥æ”¶æ–¹ (Receiver)</h5>
                                    <div class="border border-green-300 rounded p-2 mb-2 bg-green-50 shadow-inner">
                                        <h6 class="text-sm font-medium text-center text-green-800 mb-1">åº”ç”¨å±‚ (å·²æ¥æ”¶æ•°æ®)</h6>
                                        <div id="tcpHolSim_app-layer" class="tcpHolSim_app-layer-area min-h-[40px]">
                                        </div>
                                    </div>
                                    <div class="border border-purple-300 rounded p-2 bg-purple-50 shadow-inner">
                                        <h6 class="text-sm font-medium text-center text-purple-800 mb-1">TCP åè®®å±‚</h6>
                                        <div class="text-xs text-center mb-2 text-gray-600">æœŸæœ›: <span
                                                id="tcpHolSim_expected-seq" class="font-bold text-purple-700">SEQ
                                                1</span></div>
                                        <div id="tcpHolSim_receiver-buffer"
                                            class="flex space-x-1 justify-center border border-dashed border-gray-400 p-2 rounded min-h-[60px] bg-white flex-wrap">
                                            <div class="tcpHolSim_buffer-slot">ç©º</div>
                                            <div class="tcpHolSim_buffer-slot">ç©º</div>
                                            <div class="tcpHolSim_buffer-slot">ç©º</div>
                                            <div class="tcpHolSim_buffer-slot">ç©º</div>
                                        </div>
                                    </div>
                                    <div id="tcpHolSim_receiver-status"
                                        class="tcpHolSim_status-text text-xs text-center mt-2 text-purple-600 font-medium">
                                        ç­‰å¾…æ•°æ®...</div>
                                </div>
                            </div>
                            <div id="tcpHolSim_network-path"></div>
                            <div id="tcpHolSim_channel" class="absolute top-0 left-0 w-full h-full pointer-events-none">
                            </div>
                            <div id="tcpHolSim_explanation"
                                class="absolute bottom-14 left-1/2 transform -translate-x-1/2 w-11/12 text-center text-sm text-gray-700 bg-white bg-opacity-80 p-2 rounded shadow z-20">
                                ç‚¹å‡» "ä¸‹ä¸€æ­¥" å¼€å§‹æ¨¡æ‹Ÿã€‚ </div>
                        </div>
                        <div class="mt-6 flex justify-center space-x-4">
                            <button id="tcpHolSim_next-step" class="button button-primary"> <i
                                    class="fas fa-forward mr-1"></i> ä¸‹ä¸€æ­¥ </button>
                            <button id="tcpHolSim_reset" class="button button-secondary"> <i
                                    class="fas fa-undo mr-1"></i> é‡ç½® </button>
                        </div>
                    </div>
                </section>

                <section id="udp" class="content-section fade-in-section" style="animation-delay: 0.35s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">rocket_launch</span>UDP: ç”¨æˆ·æ•°æ®æŠ¥åè®®
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-base">åŸºç¡€</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">UDP æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>å…¨ç§°: <b>User Datagram Protocol</b> (ç”¨æˆ·æ•°æ®æŠ¥åè®®)ï¼Œå±äº <b>ä¼ è¾“å±‚</b> åè®®ã€‚</li>
                            <li>æ ¸å¿ƒç‰¹ç‚¹: <b>æ— è¿æ¥ã€ä¸å¯é ã€å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ã€é¢å‘æŠ¥æ–‡ã€å¤´éƒ¨å¼€é”€å°</b>ã€‚</li>
                            <li>ä¸»è¦ç›®æ ‡: æä¾›ä¸€ç§ç®€å•çš„ã€ä½å¼€é”€çš„æ•°æ®æŠ¥ä¼ è¾“æœåŠ¡ï¼Œä¸ä¿è¯å¯é æ€§å’Œé¡ºåºã€‚</li>
                            <li>åº”ç”¨åœºæ™¯: DNS, DHCP, SNMP, TFTP, å®æ—¶éŸ³è§†é¢‘ (RTP), åœ¨çº¿æ¸¸æˆç­‰å¯¹å®æ—¶æ€§è¦æ±‚é«˜ã€èƒ½å®¹å¿å°‘é‡ä¸¢åŒ…çš„åº”ç”¨ã€‚</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">UDP æŠ¥æ–‡æ ¼å¼</h3>
                        <p class="text-sm text-gray-600 mb-3"> UDP å¤´éƒ¨éå¸¸ç®€æ´ï¼Œåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼ˆ4 ä¸ª 16 ä½å­—ï¼‰ã€‚ç‚¹å‡»ä¸‹æ–¹å­—æ®µæŸ¥çœ‹è¯´æ˜ï¼š </p>
                        <div id="udp-header-vis"
                            class="border border-gray-300 rounded overflow-hidden shadow-md select-none">
                            <div class="flex w-full">
                                <div class="header-field flex-1 p-2 text-center border-r border-b border-gray-400 bg-purple-100 hover:bg-purple-300 cursor-pointer text-sm font-mono"
                                    data-info="æºç«¯å£ (16ä½): æ ‡è¯†å‘é€æ–¹åº”ç”¨ç¨‹åºç«¯å£å· (å¯é€‰)ã€‚"> æºç«¯å£ (16) </div>
                                <div class="header-field flex-1 p-2 text-center border-b border-gray-400 bg-purple-100 hover:bg-purple-300 cursor-pointer text-sm font-mono"
                                    data-info="ç›®çš„ç«¯å£ (16ä½): æ ‡è¯†æ¥æ”¶æ–¹åº”ç”¨ç¨‹åºç«¯å£å·ã€‚"> ç›®çš„ç«¯å£ (16) </div>
                            </div>
                            <div class="flex w-full">
                                <div class="header-field flex-1 p-2 text-center border-r border-gray-400 bg-purple-100 hover:bg-purple-300 cursor-pointer text-sm font-mono"
                                    data-info="é•¿åº¦ (16ä½): UDPå¤´éƒ¨+æ•°æ®çš„æ€»é•¿åº¦(å­—èŠ‚)ã€‚æœ€å°ä¸º8ã€‚"> é•¿åº¦ (16) </div>
                                <div class="header-field flex-1 p-2 text-center bg-purple-100 hover:bg-purple-300 cursor-pointer text-sm font-mono"
                                    data-info="æ ¡éªŒå’Œ (16ä½): ç”¨äºæ£€æµ‹UDPå¤´éƒ¨å’Œæ•°æ®åœ¨ä¼ è¾“ä¸­æ˜¯å¦å‡ºé”™ (å¯é€‰, IPv4ä¸­å¯ä¸º0)ã€‚"> æ ¡éªŒå’Œ (16) </div>
                            </div>
                            <div
                                class="w-full p-4 text-center bg-green-100 text-gray-700 text-sm border-t border-gray-400">
                                æ•°æ® (Payload) - å¯å˜é•¿åº¦ </div>
                        </div>
                        <div id="udp-header-info" class="header-info-display"> ç‚¹å‡»ä¸Šæ–¹å­—æ®µæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯...</div>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">UDP vs TCP å¯¹æ¯”</h3>
                        <div class="overflow-x-auto">
                            <table>
                                <thead class="bg-purple-100 text-purple-800">
                                    <tr>
                                        <th>ç‰¹æ€§</th>
                                        <th>TCP</th>
                                        <th>UDP</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>è¿æ¥æ€§</td>
                                        <td>é¢å‘è¿æ¥ (éœ€è¦ä¸‰æ¬¡æ¡æ‰‹)</td>
                                        <td>æ— è¿æ¥</td>
                                    </tr>
                                    <tr>
                                        <td>å¯é æ€§</td>
                                        <td>å¯é  (é‡ä¼ ã€ç¡®è®¤ã€æ’åº)</td>
                                        <td>ä¸å¯é  (å°½åŠ›è€Œä¸º)</td>
                                    </tr>
                                    <tr>
                                        <td>ä¼ è¾“å•ä½</td>
                                        <td>å­—èŠ‚æµ</td>
                                        <td>æ•°æ®æŠ¥ (ä¿ç•™æŠ¥æ–‡è¾¹ç•Œ)</td>
                                    </tr>
                                    <tr>
                                        <td>å¤´éƒ¨å¼€é”€</td>
                                        <td>è¾ƒå¤§ (20å­—èŠ‚èµ·, å¯é€‰éƒ¨æ›´é•¿)</td>
                                        <td>å° (å›ºå®š8å­—èŠ‚)</td>
                                    </tr>
                                    <tr>
                                        <td>æµé‡æ§åˆ¶</td>
                                        <td>æœ‰ (æ»‘åŠ¨çª—å£)</td>
                                        <td>æ— </td>
                                    </tr>
                                    <tr>
                                        <td>æ‹¥å¡æ§åˆ¶</td>
                                        <td>æœ‰</td>
                                        <td>æ— </td>
                                    </tr>
                                    <tr>
                                        <td>ä¼ è¾“æ•ˆç‡</td>
                                        <td>ç›¸å¯¹è¾ƒä½ (å› å¼€é”€å’Œæ§åˆ¶æœºåˆ¶)</td>
                                        <td>ç›¸å¯¹è¾ƒé«˜ (å¼€é”€å°)</td>
                                    </tr>
                                    <tr>
                                        <td>åº”ç”¨åœºæ™¯</td>
                                        <td>HTTP, FTP, Email, æ–‡ä»¶ä¼ è¾“</td>
                                        <td>DNS, VoIP, è§†é¢‘æµ, æ¸¸æˆ, DHCP</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="quic" class="content-section fade-in-section" style="animation-delay: 0.4s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">bolt</span>QUIC: å¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">QUIC æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>å…¨ç§°: <b>Quick UDP Internet Connections</b> (å¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥)ã€‚</li>
                            <li>å®šä½: å®šä¹‰ä¸º <b>ä¼ è¾“å±‚åè®® (RFC 9000)</b>ï¼Œä½†é€šå¸¸åœ¨ <b>ç”¨æˆ·æ€</b> å®ç°ï¼Œå¹¶ <b>åŸºäº UDP</b> è¿›è¡Œä¼ è¾“ã€‚</li>
                            <li>æ ¸å¿ƒç›®æ ‡: ç»“åˆ TCP çš„å¯é æ€§å’Œ UDP çš„ä½å»¶è¿Ÿï¼Œå¹¶è§£å†³ TCP çš„ä¸€äº›å›ºæœ‰é—®é¢˜ï¼ˆå¦‚é˜Ÿå¤´é˜»å¡ï¼‰ï¼ŒåŒæ—¶å†…ç½®åŠ å¯†ã€‚</li>
                            <li>ä¸»è¦ç‰¹ç‚¹: <b>ä½å»¶è¿Ÿè¿æ¥å»ºç«‹ (0-RTT/1-RTT)ã€å¤šè·¯å¤ç”¨æ— é˜Ÿå¤´é˜»å¡ã€è¿æ¥è¿ç§»ã€å†…ç½® TLS 1.3 åŠ å¯†ã€æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶å’Œæ¢å¤æœºåˆ¶</b>ã€‚</li>
                            <li>é©±åŠ¨åŠ›: ä¸»è¦ç”± Google æ¨åŠ¨ï¼Œæ˜¯ <b>HTTP/3 çš„åº•å±‚ä¼ è¾“åè®®</b>ã€‚</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">QUIC åœ¨åè®®æ ˆä¸­çš„ä½ç½®</h3>
                        <div class="mermaid text-center my-4 p-2 border rounded bg-white shadow-sm">
                            graph TD
                            subgraph "åº”ç”¨å±‚"
                            A["HTTP/3"]
                            end

                            subgraph "QUIC (åŸºäº UDP å®ç°çš„ä¼ è¾“åŠŸèƒ½)"
                            direction TB
                            B["QUIC"]
                            B -- "å†…ç½®åŠŸèƒ½" --> F["âœ” å¯é ä¼ è¾“<br>âœ” å¤šè·¯å¤ç”¨<br>âœ” æ‹¥å¡æ§åˆ¶<br>âœ” æµé‡æ§åˆ¶<br>âœ” TLS 1.3 åŠ å¯† (é›†æˆ)"]
                            end

                            subgraph "ä¼ è¾“å±‚"
                            C["UDP"]
                            end

                            subgraph "ç½‘ç»œå±‚"
                            D["IP"]
                            end

                            A --> B;
                            B -- "è¿è¡Œäº" --> C;
                            C --> D;

                            style B fill:#e6fffa,stroke:#38b2ac,stroke-width:2px;
                            style F fill:#f0f9ff,stroke:#3b82f6,stroke-width:1px,stroke-dasharray: 5 5;
                            style C fill:#f0fdfa,stroke:#0d9488,stroke-width:1px;
                        </div>
                        <p class="text-sm text-gray-700">QUIC è¿è¡Œåœ¨ UDP ä¹‹ä¸Šï¼Œä½†åœ¨ç”¨æˆ·ç©ºé—´å®ç°äº†åŸæœ¬ TCP åœ¨å†…æ ¸ç©ºé—´æä¾›çš„è®¸å¤šåŠŸèƒ½ï¼Œå¹¶è¿›è¡Œäº†æ”¹è¿›ã€‚</p>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">ä¸ºä»€ä¹ˆ QUIC è¦åŸºäº UDPï¼Ÿ</h3>
                        <ul class="list-disc list-inside space-y-2 text-sm text-gray-700">
                            <li><strong>é¿å…æ“ä½œç³»ç»Ÿå†…æ ¸å‡çº§ï¼š</strong> ä¿®æ”¹ TCP éœ€è¦æ›´æ–°æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œéƒ¨ç½²å‘¨æœŸé•¿ã€éš¾åº¦å¤§ã€‚åŸºäº UDP æ„å‘³ç€ QUIC
                                çš„å®ç°å’Œæ›´æ–°å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±‚é¢ï¼ˆå¦‚æµè§ˆå™¨ã€æœåŠ¡å™¨è½¯ä»¶ï¼‰å¿«é€Ÿè¿­ä»£ã€‚</li>
                            <li><strong>ç»•è¿‡ä¸­é—´è®¾å¤‡åƒµåŒ–ï¼š</strong> è®¸å¤šç½‘ç»œä¸­é—´è®¾å¤‡ï¼ˆé˜²ç«å¢™ã€NATï¼‰å¯¹ TCP çš„å¤„ç†é€»è¾‘å·²ç»å›ºåŒ–ï¼Œå¯èƒ½ä¸æ”¯æŒ TCP çš„æ–°é€‰é¡¹æˆ–ä¿®æ”¹ã€‚UDP
                                é€šå¸¸è¢«è§†ä¸ºâ€œç®€å•é€šé“â€ï¼Œé™åˆ¶è¾ƒå°‘ã€‚</li>
                            <li><strong>å®ç°æ›´çµæ´»çš„åˆ›æ–°ï¼š</strong> åœ¨ç”¨æˆ·æ€å®ç°æ‹¥å¡æ§åˆ¶ã€æµé‡æ§åˆ¶ã€é‡ä¼ é€»è¾‘ç­‰ï¼Œå¯ä»¥æ›´å¿«åœ°è¯•éªŒå’Œéƒ¨ç½²æ–°çš„ç®—æ³•å’Œç‰¹æ€§ã€‚</li>
                            <li><strong>å®ç°è¿æ¥è¿ç§»ï¼š</strong> QUIC ä½¿ç”¨ Connection ID è€Œé IP+ç«¯å£äº”å…ƒç»„æ¥æ ‡è¯†è¿æ¥ï¼Œå½“å®¢æˆ·ç«¯ç½‘ç»œåˆ‡æ¢ï¼ˆå¦‚ Wi-Fi åˆ‡æ¢åˆ°
                                4Gï¼‰å¯¼è‡´ IP æˆ–ç«¯å£å˜åŒ–æ—¶ï¼Œè¿æ¥å¯ä»¥ä¿æŒä¸æ–­å¼€ã€‚</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">QUIC çš„æ ¸å¿ƒä¼˜åŠ¿</h3>
                        <ul
                            class="list-disc list-inside grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2 text-sm text-gray-700">
                            <li><strong>å¤šè·¯å¤ç”¨æ— é˜Ÿå¤´é˜»å¡ (Stream Multiplexing without HOL Blocking):</strong> ä¸€æ¡ QUIC
                                è¿æ¥å¯ä»¥æ‰¿è½½å¤šä¸ªç‹¬ç«‹çš„é€»è¾‘æµ (Stream)ã€‚æ¯ä¸ªæµæœ‰è‡ªå·±çš„åºå·ç©ºé—´ã€‚å¦‚æœä¸€ä¸ªæµçš„æ•°æ®åŒ…ä¸¢å¤±ï¼Œåªä¼šé˜»å¡è¯¥æµï¼Œä¸å½±å“å…¶ä»–æµçš„æ•°æ®ä¼ è¾“ï¼Œè§£å†³äº† TCP çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚</li>
                            <li><strong>æ›´å¿«çš„è¿æ¥å»ºç«‹ (0-RTT or 1-RTT Handshake):</strong> QUIC å°†ä¼ è¾“å±‚æ¡æ‰‹å’Œ TLS 1.3
                                åŠ å¯†æ¡æ‰‹åˆå¹¶è¿›è¡Œã€‚å¯¹äºé¦–æ¬¡è¿æ¥ï¼Œé€šå¸¸éœ€è¦ 1-RTTã€‚å¯¹äºå·²å»ºç«‹è¿‡è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥å®ç° 0-RTT è¿æ¥æ¢å¤ï¼ˆå‘é€åŠ å¯†çš„åº”ç”¨æ•°æ®ï¼‰ã€‚</li>
                            <li><strong>è¿æ¥è¿ç§» (Connection Migration):</strong> ä½¿ç”¨ Connection ID æ ‡è¯†è¿æ¥ï¼Œå®¢æˆ·ç«¯ IP
                                æˆ–ç«¯å£å˜åŒ–æ—¶ï¼Œåªéœ€å‘æœåŠ¡å™¨å‘é€åŒ…å«æ—§ Connection ID çš„æ¢æµ‹åŒ…å³å¯æ¢å¤è¿æ¥ï¼Œæ— éœ€é‡æ–°æ¡æ‰‹ã€‚</li>
                            <li><strong>å¼ºåˆ¶åŠ å¯† (Mandatory Encryption):</strong> QUIC å¤´éƒ¨å’Œå¤§éƒ¨åˆ†è½½è·éƒ½ç»è¿‡åŠ å¯†ï¼ˆä½¿ç”¨ TLS
                                1.3ï¼‰ï¼Œæé«˜äº†é€šä¿¡çš„å®‰å…¨æ€§ï¼Œå‡å°‘äº†ä¸­é—´è®¾å¤‡ç¯¡æ”¹æˆ–çªƒå¬çš„é£é™©ã€‚</li>
                            <li><strong>æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶å’Œä¸¢å¤±æ¢å¤:</strong> æ›´ç²¾ç¡®çš„ RTT æµ‹é‡ã€æ›´ä¸°å¯Œçš„ ACK ä¿¡æ¯ï¼ˆç¡®è®¤æ”¶åˆ°çš„åŒ…åºå·èŒƒå›´ï¼‰ï¼Œæœ‰åŠ©äºæ›´å¿«ã€æ›´å‡†ç¡®åœ°æ£€æµ‹å’Œæ¢å¤ä¸¢åŒ…ã€‚
                            </li>
                        </ul>
                    </div>
                </section>

                <section id="dns" class="content-section fade-in-section" style="animation-delay: 0.45s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">dns</span>DNS è§£æ
                        <span class="level-tag level-tag-medium">ä¸­é¢‘</span>
                        <span class="level-tag level-tag-base">åŸºç¡€</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">åŸºæœ¬è¿‡ç¨‹</h3>
                        <p>DNS (Domain Name System) è´Ÿè´£å°†äººç±»å¯è¯»çš„åŸŸåï¼ˆå¦‚ www.google.comï¼‰è§£æä¸ºæœºå™¨å¯è¯»çš„ IP åœ°å€ï¼ˆå¦‚
                            172.217.160.142ï¼‰ã€‚åŸºæœ¬è§£æè¿‡ç¨‹æ¶‰åŠä¸€ç³»åˆ—æŸ¥è¯¢ï¼š</p>
                        <ol class="list-decimal list-inside space-y-1 text-sm">
                            <li><strong>æµè§ˆå™¨ç¼“å­˜:</strong> æµè§ˆå™¨é¦–å…ˆæ£€æŸ¥è‡ªèº«ç¼“å­˜ä¸­æ˜¯å¦æœ‰è¯¥åŸŸåçš„è®°å½•ã€‚</li>
                            <li><strong>æ“ä½œç³»ç»Ÿç¼“å­˜:</strong> å¦‚æœæµè§ˆå™¨ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ DNS ç¼“å­˜ï¼ˆå¦‚ Windows çš„ DNS Client æœåŠ¡ç¼“å­˜ï¼‰ã€‚</li>
                            <li><strong>Hosts æ–‡ä»¶:</strong> æ¥ç€æ£€æŸ¥æœ¬åœ°çš„ Hosts æ–‡ä»¶æ˜¯å¦æœ‰è¯¥åŸŸåçš„æ˜ å°„ã€‚</li>
                            <li><strong>æœ¬åœ° DNS æœåŠ¡å™¨ (LDNS):</strong> å¦‚æœæœ¬åœ°ç¼“å­˜å’Œ Hosts æ–‡ä»¶éƒ½æœªå‘½ä¸­ï¼Œè¯·æ±‚ä¼šå‘é€åˆ°é…ç½®çš„æœ¬åœ° DNS æœåŠ¡å™¨ï¼ˆé€šå¸¸ç”± ISP
                                æˆ–ç½‘ç»œç®¡ç†å‘˜æä¾›ï¼‰ã€‚</li>
                            <li><strong>æ ¹åŸŸåæœåŠ¡å™¨ (Root Server):</strong> LDNS å‘æ ¹æœåŠ¡å™¨æŸ¥è¯¢ï¼Œæ ¹æœåŠ¡å™¨è¿”å›è´Ÿè´£é¡¶çº§åŸŸåï¼ˆå¦‚ .comï¼‰çš„ TLD æœåŠ¡å™¨åœ°å€ã€‚
                            </li>
                            <li><strong>é¡¶çº§åŸŸåæœåŠ¡å™¨ (TLD Server):</strong> LDNS å‘ TLD æœåŠ¡å™¨æŸ¥è¯¢ï¼ŒTLD æœåŠ¡å™¨è¿”å›è´Ÿè´£è¯¥åŸŸåçš„æƒå¨åŸŸåæœåŠ¡å™¨åœ°å€ã€‚</li>
                            <li><strong>æƒå¨åŸŸåæœåŠ¡å™¨ (Authoritative Server):</strong> LDNS å‘æƒå¨æœåŠ¡å™¨æŸ¥è¯¢ï¼Œæƒå¨æœåŠ¡å™¨è¿”å›æœ€ç»ˆçš„ IP åœ°å€ã€‚</li>
                            <li><strong>ç¼“å­˜ç»“æœ:</strong> LDNS å°†æŸ¥è¯¢ç»“æœç¼“å­˜èµ·æ¥ï¼Œå¹¶è¿”å›ç»™æ“ä½œç³»ç»Ÿ/æµè§ˆå™¨ã€‚</li>
                        </ol>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">é€’å½’æŸ¥è¯¢ vs è¿­ä»£æŸ¥è¯¢</h3>
                        <strong>é€’å½’æŸ¥è¯¢ (Recursive Query):</strong> é€šå¸¸å‘ç”Ÿåœ¨ <strong>ç”¨æˆ·/å®¢æˆ·ç«¯</strong> ä¸
                        <strong>æœ¬åœ°DNSæœåŠ¡å™¨</strong> ä¹‹é—´ã€‚å®¢æˆ·ç«¯åªå‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼Œæœ¬åœ°
                        DNSæœåŠ¡å™¨è´Ÿè´£ä»£æ›¿å®¢æˆ·ç«¯å±‚å±‚æŸ¥è¯¢ï¼Œç›´åˆ°è·å–æœ€ç»ˆç»“æœæˆ–å¤±è´¥ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚"è¯·å¸®æˆ‘æŸ¥åˆ°è¿™ä¸ªåŸŸåçš„IP åœ°å€"ã€‚
                        <div class="content-card mb-4">
                            <h4 class="head4">é€’å½’æŸ¥è¯¢</h4>
                            <div class="mermaid text-center my-4 p-2 border rounded bg-white shadow-sm">
                                flowchart LR
                                subgraph æŸ¥è¯¢ç±»å‹
                                direction LR
                                User -- "åŸŸå?" --> LDNS(æœ¬åœ° DNS)
                                subgraph "é€’å½’æŸ¥è¯¢ (Recursive)"
                                direction TB
                                LDNS -- "www.example.com?" --> RootDNS((æ ¹ DNS))
                                RootDNS -- ".com TLD åœ°å€" --> LDNS
                                LDNS -- "www.example.com?" --> TLDDNS((.com TLD))
                                TLDDNS -- "example.com Auth åœ°å€" --> LDNS
                                LDNS -- "www.example.com?" --> AuthDNS((Auth DNS))
                                AuthDNS -- "IP åœ°å€" --> LDNS
                                end
                                LDNS -- "IP åœ°å€" --> User
                                end

                                %% èŠ‚ç‚¹æ ·å¼
                                style User fill:#e0f2fe,stroke:#0ea5e9
                                style LDNS fill:#fefce8,stroke:#ca8a04
                                style RootDNS fill:#fce7f3,stroke:#db2777
                                style TLDDNS fill:#ecfdf5,stroke:#16a34a
                                style AuthDNS fill:#f1f5f9,stroke:#64748b

                                %% è¾¹æ ·å¼ï¼šåˆ é™¤éæ³•å­—ç¬¦ï¼Œä»…ä¿ç•™æ ‡å‡†å±æ€§
                                linkStyle 0 stroke:#0ea5e9,stroke-width:2px
                                linkStyle 1 stroke:#a16207,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 2 stroke:#a16207,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 3 stroke:#a16207,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 4 stroke:#a16207,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 5 stroke:#a16207,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 6 stroke:#a16207,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 7 stroke:#0ea5e9,stroke-width:2px
                            </div>
                        </div>

                        <div class="content-card mb-4">
                            <h4 class="head4">è¿­ä»£æŸ¥è¯¢</h4>
                            <strong>è¿­ä»£æŸ¥è¯¢ (Iterative Query):</strong> é€šå¸¸å‘ç”Ÿåœ¨ <strong>æœ¬åœ° DNS æœåŠ¡å™¨</strong> ä¸<strong>å…¶ä»–DNS
                                æœåŠ¡å™¨</strong> (æ ¹ã€TLDã€æƒå¨) ä¹‹é—´ã€‚æœ¬åœ° DNSæœåŠ¡å™¨æ¯æ¬¡åªè¯¢é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨è¿”å›å®ƒæ‰€çŸ¥é“çš„æœ€ä½³ä¸‹ä¸€æ­¥çº¿ç´¢ï¼ˆæˆ–æœ€ç»ˆç­”æ¡ˆï¼‰ï¼Œç”±æœ¬åœ°DNS
                            æœåŠ¡å™¨ç»§ç»­å‘èµ·ä¸‹ä¸€æ¬¡æŸ¥è¯¢ã€‚"å‘Šè¯‰æˆ‘è°çŸ¥é“ .com çš„ä¿¡æ¯ï¼Ÿ" -> "å‘Šè¯‰æˆ‘è°çŸ¥é“ example.com çš„ä¿¡æ¯ï¼Ÿ" -> "å‘Šè¯‰æˆ‘www.example.comçš„ IPï¼Ÿ"ã€‚
                            <div class="mermaid text-center my-4 p-2 border rounded bg-white shadow-sm">
                                flowchart LR
                                subgraph æŸ¥è¯¢ç±»å‹
                                direction LR
                                User -- "åŸŸå?" --> LDNS(æœ¬åœ° DNS)
                                subgraph "è¿­ä»£æŸ¥è¯¢ (Iterative)"
                                direction TB
                                LDNS -- "www.example.com?" --> RootDNS((æ ¹ DNS))
                                RootDNS -- ".com TLD åœ°å€" --> TLDDNS((.com TLD))
                                TLDDNS -- "example.com Auth åœ°å€" --> AuthDNS((Auth DNS))
                                AuthDNS -- "IP åœ°å€" --> LDNS
                                end
                                LDNS -- "IP åœ°å€" --> User
                                end

                                %% èŠ‚ç‚¹æ ·å¼
                                style User fill:#e0f2fe,stroke:#0ea5e9
                                style LDNS fill:#fefce8,stroke:#ca8a04
                                style RootDNS fill:#fce7f3,stroke:#db2777
                                style TLDDNS fill:#ecfdf5,stroke:#16a34a
                                style AuthDNS fill:#f1f5f9,stroke:#64748b

                                %% è¾¹æ ·å¼ï¼šæ ‡å‡†å±æ€§ï¼Œæ— éæ³•å­—ç¬¦
                                linkStyle 0 stroke:#0ea5e9,stroke-width:2px
                                linkStyle 1 stroke:#a16207,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 2 stroke:#16a34a,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 3 stroke:#64748b,stroke-width:1px,stroke-dasharray:5 5
                                linkStyle 4 stroke:#0ea5e9,stroke-width:2px
                            </div>
                        </div>
                    </div>
                </section>

                <section id="kernel-user" class="content-section fade-in-section" style="animation-delay: 0.5s;">
                    <h2 class="flex items-center head2 "><span class="material-icons">memory</span>ç”¨æˆ·æ€ä¸å†…æ ¸æ€
                        <span class="level-tag level-tag-low">ä½é¢‘</span>
                        <span class="level-tag level-tag-advanced">è¿›é˜¶</span>
                    </h2>
                    <div class="content-card">
                        <h3 class="head3">åŸºæœ¬æ¦‚å¿µ</h3>
                        <p class="text-sm text-gray-700">ç°ä»£æ“ä½œç³»ç»Ÿä¸ºäº†ä¿æŠ¤ç³»ç»Ÿå®‰å…¨å’Œç¨³å®šï¼Œé€šå¸¸å°† CPU çš„æ‰§è¡ŒçŠ¶æ€åˆ†ä¸ºä¸¤ä¸ªçº§åˆ«ï¼š</p>
                        <ul class="list-disc list-inside space-y-2 text-sm text-gray-700 mt-2">
                            <li><strong>å†…æ ¸æ€ (Kernel Mode / Supervisor Mode):</strong>
                                <ul class="list-['-_'] list-inside ml-4 mt-1">
                                    <li>CPU å¯ä»¥æ‰§è¡Œ <b>æ‰€æœ‰æŒ‡ä»¤</b>ï¼Œè®¿é—® <b>æ‰€æœ‰å†…å­˜å’Œç¡¬ä»¶èµ„æº</b>ã€‚</li>
                                    <li>æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒä»£ç ï¼ˆå†…æ ¸ï¼‰è¿è¡Œåœ¨æ­¤æ¨¡å¼ä¸‹ã€‚</li>
                                    <li>æ‹¥æœ‰æœ€é«˜æƒé™ï¼Œè´Ÿè´£ç®¡ç†ç³»ç»Ÿèµ„æºï¼ˆè¿›ç¨‹è°ƒåº¦ã€å†…å­˜ç®¡ç†ã€è®¾å¤‡é©±åŠ¨ç­‰ï¼‰ã€‚</li>
                                </ul>
                            </li>
                            <li><strong>ç”¨æˆ·æ€ (User Mode):</strong>
                                <ul class="list-['-_'] list-inside ml-4 mt-1">
                                    <li>CPU åªèƒ½æ‰§è¡Œ <b>å—é™çš„æŒ‡ä»¤é›†</b>ï¼Œä¸èƒ½ç›´æ¥è®¿é—®ç¡¬ä»¶æˆ–å†…æ ¸æ•°æ®ã€‚</li>
                                    <li>æ™®é€šçš„åº”ç”¨ç¨‹åºè¿è¡Œåœ¨æ­¤æ¨¡å¼ä¸‹ã€‚</li>
                                    <li>æƒé™è¾ƒä½ï¼Œéœ€è¦é€šè¿‡ <b>ç³»ç»Ÿè°ƒç”¨ (System Call)</b> çš„æ–¹å¼è¯·æ±‚å†…æ ¸æä¾›æœåŠ¡ï¼ˆå¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ã€åˆ›å»ºè¿›ç¨‹ç­‰ï¼‰ã€‚</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†ï¼Ÿ</h3>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li><strong>å®‰å…¨æ€§:</strong> é™åˆ¶ç”¨æˆ·ç¨‹åºç›´æ¥æ“ä½œç¡¬ä»¶å’Œå…³é”®å†…å­˜åŒºåŸŸï¼Œé˜²æ­¢æ¶æ„æˆ–é”™è¯¯ä»£ç ç ´åç³»ç»Ÿã€‚</li>
                            <li><strong>ç¨³å®šæ€§:</strong> ç”¨æˆ·æ€ç¨‹åºçš„å´©æºƒé€šå¸¸ä¸ä¼šå½±å“æ“ä½œç³»ç»Ÿå†…æ ¸çš„è¿è¡Œï¼›è€Œå†…æ ¸æ€ä»£ç çš„é”™è¯¯å¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</li>
                            <li><strong>èµ„æºç®¡ç†:</strong> å†…æ ¸ç»Ÿä¸€ç®¡ç†å’Œè°ƒåº¦ç³»ç»Ÿèµ„æºï¼Œé¿å…ç”¨æˆ·ç¨‹åºä¹‹é—´çš„å†²çªå’Œèµ„æºæ»¥ç”¨ã€‚</li>
                        </ul>
                    </div>
                    <div class="content-card">
                        <h3 class="head3">ä¸ TCP/QUIC çš„å…³ç³»</h3>
                        <ul class="list-disc list-inside space-y-2 text-sm text-gray-700">
                            <li><strong>TCP é€šå¸¸åœ¨å†…æ ¸æ€å®ç°:</strong> TCP åè®®æ ˆæ˜¯æ“ä½œç³»ç»Ÿç½‘ç»œæ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚åº”ç”¨ç¨‹åºé€šè¿‡ Socket API (ç³»ç»Ÿè°ƒç”¨) è¯·æ±‚å†…æ ¸è¿›è¡Œ TCP
                                è¿æ¥å»ºç«‹ã€æ•°æ®æ”¶å‘ç­‰æ“ä½œã€‚
                                <ul class="list-['-_'] list-inside ml-4 mt-1 text-xs text-gray-600">
                                    <li>ä¼˜ç‚¹: æ€§èƒ½å¯èƒ½æ›´é«˜ï¼ˆå†…æ ¸ç›´æ¥æ“ä½œï¼‰ï¼Œç”±æ“ä½œç³»ç»Ÿç»Ÿä¸€ç»´æŠ¤ã€‚</li>
                                    <li>ç¼ºç‚¹: æ›´æ–°å’Œæ¼”è¿›å›°éš¾ï¼Œä¾èµ–æ“ä½œç³»ç»Ÿå‡çº§ã€‚</li>
                                </ul>
                            </li>
                            <li><strong>QUIC é€šå¸¸åœ¨ç”¨æˆ·æ€å®ç°:</strong> QUIC åº“ä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†æˆ–ä¾èµ–åº“è¿è¡Œã€‚å®ƒä½¿ç”¨ UDP Socket (ç³»ç»Ÿè°ƒç”¨)
                                å‘é€å’Œæ¥æ”¶æ•°æ®åŒ…ï¼Œç„¶ååœ¨ç”¨æˆ·æ€å®Œæˆ QUIC åè®®çš„é€»è¾‘ï¼ˆæ¡æ‰‹ã€åŠ å¯†ã€é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ç­‰ï¼‰ã€‚
                                <ul class="list-['-_'] list-inside ml-4 mt-1 text-xs text-gray-600">
                                    <li>ä¼˜ç‚¹: åè®®å¯ä»¥å¿«é€Ÿè¿­ä»£å’Œéƒ¨ç½²ï¼Œä¸ä¾èµ–å†…æ ¸ï¼›åº”ç”¨å±‚å¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶ä¼ è¾“è¡Œä¸ºã€‚</li>
                                    <li>ç¼ºç‚¹: å¯èƒ½å­˜åœ¨ç”¨æˆ·æ€/å†…æ ¸æ€åˆ‡æ¢å¼€é”€ï¼›éœ€è¦åº”ç”¨è‡ªå·±ç®¡ç†åè®®æ ˆã€‚</li>
                                </ul>
                            </li>
                        </ul>
                        <p class="text-sm font-medium text-gray-800 mt-3">ğŸ¯ æ ¸å¿ƒï¼šQUIC é€‰æ‹©åœ¨ç”¨æˆ·æ€å®ç°ï¼Œæ˜¯ä¸ºäº†ç»•å¼€å†…æ ¸æ›´æ–°çš„é™åˆ¶ï¼Œå®ç°åè®®çš„å¿«é€Ÿæ¼”è¿›å’Œéƒ¨ç½²ã€‚
                        </p>
                    </div>
                </section>

            </article>
        </main>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>


    <script>
        /**
 * JavaScript for 01-Network-Basics.html
 * Handles:
 * - Table of Contents (TOC) highlighting on scroll
 * - Section fade-in animations
 * - Mermaid diagram rendering
 * - Interactive TCP/UDP header field display
 * - Interactive simulations:
 * - TCP Handshake & Wave (Mermaid update)
 * - TCP Reliability / HOL Blocking (Packet animation)
 * - TCP Flow Control (Packet animation & window visualization)
 * - TCP Congestion Control (Chart update & packet visualization)
 */

        // --- Initialize Mermaid ---
        // Initialize Mermaid without starting automatically, as we render manually
        mermaid.initialize({
            startOnLoad: false,
            theme: 'neutral'
        });


        // --- DOMContentLoaded Listener ---
        document.addEventListener('DOMContentLoaded', () => {

            // --- TOC Highlighting & Fade-in ---
            const sections = document.querySelectorAll('main section[id], main li[id]'); // Observe sections and list items with IDs for TOC
            const tocLinks = document.querySelectorAll('#local-toc a');
            const mainContentSections = document.querySelectorAll('main > article > section.content-section'); // Target sections for fade-in

            // TOC Highlighting Logic
            const tocObserverOptions = {
                root: null,
                rootMargin: '-20% 0px -60% 0px', // Prioritize sections near the top
                threshold: 0
            };
            let lastActiveTocLink = null;

            const tocObserverCallback = (entries) => {
                let bestVisibleEntry = null;
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Find the best visible entry (closest to the top edge of the intersection area)
                        if (!bestVisibleEntry || entry.boundingClientRect.top < bestVisibleEntry.boundingClientRect.top) {
                            bestVisibleEntry = entry;
                        }
                    }
                });

                if (bestVisibleEntry) {
                    const id = bestVisibleEntry.target.getAttribute('id');
                    // Find the corresponding link in the TOC
                    const activeLink = document.querySelector(`#local-toc a[href="#${id}"]`);

                    if (activeLink && activeLink !== lastActiveTocLink) {
                        // Remove active class from the previously active link
                        if (lastActiveTocLink) {
                            lastActiveTocLink.classList.remove('active');
                        }
                        // Add active class to the new active link
                        activeLink.classList.add('active');
                        lastActiveTocLink = activeLink; // Update the last active link
                    }
                }
            };

            const tocObserver = new IntersectionObserver(tocObserverCallback, tocObserverOptions);
            sections.forEach(section => tocObserver.observe(section)); // Observe all relevant elements

            // Initial active link check based on hash or default to first
            const currentHash = window.location.hash;
            if (currentHash) {
                const initialActiveLink = document.querySelector(`#local-toc a[href="${currentHash}"]`);
                if (initialActiveLink) {
                    tocLinks.forEach(link => link.classList.remove('active')); // Clear default
                    initialActiveLink.classList.add('active');
                    lastActiveTocLink = initialActiveLink;
                }
            } else if (tocLinks.length > 0 && !lastActiveTocLink) {
                // Default to the first link if no hash or matching link found
                tocLinks[0].classList.add('active');
                lastActiveTocLink = tocLinks[0];
            }

            // Fade-in Animation Logic for Sections
            const fadeObserverOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
            const fadeObserverCallback = (entries, observer) => {
                entries.forEach((entry, index) => { // Use index for consistent delay
                    if (entry.isIntersecting) {
                        entry.target.style.animationDelay = `${index * 0.05}s`;
                        entry.target.classList.add('fade-in-section');
                        observer.unobserve(entry.target); // Stop observing once faded in
                    }
                });
            };
            const fadeObserver = new IntersectionObserver(fadeObserverCallback, fadeObserverOptions);
            mainContentSections.forEach(section => fadeObserver.observe(section));

            // --- Interactive Header Field Display ---
            function displayHeaderInfo(containerId, infoDivId) {
                const container = document.getElementById(containerId);
                const infoDiv = document.getElementById(infoDivId);
                if (!container || !infoDiv) {
                    console.warn(`Header display setup failed: Missing elements for ${containerId} or ${infoDivId}`);
                    return;
                }

                let lastClickedField = null;

                container.querySelectorAll('.header-field').forEach(field => {
                    field.addEventListener('click', () => {
                        const info = field.getAttribute('data-info');
                        infoDiv.textContent = info || 'æš‚æ— è¯¦ç»†ä¿¡æ¯ã€‚';
                        infoDiv.style.backgroundColor = '#e2e8f0'; // Indicate update

                        // Reset background color for all fields except the clicked one
                        container.querySelectorAll('.header-field').forEach(f => {
                            if (f !== field) {
                                // Determine original background color (tricky, might need default classes)
                                let defaultBg = '';
                                if (f.classList.contains('bg-blue-100')) defaultBg = '#DBEAFE'; // Tailwind blue-100
                                else if (f.classList.contains('bg-purple-100')) defaultBg = '#F3E8FF'; // Tailwind purple-100
                                else if (f.classList.contains('bg-yellow-100')) defaultBg = '#FEF9C3'; // Tailwind yellow-100
                                // Add more default colors if needed
                                f.style.backgroundColor = defaultBg;
                            }
                        });

                        // Highlight clicked field
                        field.style.backgroundColor = '#63b3ed'; // Highlight blue (Tailwind blue-400 approx)
                        lastClickedField = field; // Remember last clicked

                        setTimeout(() => { infoDiv.style.backgroundColor = ''; }, 300); // Fade back info bg
                    });
                });
            }

            displayHeaderInfo('tcp-header-vis', 'tcp-header-info');
            displayHeaderInfo('udp-header-vis', 'udp-header-info');

            // --- Mermaid Rendering Function ---
            /**
             * Renders a Mermaid diagram definition into a given container.
             * @param {HTMLElement} container - The DOM element to render the diagram into.
             * @param {string} definition - The Mermaid diagram definition string.
             * @param {string} idSuffix - A unique suffix for the generated SVG ID to prevent conflicts.
             */
            async function renderMermaid(container, definition, idSuffix) {
                if (!container || typeof definition !== 'string' || typeof idSuffix !== 'string') {
                    console.error("renderMermaid: Invalid arguments.", { container, definition, idSuffix });
                    if (container) container.innerHTML = "Error: Invalid input for rendering.";
                    return;
                }
                if (!container.id) {
                    console.warn("Mermaid container is missing an ID. Assigning a temporary one.");
                    container.id = `mermaid-temp-${idSuffix}-${Math.random().toString(16).slice(2)}`;
                }
                const svgId = `mermaid-svg-${container.id}-${idSuffix}`;

                try {
                    if (typeof mermaid === 'undefined' || typeof mermaid.render !== 'function') {
                        throw new Error("Mermaid library or mermaid.render function is not available.");
                    }
                    const { svg, bindFunctions } = await mermaid.render(svgId, definition);
                    container.innerHTML = svg;
                    if (bindFunctions) bindFunctions(container);
                } catch (error) {
                    console.error(`Mermaid rendering error for ${svgId}:`, error);
                    container.innerHTML = `<div class="text-red-500 p-4 border border-red-300 rounded bg-red-50">Error rendering diagram. Check console.</div>`;
                }
            }

            // --- TCP Handshake & Wave Simulation ---
            const handshakeDiagramDefs = [
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: CLOSED
Note right of S: LISTEN`,
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: CLOSED
Note right of S: LISTEN
C->>S: SYN (Seq=x)
Note left of C: SYN_SENT`,
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: CLOSED
Note right of S: LISTEN
C->>S: SYN (Seq=x)
Note left of C: SYN_SENT
S-->>C: SYN+ACK (Seq=y, Ack=x+1)
Note right of S: SYN_RCVD`,
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: CLOSED
Note right of S: LISTEN
C->>S: SYN (Seq=x)
Note left of C: SYN_SENT
S-->>C: SYN+ACK (Seq=y, Ack=x+1)
Note right of S: SYN_RCVD
C->>S: ACK (Ack=y+1)
Note left of C: ESTABLISHED
Note right of S: ESTABLISHED`
            ];
            const waveDiagramDefs = [
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: ESTABLISHED
Note right of S: ESTABLISHED`,
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: ESTABLISHED
Note right of S: ESTABLISHED
C->>S: FIN (Seq=u)
Note left of C: FIN_WAIT_1`,
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: ESTABLISHED
Note right of S: ESTABLISHED
C->>S: FIN (Seq=u)
Note left of C: FIN_WAIT_1
S-->>C: ACK (Ack=u+1)
Note left of C: FIN_WAIT_2
Note right of S: CLOSE_WAIT`,
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: ESTABLISHED
Note right of S: ESTABLISHED
C->>S: FIN (Seq=u)
Note left of C: FIN_WAIT_1
S-->>C: ACK (Ack=u+1)
Note left of C: FIN_WAIT_2
Note right of S: CLOSE_WAIT
Note right of S: Server may still send data...
S->>C: FIN (Seq=v)
Note right of S: LAST_ACK`,
                `sequenceDiagram
participant C as Client
participant S as Server
Note left of C: ESTABLISHED
Note right of S: ESTABLISHED
C->>S: FIN (Seq=u)
Note left of C: FIN_WAIT_1
S-->>C: ACK (Ack=u+1)
Note left of C: FIN_WAIT_2
Note right of S: CLOSE_WAIT
Note right of S: Server may still send data...
S->>C: FIN (Seq=v)
Note right of S: LAST_ACK
C-->>S: ACK (Ack=v+1)
Note left of C: TIME_WAIT (2*MSL)
Note right of S: CLOSED
Note left of C: ...after 2*MSL... CLOSED`
            ];

            let currentHandshakeStep = 0;
            const handshakeSteps = [
                document.getElementById('handshake-step-1'),
                document.getElementById('handshake-step-2'),
                document.getElementById('handshake-step-3')
            ].filter(el => el !== null);
            const nextHandshakeBtn = document.getElementById('next-handshake-step');
            const handshakeDiagramContainer = document.getElementById('mermaid-handshake-diagram');

            let currentWaveStep = 0;
            const waveSteps = [
                document.getElementById('wave-step-1'),
                document.getElementById('wave-step-2'),
                document.getElementById('wave-step-3'),
                document.getElementById('wave-step-4')
            ].filter(el => el !== null);
            const nextWaveBtn = document.getElementById('next-wave-step');
            const waveDiagramContainer = document.getElementById('mermaid-wave-diagram');

            function showHandshakeStep(stepIndexToShow) {
                handshakeSteps.forEach((step, index) => {
                    if (step) step.classList.toggle('active', index === (stepIndexToShow - 1));
                });
                if (handshakeDiagramContainer && handshakeDiagramDefs[stepIndexToShow]) {
                    renderMermaid(handshakeDiagramContainer, handshakeDiagramDefs[stepIndexToShow], `h${stepIndexToShow}`);
                }
            }

            function showWaveStep(stepIndexToShow) {
                waveSteps.forEach((step, index) => {
                    if (step) step.classList.toggle('active', index === (stepIndexToShow - 1));
                });
                if (waveDiagramContainer && waveDiagramDefs[stepIndexToShow]) {
                    renderMermaid(waveDiagramContainer, waveDiagramDefs[stepIndexToShow], `w${stepIndexToShow}`);
                }
            }

            if (nextHandshakeBtn && handshakeSteps.length > 0 && handshakeDiagramContainer) {
                renderMermaid(handshakeDiagramContainer, handshakeDiagramDefs[0], 'h0'); // Initial render
                nextHandshakeBtn.addEventListener('click', () => {
                    currentHandshakeStep = (currentHandshakeStep % handshakeSteps.length) + 1;
                    showHandshakeStep(currentHandshakeStep);
                    nextHandshakeBtn.innerHTML = (currentHandshakeStep === handshakeSteps.length)
                        ? '<i class="fas fa-redo mr-1"></i> é‡ç½® (æ¡æ‰‹)'
                        : '<i class="fas fa-play mr-1"></i> ä¸‹ä¸€æ­¥ (æ¡æ‰‹)';
                });
            }

            if (nextWaveBtn && waveSteps.length > 0 && waveDiagramContainer) {
                renderMermaid(waveDiagramContainer, waveDiagramDefs[0], 'w0'); // Initial render
                nextWaveBtn.addEventListener('click', () => {
                    currentWaveStep = (currentWaveStep % waveSteps.length) + 1;
                    showWaveStep(currentWaveStep);
                    nextWaveBtn.innerHTML = (currentWaveStep === waveSteps.length)
                        ? '<i class="fas fa-redo mr-1"></i> é‡ç½® (æŒ¥æ‰‹)'
                        : '<i class="fas fa-play mr-1"></i> ä¸‹ä¸€æ­¥ (æŒ¥æ‰‹)';
                });
            }

            // Render static Mermaid diagrams on the page
            try {
                mermaid.run();
            } catch (e) {
                console.error("Error running Mermaid on static elements:", e);
            }

            // --- TCP Reliability / HOL Blocking Simulation (tcpHolSim_) ---
            const tcpHolSim_elements = {
                animationArea: document.getElementById('tcpHolSim_animation-area'),
                channel: document.getElementById('tcpHolSim_channel'),
                senderWindow: document.getElementById('tcpHolSim_sender-window'),
                senderWindowLabel: document.getElementById('tcpHolSim_sender-window-label'),
                receiverBuffer: document.getElementById('tcpHolSim_receiver-buffer'),
                appLayer: document.getElementById('tcpHolSim_app-layer'),
                nextStepBtn: document.getElementById('tcpHolSim_next-step'),
                resetBtn: document.getElementById('tcpHolSim_reset'),
                explanation: document.getElementById('tcpHolSim_explanation'),
                expectedSeqEl: document.getElementById('tcpHolSim_expected-seq'),
                senderStatus: document.getElementById('tcpHolSim_sender-status'),
                receiverStatus: document.getElementById('tcpHolSim_receiver-status'),
                networkPath: document.getElementById('tcpHolSim_network-path'),
                senderSeqElements: {},
                senderRtoTimers: {},
                bufferSlots: document.querySelectorAll('#tcpHolSim_receiver-buffer .tcpHolSim_buffer-slot')
            };
            const TCPHOLSIM_MAX_SEQ = 6;
            for (let i = 1; i <= TCPHOLSIM_MAX_SEQ; i++) {
                tcpHolSim_elements.senderSeqElements[i] = document.getElementById(`tcpHolSim_sender-seq-${i}`);
                tcpHolSim_elements.senderRtoTimers[i] = document.getElementById(`tcpHolSim_timer-${i}`);
            }

            let tcpHolSim_state = {
                currentStep: 0,
                packets: {},
                acks: {},
                receiverBufferContent: {},
                deliveredToAppSeq: new Set(),
                expectedSeqNum: 1,
                senderWindowStart: 1,
                senderWindowSize: 4,
                rtoTimersActive: {},
                animationInProgress: false,
                senderStartX: 50, // Default positions, will be recalculated
                senderStartY: 150,
                receiverEndX: 350,
                receiverEndY: 150,
                ackReturnY: 200,
                appLayerY: 100
            };

            function tcpHolSim_calculatePositions() {
                requestAnimationFrame(() => {
                    const senderBox = tcpHolSim_elements.senderSeqElements[1]?.getBoundingClientRect();
                    const receiverBox = tcpHolSim_elements.receiverBuffer?.getBoundingClientRect();
                    const channelBox = tcpHolSim_elements.animationArea?.getBoundingClientRect();
                    const pathBox = tcpHolSim_elements.networkPath?.getBoundingClientRect();
                    const appBox = tcpHolSim_elements.appLayer?.getBoundingClientRect();

                    if (!senderBox || !receiverBox || !channelBox || !pathBox || !appBox) {
                        console.warn("tcpHolSim: Could not calculate positions, elements missing.");
                        return;
                    }

                    tcpHolSim_state.senderStartX = senderBox.left - channelBox.left + senderBox.width / 2;
                    tcpHolSim_state.receiverEndX = receiverBox.left - channelBox.left + receiverBox.width / 2;
                    tcpHolSim_state.receiverEndY = pathBox.top - channelBox.top - 15;
                    tcpHolSim_state.senderStartY = tcpHolSim_state.receiverEndY;
                    tcpHolSim_state.ackReturnY = pathBox.top - channelBox.top + 15;
                    tcpHolSim_state.appLayerY = appBox.top - channelBox.top + appBox.height / 2;
                });
            }

            // (Include all helper functions from ä¼ è¾“å±‚.html for the tcpRelSim_, prefixed with tcpHolSim_)
            // e.g., tcpHolSim_createPacketElement, tcpHolSim_createAckElement, tcpHolSim_moveElement, etc.
            // ... (implementation of helper functions adapted with tcpHolSim_ prefix) ...
            // --- Helper Functions (Adapted with tcpHolSim_ prefix) ---

            function tcpHolSim_createPacketElement(seqNum, isRetransmit = false) {
                const uniqueIdPart = `${seqNum}-${isRetransmit ? 'retransmit' : 'orig'}-${Date.now()}`;
                const packetId = `tcpHolSim_packet-${uniqueIdPart}`;
                const packet = document.createElement('div');
                packet.id = packetId;
                packet.className = 'tcpHolSim_packet p-1 border border-blue-500 rounded bg-blue-100 text-xs text-center shadow-md min-w-[40px]';
                packet.textContent = `SEQ ${seqNum}`;
                if (isRetransmit) {
                    packet.classList.add('tcpHolSim_packet-retransmitted');
                    packet.textContent += ' (é‡ä¼ )';
                }
                packet.style.position = 'absolute'; // Ensure absolute positioning initially
                packet.style.left = `${tcpHolSim_state.senderStartX}px`;
                packet.style.top = `${tcpHolSim_state.senderStartY}px`;
                tcpHolSim_elements.channel.appendChild(packet);
                tcpHolSim_state.packets[packetId] = { element: packet, seq: seqNum, state: 'sending', isRetransmit, id: packetId };
                return packet;
            }

            function tcpHolSim_createAckElement(ackNum, isDuplicate = false) {
                const uniqueIdPart = `${ackNum}-${isDuplicate ? 'dup' : 'orig'}-${Date.now()}`;
                const ackId = `tcpHolSim_ack-${uniqueIdPart}`;
                const ack = document.createElement('div');
                ack.id = ackId;
                ack.className = 'tcpHolSim_ack p-1 border border-green-500 rounded bg-green-100 text-xs text-center shadow min-w-[40px]';
                ack.textContent = `ACK ${ackNum}`;
                if (isDuplicate) {
                    ack.classList.remove('border-green-500', 'bg-green-100');
                    ack.classList.add('border-orange-500', 'bg-orange-100');
                    ack.textContent += ' (é‡å¤)';
                }
                ack.style.position = 'absolute'; // Ensure absolute positioning initially
                ack.style.left = `${tcpHolSim_state.receiverEndX}px`;
                ack.style.top = `${tcpHolSim_state.ackReturnY}px`;
                tcpHolSim_elements.channel.appendChild(ack);
                tcpHolSim_state.acks[ackId] = { element: ack, ack: ackNum, state: 'sending', isDuplicate, id: ackId };
                return ack;
            }

            function tcpHolSim_moveElement(element, targetX, targetY, callback) {
                if (!element || !element.style || !element.parentElement) {
                    console.warn("tcpHolSim: Attempted to move an invalid or detached element:", element);
                    if (callback) requestAnimationFrame(callback);
                    return;
                }
                element.style.position = 'absolute';
                void element.offsetWidth; // Force reflow

                const elementWidth = element.offsetWidth || 40;
                const elementHeight = element.offsetHeight || 24;
                element.style.left = `${targetX - elementWidth / 2}px`;
                element.style.top = `${targetY - elementHeight / 2}px`;

                const transitionEndHandler = (event) => {
                    if (event.target === element && (event.propertyName === 'left' || event.propertyName === 'top')) {
                        element.removeEventListener('transitionend', transitionEndHandler);
                        if (callback) requestAnimationFrame(callback);
                    }
                };
                element.addEventListener('transitionend', transitionEndHandler);

                // Fallback timer
                setTimeout(() => {
                    element.removeEventListener('transitionend', transitionEndHandler);
                    // Check if callback already executed? Hard to do reliably.
                    // If element still exists and callback hasn't run, maybe run it?
                    // For simplicity, we might rely on the transitionend event primarily.
                }, 3000); // Slightly longer than animation
            }

            function tcpHolSim_applyArrivalCue(element) {
                if (!element) return;
                element.classList.add('tcpHolSim_packet-arrived-cue');
                setTimeout(() => {
                    if (element) element.classList.remove('tcpHolSim_packet-arrived-cue');
                }, 500);
            }

            function tcpHolSim_applyLosingCue(element, callback) {
                if (!element) return;
                element.classList.add('tcpHolSim_packet-losing');
                setTimeout(() => {
                    if (element) element.classList.remove('tcpHolSim_packet-losing');
                    if (callback) callback();
                }, 500);
            }

            function tcpHolSim_updateExplanation(text) { if (tcpHolSim_elements.explanation) tcpHolSim_elements.explanation.textContent = text; }
            function tcpHolSim_updateSenderStatus(text) { if (tcpHolSim_elements.senderStatus) { tcpHolSim_elements.senderStatus.style.opacity = 0; setTimeout(() => { tcpHolSim_elements.senderStatus.textContent = text; tcpHolSim_elements.senderStatus.style.opacity = 1; }, 300); } }
            function tcpHolSim_updateReceiverStatus(text) { if (tcpHolSim_elements.receiverStatus) { tcpHolSim_elements.receiverStatus.style.opacity = 0; setTimeout(() => { tcpHolSim_elements.receiverStatus.textContent = text; tcpHolSim_elements.receiverStatus.style.opacity = 1; }, 300); } }

            function tcpHolSim_updateExpectedSeq(seqNum) {
                tcpHolSim_state.expectedSeqNum = seqNum;
                if (tcpHolSim_elements.expectedSeqEl) {
                    tcpHolSim_elements.expectedSeqEl.textContent = `SEQ ${seqNum}`;
                    tcpHolSim_elements.expectedSeqEl.classList.add('transition', 'duration-300', 'transform', 'scale-110');
                    setTimeout(() => tcpHolSim_elements.expectedSeqEl.classList.remove('scale-110'), 300);
                }
            }

            function tcpHolSim_updateSenderWindowVisual() {
                const windowEnd = tcpHolSim_state.senderWindowStart + tcpHolSim_state.senderWindowSize - 1;
                if (tcpHolSim_elements.senderWindowLabel) tcpHolSim_elements.senderWindowLabel.textContent = `å‘é€çª—å£ [${tcpHolSim_state.senderWindowStart}-${windowEnd}]`;
                for (let i = 1; i <= TCPHOLSIM_MAX_SEQ; i++) {
                    const el = tcpHolSim_elements.senderSeqElements[i];
                    if (el) {
                        const isInWindow = (i >= tcpHolSim_state.senderWindowStart && i <= windowEnd);
                        const isAcked = (i < tcpHolSim_state.senderWindowStart);
                        el.classList.remove('opacity-50', 'bg-green-200', 'border-green-400', 'bg-gray-300', 'bg-white');
                        if (isAcked) {
                            el.classList.add('opacity-50', 'bg-green-200', 'border-green-400');
                        } else if (isInWindow) {
                            el.classList.add('bg-white');
                        } else {
                            el.classList.add('opacity-50', 'bg-gray-300');
                        }
                    }
                }
            }

            function tcpHolSim_addToReceiverBuffer(packetId) {
                const packetInfo = tcpHolSim_state.packets[packetId];
                if (!packetInfo || !packetInfo.element) return;
                const packetElement = packetInfo.element;
                packetElement.classList.remove('tcpHolSim_packet-arrived-cue');
                packetElement.classList.add('tcpHolSim_packet-buffered');
                tcpHolSim_state.receiverBufferContent[packetInfo.seq] = packetId;
                packetInfo.state = 'buffered';
                tcpHolSim_updateReceiverBufferVisualOrder();
            }

            function tcpHolSim_updateReceiverBufferVisualOrder() {
                const sortedKeys = Object.keys(tcpHolSim_state.receiverBufferContent).map(Number).sort((a, b) => a - b);
                tcpHolSim_elements.bufferSlots.forEach(slot => {
                    slot.innerHTML = '';
                    slot.classList.add('bg-gray-200');
                    slot.textContent = 'ç©º';
                });
                sortedKeys.forEach((seqNum, index) => {
                    if (index < tcpHolSim_elements.bufferSlots.length) {
                        const packetId = tcpHolSim_state.receiverBufferContent[seqNum];
                        const packetEl = tcpHolSim_state.packets[packetId]?.element;
                        if (packetEl) {
                            packetEl.style.position = 'static';
                            tcpHolSim_elements.bufferSlots[index].innerHTML = '';
                            tcpHolSim_elements.bufferSlots[index].appendChild(packetEl);
                            tcpHolSim_elements.bufferSlots[index].classList.remove('bg-gray-200');
                        }
                    }
                });
            }

            function tcpHolSim_deliverSequenceToApp(onCompleteCallback) {
                let deliveredSomething = false;
                let deliveryChainComplete = true;

                while (tcpHolSim_state.receiverBufferContent[tcpHolSim_state.expectedSeqNum]) {
                    deliveryChainComplete = false;
                    const currentExpectedSeq = tcpHolSim_state.expectedSeqNum; // Capture current value
                    const packetIdToDeliver = tcpHolSim_state.receiverBufferContent[currentExpectedSeq];
                    const packetElement = tcpHolSim_state.packets[packetIdToDeliver]?.element;
                    const packetInfo = tcpHolSim_state.packets[packetIdToDeliver];

                    if (!packetElement || !packetInfo) {
                        console.error(`tcpHolSim: Packet data not found for SEQ ${currentExpectedSeq} in buffer.`);
                        delete tcpHolSim_state.receiverBufferContent[currentExpectedSeq];
                        tcpHolSim_state.expectedSeqNum++;
                        continue;
                    }

                    const slot = packetElement.parentElement;
                    if (!slot || !slot.classList.contains('tcpHolSim_buffer-slot')) {
                        console.error(`tcpHolSim: Packet SEQ ${currentExpectedSeq} is not in a buffer slot.`);
                        delete tcpHolSim_state.receiverBufferContent[currentExpectedSeq];
                        tcpHolSim_state.expectedSeqNum++;
                        continue;
                    }
                    const slotRect = slot.getBoundingClientRect();
                    const channelRect = tcpHolSim_elements.animationArea.getBoundingClientRect();
                    const startX = slotRect.left - channelRect.left + slotRect.width / 2;
                    const startY = slotRect.top - channelRect.top + slotRect.height / 2;

                    packetElement.style.position = 'absolute';
                    packetElement.style.left = `${startX - packetElement.offsetWidth / 2}px`;
                    packetElement.style.top = `${startY - packetElement.offsetHeight / 2}px`;
                    tcpHolSim_elements.channel.appendChild(packetElement);
                    slot.innerHTML = 'ç©º';
                    slot.classList.add('bg-gray-200');

                    packetElement.classList.remove('tcpHolSim_packet-buffered');
                    packetElement.style.transform = 'scale(1)';

                    // Remove from buffer state *before* starting animation
                    delete tcpHolSim_state.receiverBufferContent[currentExpectedSeq];

                    tcpHolSim_moveElement(packetElement, tcpHolSim_state.receiverEndX, tcpHolSim_state.appLayerY, () => {
                        packetElement.style.position = 'static';
                        packetElement.classList.add('tcpHolSim_packet-delivered');
                        tcpHolSim_elements.appLayer.appendChild(packetElement);
                        tcpHolSim_state.deliveredToAppSeq.add(currentExpectedSeq);
                        if (packetInfo) packetInfo.state = 'delivered';
                        tcpHolSim_sortAppLayer();

                        // Update expected seq *after* delivery animation
                        // Check if the expected number is still the one we just delivered
                        if (tcpHolSim_state.expectedSeqNum === currentExpectedSeq) {
                            tcpHolSim_updateExpectedSeq(currentExpectedSeq + 1);
                        } else {
                            console.warn(`tcpHolSim: Expected sequence number changed during delivery animation of ${currentExpectedSeq}. Now expects ${tcpHolSim_state.expectedSeqNum}`);
                        }

                        deliveredSomething = true;
                        // Check next packet after a short delay
                        setTimeout(() => tcpHolSim_deliverSequenceToApp(onCompleteCallback), 100);
                    });

                    return true; // Indicate delivery was initiated
                }

                if (deliveryChainComplete && onCompleteCallback) {
                    setTimeout(onCompleteCallback, 50);
                }
                return deliveredSomething;
            }

            function tcpHolSim_sortAppLayer() {
                const appPackets = Array.from(tcpHolSim_elements.appLayer.children);
                appPackets.sort((a, b) => {
                    const seqA = parseInt(a.textContent.match(/SEQ (\d+)/)?.[1] || '0');
                    const seqB = parseInt(b.textContent.match(/SEQ (\d+)/)?.[1] || '0');
                    return seqA - seqB;
                });
                appPackets.forEach(p => tcpHolSim_elements.appLayer.appendChild(p));
            }

            function tcpHolSim_startRtoTimerVisual(seqNum) { const timerEl = tcpHolSim_elements.senderRtoTimers[seqNum]; if (timerEl) { timerEl.classList.remove('expired'); timerEl.classList.add('active'); tcpHolSim_state.rtoTimersActive[seqNum] = true; } }
            function tcpHolSim_expireRtoTimerVisual(seqNum) { const timerEl = tcpHolSim_elements.senderRtoTimers[seqNum]; if (timerEl && tcpHolSim_state.rtoTimersActive[seqNum]) { timerEl.classList.add('expired'); } }
            function tcpHolSim_resetRtoTimerVisual(seqNum) { const timerEl = tcpHolSim_elements.senderRtoTimers[seqNum]; if (timerEl) { timerEl.classList.remove('active', 'expired'); tcpHolSim_state.rtoTimersActive[seqNum] = false; } }

            // Define tcpHolSim_steps array (copy and adapt steps from ä¼ è¾“å±‚.html, using tcpHolSim_ prefix)
            const tcpHolSim_steps = [
                // Step 0: Initial State Setup
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    tcpHolSim_updateExplanation("åˆå§‹çŠ¶æ€ï¼šå‘é€æ–¹å‡†å¤‡æŒ‰çª—å£å¤§å° (W=4) å‘é€æ•°æ®ã€‚æ¥æ”¶æ–¹æœŸæœ›æ”¶åˆ° SEQ 1ã€‚");
                    tcpHolSim_updateSenderStatus("å‡†å¤‡å°±ç»ª");
                    tcpHolSim_updateReceiverStatus("ç­‰å¾… SEQ 1");
                    tcpHolSim_updateSenderWindowVisual();
                    tcpHolSim_updateExpectedSeq(1);
                    tcpHolSim_state.animationInProgress = false;
                },
                // Step 1: Send SEQ 1, 2, 3, 4
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    tcpHolSim_updateExplanation("æ­¥éª¤ 1: å‘é€æ–¹å‘é€çª—å£å†…çš„æ•°æ®åŒ… (SEQ 1, 2, 3, 4)ã€‚");
                    tcpHolSim_updateSenderStatus("å‘é€ SEQ 1-4");
                    let packetsStartedMoving = 0;
                    const totalPackets = 4;
                    const onAllStarted = () => {
                        packetsStartedMoving++;
                        if (packetsStartedMoving === totalPackets) {
                            tcpHolSim_state.animationInProgress = false; // Unlock after all starts
                        }
                    };

                    [1, 2, 3, 4].forEach((seq, index) => {
                        if (!tcpHolSim_state.senderStartX) {
                            console.warn("tcpHolSim: Positions not calculated yet, delaying step 1.");
                            setTimeout(() => tcpHolSim_steps[1](), 100);
                            return;
                        }
                        const packet = tcpHolSim_createPacketElement(seq);
                        tcpHolSim_startRtoTimerVisual(seq);
                        setTimeout(() => {
                            if (packet && tcpHolSim_state.packets[packet.id]) {
                                tcpHolSim_moveElement(packet, tcpHolSim_state.receiverEndX, tcpHolSim_state.receiverEndY, () => {
                                    if (tcpHolSim_state.packets[packet.id]) tcpHolSim_state.packets[packet.id].state = 'arrived_at_receiver_location';
                                });
                                onAllStarted(); // Count towards unlocking
                            } else {
                                console.warn(`tcpHolSim: Packet ${seq} element creation or state tracking failed.`);
                                onAllStarted(); // Still count
                            }
                        }, index * 400); // Stagger sending
                    });
                },
                // Step 2: SEQ 2 Lost During Transit
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    let packet2Id = Object.keys(tcpHolSim_state.packets).find(id => tcpHolSim_state.packets[id].seq === 2 && !tcpHolSim_state.packets[id].isRetransmit && (tcpHolSim_state.packets[id].state === 'sending' || tcpHolSim_state.packets[id].state === 'arrived_at_receiver_location'));
                    const packet2 = packet2Id ? tcpHolSim_state.packets[packet2Id].element : null;
                    const packet2Info = packet2Id ? tcpHolSim_state.packets[packet2Id] : null;

                    tcpHolSim_updateExplanation("æ­¥éª¤ 2: SEQ 2 åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼");
                    tcpHolSim_updateSenderStatus("ç­‰å¾… ACK...");
                    tcpHolSim_updateReceiverStatus("ç­‰å¾… SEQ 1...");

                    if (packet2 && packet2Info) {
                        packet2.style.transition = 'all 0.5s ease-out';
                        const currentLeft = parseFloat(packet2.style.left);
                        const moveDist = (tcpHolSim_state.receiverEndX - tcpHolSim_state.senderStartX) * 0.3;
                        packet2.style.left = `${currentLeft + moveDist}px`;

                        setTimeout(() => {
                            tcpHolSim_applyLosingCue(packet2, () => {
                                if (!packet2) return;
                                packet2.classList.add('tcpHolSim_packet-lost');
                                packet2Info.state = 'lost';
                                setTimeout(() => {
                                    if (packet2 && packet2.parentNode) {
                                        packet2.parentNode.removeChild(packet2);
                                    }
                                    tcpHolSim_state.animationInProgress = false;
                                }, 800);
                            });
                        }, 500);
                    } else {
                        console.warn("tcpHolSim: Original Packet 2 not found or not in sending state for loss.");
                        let lostPacket2Info = Object.values(tcpHolSim_state.packets).find(p => p.seq === 2 && !p.isRetransmit);
                        if (lostPacket2Info) lostPacket2Info.state = 'lost';
                        tcpHolSim_state.animationInProgress = false;
                    }
                },
                // Step 3: SEQ 1 Arrives, Delivered, ACK 2 Sent
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    let packet1Id = Object.keys(tcpHolSim_state.packets).find(id => tcpHolSim_state.packets[id].seq === 1 && tcpHolSim_state.packets[id].state === 'arrived_at_receiver_location');
                    const packet1 = packet1Id ? tcpHolSim_state.packets[packet1Id].element : null;
                    const packet1Info = packet1Id ? tcpHolSim_state.packets[packet1Id] : null;

                    tcpHolSim_updateExplanation("æ­¥éª¤ 3: SEQ 1 åˆ°è¾¾æ¥æ”¶æ–¹ã€‚æ¥æ”¶æ–¹å°†å…¶äº¤ä»˜ç»™åº”ç”¨å±‚ï¼Œå¹¶å‘é€ ACK 2ã€‚");
                    tcpHolSim_updateReceiverStatus("æ”¶åˆ° SEQ 1, äº¤ä»˜åº”ç”¨å±‚, å‘é€ ACK 2");

                    if (packet1 && packet1Info) {
                        packet1Info.state = 'arrived_in_order';
                        tcpHolSim_applyArrivalCue(packet1);
                        setTimeout(() => {
                            if (!packet1) return;
                            tcpHolSim_updateExpectedSeq(2);
                            tcpHolSim_moveElement(packet1, tcpHolSim_state.receiverEndX, tcpHolSim_state.appLayerY, () => {
                                packet1.style.position = 'static';
                                packet1.classList.add('tcpHolSim_packet-delivered');
                                tcpHolSim_elements.appLayer.appendChild(packet1);
                                tcpHolSim_state.deliveredToAppSeq.add(1);
                                packet1Info.state = 'delivered';
                                tcpHolSim_sortAppLayer();
                                const ack2 = tcpHolSim_createAckElement(2);
                                tcpHolSim_moveElement(ack2, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => {
                                    if (tcpHolSim_state.acks[ack2.id]) tcpHolSim_state.acks[ack2.id].state = 'arrived_at_sender';
                                    tcpHolSim_state.animationInProgress = false; // Unlock after ACK arrives
                                });
                            });
                        }, 600);
                    } else {
                        console.error("tcpHolSim: Packet 1 not found or not in correct state at Step 3.");
                        tcpHolSim_updateExpectedSeq(2);
                        tcpHolSim_state.deliveredToAppSeq.add(1);
                        const ack2 = tcpHolSim_createAckElement(2);
                        tcpHolSim_moveElement(ack2, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => { tcpHolSim_state.animationInProgress = false; });
                    }
                },
                // Step 4: SEQ 3 Arrives, Buffered, Repeat ACK 2
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    let packet3Id = Object.keys(tcpHolSim_state.packets).find(id => tcpHolSim_state.packets[id].seq === 3 && tcpHolSim_state.packets[id].state === 'arrived_at_receiver_location');
                    const packet3 = packet3Id ? tcpHolSim_state.packets[packet3Id].element : null;
                    const packet3Info = packet3Id ? tcpHolSim_state.packets[packet3Id] : null;

                    tcpHolSim_updateExplanation("æ­¥éª¤ 4: SEQ 3 åˆ°è¾¾ã€‚å› æœŸæœ› SEQ 2 è€Œå¤±åºï¼Œè¢«æ”¾å…¥ç¼“å†²åŒºã€‚æ¥æ”¶æ–¹é‡å¤å‘é€ ACK 2ã€‚");
                    tcpHolSim_updateReceiverStatus("æ”¶åˆ°ä¹±åº SEQ 3, ç¼“å†², é‡å¤ ACK 2");

                    if (packet3 && packet3Info) {
                        packet3Info.state = 'arrived_ooo';
                        tcpHolSim_applyArrivalCue(packet3);
                        setTimeout(() => {
                            if (!packet3) return;
                            tcpHolSim_addToReceiverBuffer(packet3Info.id);
                            const ack2_dup1 = tcpHolSim_createAckElement(2, true);
                            tcpHolSim_moveElement(ack2_dup1, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => {
                                if (tcpHolSim_state.acks[ack2_dup1.id]) tcpHolSim_state.acks[ack2_dup1.id].state = 'arrived_at_sender';
                                tcpHolSim_state.animationInProgress = false; // Unlock after dup ACK arrives
                            });
                        }, 600);
                    } else {
                        console.error("tcpHolSim: Packet 3 not found or not in correct state at Step 4.");
                        const ack2_dup1 = tcpHolSim_createAckElement(2, true);
                        tcpHolSim_moveElement(ack2_dup1, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => { tcpHolSim_state.animationInProgress = false; });
                    }
                },
                // Step 5: SEQ 4 Arrives, Buffered, Repeat ACK 2 (HOL Blocking Visible)
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    let packet4Id = Object.keys(tcpHolSim_state.packets).find(id => tcpHolSim_state.packets[id].seq === 4 && tcpHolSim_state.packets[id].state === 'arrived_at_receiver_location');
                    const packet4 = packet4Id ? tcpHolSim_state.packets[packet4Id].element : null;
                    const packet4Info = packet4Id ? tcpHolSim_state.packets[packet4Id] : null;

                    tcpHolSim_updateExplanation("æ­¥éª¤ 5: SEQ 4 åˆ°è¾¾ã€‚ä»ç„¶å¤±åºï¼Œæ”¾å…¥ç¼“å†²åŒºã€‚å†æ¬¡é‡å¤å‘é€ ACK 2ã€‚é˜Ÿå¤´é˜»å¡å‘ç”Ÿï¼");
                    tcpHolSim_updateReceiverStatus("æ”¶åˆ°ä¹±åº SEQ 4, ç¼“å†², é‡å¤ ACK 2");

                    if (packet4 && packet4Info) {
                        packet4Info.state = 'arrived_ooo';
                        tcpHolSim_applyArrivalCue(packet4);
                        setTimeout(() => {
                            if (!packet4) return;
                            tcpHolSim_addToReceiverBuffer(packet4Info.id);
                            const ack2_dup2 = tcpHolSim_createAckElement(2, true);
                            tcpHolSim_moveElement(ack2_dup2, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => {
                                if (tcpHolSim_state.acks[ack2_dup2.id]) tcpHolSim_state.acks[ack2_dup2.id].state = 'arrived_at_sender';
                                tcpHolSim_state.animationInProgress = false; // Unlock after dup ACK arrives
                            });
                        }, 600);
                    } else {
                        console.error("tcpHolSim: Packet 4 not found or not in correct state at Step 5.");
                        const ack2_dup2 = tcpHolSim_createAckElement(2, true);
                        tcpHolSim_moveElement(ack2_dup2, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => { tcpHolSim_state.animationInProgress = false; });
                    }
                },
                // Step 6: Sender Processes original ACK 2, Slides Window, Sends SEQ 5
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    tcpHolSim_updateExplanation("æ­¥éª¤ 6: å‘é€æ–¹æ”¶åˆ°ç¬¬ä¸€ä¸ª ACK 2ï¼Œç¡®è®¤ SEQ 1ã€‚çª—å£æ»‘åŠ¨è‡³ [2-5]ï¼Œå¹¶å‘é€ SEQ 5ã€‚");
                    tcpHolSim_updateSenderStatus("æ”¶åˆ° ACK 2, çª—å£ -> [2-5], å‘é€ SEQ 5");

                    // Process the first non-duplicate ACK 2
                    const ack2ToProcessId = Object.keys(tcpHolSim_state.acks).find(id =>
                        tcpHolSim_state.acks[id].ack === 2 &&
                        !tcpHolSim_state.acks[id].isDuplicate &&
                        tcpHolSim_state.acks[id].state === 'arrived_at_sender'
                    );

                    if (ack2ToProcessId) {
                        const ackElement = tcpHolSim_state.acks[ack2ToProcessId].element;
                        if (ackElement && ackElement.parentNode) ackElement.parentNode.removeChild(ackElement);
                        delete tcpHolSim_state.acks[ack2ToProcessId];
                        tcpHolSim_resetRtoTimerVisual(1); // Stop timer for ACKed packet
                        const packet1Info = Object.values(tcpHolSim_state.packets).find(p => p.seq === 1 && !p.isRetransmit);
                        if (packet1Info) packet1Info.state = 'acked';
                    } else {
                        console.warn("tcpHolSim: Original ACK 2 not found or not arrived at sender yet for processing in Step 6.");
                        // Assume ACK logically processed for demo flow
                    }

                    // Slide Window
                    tcpHolSim_state.senderWindowStart = 2;
                    tcpHolSim_updateSenderWindowVisual();

                    // Send SEQ 5
                    const packet5 = tcpHolSim_createPacketElement(5);
                    tcpHolSim_startRtoTimerVisual(5);
                    tcpHolSim_moveElement(packet5, tcpHolSim_state.receiverEndX, tcpHolSim_state.receiverEndY, () => {
                        if (tcpHolSim_state.packets[packet5.id]) tcpHolSim_state.packets[packet5.id].state = 'arrived_at_receiver_location';
                        // Don't unlock here, let next step handle arrival
                    });

                    // Clean up duplicate ACKs that might have arrived
                    const duplicateAckIds = Object.keys(tcpHolSim_state.acks).filter(id => tcpHolSim_state.acks[id].ack === 2 && tcpHolSim_state.acks[id].isDuplicate && tcpHolSim_state.acks[id].state === 'arrived_at_sender');
                    duplicateAckIds.forEach(id => {
                        const dupAckElement = tcpHolSim_state.acks[id].element;
                        if (dupAckElement && dupAckElement.parentNode) dupAckElement.parentNode.removeChild(dupAckElement);
                        delete tcpHolSim_state.acks[id];
                    });


                    tcpHolSim_state.animationInProgress = false; // Unlock after starting SEQ 5 move
                },
                // Step 7: SEQ 5 Arrives, Buffered, Repeat ACK 2
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    let packet5Id = Object.keys(tcpHolSim_state.packets).find(id => tcpHolSim_state.packets[id].seq === 5 && tcpHolSim_state.packets[id].state === 'arrived_at_receiver_location');
                    const packet5 = packet5Id ? tcpHolSim_state.packets[packet5Id].element : null;
                    const packet5Info = packet5Id ? tcpHolSim_state.packets[packet5Id] : null;

                    tcpHolSim_updateExplanation("æ­¥éª¤ 7: SEQ 5 åˆ°è¾¾ã€‚å› æœŸæœ› SEQ 2 è€Œå¤±åºï¼Œè¢«æ”¾å…¥ç¼“å†²åŒºã€‚å†æ¬¡é‡å¤å‘é€ ACK 2ã€‚");
                    tcpHolSim_updateReceiverStatus("æ”¶åˆ°ä¹±åº SEQ 5, ç¼“å†², é‡å¤ ACK 2");

                    if (packet5 && packet5Info) {
                        packet5Info.state = 'arrived_ooo';
                        tcpHolSim_applyArrivalCue(packet5);
                        setTimeout(() => {
                            if (!packet5) return;
                            tcpHolSim_addToReceiverBuffer(packet5Info.id);
                            const ack2_dup3 = tcpHolSim_createAckElement(2, true);
                            tcpHolSim_moveElement(ack2_dup3, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => {
                                if (tcpHolSim_state.acks[ack2_dup3.id]) tcpHolSim_state.acks[ack2_dup3.id].state = 'arrived_at_sender';
                                tcpHolSim_state.animationInProgress = false; // Unlock after dup ACK arrives
                            });
                        }, 600);
                    } else {
                        console.error("tcpHolSim: Packet 5 not found or not in correct state at Step 7.");
                        const ack2_dup3 = tcpHolSim_createAckElement(2, true);
                        tcpHolSim_moveElement(ack2_dup3, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => { tcpHolSim_state.animationInProgress = false; });
                    }
                },
                // Step 8: RTO Timeout for SEQ 2
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    // Clean up any remaining duplicate ACKs at sender
                    const duplicateAckIds = Object.keys(tcpHolSim_state.acks).filter(id => tcpHolSim_state.acks[id].ack === 2 && tcpHolSim_state.acks[id].isDuplicate && tcpHolSim_state.acks[id].state === 'arrived_at_sender');
                    duplicateAckIds.forEach(id => {
                        const dupAckElement = tcpHolSim_state.acks[id].element;
                        if (dupAckElement && dupAckElement.parentNode) dupAckElement.parentNode.removeChild(dupAckElement);
                        delete tcpHolSim_state.acks[id];
                    });

                    tcpHolSim_updateExplanation("æ­¥éª¤ 8: å‘é€æ–¹æœªæ”¶åˆ°å¯¹ SEQ 2 çš„ç¡®è®¤ï¼Œå…¶ RTO è®¡æ—¶å™¨åˆ°æœŸï¼");
                    tcpHolSim_updateSenderStatus("SEQ 2 è¶…æ—¶!");
                    tcpHolSim_expireRtoTimerVisual(2);
                    tcpHolSim_state.animationInProgress = false;
                },
                // Step 9: Retransmit SEQ 2
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    tcpHolSim_updateExplanation("æ­¥éª¤ 9: å‘é€æ–¹è¶…æ—¶é‡ä¼  SEQ 2ã€‚");
                    tcpHolSim_updateSenderStatus("é‡ä¼  SEQ 2");
                    const retransmitPacket2 = tcpHolSim_createPacketElement(2, true);
                    tcpHolSim_resetRtoTimerVisual(2);
                    tcpHolSim_startRtoTimerVisual(2);
                    tcpHolSim_moveElement(retransmitPacket2, tcpHolSim_state.receiverEndX, tcpHolSim_state.receiverEndY, () => {
                        if (tcpHolSim_state.packets[retransmitPacket2.id]) tcpHolSim_state.packets[retransmitPacket2.id].state = 'arrived_at_receiver_location';
                        // Don't unlock here
                    });
                    tcpHolSim_state.animationInProgress = false; // Unlock after move starts
                },
                // Step 10: Retransmitted SEQ 2 Arrives
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    let packet2_retransmit_id = Object.keys(tcpHolSim_state.packets).find(id =>
                        tcpHolSim_state.packets[id].seq === 2 &&
                        tcpHolSim_state.packets[id].isRetransmit &&
                        tcpHolSim_state.packets[id].state === 'arrived_at_receiver_location'
                    );
                    const packet2_retransmit = packet2_retransmit_id ? tcpHolSim_state.packets[packet2_retransmit_id].element : null;
                    const packet2_retransmit_info = packet2_retransmit_id ? tcpHolSim_state.packets[packet2_retransmit_id] : null;

                    tcpHolSim_updateExplanation("æ­¥éª¤ 10: é‡ä¼ çš„ SEQ 2 åˆ°è¾¾æ¥æ”¶æ–¹ã€‚æ­£æ˜¯æœŸæœ›çš„æ•°æ®åŒ…ï¼");
                    tcpHolSim_updateReceiverStatus("æ”¶åˆ°é‡ä¼ çš„ SEQ 2");

                    if (packet2_retransmit && packet2_retransmit_info) {
                        packet2_retransmit_info.state = 'arrived_in_order';
                        tcpHolSim_applyArrivalCue(packet2_retransmit);
                        setTimeout(() => { tcpHolSim_state.animationInProgress = false; }, 600); // Wait for cue
                    } else {
                        console.error("tcpHolSim: Retransmitted Packet 2 element not found or not in correct state at Step 10.");
                        tcpHolSim_state.animationInProgress = false;
                    }
                },
                // Step 11: Deliver SEQ 2, 3, 4, 5, Send ACK 6
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    tcpHolSim_updateExplanation("æ­¥éª¤ 11: æ¥æ”¶æ–¹äº¤ä»˜ SEQ 2 (é‡ä¼ )ã€‚ç„¶åæŒ‰åºäº¤ä»˜ç¼“å†²ä¸­çš„ SEQ 3, 4, 5ã€‚é˜Ÿå¤´é˜»å¡è§£é™¤ï¼å‘é€ ACK 6ã€‚");
                    tcpHolSim_updateReceiverStatus("äº¤ä»˜ SEQ 2, 3, 4, 5, å‘é€ ACK 6");

                    let packet2_retransmit_id = Object.keys(tcpHolSim_state.packets).find(id =>
                        tcpHolSim_state.packets[id].seq === 2 &&
                        tcpHolSim_state.packets[id].isRetransmit &&
                        tcpHolSim_state.packets[id].state === 'arrived_in_order'
                    );
                    const packet2_retransmit = packet2_retransmit_id ? tcpHolSim_state.packets[packet2_retransmit_id].element : null;
                    const packet2_retransmit_info = packet2_retransmit_id ? tcpHolSim_state.packets[packet2_retransmit_id] : null;

                    if (!packet2_retransmit || !packet2_retransmit_info) {
                        console.error("tcpHolSim: Retransmitted Packet 2 not found or not arrived for delivery at Step 11.");
                        tcpHolSim_state.animationInProgress = false;
                        return;
                    }

                    packet2_retransmit.classList.remove('tcpHolSim_packet-arrived-cue');
                    tcpHolSim_moveElement(packet2_retransmit, tcpHolSim_state.receiverEndX, tcpHolSim_state.appLayerY, () => {
                        packet2_retransmit.style.position = 'static';
                        packet2_retransmit.classList.add('tcpHolSim_packet-delivered');
                        tcpHolSim_elements.appLayer.appendChild(packet2_retransmit);
                        tcpHolSim_state.deliveredToAppSeq.add(2);
                        packet2_retransmit_info.state = 'delivered';
                        tcpHolSim_sortAppLayer();
                        tcpHolSim_updateExpectedSeq(3);

                        tcpHolSim_deliverSequenceToApp(() => {
                            if (tcpHolSim_state.expectedSeqNum === 6) {
                                const ack6 = tcpHolSim_createAckElement(6);
                                tcpHolSim_moveElement(ack6, tcpHolSim_state.senderStartX, tcpHolSim_state.ackReturnY, () => {
                                    if (tcpHolSim_state.acks[ack6.id]) tcpHolSim_state.acks[ack6.id].state = 'arrived_at_sender';
                                    tcpHolSim_state.animationInProgress = false; // Final unlock
                                });
                            } else {
                                console.error(`tcpHolSim: Expected sequence number is ${tcpHolSim_state.expectedSeqNum}, not 6, after delivering buffered packets.`);
                                tcpHolSim_state.animationInProgress = false;
                            }
                        });
                    });
                },
                // Step 12: Sender Processes ACK 6, Slides Window
                () => {
                    tcpHolSim_state.animationInProgress = true;
                    tcpHolSim_updateExplanation("æ­¥éª¤ 12: å‘é€æ–¹æ”¶åˆ° ACK 6ï¼Œç¡®è®¤ SEQ 2-5ã€‚å‘é€çª—å£å‘å‰æ»‘åŠ¨è‡³ [6-9]ã€‚");
                    tcpHolSim_updateSenderStatus("æ”¶åˆ° ACK 6, çª—å£ -> [6-9]");

                    const ack6Id = Object.keys(tcpHolSim_state.acks).find(id => tcpHolSim_state.acks[id].ack === 6 && tcpHolSim_state.acks[id].state === 'arrived_at_sender');
                    if (ack6Id) {
                        const ack6Element = tcpHolSim_state.acks[ack6Id].element;
                        if (ack6Element && ack6Element.parentNode) ack6Element.parentNode.removeChild(ack6Element);
                        delete tcpHolSim_state.acks[ack6Id];
                    } else {
                        console.warn("tcpHolSim: ACK 6 not found or not arrived at sender.");
                    }

                    [2, 3, 4, 5].forEach(seq => {
                        tcpHolSim_resetRtoTimerVisual(seq);
                        const packetInfo = Object.values(tcpHolSim_state.packets).find(p => p.seq === seq); // Find any packet with this seq
                        if (packetInfo) packetInfo.state = 'acked';
                    });

                    tcpHolSim_state.senderWindowStart = 6;
                    tcpHolSim_updateSenderWindowVisual();

                    tcpHolSim_updateExplanation("æ¨¡æ‹Ÿç»“æŸã€‚é˜Ÿå¤´é˜»å¡å·²æ¼”ç¤ºå¹¶è§£é™¤ã€‚å‘é€æ–¹çª—å£å·²æ›´æ–°ã€‚å¯ä»¥ 'é‡ç½®' å†æ¥ä¸€æ¬¡ã€‚");
                    if (tcpHolSim_elements.nextStepBtn) {
                        tcpHolSim_elements.nextStepBtn.disabled = true;
                        tcpHolSim_elements.nextStepBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                    tcpHolSim_state.animationInProgress = false;
                }
            ];

            function tcpHolSim_initializeSimulation() {
                console.log("tcpHolSim: Resetting simulation...");
                tcpHolSim_state.animationInProgress = true;
                tcpHolSim_elements.channel.querySelectorAll('.tcpHolSim_packet, .tcpHolSim_ack').forEach(el => {
                    el.style.transition = 'none';
                    if (el.parentNode) el.parentNode.removeChild(el);
                });

                tcpHolSim_state.currentStep = 0;
                tcpHolSim_state.packets = {};
                tcpHolSim_state.acks = {};
                tcpHolSim_state.receiverBufferContent = {};
                tcpHolSim_state.deliveredToAppSeq.clear();
                tcpHolSim_state.expectedSeqNum = 1;
                tcpHolSim_state.senderWindowStart = 1;
                tcpHolSim_state.rtoTimersActive = {};

                tcpHolSim_elements.channel.innerHTML = '';
                tcpHolSim_elements.appLayer.innerHTML = '';
                tcpHolSim_elements.bufferSlots.forEach(slot => {
                    slot.innerHTML = 'ç©º';
                    slot.classList.add('bg-gray-200');
                });

                for (let i = 1; i <= TCPHOLSIM_MAX_SEQ; i++) {
                    tcpHolSim_resetRtoTimerVisual(i);
                    if (tcpHolSim_elements.senderSeqElements[i]) {
                        tcpHolSim_elements.senderSeqElements[i].classList.remove('opacity-50', 'bg-green-200', 'border-green-400', 'bg-gray-300');
                        tcpHolSim_elements.senderSeqElements[i].classList.add('border-gray-400', 'bg-white');
                    }
                }
                tcpHolSim_updateSenderWindowVisual();
                tcpHolSim_steps[0](); // Run initial setup step

                if (tcpHolSim_elements.nextStepBtn) {
                    tcpHolSim_elements.nextStepBtn.disabled = false;
                    tcpHolSim_elements.nextStepBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                console.log("tcpHolSim: Simulation Reset Complete. Current Step:", tcpHolSim_state.currentStep);
                // animationInProgress is set to false by step 0
            }

            if (tcpHolSim_elements.nextStepBtn && tcpHolSim_elements.resetBtn) {
                tcpHolSim_elements.nextStepBtn.addEventListener('click', () => {
                    if (tcpHolSim_state.animationInProgress) return;
                    if (tcpHolSim_state.currentStep < tcpHolSim_steps.length) {
                        try {
                            console.log(`tcpHolSim: Executing Step: ${tcpHolSim_state.currentStep}`);
                            tcpHolSim_state.animationInProgress = true;
                            tcpHolSim_steps[tcpHolSim_state.currentStep]();
                            tcpHolSim_state.currentStep++;
                        } catch (error) {
                            console.error(`tcpHolSim: Error executing step ${tcpHolSim_state.currentStep - 1}:`, error);
                            tcpHolSim_updateExplanation(`æ‰§è¡Œæ­¥éª¤ ${tcpHolSim_state.currentStep - 1} æ—¶å‡ºé”™: ${error.message}. è¯·å°è¯•é‡ç½®ã€‚`);
                            tcpHolSim_elements.nextStepBtn.disabled = true;
                            tcpHolSim_elements.nextStepBtn.classList.add('opacity-50', 'cursor-not-allowed');
                            tcpHolSim_state.animationInProgress = false;
                        }
                    }
                });
                tcpHolSim_elements.resetBtn.addEventListener('click', tcpHolSim_initializeSimulation);
                tcpHolSim_calculatePositions(); // Initial calculation
                setTimeout(tcpHolSim_initializeSimulation, 100); // Initialize after positions are likely set
                window.addEventListener('resize', tcpHolSim_calculatePositions);
            } else {
                console.error("tcpHolSim: Initialization failed - Next or Reset button not found.");
            }


            // --- TCP Flow Control Simulation (tcpFlowSim_) ---
            const tcpFlowSim_elements = {
                senderBufferEl: document.getElementById('tcpFlowSim_sender-buffer'),
                receiverBufferEl: document.getElementById('tcpFlowSim_receiver-buffer'),
                receiverBufferContainerEl: document.getElementById('tcpFlowSim_receiver-buffer-container'),
                transmissionChannelEl: document.getElementById('tcpFlowSim_transmission-channel'),
                sendPacketBtn: document.getElementById('tcpFlowSim_send-packet-btn'),
                processPacketBtn: document.getElementById('tcpFlowSim_process-packet-btn'),
                resetBtn: document.getElementById('tcpFlowSim_reset-btn'),
                messageContentEl: document.getElementById('tcpFlowSim_message-content'),
                sndNxtEl: document.getElementById('tcpFlowSim_snd-nxt'),
                sndUnaEl: document.getElementById('tcpFlowSim_snd-una'),
                sendWindowSizeEl: document.getElementById('tcpFlowSim_send-window-size'),
                usableWindowSizeEl: document.getElementById('tcpFlowSim_usable-window-size'),
                advertisedRwndEl: document.getElementById('tcpFlowSim_advertised-rwnd'),
                sendWindowSizeTooltipEl: document.getElementById('tcpFlowSim_send-window-size-tooltip'),
                rcvNxtEl: document.getElementById('tcpFlowSim_rcv-nxt'),
                bufferCapacityEl: document.getElementById('tcpFlowSim_buffer-capacity'),
                currentRwndEl: document.getElementById('tcpFlowSim_current-rwnd'),
                recvWindowSizeTooltipEl: document.getElementById('tcpFlowSim_recv-window-size-tooltip')
            };

            const TCP_FLOW_SIM_PACKET_SIZE = 36;
            const TCP_FLOW_SIM_BUFFER_CAPACITY = 10;
            const TCP_FLOW_SIM_MAX_SEQ_NUM = 30;
            const TCP_FLOW_SIM_ANIMATION_DURATION = 1500;
            const TCP_FLOW_SIM_PROBE_INTERVAL = 4000;

            let tcpFlowSim_state = {
                sndNxt: 1,
                sndUna: 1,
                rcvNxt: 1,
                advertisedRwnd: TCP_FLOW_SIM_BUFFER_CAPACITY,
                currentRwnd: TCP_FLOW_SIM_BUFFER_CAPACITY,
                sendWindowSize: TCP_FLOW_SIM_BUFFER_CAPACITY,
                usableWindowSize: TCP_FLOW_SIM_BUFFER_CAPACITY,
                nextPacketToSend: 1,
                receiverBuffer: [], // Stores {seq: number}
                senderPackets: {}, // Stores {seq: element}
                inFlightPackets: {}, // Stores {seq: {type: 'data'|'ack'|'probe', el: element}}
                zeroWindowProbeTimer: null,
                isZeroWindow: false,
                isSimulating: false
            };

            // (Include all helper functions from ä¼ è¾“å±‚.html for the tcpFlowSim_, prefixed with tcpFlowSim_)
            // e.g., tcpFlowSim_initSimulation, tcpFlowSim_createPacketElement, tcpFlowSim_updateSenderUI, etc.
            // ... (implementation of helper functions adapted with tcpFlowSim_ prefix) ...
            function tcpFlowSim_initSimulation() {
                tcpFlowSim_state.isSimulating = false;
                tcpFlowSim_state.sndNxt = 1;
                tcpFlowSim_state.sndUna = 1;
                tcpFlowSim_state.rcvNxt = 1;
                tcpFlowSim_state.advertisedRwnd = TCP_FLOW_SIM_BUFFER_CAPACITY;
                tcpFlowSim_state.currentRwnd = TCP_FLOW_SIM_BUFFER_CAPACITY;
                tcpFlowSim_state.sendWindowSize = TCP_FLOW_SIM_BUFFER_CAPACITY;
                tcpFlowSim_state.usableWindowSize = TCP_FLOW_SIM_BUFFER_CAPACITY;
                tcpFlowSim_state.nextPacketToSend = 1;
                tcpFlowSim_state.receiverBuffer = [];
                tcpFlowSim_state.senderPackets = {};
                tcpFlowSim_state.inFlightPackets = {};
                tcpFlowSim_state.isZeroWindow = false;
                if (tcpFlowSim_state.zeroWindowProbeTimer) {
                    clearTimeout(tcpFlowSim_state.zeroWindowProbeTimer);
                    tcpFlowSim_state.zeroWindowProbeTimer = null;
                }

                // Clear UI elements
                tcpFlowSim_elements.senderBufferEl?.querySelectorAll('.tcpFlowSim_packet, .tcpFlowSim_window-segment').forEach(el => el.remove());
                tcpFlowSim_elements.receiverBufferEl?.querySelectorAll('.tcpFlowSim_packet, .tcpFlowSim_window-segment').forEach(el => el.remove());
                if (tcpFlowSim_elements.transmissionChannelEl) tcpFlowSim_elements.transmissionChannelEl.innerHTML = '';

                // Add initial packets to sender buffer
                if (tcpFlowSim_elements.senderBufferEl) {
                    for (let i = 1; i <= TCP_FLOW_SIM_MAX_SEQ_NUM; i++) {
                        tcpFlowSim_createSenderPacket(i);
                    }
                }

                tcpFlowSim_updateSenderUI();
                tcpFlowSim_updateReceiverUI();

                if (tcpFlowSim_elements.sendPacketBtn) tcpFlowSim_elements.sendPacketBtn.disabled = false;
                if (tcpFlowSim_elements.processPacketBtn) tcpFlowSim_elements.processPacketBtn.disabled = true;
                tcpFlowSim_showMessage("æ¨¡æ‹Ÿå·²é‡ç½®ã€‚ç‚¹å‡» 'å‘é€æ•°æ®åŒ…' å¼€å§‹ä½“éªŒ TCP æµé‡æ§åˆ¶è¿‡ç¨‹ã€‚");
            }

            function tcpFlowSim_createPacketElement(seq, type = 'sender') {
                const packet = document.createElement('div');
                packet.classList.add('tcpFlowSim_packet');
                packet.dataset.seq = seq;
                packet.textContent = seq;
                packet.style.position = 'relative';
                packet.style.left = '0px';
                packet.style.top = '0px';
                if (type === 'receiver') packet.classList.add('tcpFlowSim_received');
                return packet;
            }

            function tcpFlowSim_createSenderPacket(seq) {
                const packet = tcpFlowSim_createPacketElement(seq, 'sender');
                tcpFlowSim_state.senderPackets[seq] = packet;
                if (tcpFlowSim_elements.senderBufferEl) tcpFlowSim_elements.senderBufferEl.appendChild(packet);
                packet.style.position = 'absolute';
                tcpFlowSim_positionPacketInBuffer(packet, seq, tcpFlowSim_elements.senderBufferEl);
            }

            function tcpFlowSim_positionPacketInBuffer(packetEl, seq, bufferEl) {
                if (!bufferEl || !packetEl) return;
                const index = seq - 1;
                const containerWidth = bufferEl.clientWidth;
                const itemsPerRow = containerWidth > 0 ? Math.floor(containerWidth / TCP_FLOW_SIM_PACKET_SIZE) : 1;
                if (itemsPerRow <= 0) return;
                const row = Math.floor(index / itemsPerRow);
                const col = index % itemsPerRow;
                packetEl.style.left = `${col * TCP_FLOW_SIM_PACKET_SIZE}px`;
                packetEl.style.top = `${row * TCP_FLOW_SIM_PACKET_SIZE}px`;
            }

            function tcpFlowSim_updateSenderUI() {
                if (!tcpFlowSim_elements.sndNxtEl) return; // Basic check

                tcpFlowSim_elements.sndNxtEl.textContent = tcpFlowSim_state.sndNxt;
                tcpFlowSim_elements.sndUnaEl.textContent = tcpFlowSim_state.sndUna;
                tcpFlowSim_state.sendWindowSize = tcpFlowSim_state.advertisedRwnd; // Simplified
                tcpFlowSim_elements.sendWindowSizeEl.textContent = tcpFlowSim_state.sendWindowSize;
                tcpFlowSim_elements.advertisedRwndEl.textContent = tcpFlowSim_state.advertisedRwnd;
                tcpFlowSim_state.usableWindowSize = Math.max(0, tcpFlowSim_state.sendWindowSize - (tcpFlowSim_state.sndNxt - tcpFlowSim_state.sndUna));
                tcpFlowSim_elements.usableWindowSizeEl.textContent = tcpFlowSim_state.usableWindowSize;

                if (tcpFlowSim_elements.sendPacketBtn) {
                    tcpFlowSim_elements.sendPacketBtn.disabled = tcpFlowSim_state.isSimulating || (tcpFlowSim_state.usableWindowSize <= 0 || tcpFlowSim_state.nextPacketToSend > TCP_FLOW_SIM_MAX_SEQ_NUM || tcpFlowSim_state.isZeroWindow);
                }

                if (!tcpFlowSim_state.isSimulating) {
                    if (tcpFlowSim_state.isZeroWindow && tcpFlowSim_state.usableWindowSize <= 0) {
                        tcpFlowSim_showMessage(`çŠ¶æ€: æ¥æ”¶æ–¹çª—å£ä¸º 0 (<code>rwnd</code>=0)ï¼Œå‘é€æš‚åœã€‚ç­‰å¾…é›¶çª—å£æ¢æµ‹...`, 'warning');
                        if (!tcpFlowSim_state.zeroWindowProbeTimer) { tcpFlowSim_state.zeroWindowProbeTimer = setTimeout(tcpFlowSim_sendZeroWindowProbe, TCP_FLOW_SIM_PROBE_INTERVAL); }
                    } else if (tcpFlowSim_state.usableWindowSize <= 0 && tcpFlowSim_state.sndNxt <= TCP_FLOW_SIM_MAX_SEQ_NUM) {
                        tcpFlowSim_showMessage(`çŠ¶æ€: å‘é€çª—å£å·²æ»¡ (å¯ç”¨çª—å£=0)ï¼Œæ— æ³•å‘é€æ–°æ•°æ®ï¼Œç­‰å¾… ACK...`, 'info');
                    } else if (tcpFlowSim_state.nextPacketToSend > TCP_FLOW_SIM_MAX_SEQ_NUM) {
                        tcpFlowSim_showMessage(`çŠ¶æ€: æ‰€æœ‰æ•°æ®åŒ… (${TCP_FLOW_SIM_MAX_SEQ_NUM}) å·²å‘é€æˆ–å‘é€å®Œæ¯•ã€‚`, 'info');
                    } else if (tcpFlowSim_state.usableWindowSize > 0 && !tcpFlowSim_state.isZeroWindow) {
                        tcpFlowSim_showMessage(`çŠ¶æ€: å¯ç”¨çª—å£=${tcpFlowSim_state.usableWindowSize}ï¼Œå¯ä»¥å‘é€æ•°æ®åŒ…ã€‚`, 'info');
                    }
                }

                tcpFlowSim_updateSenderPacketStates();
                tcpFlowSim_updateSendWindowIndicator();
            }

            function tcpFlowSim_updateReceiverUI() {
                if (!tcpFlowSim_elements.rcvNxtEl) return; // Basic check

                tcpFlowSim_elements.rcvNxtEl.textContent = tcpFlowSim_state.rcvNxt;
                tcpFlowSim_elements.bufferCapacityEl.textContent = TCP_FLOW_SIM_BUFFER_CAPACITY;
                tcpFlowSim_state.currentRwnd = Math.max(0, TCP_FLOW_SIM_BUFFER_CAPACITY - tcpFlowSim_state.receiverBuffer.length);
                tcpFlowSim_elements.currentRwndEl.textContent = tcpFlowSim_state.currentRwnd;

                if (tcpFlowSim_elements.processPacketBtn) {
                    tcpFlowSim_elements.processPacketBtn.disabled = tcpFlowSim_state.isSimulating || tcpFlowSim_state.receiverBuffer.length === 0;
                }

                tcpFlowSim_updateReceiverPacketStates();
                tcpFlowSim_updateRecvWindowIndicator();
            }

            function tcpFlowSim_updateSendWindowIndicator() {
                if (!tcpFlowSim_elements.senderBufferEl || !tcpFlowSim_elements.sendWindowSizeTooltipEl) return;
                tcpFlowSim_elements.senderBufferEl.querySelectorAll('.tcpFlowSim_send-window-segment').forEach(el => el.remove());
                tcpFlowSim_elements.sendWindowSizeTooltipEl.textContent = tcpFlowSim_state.sendWindowSize;
                if (tcpFlowSim_state.sendWindowSize <= 0) return;

                const windowStartSeq = tcpFlowSim_state.sndUna;
                const windowEndSeq = Math.min(tcpFlowSim_state.sndUna + tcpFlowSim_state.sendWindowSize - 1, TCP_FLOW_SIM_MAX_SEQ_NUM);
                if (windowStartSeq > windowEndSeq) return;

                const containerWidth = tcpFlowSim_elements.senderBufferEl.clientWidth;
                const itemsPerRow = containerWidth > 0 ? Math.floor(containerWidth / TCP_FLOW_SIM_PACKET_SIZE) : 1;
                if (itemsPerRow <= 0) return;

                const startSeqIndex = windowStartSeq - 1;
                const endSeqIndex = windowEndSeq - 1;
                const startRow = Math.floor(startSeqIndex / itemsPerRow);
                const startCol = startSeqIndex % itemsPerRow;
                const endRow = Math.floor(endSeqIndex / itemsPerRow);
                const endCol = endSeqIndex % itemsPerRow;

                for (let row = startRow; row <= endRow; row++) {
                    const segStartCol = (row === startRow) ? startCol : 0;
                    const segEndCol = (row === endRow) ? endCol : itemsPerRow - 1;
                    if (segStartCol > segEndCol) continue;

                    const segLeft = segStartCol * TCP_FLOW_SIM_PACKET_SIZE;
                    const segTop = row * TCP_FLOW_SIM_PACKET_SIZE;
                    const segWidth = (segEndCol - segStartCol + 1) * TCP_FLOW_SIM_PACKET_SIZE;
                    const segHeight = TCP_FLOW_SIM_PACKET_SIZE;

                    const segment = document.createElement('div');
                    segment.classList.add('tcpFlowSim_window-segment', 'tcpFlowSim_send-window-segment');
                    segment.style.left = `${segLeft}px`;
                    segment.style.top = `${segTop}px`;
                    segment.style.width = `${Math.min(segWidth, containerWidth - segLeft)}px`;
                    segment.style.height = `${segHeight}px`;
                    tcpFlowSim_elements.senderBufferEl.appendChild(segment);
                }
            }

            function tcpFlowSim_updateRecvWindowIndicator() {
                if (!tcpFlowSim_elements.receiverBufferEl || !tcpFlowSim_elements.recvWindowSizeTooltipEl) return;
                tcpFlowSim_elements.receiverBufferEl.querySelectorAll('.tcpFlowSim_recv-window-segment').forEach(el => el.remove());
                const windowSize = tcpFlowSim_state.currentRwnd;
                tcpFlowSim_elements.recvWindowSizeTooltipEl.textContent = windowSize;
                if (windowSize <= 0) return;

                const windowStartSeq = tcpFlowSim_state.rcvNxt;
                // Receiver window indicates *available slots*, ending at buffer capacity limit
                const windowEndSeq = Math.min(tcpFlowSim_state.rcvNxt + windowSize - 1, TCP_FLOW_SIM_BUFFER_CAPACITY);
                if (windowStartSeq > windowEndSeq) return;

                const containerWidth = tcpFlowSim_elements.receiverBufferEl.clientWidth;
                const itemsPerRow = containerWidth > 0 ? Math.floor(containerWidth / TCP_FLOW_SIM_PACKET_SIZE) : 1;
                if (itemsPerRow <= 0) return;

                const startSeqIndex = windowStartSeq - 1; // Index of the first available slot
                const endSeqIndex = windowEndSeq - 1;   // Index of the last available slot
                const startRow = Math.floor(startSeqIndex / itemsPerRow);
                const startCol = startSeqIndex % itemsPerRow;
                const endRow = Math.floor(endSeqIndex / itemsPerRow);
                const endCol = endSeqIndex % itemsPerRow;

                for (let row = startRow; row <= endRow; row++) {
                    const segStartCol = (row === startRow) ? startCol : 0;
                    const segEndCol = (row === endRow) ? endCol : itemsPerRow - 1;
                    if (segStartCol > segEndCol) continue;

                    const segLeft = segStartCol * TCP_FLOW_SIM_PACKET_SIZE;
                    const segTop = row * TCP_FLOW_SIM_PACKET_SIZE;
                    const segWidth = (segEndCol - segStartCol + 1) * TCP_FLOW_SIM_PACKET_SIZE;
                    const segHeight = TCP_FLOW_SIM_PACKET_SIZE;

                    const segment = document.createElement('div');
                    segment.classList.add('tcpFlowSim_window-segment', 'tcpFlowSim_recv-window-segment');
                    segment.style.left = `${segLeft}px`;
                    segment.style.top = `${segTop}px`;
                    segment.style.width = `${Math.min(segWidth, containerWidth - segLeft)}px`;
                    segment.style.height = `${segHeight}px`;
                    tcpFlowSim_elements.receiverBufferEl.appendChild(segment);
                }
            }

            function tcpFlowSim_updateSenderPacketStates() {
                Object.keys(tcpFlowSim_state.senderPackets).forEach(seq => {
                    const packetEl = tcpFlowSim_state.senderPackets[seq];
                    if (!packetEl) return;
                    const seqNum = parseInt(seq);
                    packetEl.classList.remove('tcpFlowSim_sent', 'tcpFlowSim_acked');
                    packetEl.style.opacity = '1';
                    if (seqNum < tcpFlowSim_state.sndUna) {
                        packetEl.classList.add('tcpFlowSim_acked');
                        packetEl.style.opacity = '0.5';
                    } else if (seqNum < tcpFlowSim_state.sndNxt) {
                        packetEl.classList.add('tcpFlowSim_sent');
                    } else {
                        packetEl.style.opacity = seqNum < tcpFlowSim_state.sndUna + tcpFlowSim_state.sendWindowSize ? '1' : '0.3';
                    }
                    tcpFlowSim_positionPacketInBuffer(packetEl, seqNum, tcpFlowSim_elements.senderBufferEl);
                });
            }

            function tcpFlowSim_updateReceiverPacketStates() {
                if (!tcpFlowSim_elements.receiverBufferEl) return;
                tcpFlowSim_elements.receiverBufferEl.querySelectorAll('.tcpFlowSim_packet').forEach(p => p.remove());
                tcpFlowSim_state.receiverBuffer.forEach(packetInfo => {
                    const packetEl = tcpFlowSim_createPacketElement(packetInfo.seq, 'receiver');
                    packetEl.classList.add('tcpFlowSim_buffered');
                    tcpFlowSim_elements.receiverBufferEl.appendChild(packetEl);
                    tcpFlowSim_positionPacketInBuffer(packetEl, packetInfo.seq, tcpFlowSim_elements.receiverBufferEl);
                });
            }

            function tcpFlowSim_animatePacket(seq, type) {
                tcpFlowSim_state.isSimulating = true;
                tcpFlowSim_updateSenderUI();
                tcpFlowSim_updateReceiverUI();

                const startEl = (type === 'data' || type === 'probe') ? tcpFlowSim_state.senderPackets[seq] : tcpFlowSim_elements.receiverBufferContainerEl;
                const endEl = (type === 'data' || type === 'probe') ? tcpFlowSim_elements.receiverBufferContainerEl : tcpFlowSim_elements.senderBufferEl;

                if (!startEl || !endEl) {
                    console.error(`tcpFlowSim: Cannot animate ${type} for SEQ=${seq}, start or end element not found.`);
                    tcpFlowSim_state.isSimulating = false; tcpFlowSim_updateSenderUI(); tcpFlowSim_updateReceiverUI(); return;
                }

                const startRect = startEl.getBoundingClientRect();
                const endRect = endEl.getBoundingClientRect();
                const channelRect = tcpFlowSim_elements.transmissionChannelEl?.getBoundingClientRect();

                if (!channelRect) {
                    console.error("tcpFlowSim: Transmission channel not found.");
                    tcpFlowSim_state.isSimulating = false; tcpFlowSim_updateSenderUI(); tcpFlowSim_updateReceiverUI(); return;
                }

                const arrow = document.createElement('div');
                arrow.classList.add('tcpFlowSim_arrow', `tcpFlowSim_${type}`);
                arrow.style.position = 'absolute';
                arrow.style.zIndex = '5';
                let textContent = '';
                if (type === 'data') textContent = `SEQ=${seq}`;
                else if (type === 'ack') textContent = `ACK=${tcpFlowSim_state.rcvNxt}, rwnd=${tcpFlowSim_state.currentRwnd}`;
                else if (type === 'probe') textContent = `Probe (SEQ=${seq})`;
                arrow.textContent = textContent;

                let startX, startY, endX, endY;
                if (type === 'data' || type === 'probe') {
                    const senderPacketRect = tcpFlowSim_state.senderPackets[seq] ? tcpFlowSim_state.senderPackets[seq].getBoundingClientRect() : startRect;
                    startX = senderPacketRect.left + senderPacketRect.width / 2 - channelRect.left;
                    startY = senderPacketRect.bottom - channelRect.top + 5;
                    endX = endRect.left + endRect.width / 2 - channelRect.left;
                    endY = endRect.top - channelRect.top - (arrow.offsetHeight || 20) - 5; // Estimate height if needed
                } else { // ACK
                    startX = startRect.left + startRect.width / 2 - channelRect.left;
                    startY = startRect.top - channelRect.top - (arrow.offsetHeight || 20) - 5;
                    endX = endRect.left + endRect.width / 2 - channelRect.left;
                    endY = endRect.bottom - channelRect.top + 5;
                }
                startY = Math.max(0, Math.min(startY, channelRect.height - (arrow.offsetHeight || 20)));
                endY = Math.max(0, Math.min(endY, channelRect.height - (arrow.offsetHeight || 20)));
                arrow.style.left = `${startX}px`;
                arrow.style.top = `${startY}px`;
                arrow.style.opacity = '1';
                if (tcpFlowSim_elements.transmissionChannelEl) tcpFlowSim_elements.transmissionChannelEl.appendChild(arrow);
                tcpFlowSim_state.inFlightPackets[seq] = { type: type, el: arrow };
                void arrow.offsetWidth;
                arrow.style.transform = `translate(${endX - startX}px, ${endY - startY}px)`;

                setTimeout(() => {
                    if (tcpFlowSim_elements.transmissionChannelEl?.contains(arrow)) {
                        tcpFlowSim_elements.transmissionChannelEl.removeChild(arrow);
                    }
                    delete tcpFlowSim_state.inFlightPackets[seq];
                    if (type === 'data') tcpFlowSim_handlePacketArrival(seq);
                    else if (type === 'ack') tcpFlowSim_handleAckArrival(seq);
                    else if (type === 'probe') tcpFlowSim_handleProbeArrival(seq);
                    tcpFlowSim_state.isSimulating = false;
                    tcpFlowSim_updateSenderUI();
                    tcpFlowSim_updateReceiverUI();
                }, TCP_FLOW_SIM_ANIMATION_DURATION);
            }

            function tcpFlowSim_handleSendPacket() {
                if (tcpFlowSim_state.isSimulating || tcpFlowSim_state.usableWindowSize <= 0 || tcpFlowSim_state.nextPacketToSend > TCP_FLOW_SIM_MAX_SEQ_NUM || tcpFlowSim_state.isZeroWindow) { tcpFlowSim_updateSenderUI(); return; }
                const seqToSend = tcpFlowSim_state.nextPacketToSend;
                tcpFlowSim_showMessage(`å‡†å¤‡å‘é€: SEQ=${seqToSend}ã€‚å› ä¸ºå¯ç”¨çª—å£ (${tcpFlowSim_state.usableWindowSize}) > 0 ä¸”æœªæ”¶åˆ°é›¶çª—å£é€šçŸ¥ã€‚`, 'info');
                if (tcpFlowSim_state.senderPackets[seqToSend]) {
                    tcpFlowSim_state.senderPackets[seqToSend].classList.add('tcpFlowSim_sent');
                    tcpFlowSim_state.senderPackets[seqToSend].classList.remove('tcpFlowSim_acked');
                    tcpFlowSim_state.senderPackets[seqToSend].style.opacity = '1';
                } else { console.error(`tcpFlowSim: Sender packet element for SEQ=${seqToSend} not found!`); return; }
                tcpFlowSim_state.sndNxt++;
                tcpFlowSim_state.nextPacketToSend++;
                tcpFlowSim_showMessage(`å‘é€ä¸­: SEQ=${seqToSend}ã€‚SND.NXT æ›´æ–°ä¸º ${tcpFlowSim_state.sndNxt}ã€‚å¯ç”¨çª—å£å‡å°‘ã€‚`, 'info');
                tcpFlowSim_updateSenderUI();
                tcpFlowSim_animatePacket(seqToSend, 'data');
            }

            function tcpFlowSim_handlePacketArrival(seq) {
                tcpFlowSim_showMessage(`åˆ°è¾¾: æ•°æ®åŒ… SEQ=${seq} å·²åˆ°è¾¾æ¥æ”¶æ–¹ã€‚å¼€å§‹æ£€æŸ¥...`, 'info');
                if (seq === tcpFlowSim_state.rcvNxt) {
                    if (tcpFlowSim_state.currentRwnd > 0) {
                        tcpFlowSim_showMessage(`å¤„ç†: SEQ=${seq} æ˜¯æœŸæœ›åºå· (${tcpFlowSim_state.rcvNxt}) ä¸”æ¥æ”¶çª—å£ (${tcpFlowSim_state.currentRwnd}) > 0ã€‚æ”¾å…¥ç¼“å†²åŒºã€‚`, 'success');
                        tcpFlowSim_state.receiverBuffer.push({ seq: seq });
                        tcpFlowSim_state.receiverBuffer.sort((a, b) => a.seq - b.seq);
                        tcpFlowSim_state.rcvNxt++;
                        tcpFlowSim_updateReceiverUI();
                        tcpFlowSim_showMessage(`å‡†å¤‡ACK: æ¥æ”¶æ–¹ç¼“å­˜äº† SEQ=${seq}ï¼ŒæœŸæœ›ä¸‹ä¸€ä¸ªæ˜¯ ${tcpFlowSim_state.rcvNxt}ã€‚å°†å‘é€ ACK=${tcpFlowSim_state.rcvNxt} å¹¶é€šå‘Šå½“å‰ <code>rwnd</code>=${tcpFlowSim_state.currentRwnd}ã€‚`, 'info');
                        tcpFlowSim_sendAck();
                    } else {
                        tcpFlowSim_showMessage(`ä¸¢å¼ƒ: SEQ=${seq} æ˜¯æœŸæœ›åºå·ï¼Œä½†æ¥æ”¶ç¼“å†²åŒºå·²æ»¡ (<code>rwnd</code>=0)ã€‚æ•°æ®åŒ…è¢«ä¸¢å¼ƒã€‚`, 'warning');
                        tcpFlowSim_showMessage(`å‡†å¤‡ACK: å³ä½¿ä¸¢å¼ƒäº† SEQ=${seq}ï¼Œä»éœ€å‘é€ ACK=${tcpFlowSim_state.rcvNxt} (å½“å‰æœŸæœ›å€¼)ï¼Œå¹¶æ˜ç¡®é€šå‘Š <code>rwnd</code>=0ã€‚`, 'info');
                        tcpFlowSim_sendAck();
                    }
                } else if (seq < tcpFlowSim_state.rcvNxt) {
                    tcpFlowSim_showMessage(`é‡å¤: æ”¶åˆ° SEQ=${seq}ï¼Œä½†å·²æœŸæœ› ${tcpFlowSim_state.rcvNxt}ã€‚æ­¤ä¸ºé‡å¤åŒ…ï¼Œä¸¢å¼ƒã€‚`, 'warning');
                    tcpFlowSim_showMessage(`å‡†å¤‡ACK: ä¸ºå¸®åŠ©å‘é€æ–¹å¯èƒ½å­˜åœ¨çš„ä¸¢åŒ…æ£€æµ‹ï¼Œé‡æ–°å‘é€ ACK=${tcpFlowSim_state.rcvNxt} (å½“å‰æœŸæœ›å€¼) åŠå½“å‰ <code>rwnd</code>=${tcpFlowSim_state.currentRwnd}ã€‚`, 'info');
                    tcpFlowSim_sendAck();
                } else { // seq > rcvNxt (ä¹±åº)
                    // Simplified: In a real scenario, might buffer out-of-order packets if space allows.
                    // For this simulation, we just discard and send duplicate ACK.
                    tcpFlowSim_showMessage(`ä¹±åº: æ”¶åˆ° SEQ=${seq}ï¼Œä½†æœŸæœ› ${tcpFlowSim_state.rcvNxt}ã€‚æ­¤ä¸ºä¹±åºåŒ… (æœ¬æ¨¡æ‹Ÿç®€åŒ–å¤„ç†ï¼Œä¸¢å¼ƒ)ã€‚`, 'warning');
                    tcpFlowSim_showMessage(`å‡†å¤‡ACK: å‘é€é‡å¤ ACK=${tcpFlowSim_state.rcvNxt} (å½“å‰æœŸæœ›å€¼) åŠå½“å‰ <code>rwnd</code>=${tcpFlowSim_state.currentRwnd}ã€‚`, 'info');
                    tcpFlowSim_sendAck();
                }
            }

            function tcpFlowSim_sendAck() {
                const ackNum = tcpFlowSim_state.rcvNxt;
                const advertisedWindow = tcpFlowSim_state.currentRwnd;
                tcpFlowSim_showMessage(`å‘é€ACK: ACK=${ackNum}, <code>rwnd</code>=${advertisedWindow}ã€‚é€šçŸ¥å‘é€æ–¹å·²æ”¶åˆ° ${ackNum - 1} åŠä¹‹å‰çš„åŒ…ï¼Œå¹¶å‘ŠçŸ¥å‰©ä½™ç©ºé—´ã€‚`, 'info');
                tcpFlowSim_animatePacket(ackNum, 'ack');
            }

            function tcpFlowSim_handleAckArrival(ackNum) {
                // In this simplified simulation, we use the *current* receiver rwnd
                // A real ACK carries the rwnd value *at the time the ACK was sent*.
                const receivedRwnd = tcpFlowSim_state.currentRwnd;

                tcpFlowSim_showMessage(`æ”¶åˆ°ACK: ACK=${ackNum}, (å‡è®¾æŠ¥æ–‡ä¸­æºå¸¦ <code>rwnd</code>=${receivedRwnd})ã€‚å¤„ç†ç¡®è®¤ä¿¡æ¯å’Œçª—å£æ›´æ–°...`, 'info');

                if (ackNum > tcpFlowSim_state.sndUna) {
                    const newlyAckedCount = ackNum - tcpFlowSim_state.sndUna;
                    tcpFlowSim_showMessage(`æœ‰æ•ˆACK: ACK=${ackNum} > SND.UNA=${tcpFlowSim_state.sndUna}ã€‚ç¡®è®¤äº† ${newlyAckedCount} ä¸ªæ–°æ•°æ®åŒ…ã€‚å‘é€çª—å£å‘å‰æ»‘åŠ¨ã€‚`, 'success');
                    tcpFlowSim_state.sndUna = ackNum;
                    if (tcpFlowSim_state.isZeroWindow && receivedRwnd > 0) {
                        tcpFlowSim_state.isZeroWindow = false;
                        if (tcpFlowSim_state.zeroWindowProbeTimer) { clearTimeout(tcpFlowSim_state.zeroWindowProbeTimer); tcpFlowSim_state.zeroWindowProbeTimer = null; }
                        tcpFlowSim_showMessage(`çª—å£é‡å¼€: æ”¶åˆ°çš„ ACK ä¸­ <code>rwnd</code>=${receivedRwnd} > 0ã€‚è§£é™¤é›¶çª—å£çŠ¶æ€ï¼Œåœæ­¢æ¢æµ‹ï¼Œå¯ä»¥æ¢å¤å‘é€ã€‚`, 'success');
                    }
                } else {
                    tcpFlowSim_showMessage(`é‡å¤ACK: ACK=${ackNum} <= SND.UNA=${tcpFlowSim_state.sndUna}ã€‚æœªç¡®è®¤æ–°æ•°æ®ã€‚`, 'info');
                }

                if (tcpFlowSim_state.advertisedRwnd !== receivedRwnd) {
                    tcpFlowSim_showMessage(`çª—å£æ›´æ–°: æ”¶åˆ°çš„ ACK ä¸­ <code>rwnd</code>=${receivedRwnd} ä¸å‘é€æ–¹è®°å½• (${tcpFlowSim_state.advertisedRwnd}) ä¸åŒã€‚æ›´æ–°å‘é€æ–¹è®°å½•çš„æ¥æ”¶çª—å£ã€‚`, 'info');
                    tcpFlowSim_state.advertisedRwnd = receivedRwnd;
                    if (tcpFlowSim_state.advertisedRwnd === 0) {
                        tcpFlowSim_state.isZeroWindow = true;
                    } else {
                        if (tcpFlowSim_state.isZeroWindow) { // Window opened
                            tcpFlowSim_state.isZeroWindow = false;
                            if (tcpFlowSim_state.zeroWindowProbeTimer) { clearTimeout(tcpFlowSim_state.zeroWindowProbeTimer); tcpFlowSim_state.zeroWindowProbeTimer = null; }
                            tcpFlowSim_showMessage(`çª—å£é‡å¼€: (å¯èƒ½åœ¨é‡å¤ ACK ä¸­) <code>rwnd</code>=${receivedRwnd} > 0ï¼Œè§£é™¤é›¶çª—å£ã€‚`, 'success');
                        }
                    }
                } else if (tcpFlowSim_state.isZeroWindow && receivedRwnd === 0) {
                    tcpFlowSim_showMessage(`ç»´æŒé›¶çª—å£: æ”¶åˆ°çš„ ACK ç¡®è®¤ <code>rwnd</code> ä»ä¸º 0ã€‚ç»§ç»­ç­‰å¾…æ¢æµ‹æˆ–çª—å£æ›´æ–°ã€‚`, 'warning');
                    if (!tcpFlowSim_state.zeroWindowProbeTimer) {
                        tcpFlowSim_state.zeroWindowProbeTimer = setTimeout(tcpFlowSim_sendZeroWindowProbe, TCP_FLOW_SIM_PROBE_INTERVAL);
                    }
                }

                tcpFlowSim_updateSenderUI();
            }

            function tcpFlowSim_handleProcessPacket() {
                if (tcpFlowSim_state.isSimulating || tcpFlowSim_state.receiverBuffer.length === 0) return;
                tcpFlowSim_showMessage(`åº”ç”¨å¤„ç†: æ¨¡æ‹Ÿä¸Šå±‚åº”ç”¨ä»æ¥æ”¶ç¼“å†²åŒºè¯»å–æ•°æ®...`, 'info');
                const processedPacket = tcpFlowSim_state.receiverBuffer.shift();
                tcpFlowSim_showMessage(`å¤„ç†å®Œæˆ: åº”ç”¨è¯»å–äº† SEQ=${processedPacket.seq}ã€‚æ¥æ”¶ç¼“å†²åŒºç©ºé—´å¢åŠ ã€‚`, 'success');
                tcpFlowSim_updateReceiverUI();
                tcpFlowSim_showMessage(`å‡†å¤‡ACK: å› ç¼“å†²åŒºç©ºé—´å¢åŠ ï¼Œå‘é€æ–°çš„ ACK=${tcpFlowSim_state.rcvNxt}ï¼Œé€šå‘Šå¢å¤§äº†çš„ <code>rwnd</code>=${tcpFlowSim_state.currentRwnd}ï¼Œä»¥ä¾¿å‘é€æ–¹å¯ä»¥å‘é€æ›´å¤šæ•°æ®ã€‚`, 'info');
                tcpFlowSim_sendAck();
            }

            function tcpFlowSim_sendZeroWindowProbe() {
                if (!tcpFlowSim_state.isZeroWindow || tcpFlowSim_state.isSimulating) {
                    if (tcpFlowSim_state.isZeroWindow && !tcpFlowSim_state.zeroWindowProbeTimer) { tcpFlowSim_state.zeroWindowProbeTimer = setTimeout(tcpFlowSim_sendZeroWindowProbe, TCP_FLOW_SIM_PROBE_INTERVAL); }
                    return;
                }
                const probeSeq = tcpFlowSim_state.sndUna; // Probe based on the oldest unacknowledged seq
                if (probeSeq < tcpFlowSim_state.sndNxt && tcpFlowSim_state.senderPackets[probeSeq]) {
                    tcpFlowSim_showMessage(`é›¶çª—å£æ¢æµ‹: å‘é€æ–¹ç­‰å¾…è¶…æ—¶ (${TCP_FLOW_SIM_PROBE_INTERVAL / 1000}s)ï¼Œå‘é€æ¢æµ‹åŒ… (åŸºäº SEQ=${probeSeq}) ä»¥æŸ¥è¯¢æ¥æ”¶æ–¹çª—å£æ˜¯å¦æ›´æ–°ã€‚`, 'warning');
                    tcpFlowSim_animatePacket(probeSeq, 'probe');
                } else {
                    tcpFlowSim_showMessage(`æ¢æµ‹å¤±è´¥: æ— æ³•åŸºäº SEQ=${probeSeq} å‘é€æ¢æµ‹ (å¯èƒ½å·²ç¡®è®¤æˆ–æ— æ­¤åŒ…)ã€‚ç¨åé‡è¯•...`, 'error');
                    if (tcpFlowSim_state.zeroWindowProbeTimer) clearTimeout(tcpFlowSim_state.zeroWindowProbeTimer);
                    tcpFlowSim_state.zeroWindowProbeTimer = setTimeout(tcpFlowSim_sendZeroWindowProbe, TCP_FLOW_SIM_PROBE_INTERVAL);
                }
            }

            function tcpFlowSim_handleProbeArrival(seq) {
                tcpFlowSim_showMessage(`æ¢æµ‹åˆ°è¾¾: æ¥æ”¶æ–¹æ”¶åˆ°æ¥è‡ªå‘é€æ–¹çš„é›¶çª—å£æ¢æµ‹åŒ… (åŸºäº SEQ=${seq})ã€‚`, 'info');
                tcpFlowSim_showMessage(`æ¢æµ‹å“åº”: æ¥æ”¶æ–¹å›å¤ ACK=${tcpFlowSim_state.rcvNxt} å¹¶æºå¸¦å½“å‰ <code>rwnd</code>=${tcpFlowSim_state.currentRwnd}ã€‚`, 'info');
                tcpFlowSim_sendAck();
            }

            let tcpFlowSim_messageTimeout;
            function tcpFlowSim_showMessage(msg, type = 'info') {
                clearTimeout(tcpFlowSim_messageTimeout);
                const newMessageDiv = document.createElement('div');
                newMessageDiv.innerHTML = msg; // Use innerHTML for <code> tag rendering

                const messageArea = document.getElementById('tcpFlowSim_message-area');
                const messageContentEl = tcpFlowSim_elements.messageContentEl;
                if (!messageArea || !messageContentEl) return;

                messageArea.classList.remove('bg-blue-50', 'border-blue-300', 'bg-green-50', 'border-green-300', 'bg-yellow-50', 'border-yellow-300', 'bg-red-50', 'border-red-300');
                messageContentEl.classList.remove('text-blue-700', 'text-green-700', 'text-amber-700', 'text-red-700');

                switch (type) {
                    case 'success': messageArea.classList.add('bg-green-50', 'border-green-300'); messageContentEl.classList.add('text-green-700'); break;
                    case 'warning': messageArea.classList.add('bg-yellow-50', 'border-yellow-300'); messageContentEl.classList.add('text-amber-700'); break;
                    case 'error': messageArea.classList.add('bg-red-50', 'border-red-300'); messageContentEl.classList.add('text-red-700'); break;
                    default: messageArea.classList.add('bg-blue-50', 'border-blue-300'); messageContentEl.classList.add('text-blue-700'); break;
                }

                messageContentEl.style.top = '-150%'; // Move old message out up
                setTimeout(() => {
                    messageContentEl.innerHTML = ''; // Clear old content
                    messageContentEl.appendChild(newMessageDiv); // Add new content
                    messageContentEl.style.top = '150%'; // Position new message below
                    void messageContentEl.offsetWidth; // Force reflow
                    messageContentEl.style.transition = 'top 0.5s ease-in-out'; // Apply transition
                    messageContentEl.style.top = '50%'; // Animate new message in
                    messageContentEl.style.transform = 'translateY(-50%)';
                }, 250); // Wait for old message to move out
            }

            if (tcpFlowSim_elements.sendPacketBtn) tcpFlowSim_elements.sendPacketBtn.addEventListener('click', tcpFlowSim_handleSendPacket);
            if (tcpFlowSim_elements.processPacketBtn) tcpFlowSim_elements.processPacketBtn.addEventListener('click', tcpFlowSim_handleProcessPacket);
            if (tcpFlowSim_elements.resetBtn) tcpFlowSim_elements.resetBtn.addEventListener('click', tcpFlowSim_initSimulation);
            window.addEventListener('resize', () => {
                if (!tcpFlowSim_state.isSimulating) {
                    tcpFlowSim_updateSenderPacketStates();
                    tcpFlowSim_updateReceiverPacketStates();
                    tcpFlowSim_updateSendWindowIndicator();
                    tcpFlowSim_updateRecvWindowIndicator();
                }
            });
            tcpFlowSim_initSimulation(); // Initial setup


            // --- TCP Congestion Control Simulation (tcpCongestionSim_) ---
            const tcpCongestionSim_elements = {
                statusIndicator: document.getElementById('tcpCongestionSim_status-indicator'),
                cwndValue: document.getElementById('tcpCongestionSim_cwnd-value'),
                ssthreshValue: document.getElementById('tcpCongestionSim_ssthresh-value'),
                rttCounter: document.getElementById('tcpCongestionSim_rtt-counter'),
                dupAckDisplay: document.getElementById('tcpCongestionSim_dup-ack-display'),
                packetArea: document.getElementById('tcpCongestionSim_packet-area'),
                explanationArea: document.getElementById('tcpCongestionSim_explanation-area'),
                startButton: document.getElementById('tcpCongestionSim_start-button'),
                lossButton: document.getElementById('tcpCongestionSim_loss-button'),
                dupAckButton: document.getElementById('tcpCongestionSim_dup-ack-button'),
                resetButton: document.getElementById('tcpCongestionSim_reset-button'),
                chartCanvas: document.getElementById('tcpCongestionSim_congestionChart')
            };

            let tcpCongestionSim_state = {
                cwnd: 1,
                ssthresh: 64,
                phase: 'slow-start', // slow-start, congestion-avoidance, fast-recovery, timeout
                rtt: 0,
                dupAcks: 0,
                chart: null,
                chartData: {
                    labels: [],
                    datasets: [
                        { label: 'cwnd (MSS)', data: [], borderColor: 'rgb(59, 130, 246)', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.1, fill: true, pointRadius: 3, pointHoverRadius: 6 },
                        { label: 'ssthresh (MSS)', data: [], borderColor: 'rgb(16, 185, 129)', backgroundColor: 'rgba(16, 185, 129, 0.1)', borderDash: [5, 5], tension: 0.1, fill: false, pointRadius: 3, pointHoverRadius: 6 }
                    ]
                },
                simulationRunning: false
            };
            const TCP_CONGESTION_SIM_MAX_CHART_POINTS = 50;

            // (Include all helper functions from ä¼ è¾“å±‚.html for the tcpVis_, prefixed with tcpCongestionSim_)
            // e.g., tcpCongestionSim_updateUI, tcpCongestionSim_visualizePackets, tcpCongestionSim_initializeChart, etc.
            // ... (implementation of helper functions adapted with tcpCongestionSim_ prefix) ...
            function tcpCongestionSim_updateUI(explanation = "", highlightState = false) {
                if (!tcpCongestionSim_elements.statusIndicator) return; // Basic check

                const prevStateHtml = tcpCongestionSim_elements.statusIndicator.innerHTML;
                const stateInfo = tcpCongestionSim_getStateInfo(tcpCongestionSim_state.phase);

                tcpCongestionSim_elements.statusIndicator.innerHTML = stateInfo.html;
                tcpCongestionSim_elements.statusIndicator.className = `tcpCongestionSim_status-indicator ${stateInfo.className}`;

                if (highlightState && prevStateHtml !== stateInfo.html) {
                    tcpCongestionSim_elements.statusIndicator.classList.add('tcpCongestionSim_highlight-state-change');
                    setTimeout(() => tcpCongestionSim_elements.statusIndicator.classList.remove('tcpCongestionSim_highlight-state-change'), 1000);
                }

                tcpCongestionSim_elements.cwndValue.textContent = `${tcpCongestionSim_state.cwnd} MSS`;
                tcpCongestionSim_elements.ssthreshValue.textContent = `${tcpCongestionSim_state.ssthresh} MSS`;
                tcpCongestionSim_elements.rttCounter.textContent = tcpCongestionSim_state.rtt;
                tcpCongestionSim_elements.dupAckDisplay.textContent = tcpCongestionSim_state.dupAcks;

                if (explanation && tcpCongestionSim_elements.explanationArea) {
                    tcpCongestionSim_elements.explanationArea.innerHTML = explanation.replace(/\n/g, '<br>');
                }

                tcpCongestionSim_updateChartData();

                if (tcpCongestionSim_elements.startButton) tcpCongestionSim_elements.startButton.disabled = false;
                if (tcpCongestionSim_elements.lossButton) tcpCongestionSim_elements.lossButton.disabled = !tcpCongestionSim_state.simulationRunning;
                if (tcpCongestionSim_elements.dupAckButton) tcpCongestionSim_elements.dupAckButton.disabled = !tcpCongestionSim_state.simulationRunning || tcpCongestionSim_state.phase === 'fast-recovery' || tcpCongestionSim_state.dupAcks >= 3;
                if (tcpCongestionSim_elements.resetButton) tcpCongestionSim_elements.resetButton.disabled = false;
                tcpCongestionSim_visualizePackets();
            }

            function tcpCongestionSim_visualizePackets(action = 'ack') {
                if (!tcpCongestionSim_elements.packetArea) return;
                tcpCongestionSim_elements.packetArea.innerHTML = '';
                const numPackets = Math.min(Math.max(1, Math.floor(tcpCongestionSim_state.cwnd)), 30);
                for (let i = 0; i < numPackets; i++) {
                    const packet = document.createElement('div');
                    packet.classList.add('tcpCongestionSim_packet');
                    tcpCongestionSim_elements.packetArea.appendChild(packet);
                    setTimeout(() => {
                        packet.classList.add('tcpCongestionSim_sent');
                        setTimeout(() => {
                            packet.classList.remove('tcpCongestionSim_sent');
                            if (action === 'ack') { packet.classList.add('tcpCongestionSim_ack'); }
                            else if (action === 'lost') { packet.classList.add('tcpCongestionSim_lost'); }
                            else if (action === 'dup-ack') { packet.classList.add('tcpCongestionSim_duplicate-ack'); }
                        }, 400 + i * 10);
                    }, i * 15);
                }
            }

            function tcpCongestionSim_getStateInfo(s) {
                let text = '', iconClass = '', cssClass = '';
                switch (s) {
                    case 'slow-start': text = 'æ…¢å¯åŠ¨'; iconClass = 'fas fa-rocket text-blue-500'; cssClass = 'tcpCongestionSim_status-slow-start'; break;
                    case 'congestion-avoidance': text = 'æ‹¥å¡é¿å…'; iconClass = 'fas fa-walking text-green-600'; cssClass = 'tcpCongestionSim_status-congestion-avoidance'; break;
                    case 'timeout': text = 'è¶…æ—¶æ¢å¤'; iconClass = 'fas fa-exclamation-triangle text-red-600'; cssClass = 'tcpCongestionSim_status-timeout'; break;
                    case 'fast-recovery': text = 'å¿«é€Ÿæ¢å¤'; iconClass = 'fas fa-shipping-fast text-yellow-600'; cssClass = 'tcpCongestionSim_status-fast-recovery'; break;
                    default: text = 'æœªçŸ¥'; iconClass = 'fas fa-question-circle text-gray-500'; cssClass = '';
                }
                return { html: `<i class="${iconClass}"></i><span>${text}</span>`, className: cssClass };
            }

            function tcpCongestionSim_updateChartData() {
                if (!tcpCongestionSim_state.chart) return;
                const { labels, datasets } = tcpCongestionSim_state.chartData;
                labels.push(tcpCongestionSim_state.rtt);
                datasets[0].data.push(tcpCongestionSim_state.cwnd);
                datasets[1].data.push(tcpCongestionSim_state.ssthresh);
                if (labels.length > TCP_CONGESTION_SIM_MAX_CHART_POINTS) {
                    labels.shift();
                    datasets[0].data.shift();
                    datasets[1].data.shift();
                }
                tcpCongestionSim_state.chart.update();
            }

            function tcpCongestionSim_initializeChart() {
                if (!tcpCongestionSim_elements.chartCanvas) return;
                const ctx = tcpCongestionSim_elements.chartCanvas.getContext('2d');
                if (tcpCongestionSim_state.chart) { tcpCongestionSim_state.chart.destroy(); }
                tcpCongestionSim_state.chart = new Chart(ctx, {
                    type: 'line',
                    data: tcpCongestionSim_state.chartData,
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: { x: { title: { display: true, text: 'è½®æ¬¡ (RTT)' } }, y: { title: { display: true, text: 'çª—å£å¤§å° (MSS)' }, beginAtZero: true } },
                        plugins: { legend: { position: 'top' }, title: { display: true, text: 'cwnd ä¸ ssthresh å˜åŒ–æ›²çº¿' } }
                    }
                });
            }

            function tcpCongestionSim_resetSimulation() {
                tcpCongestionSim_state.cwnd = 1;
                tcpCongestionSim_state.ssthresh = 64;
                tcpCongestionSim_state.phase = 'slow-start';
                tcpCongestionSim_state.rtt = 0;
                tcpCongestionSim_state.dupAcks = 0;
                tcpCongestionSim_state.simulationRunning = false;
                tcpCongestionSim_state.chartData.labels = [];
                tcpCongestionSim_state.chartData.datasets[0].data = [];
                tcpCongestionSim_state.chartData.datasets[1].data = [];
                const initialExplanation = `... (Initial Explanation Text) ...`; // Add initial text here
                tcpCongestionSim_updateUI(initialExplanation, true);
                tcpCongestionSim_initializeChart();
                if (tcpCongestionSim_elements.packetArea) tcpCongestionSim_elements.packetArea.innerHTML = '';
                if (tcpCongestionSim_elements.startButton) tcpCongestionSim_elements.startButton.textContent = 'å¼€å§‹/ä¸‹ä¸€æ­¥ (ACK)';
                if (tcpCongestionSim_elements.lossButton) tcpCongestionSim_elements.lossButton.disabled = true;
                if (tcpCongestionSim_elements.dupAckButton) tcpCongestionSim_elements.dupAckButton.disabled = true;
            }

            function tcpCongestionSim_handleAck() {
                let explanation = "", highlight = false;
                if (!tcpCongestionSim_state.simulationRunning) {
                    tcpCongestionSim_state.simulationRunning = true;
                    if (tcpCongestionSim_elements.startButton) tcpCongestionSim_elements.startButton.textContent = 'ä¸‹ä¸€æ­¥ (ACK)';
                    explanation = `... (Simulation Start Explanation) ...`;
                    tcpCongestionSim_updateUI(explanation, true);
                    return;
                }
                tcpCongestionSim_state.rtt++;
                tcpCongestionSim_state.dupAcks = 0;
                const oldCwnd = tcpCongestionSim_state.cwnd;
                if (tcpCongestionSim_state.phase === 'slow-start') {
                    tcpCongestionSim_state.cwnd *= 2;
                    explanation = `RTT ${tcpCongestionSim_state.rtt}: æ”¶åˆ° ACKã€‚ä»å¤„ <strong>æ…¢å¯åŠ¨</strong>ã€‚cwnd: ${oldCwnd} -> ${tcpCongestionSim_state.cwnd} (æŒ‡æ•°å¢)ã€‚`;
                    if (tcpCongestionSim_state.cwnd >= tcpCongestionSim_state.ssthresh) {
                        tcpCongestionSim_state.phase = 'congestion-avoidance';
                        explanation += ` cwnd â‰¥ ssthresh (${tcpCongestionSim_state.ssthresh})ï¼Œåˆ‡æ¢åˆ° <strong>æ‹¥å¡é¿å…</strong>ã€‚`;
                        highlight = true;
                    }
                } else if (tcpCongestionSim_state.phase === 'congestion-avoidance') {
                    tcpCongestionSim_state.cwnd++;
                    explanation = `RTT ${tcpCongestionSim_state.rtt}: æ”¶åˆ° ACKã€‚å¤„ <strong>æ‹¥å¡é¿å…</strong>ã€‚cwnd: ${oldCwnd} -> ${tcpCongestionSim_state.cwnd} (çº¿æ€§å¢)ã€‚`;
                } else if (tcpCongestionSim_state.phase === 'fast-recovery') {
                    tcpCongestionSim_state.cwnd = tcpCongestionSim_state.ssthresh;
                    tcpCongestionSim_state.phase = 'congestion-avoidance';
                    explanation = `RTT ${tcpCongestionSim_state.rtt}: æ”¶åˆ°æ–° ACKï¼Œé€€å‡ºå¿«é€Ÿæ¢å¤ã€‚cwnd=${tcpCongestionSim_state.ssthresh}ï¼Œè¿›å…¥<strong>æ‹¥å¡é¿å…</strong>ã€‚`;
                    highlight = true;
                }
                tcpCongestionSim_updateUI(explanation, highlight);
                tcpCongestionSim_visualizePackets('ack');
            }

            function tcpCongestionSim_handleTimeout() {
                if (!tcpCongestionSim_state.simulationRunning) return;
                tcpCongestionSim_state.rtt++;
                const oldCwnd = tcpCongestionSim_state.cwnd;
                tcpCongestionSim_state.phase = 'timeout';
                tcpCongestionSim_state.ssthresh = Math.max(Math.floor(oldCwnd / 2), 1);
                tcpCongestionSim_state.cwnd = 1;
                tcpCongestionSim_state.dupAcks = 0;
                const explanation = `... (Timeout Explanation) ...`;
                tcpCongestionSim_updateUI(explanation, true);
                setTimeout(() => {
                    if (tcpCongestionSim_state.phase === 'timeout') {
                        tcpCongestionSim_state.phase = 'slow-start';
                        tcpCongestionSim_updateUI(explanation + `<br>å·²é€€å› <strong>æ…¢å¯åŠ¨</strong>ã€‚`, false);
                    }
                }, 1500);
                tcpCongestionSim_visualizePackets('lost');
            }

            function tcpCongestionSim_handleDuplicateAck() {
                if (!tcpCongestionSim_state.simulationRunning || tcpCongestionSim_state.phase === 'fast-recovery') return;
                tcpCongestionSim_state.dupAcks++;
                let explanation = `RTT ${tcpCongestionSim_state.rtt}: æ”¶åˆ°ç¬¬ ${tcpCongestionSim_state.dupAcks} ä¸ªé‡å¤ ACKã€‚`;
                let highlight = false;
                if (tcpCongestionSim_state.dupAcks === 3) {
                    const oldCwnd = tcpCongestionSim_state.cwnd;
                    // Simplified Reno: Set ssthresh, set cwnd to ssthresh, enter Congestion Avoidance
                    tcpCongestionSim_state.ssthresh = Math.max(Math.floor(oldCwnd / 2), 1);
                    tcpCongestionSim_state.cwnd = tcpCongestionSim_state.ssthresh; // Go directly to Congestion Avoidance
                    tcpCongestionSim_state.phase = 'congestion-avoidance'; // Directly enter CA
                    highlight = true;
                    explanation = `... (Fast Retransmit/Recovery Explanation - Reno Simplified) ...`;
                    tcpCongestionSim_state.dupAcks = 0; // Reset after handling
                } else {
                    explanation += ` cwnd=${tcpCongestionSim_state.cwnd}ã€‚ç­‰å¾…ç¬¬ 3 ä¸ªé‡å¤ ACKã€‚`;
                }
                tcpCongestionSim_updateUI(explanation, highlight);
                tcpCongestionSim_visualizePackets('dup-ack');
            }

            if (tcpCongestionSim_elements.startButton) tcpCongestionSim_elements.startButton.addEventListener('click', tcpCongestionSim_handleAck);
            if (tcpCongestionSim_elements.lossButton) tcpCongestionSim_elements.lossButton.addEventListener('click', tcpCongestionSim_handleTimeout);
            if (tcpCongestionSim_elements.dupAckButton) tcpCongestionSim_elements.dupAckButton.addEventListener('click', tcpCongestionSim_handleDuplicateAck);
            if (tcpCongestionSim_elements.resetButton) tcpCongestionSim_elements.resetButton.addEventListener('click', tcpCongestionSim_resetSimulation);
            tcpCongestionSim_resetSimulation(); // Initial setup


            // --- Final Initialization ---
            // (Call any other init functions if needed)

        }); // End of DOMContentLoaded listener

    </script>
</body>

</html>