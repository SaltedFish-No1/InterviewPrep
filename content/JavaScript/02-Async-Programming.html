<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript å¼‚æ­¥ç¼–ç¨‹ä¸äº‹ä»¶å¾ªç¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../../global.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />

    <style>
        /* --- Page-Specific Styles (Minimal, rely on global.css) --- */
        html { scroll-padding-top: 2rem; }

        /* Styles for the initial checklist (can be removed if replaced by full content) */
        .knowledge-list { list-style: none; padding-left: 0; }
        .knowledge-list li { display: flex; align-items: flex-start; margin-bottom: 1rem; padding: 1rem; background-color: var(--bg-color-white); border-radius: 0.5rem; box-shadow: var(--card-shadow-default); border: 1px solid var(--border-color-light); transition: box-shadow 0.2s ease; }
        .knowledge-list li:hover { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .knowledge-list input[type="checkbox"] { margin-top: 0.25rem; margin-right: 0.75rem; flex-shrink: 0; width: 1rem; height: 1rem; accent-color: var(--primary-color); cursor: pointer; }
        .knowledge-list .item-content { flex-grow: 1; display: flex; flex-direction: column; }
        .knowledge-list .item-content a { color: var(--text-color-dark); font-weight: 500; text-decoration: none; margin-bottom: 0.5rem; transition: color 0.2s ease; }
        .knowledge-list .item-content a:hover { color: var(--primary-color-dark); text-decoration: underline; }
        .knowledge-list .item-content a code { font-family: var(--font-family-mono); font-size: 0.85em; background-color: var(--primary-color-light); color: var(--primary-color-dark); padding: 0.1rem 0.3rem; border-radius: 0.25rem; }
        .knowledge-list .item-tags { display: flex; gap: 0.5rem; margin-top: auto; }
        .knowledge-list .item-tag { display: inline-block; padding: 0.15rem 0.6rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; line-height: 1.2; }
        .tag-freq-high { background-color: #fee2e2; color: #b91c1c; }
        .tag-freq-medium { background-color: #fff7ed; color: #c2410c; }
        .tag-diff-basic { background-color: #eff6ff; color: #1e40af; }

         /* --- Styles copied/adapted from the V4 example --- */
         /* Ensure consistency with global.css variables */
         :root {
             --stack-color: #fda4af; /* red-300 */
             --stack-bg: #fff1f2;    /* red-50 */
             --stack-text: #9f1239;   /* red-900 */
             --api-color: #86efac;   /* green-300 */
             --api-bg: #f0fdf4;     /* green-50 */
             --api-text: #15803d;    /* green-700 */
             --micro-color: #fcd34d; /* yellow-300 */
             --micro-bg: #fefce8;    /* yellow-50 */
             --micro-text: #a16207;   /* yellow-700 */
             --macro-color: #a5b4fc; /* indigo-300 */
             --macro-bg: #eef2ff;    /* indigo-50 */
             --macro-text: #4338ca;   /* indigo-700 */
             --output-bg: var(--bg-color-lighter); /* Use global variable */
             --output-text: var(--text-color-default); /* Use global variable */
         }
        /* Sidebar active link style */
        .local-side-nav li a.current { background-color: var(--primary-color-light); color: var(--primary-color-dark); font-weight: 500; border-left-color: var(--primary-color); }

        /* Content section titles (using global.css head classes) */
        .content-section h2 { border-bottom: 1px solid var(--border-color-light); padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        .content-section h3 { margin-top: 1.5rem; margin-bottom: 1rem; } /* Adjust margins */
        .content-section h4 { margin-top: 1rem; margin-bottom: 0.75rem; font-size: 1.1rem; } /* Adjust margins/size */

        /* Card styles (rely on global.css .content-card) */
        .info-card { /* Specific background/border if needed, else use .content-card */
            background-color: var(--bg-color-white); /* Default card background */
            border: 1px solid var(--border-color-light);
            padding: var(--card-padding-nested); /* Use nested padding */
            margin-top: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem; /* Ensure rounding */
            box-shadow: var(--card-shadow-nested-level1); /* Use nested shadow */
        }
        .info-card.accent-blue { background-color: var(--primary-color-light); border-color: var(--primary-color); }
        .info-card.accent-yellow { background-color: var(--warning-color-light); border-color: var(--warning-color); }
        .info-card.accent-indigo { background-color: var(--macro-bg); border-color: var(--macro-color); }

        /* Code block style (rely on global.css pre/code) */
        /* Use a specific class if overrides needed, e.g., .example-code */
        .my-code-block { /* Class from example, ensure it matches global pre styles */
            background-color: var(--text-color-dark); /* Dark background */
            color: var(--bg-color-lighter); /* Light text */
            padding: 1rem;
            border-radius: 0.375rem;
            overflow-x: auto;
            font-family: var(--font-family-mono);
            font-size: 0.875rem;
            line-height: 1.4;
            margin: 1rem 0;
        }
        .my-code-block code { /* Reset inline styles within */
            background: none; color: inherit; padding: 0; border-radius: 0; font-size: inherit; font-family: inherit;
        }

        /* Explanation Box */
        .explanation-box { background-color: var(--bg-color-lighter); border: 1px solid var(--border-color-light); padding: 1rem; border-radius: 0.375rem; margin-top: 1rem; font-size: 0.9rem; color: var(--text-color-light); }
        .explanation-box strong { color: var(--text-color-default); }
        .explanation-box ol, .explanation-box ul { padding-left: 1.25rem; margin-top: 0.5rem; }

        /* Quiz Card (rely on global.css .quiz-card, but add V4 specifics if needed) */
        /* Assuming global.css covers most quiz styles */
        .quiz-card { margin-top: 1.5rem; margin-bottom: 1.5rem; }
        .quiz-options button { /* Style as buttons if needed */ }
        .quiz-feedback { /* Styles from global.css */ }
        .feedback-correct { /* Styles from global.css */ }
        .feedback-incorrect { /* Styles from global.css */ }
        .button-correct { background-color: var(--success-color-light) !important; border-color: var(--success-color) !important; color: var(--success-color) !important; font-weight: 600 !important; }
        .button-incorrect { background-color: var(--danger-color-light) !important; border-color: var(--danger-color) !important; color: var(--danger-color) !important; }
        .button-dimmed { opacity: 0.6; }

        /* Diagram Styles */
        .diagram-container { text-align: center; padding: 1.5rem; margin-top: 1rem; background-color: var(--bg-color-white); border-radius: 0.5rem; border: 1px solid var(--border-color-light); box-shadow: var(--card-shadow-default); }
        .diagram-title { font-weight: 600; color: var(--primary-color-dark); margin-bottom: 1.5rem; font-size: 1.1rem; }
        .mermaid svg { max-width: 100%; height: auto; display: block; margin: 0 auto; }

        /* Simulator Styles */
        .simulator-container { background-color: #f5f3ff; /* violet-50 */ border: 1px solid #c4b5fd; /* violet-300 */ border-radius: 0.5rem; padding: 1.5rem; margin-top: 1.5rem; }
        .simulator-title { font-weight: 600; color: #5b21b6; /* violet-800 */ margin-bottom: 1.5rem; font-size: 1.25rem; }
        .simulator-layout { display: grid; grid-template-columns: repeat(1, 1fr); gap: 1.5rem; }
        @media (min-width: 1024px) { .simulator-layout { grid-template-columns: 1.5fr 1fr 1fr; grid-template-areas: "code queues output" "controls queues output"; } }
        .sim-panel { border: 1px solid #ddd6fe; /* violet-200 */ border-radius: 0.5rem; padding: 1rem; background-color: white; min-height: 150px; display: flex; flex-direction: column; }
        .sim-panel-title { font-weight: 600; color: #6d28d9; /* violet-700 */ margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e9d5ff; /* violet-100 */ font-size: 0.9rem; }
        @media (min-width: 1024px) { .sim-code-panel { grid-area: code; } .sim-queues-panel { grid-area: queues; } .sim-output-panel { grid-area: output; } .sim-controls { grid-area: controls; } }
        .sim-code pre { margin-bottom: 0; flex-grow: 1; background-color: var(--text-color-dark); color: var(--bg-color-lighter); padding: 1rem; font-size: 0.85em; border-radius: 0.25rem; }
        .sim-code .line-highlight { background-color: #a78bfa; /* violet-400 */ color: #1e1b4b; /* violet-950 */ display: block; margin: 0 -1rem; padding: 0 1rem; border-radius: 0.2rem; }
        .sim-controls { display: flex; gap: 0.75rem; margin-top: 1rem; flex-wrap: wrap; }
        .sim-btn { background-color: #7c3aed; /* violet-600 */ color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.375rem; cursor: pointer; font-weight: 500; transition: background-color 0.2s; font-size: 0.875rem; }
        .sim-btn:hover:not(:disabled) { background-color: #6d28d9; /* violet-700 */ }
        .sim-btn:disabled { background-color: #a78bfa; /* violet-400 */ cursor: not-allowed; opacity: 0.7; }
        .sim-queue { border: 1px dashed; border-radius: 0.375rem; padding: 0.75rem; margin-bottom: 1rem; min-height: 80px; font-size: 0.85em; flex-grow: 1; display: flex; flex-direction: column; gap: 0.3rem; overflow-y: auto; }
        .sim-queue-item { background-color: #f5f3ff; border: 1px solid #ddd6fe; padding: 0.3rem 0.6rem; border-radius: 0.25rem; font-family: var(--font-family-mono); word-break: break-all; }
        .sim-call-stack { border-color: var(--stack-color); }
        .sim-call-stack .sim-queue-item { background-color: var(--stack-bg); border-color: var(--stack-color); color: var(--stack-text); }
        .sim-web-apis { border-color: var(--api-color); }
        .sim-web-apis .sim-queue-item { background-color: var(--api-bg); border-color: var(--api-color); color: var(--api-text); }
        .sim-micro-queue { border-color: var(--micro-color); }
        .sim-micro-queue .sim-queue-item { background-color: var(--micro-bg); border-color: var(--micro-color); color: var(--micro-text); }
        .sim-macro-queue { border-color: var(--macro-color); }
        .sim-macro-queue .sim-queue-item { background-color: var(--macro-bg); border-color: var(--macro-color); color: var(--macro-text); }
        .sim-output-log { background-color: var(--output-bg); border: 1px solid var(--border-color-default); color: var(--output-text); font-family: var(--font-family-mono); white-space: pre-wrap; min-height: 100px; flex-grow: 1; font-size: 0.9em; padding: 0.75rem; border-radius: 0.375rem; overflow-y: auto; }
        .sim-explanation { font-size: 0.8rem; color: var(--text-color-light); margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px dashed #ddd6fe; min-height: 3em; }

         /* Playground Styles */
        .playground-card { background-color: #f0fdfa; /* teal-50 */ border: 1px solid #5eead4; /* teal-200 */ margin-top: 1.5rem; padding: 1.5rem; border-radius: 0.5rem; }
        .playground-title { font-weight: 600; color: #115e59; /* teal-800 */ margin-bottom: 1.25rem; font-size: 1.1rem; }
        .playground-options { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px dashed #bae6fd; /* sky-200 */ font-size: 0.9em; }
        .playground-options label { display: flex; align-items: center; gap: 0.5rem; color: var(--text-color-default); }
        .playground-options input[type="number"] { width: 60px; padding: 0.25rem 0.5rem; border: 1px solid #7dd3fc; /* sky-300 */ border-radius: 0.25rem; }
        .playground-options input[type="checkbox"] { width: 1rem; height: 1rem; accent-color: #0ea5e9; /* sky-500 */ }
        .playground-controls { margin-top: 1rem; display: flex; gap: 0.5rem; align-items: center; }
        .playground-run-btn { background-color: #0ea5e9; /* sky-500 */ color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.375rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s; font-size: 0.875rem; }
        .playground-run-btn:hover:not(:disabled) { background-color: #0284c7; /* sky-600 */ }
        .playground-run-btn:disabled { background-color: #7dd3fc; /* sky-300 */ cursor: not-allowed; opacity: 0.7; }
        .playground-output { margin-top: 1rem; background-color: var(--bg-color-light); border: 1px solid var(--border-color-light); border-radius: 0.5rem; padding: 1rem; min-height: 60px; font-family: var(--font-family-mono); font-size: 0.85em; color: var(--text-color-default); white-space: pre-wrap; overflow-x: auto; }
        .playground-output .log-error { color: var(--danger-color); font-weight: bold; }
        .playground-output .log-info { color: var(--text-color-light); font-style: italic; }
        .playground-output .log-success { color: var(--success-color); font-weight: bold; }
        /* Added styles for simple playground (from V4) */
        .playground-input { display: inline-block; width: 40px; /* Smaller input */ padding: 0.4rem; border: 1px solid #99f6e4; /* teal-300 */ border-radius: 0.375rem; margin: 0 0.25rem; text-align: center; font-family: var(--font-family-mono); font-size: 0.9em; }
        .playground-check-btn { display: inline-block; background-color: #14b8a6; /* teal-500 */ color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s; margin-top: 0; /* Align with inputs */ border: none; font-size: 0.875rem; }
        .playground-check-btn:hover:not(:disabled) { background-color: #0d9488; /* teal-600 */ }
        .playground-check-btn:disabled { background-color: #9ca3af; /* gray-400 */ cursor: not-allowed; opacity: 0.7; }
        .playground-feedback { margin-top: 1rem; font-weight: 500; font-size: 0.9rem; }


        /* Interview Prep Card */
        .interview-card { border-left: 4px solid var(--primary-color); background-color: var(--bg-color-white); padding: 1.5rem; border-radius: 0 0.5rem 0.5rem 0; box-shadow: var(--card-shadow-default); margin-top: 1.5rem; }
        .interview-card h4 { margin-top: 0; color: var(--primary-color-dark); border-bottom: 1px solid var(--primary-color-light); padding-bottom: 0.75rem; margin-bottom: 1.25rem; font-size: 1.1rem; }
        .interview-card .answer-points { font-size: 0.95rem; color: var(--text-color-default); }
        .interview-card .answer-points ul, .interview-card .answer-points ol { padding-left: 1.5rem; margin-top: 0.5rem; }
        .interview-card .review-link { display: inline-block; margin-top: 1rem; font-size: 0.8rem; font-weight: 500; color: var(--primary-color-dark); text-decoration: none; padding: 0.25rem 0.5rem; border-radius: 0.25rem; background-color: var(--primary-color-light); transition: all 0.2s ease; }
        .interview-card .review-link:hover { color: var(--primary-color); background-color: #dbeafe; /* blue-100 */ text-decoration: underline; transform: translateY(-1px); }

        /* Fade-in Animation */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-section { opacity: 0; animation: fadeIn 0.5s ease-out forwards; }

    </style>
</head>

<body class="bg-gray-100"> <div class="page-container"> <aside class="local-side-nav"> <h4 class="head4">JS æ ¸å¿ƒåŸºç¡€</h4> <ul id="local-toc">
                 <li><a href="#async-concepts"><span class="material-icons nav-icon">info</span>åŒæ­¥ä¸å¼‚æ­¥</a></li>
                 <li><a href="#callbacks"><span class="material-icons nav-icon">call_split</span>å›è°ƒå‡½æ•°</a></li>
                 <li><a href="#promise-basics"><span class="material-icons nav-icon">hourglass_empty</span>Promise åŸºç¡€</a></li>
                 <li><a href="#promise-methods"><span class="material-icons nav-icon">list_alt</span>Promise é™æ€æ–¹æ³•</a></li>
                 <li><a href="#async-await"><span class="material-icons nav-icon">auto_awesome</span>async/await</a></li>
                 <li><a href="#event-loop-details"><span class="material-icons nav-icon">sync</span>äº‹ä»¶å¾ªç¯è¯¦è§£</a></li>
                 <li><a href="#playground"><span class="material-icons nav-icon">science</span>äº¤äº’å¼æ¼”ç»ƒåœº</a></li>
                 <li><a href="#async-interview-prep"><span class="material-icons nav-icon">question_answer</span>å¼‚æ­¥é¢è¯•é¢˜</a></li>
                 <li><a href="01-Language-Basics.html"><span class="material-icons nav-icon">arrow_back</span>è¿”å› JS åŸºç¡€</a></li>
             </ul>
             <a href="../../index.html" class="back-link">
                 &larr; è¿”å›å¤§çº²ç›®å½•
             </a>
         </aside>

        <main class="content-main"> <article>
                <section id="async-intro" class="content-section fade-in-section">
                    <h1 class="head1 flex items-center gap-2">
                        <span class="material-icons text-3xl text-blue-600">hourglass_empty</span>
                        JavaScript å¼‚æ­¥ç¼–ç¨‹ä¸äº‹ä»¶å¾ªç¯
                    </h1>
                    <p>
                        JavaScript å¼•æ“æœ¬èº«æ˜¯<strong class="text-red-600">å•çº¿ç¨‹</strong>æ‰§è¡Œçš„ï¼Œè¿™æ„å‘³ç€åœ¨ä»»æ„æ—¶åˆ»ï¼Œå®ƒåªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ç„¶è€Œï¼Œç°ä»£ Web åº”ç”¨å……æ»¡äº†éœ€è¦ç­‰å¾…çš„æ“ä½œï¼Œæ¯”å¦‚ä»æœåŠ¡å™¨è·å–æ•°æ®ã€è®¾ç½®å®šæ—¶å™¨ã€å“åº”ç”¨æˆ·ç‚¹å‡»ç­‰ã€‚å¦‚æœ JS
                        å®Œå…¨åŒæ­¥åœ°æ‰§è¡Œè¿™äº›æ“ä½œï¼Œé‚£ä¹ˆåœ¨ç­‰å¾…æœŸé—´ï¼Œæ•´ä¸ªé¡µé¢ï¼ˆå°¤å…¶æ˜¯ç”¨æˆ·ç•Œé¢ï¼‰å°†ä¼šè¢«<strong class="text-red-600">é˜»å¡</strong>ï¼Œæ— æ³•å“åº”ç”¨æˆ·è¾“å…¥ï¼Œå¯¼è‡´æå·®çš„ç”¨æˆ·ä½“éªŒã€‚
                    </p>
                    <p>
                        ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaScript ä¾èµ–å…¶<strong class="text-blue-600">å®¿ä¸»ç¯å¢ƒ</strong>ï¼ˆå¦‚æµè§ˆå™¨æˆ– Node.jsï¼‰æä¾›çš„èƒ½åŠ›æ¥å¤„ç†<strong class="text-red-600">å¼‚æ­¥ (Asynchronous)</strong> æ“ä½œã€‚å¼‚æ­¥ç¼–ç¨‹å…è®¸æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªè€—æ—¶æ“ä½œï¼Œç„¶åç»§ç»­æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œè€Œæ— éœ€ç­‰å¾…è¯¥æ“ä½œå®Œæˆã€‚å½“å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œç¯å¢ƒä¼šé€šè¿‡æŸç§æœºåˆ¶ï¼ˆé€šå¸¸æ˜¯å›è°ƒå‡½æ•°æˆ– Promiseï¼‰é€šçŸ¥æˆ‘ä»¬çš„ä»£ç ã€‚
                    </p>
                    <p>
                        <strong class="text-red-600">äº‹ä»¶å¾ªç¯ (Event Loop)</strong> æœºåˆ¶æ˜¯è¿™ä¸€åˆ‡çš„æ ¸å¿ƒï¼Œå®ƒåè°ƒäº† JS å¼•æ“ã€å®¿ä¸»ç¯å¢ƒ API å’Œä»»åŠ¡é˜Ÿåˆ—ä¹‹é—´çš„äº¤äº’ï¼Œä½¿å¾—å•çº¿ç¨‹çš„ JS èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¹¶å‘ä»»åŠ¡ï¼Œå®ç°éé˜»å¡ I/Oã€‚
                    </p>
                    <p>
                        æœ¬ç« å°†æ·±å…¥æ¢è®¨ JS ä¸­å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€æ¦‚å¿µï¼ˆåŒæ­¥ vs å¼‚æ­¥ã€å›è°ƒå‡½æ•°ï¼‰ï¼Œä»¥åŠç°ä»£ JS ä¸­å¤„ç†å¼‚æ­¥çš„ä¸»è¦æ–¹å¼ï¼ˆPromiseã€async/awaitï¼‰ï¼Œå¹¶æœ€ç»ˆæ­ç¤ºäº‹ä»¶å¾ªç¯ï¼ˆå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ï¼‰çš„å·¥ä½œåŸç†ã€‚
                    </p>
                </section>

                <section id="async-concepts" class="content-section fade-in-section">
                    <h2 class="head2 flex items-center"><span class="material-icons mr-2 text-blue-600">compare_arrows</span>åŒæ­¥ vs å¼‚æ­¥ & å›è°ƒå‡½æ•°</h2>

                    <div class="content-card">
                        <h3 class="head3">åŒæ­¥ (Synchronous)</h3>
                        <p>
                            åŒæ­¥æ“ä½œæ„å‘³ç€ä»£ç æŒ‰é¡ºåº<strong class="text-red-600">é€è¡Œæ‰§è¡Œ</strong>ã€‚åä¸€ä¸ªä»»åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆåæ‰èƒ½å¼€å§‹ã€‚å¦‚æœå‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œæ•´ä¸ªç¨‹åºå°±ä¼šè¢«é˜»å¡ã€‚
                        </p>
                        <pre class="my-code-block"><code class="language-javascript">// åŒæ­¥ç¤ºä¾‹
console.log('ä»»åŠ¡ 1 å¼€å§‹');

// å‡è®¾è¿™æ˜¯ä¸€ä¸ªè€—æ—¶çš„åŒæ­¥æ“ä½œ (ä¾‹å¦‚å¤æ‚çš„è®¡ç®—)
let result = 0;
for (let i = 0; i < 1e8; i++) { // æ¨¡æ‹Ÿè€—æ—¶
  result += i;
}
console.log('ä»»åŠ¡ 1 å®Œæˆ, ç»“æœ:', result); // å¿…é¡»ç­‰å¾…å¾ªç¯ç»“æŸ

console.log('ä»»åŠ¡ 2 å¼€å§‹'); // åªæœ‰åœ¨ä»»åŠ¡1å®Œæˆåæ‰ä¼šæ‰§è¡Œ</code></pre>
                    </div>

                    <div class="content-card">
                        <h3 class="head3">å¼‚æ­¥ (Asynchronous)</h3>
                        <p>
                            å¼‚æ­¥æ“ä½œåˆ™ä¸åŒã€‚å½“ä½ å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œç¨‹åº<strong class="text-red-600">ä¸ä¼šç­‰å¾…</strong>å®ƒå®Œæˆï¼Œè€Œæ˜¯ç«‹å³ç»§ç»­æ‰§è¡Œåç»­çš„ä»£ç ã€‚å¼‚æ­¥ä»»åŠ¡é€šå¸¸äº¤ç»™å®¿ä¸»ç¯å¢ƒï¼ˆæµè§ˆå™¨/Node.jsï¼‰åœ¨åå°å¤„ç†ã€‚å½“è¯¥ä»»åŠ¡å®Œæˆåï¼Œç¯å¢ƒä¼šé€šè¿‡æŸç§æ–¹å¼é€šçŸ¥ JSï¼Œé€šå¸¸æ˜¯æ‰§è¡Œä¸€ä¸ªé¢„å…ˆæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚
                        </p>
                        <pre class="my-code-block"><code class="language-javascript">// å¼‚æ­¥ç¤ºä¾‹ (ä½¿ç”¨ setTimeout æ¨¡æ‹Ÿ)
console.log('ä»»åŠ¡ 1 å¼€å§‹');

// å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ (å®šæ—¶å™¨)
setTimeout(function task1Callback() {
  // è¿™ä¸ªå‡½æ•°ä¸ä¼šç«‹å³æ‰§è¡Œ
  console.log('ä»»åŠ¡ 1 çš„å¼‚æ­¥å›è°ƒæ‰§è¡Œ');
}, 100); // å»¶è¿Ÿ 100æ¯«ç§’ (äº¤ç»™ç¯å¢ƒAPIå¤„ç†)

console.log('ä»»åŠ¡ 2 å¼€å§‹'); // è¿™è¡Œä»£ç ä¼šå‡ ä¹ç«‹å³æ‰§è¡Œï¼Œæ— éœ€ç­‰å¾… setTimeout å®Œæˆ

// è¾“å‡ºé¡ºåº:
// ä»»åŠ¡ 1 å¼€å§‹
// ä»»åŠ¡ 2 å¼€å§‹
// (å¤§çº¦ 100ms å)
// ä»»åŠ¡ 1 çš„å¼‚æ­¥å›è°ƒæ‰§è¡Œ</code></pre>
                    </div>

                    <div class="content-card" id="callbacks">
                        <h3 class="head3">å›è°ƒå‡½æ•° (Callback Functions)</h3>
                        <p>
                            å›è°ƒå‡½æ•°æ˜¯å®ç°å¼‚æ­¥çš„ä¸€ç§<strong class="text-red-600">åŸºæœ¬æ¨¡å¼</strong>ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong class="text-red-600">ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°</strong>çš„å‡½æ•°ã€‚å½“é‚£ä¸ªå¤–éƒ¨å‡½æ•°å®ŒæˆæŸä¸ªï¼ˆé€šå¸¸æ˜¯å¼‚æ­¥çš„ï¼‰æ“ä½œåï¼Œå®ƒä¼š<strong class="text-red-600">è°ƒç”¨</strong>ï¼ˆ"å›è°ƒ"ï¼‰æˆ‘ä»¬ä¼ å…¥çš„è¿™ä¸ªå‡½æ•°ã€‚
                        </p>
                        <p>
                            åœ¨ä¸Šé¢çš„ <code>setTimeout</code> ä¾‹å­ä¸­ï¼Œ<code>function task1Callback() { ... }</code> å°±æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚æˆ‘ä»¬æŠŠå®ƒä¼ ç»™ <code>setTimeout</code>ï¼Œæµè§ˆå™¨åœ¨ 100ms åå°†å®ƒæ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œäº‹ä»¶å¾ªç¯æœ€ç»ˆä¼šæ‰§è¡Œå®ƒã€‚
                        </p>
                        <p>
                            <strong>ä¼˜ç‚¹ï¼š</strong> ç®€å•ç›´è§‚ï¼Œæ˜¯å¼‚æ­¥çš„åŸºç¡€ã€‚
                        </p>
                        <p>
                            <strong>ç¼ºç‚¹ï¼šå›è°ƒåœ°ç‹± (Callback Hell / Pyramid of Doom)</strong>
                        </p>
                        <p>
                            å½“éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªç›¸äº’ä¾èµ–çš„å¼‚æ­¥æ“ä½œæ—¶ï¼Œå›è°ƒå‡½æ•°åµŒå¥—ä¼šå˜å¾—éå¸¸æ·±ï¼Œä»£ç éš¾ä»¥é˜…è¯»ã€ç†è§£å’Œç»´æŠ¤ã€‚
                        </p>
                        <pre class="my-code-block"><code class="language-javascript">// å›è°ƒåœ°ç‹±ç¤ºä¾‹
asyncOperation1(function(result1) {
  console.log('Step 1 done:', result1);
  asyncOperation2(result1, function(result2) {
    console.log('Step 2 done:', result2);
    asyncOperation3(result2, function(result3) {
      console.log('Step 3 done:', result3);
      // ... æ›´å¤šçš„åµŒå¥— ...
      console.log('All steps finished!');
    }, function(error3) {
      console.error('Error in step 3:', error3);
    });
  }, function(error2) {
    console.error('Error in step 2:', error2);
  });
}, function(error1) {
  console.error('Error in step 1:', error1);
});

// é”™è¯¯å¤„ç†ä¹Ÿå˜å¾—å¤æ‚å’Œåˆ†æ•£</code></pre>
                        <p>
                            ä¸ºäº†è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œç°ä»£ JavaScript å¼•å…¥äº†æ›´ä¼˜é›…çš„å¼‚æ­¥å¤„ç†æ–¹æ¡ˆï¼Œå¦‚ Promise å’Œ async/awaitã€‚
                        </p>
                    </div>
                </section>

                <section id="promise-basics" class="content-section fade-in-section">
                     <h2 class="head2 flex items-center"><span class="material-icons mr-2 text-blue-600">hourglass_empty</span>Promise åŸºç¡€</h2>
                     <div class="content-card" id="promise"> <h3 class="head3">èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆéœ€è¦ Promiseï¼Ÿ</h3>
                         <p>åœ¨ Promise å‡ºç°ä¹‹å‰ï¼Œå¤„ç†å¼‚æ­¥æ“ä½œï¼ˆå°¤å…¶æ˜¯éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œæ—¶ï¼‰é€šå¸¸ä¾èµ–äºå›è°ƒå‡½æ•°åµŒå¥—ã€‚å½“åµŒå¥—å±‚æ•°è¿‡å¤šæ—¶ï¼Œä¼šå¯¼è‡´ä»£ç éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ï¼Œå½¢æˆæ‰€è°“çš„ "å›è°ƒåœ°ç‹±" (Callback Hell)ã€‚</p>
                         <pre class="my-code-block"><code class="language-javascript">// å›è°ƒåœ°ç‹±ç¤ºä¾‹ (Pyramid of Doom)
getData(function(a) {
  parseData(a, function(b) {
    processData(b, function(c) {
      displayData(c, function() {
        // ... Code becomes deeply nested and hard to follow
      });
    });
  });
});</code></pre>

                         <h3 class="head3">æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼šPromise çš„æ ¸å¿ƒæ¦‚å¿µ</h3>
                         <p>Promise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„<strong class="text-red-600">æœ€ç»ˆå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰</strong>åŠå…¶ç»“æœå€¼ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong class="text-blue-600">çŠ¶æ€æœº</strong>ï¼Œç”¨äºæ›´ä¼˜é›…åœ°ç®¡ç†å¼‚æ­¥æµç¨‹ã€‚</p>
                         <div class="diagram-container">
                             <p class="diagram-title">Promise çŠ¶æ€æœº</p>
                             <div class="mermaid">
stateDiagram-v2
    [*] --> Pending : Start
    Pending --> Fulfilled : resolve(value)
    Pending --> Rejected : reject(reason)
    Fulfilled --> [*] : Settled (End)
    Rejected --> [*] : Settled (End)

    note right of Pending: åˆå§‹çŠ¶æ€, æ“ä½œè¿›è¡Œä¸­
    note left of Fulfilled: æ“ä½œæˆåŠŸ, æ‹¥æœ‰ value
    note left of Rejected: æ“ä½œå¤±è´¥, æ‹¥æœ‰ reason
                             </div>
                             <div class="explanation-box mt-6">
                                 <strong>çŠ¶æ€ç‰¹ç‚¹:</strong>
                                 <ul class="list-disc pl-4 text-sm mt-2 space-y-1.5">
                                     <li>åˆå§‹çŠ¶æ€ä¸º <strong>Pending</strong> (è¿›è¡Œä¸­)ã€‚</li>
                                     <li>ä» Pending å¯ä»¥é€šè¿‡è°ƒç”¨ <code>resolve(value)</code> å˜ä¸º <strong>Fulfilled</strong> (å·²æˆåŠŸ)ã€‚</li>
                                     <li>ä» Pending å¯ä»¥é€šè¿‡è°ƒç”¨ <code>reject(reason)</code> å˜ä¸º <strong>Rejected</strong> (å·²å¤±è´¥)ã€‚</li>
                                     <li>çŠ¶æ€ä¸€æ—¦ä» Pending å˜ä¸º Fulfilled æˆ– Rejected (å³ settled)ï¼Œå°±<strong class="text-red-600">ä¸å¯å†æ¬¡æ”¹å˜</strong>ã€‚</li>
                                     <li>Promise å¿…é¡»æœ‰ä¸€ä¸ª <code>.then</code> æ–¹æ³•æ¥è®¿é—®å…¶æœ€ç»ˆç»“æœæˆ–å¤±è´¥åŸå› ã€‚</li>
                                 </ul>
                             </div>
                         </div>

                         <h3 class="head3">æ€ä¹ˆè§£å†³é—®é¢˜ï¼šPromise çš„ä½¿ç”¨</h3>
                         <div class="info-card"> <ul class="list-none space-y-6">
                                 <li>
                                     <strong>åˆ›å»º Promise:</strong> ä½¿ç”¨ <code>new Promise((resolve, reject) => { ... })</code> æ„é€ å‡½æ•°ã€‚æ‰§è¡Œå™¨å‡½æ•°ä¼š<strong class="text-red-600">ç«‹å³åŒæ­¥æ‰§è¡Œ</strong>ã€‚
                                     <pre class="my-code-block"><code class="language-javascript">const fetchData = new Promise((resolve, reject) => {
  console.log('Promise executor started...'); // åŒæ­¥æ‰§è¡Œ
  // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
  setTimeout(() => {
    const success = Math.random() > 0.3; // æ¨¡æ‹ŸæˆåŠŸæˆ–å¤±è´¥
    if (success) {
      resolve({ data: 'Some fetched data' }); // æ“ä½œæˆåŠŸï¼ŒçŠ¶æ€å˜ä¸º Fulfilled
    } else {
      reject(new Error('Failed to fetch data')); // æ“ä½œå¤±è´¥ï¼ŒçŠ¶æ€å˜ä¸º Rejected
    }
  }, 1000);
});</code></pre>
                                 </li>
                                 <li>
                                     <strong><code>.then(onFulfilled, onRejected?)</code>:</strong> æ³¨å†Œå›è°ƒæ¥å¤„ç† Promise çš„æœ€ç»ˆçŠ¶æ€ã€‚<code>onFulfilled</code> åœ¨ Promise å˜ä¸º Fulfilled æ—¶è°ƒç”¨ï¼Œ<code>onRejected</code> (å¯é€‰) åœ¨å˜ä¸º Rejected æ—¶è°ƒç”¨ã€‚<code>.then</code> <strong class="text-red-600">è¿”å›ä¸€ä¸ªæ–°çš„ Promise</strong>ï¼Œå…è®¸é“¾å¼è°ƒç”¨ã€‚
                                     <pre class="my-code-block"><code class="language-javascript">fetchData.then(
  result => { // onFulfilled
    console.log('Success:', result.data);
    return result.data.toUpperCase(); // è¿”å›å€¼å°†ä½œä¸ºä¸‹ä¸€ä¸ª then çš„è¾“å…¥
  },
  error => { // onRejected (å¯é€‰)
    console.error('Initial fetch failed:', error.message);
    // å¯ä»¥è¿”å›ä¸€ä¸ªå€¼æ¥â€œæ¢å¤â€é“¾ï¼Œæˆ–è€…æŠ›å‡ºé”™è¯¯ç»§ç»­ä¼ é€’
    throw new Error('Handling initial error, but still failing.');
  }
).then(
  processedData => { console.log('Processed Data:', processedData); }
  // æ³¨æ„ï¼šå¦‚æœä¸Šä¸€æ­¥çš„ onRejected æŠ›å‡ºé”™è¯¯ï¼Œè¿™é‡Œä¸ä¼šæ‰§è¡Œï¼Œé”™è¯¯ä¼šç»§ç»­ä¼ é€’
).catch(finalError => { // é€šå¸¸ç”¨ catch ç»Ÿä¸€å¤„ç†é“¾ä¸­ä»»ä½•æœªæ•è·çš„é”™è¯¯
    console.error("Caught error somewhere in the chain:", finalError.message);
});</code></pre>
                                 </li>
                                 <li>
                                     <strong><code>.catch(onRejected)</code>:</strong> ä¸“é—¨ç”¨äºæ³¨å†Œé”™è¯¯å¤„ç†å›è°ƒï¼Œæ˜¯ <code>.then(null, onRejected)</code> çš„è¯­æ³•ç³–ã€‚é€šå¸¸æ”¾åœ¨é“¾çš„æœ«å°¾æ•è·ä»»ä½•å‰é¢æœªå¤„ç†çš„é”™è¯¯ã€‚
                                     <pre class="my-code-block"><code class="language-javascript">fetchData
  .then(result => result.data)
  .then(data => data.nonExistentProperty.toUpperCase()) // è¿™é‡Œä¼šäº§ç”Ÿé”™è¯¯
  .catch(error => { // æ•è· fetchData çš„ reject æˆ–ä¸Šé¢ then ä¸­çš„é”™è¯¯
    console.error('Caught error in chain:', error);
    return 'Default value after error'; // å¯ä»¥è¿”å›é»˜è®¤å€¼ä½¿é“¾ç»§ç»­
  })
  .then(finalValue => {
    console.log('Final value:', finalValue); // è¾“å‡º 'Default value after error'
  });</code></pre>
                                 </li>
                                 <li>
                                     <strong><code>.finally(onFinally)</code>:</strong> æ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œæ— è®º Promise æ˜¯ Fulfilled è¿˜æ˜¯ Rejected éƒ½ä¼šæ‰§è¡Œã€‚å¸¸ç”¨äºæ‰§è¡Œæ¸…ç†æ“ä½œã€‚<code>finally</code> å›è°ƒä¸æ¥æ”¶å‚æ•°ï¼Œå…¶è¿”å›å€¼ï¼ˆé™¤éæŠ›é”™ï¼‰ä¸å½±å“é“¾çš„ç»“æœã€‚
                                     <pre class="my-code-block"><code class="language-javascript">fetchData
  .then(result => console.log('Data:', result))
  .catch(error => console.error('Error:', error))
  .finally(() => {
    console.log('Fetch operation finished (finally).'); // æ€»ä¼šæ‰§è¡Œ
  });</code></pre>
                                 </li>
                                 <li>
                                     <strong>é“¾å¼è°ƒç”¨ & é”™è¯¯å†’æ³¡:</strong> Promise é“¾å…è®¸å°†å¼‚æ­¥æ“ä½œä¸²è”ã€‚é”™è¯¯ä¼šæ²¿ç€é“¾å‘ä¸‹ä¼ é€’ï¼Œç›´åˆ°è¢« <code>.catch</code> æ•è·ã€‚
                                     <pre class="my-code-block"><code class="language-javascript">Promise.resolve(1)
  .then(value => { console.log(value); return value + 1; }) // 1, returns 2
  .then(value => { console.log(value); throw new Error('Something went wrong'); }) // 2, throws error
  .then(value => console.log('This will not run')) // Skipped
  .catch(error => { console.error('Caught:', error.message); return 'recovered'; }) // Caught: Something went wrong, returns 'recovered'
  .then(value => console.log('After catch:', value)); // After catch: recovered</code></pre>
                                 </li>
                             </ul>
                         </div>
                         <div class="quiz-card" id="quiz-promise">
                             <p class="quiz-question">ğŸ§  Quiz: Promise çš„ <code>.then</code> æ–¹æ³•æœ€å¤šå¯ä»¥æ¥æ”¶å‡ ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Ÿ</p>
                             <div class="quiz-options">
                                 <button class="button button-secondary w-full text-left justify-start" data-option="A" onclick="checkAnswer('quiz-promise', 'A', 'B')">A) 1 ä¸ª (onFulfilled)</button>
                                 <button class="button button-secondary w-full text-left justify-start" data-option="B" onclick="checkAnswer('quiz-promise', 'B', 'B')">B) 2 ä¸ª (onFulfilled, onRejected)</button>
                                 <button class="button button-secondary w-full text-left justify-start" data-option="C" onclick="checkAnswer('quiz-promise', 'C', 'B')">C) 3 ä¸ª (onFulfilled, onRejected, onFinally)</button>
                                 <button class="button button-secondary w-full text-left justify-start" data-option="D" onclick="checkAnswer('quiz-promise', 'D', 'B')">D) ä¸å®šæ•°é‡çš„å›è°ƒå‡½æ•°</button>
                             </div>
                             <div class="quiz-feedback mt-4" style="display: none;"></div>
                             <div class="explanation-box mt-4 text-xs" style="display: none;">
                                 <code>.then()</code> æ–¹æ³•è®¾è®¡ä¸Šæ¥æ”¶ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯æˆåŠŸå›è°ƒ (<code>onFulfilled</code>)ï¼Œç¬¬äºŒä¸ªæ˜¯å¤±è´¥å›è°ƒ (<code>onRejected</code>)ã€‚<code>.finally()</code> æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•ã€‚
                             </div>
                         </div>
                     </div>
                 </section>

                <section id="promise-methods" class="content-section fade-in-section">
                    <h2 class="head2 flex items-center"><span class="material-icons mr-2 text-blue-600">list_alt</span>Promise é™æ€æ–¹æ³•</h2>
                    <p>å½“éœ€è¦å¹¶å‘å¤„ç†å¤šä¸ªå¼‚æ­¥æ“ä½œå¹¶æ ¹æ®å®ƒä»¬çš„ç»“æœè¿›è¡Œä¸åŒå¤„ç†æ—¶ï¼ŒPromise æä¾›äº†ä¸€äº›å¼ºå¤§çš„é™æ€æ–¹æ³•ã€‚é€šè¿‡ä¸‹é¢çš„ Playgroundï¼Œä½ å¯ä»¥ä¿®æ”¹å‚æ•°å¹¶è§‚å¯Ÿç»“æœï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£å®ƒä»¬çš„è¡Œä¸ºã€‚</p>
                    <div class="space-y-8 mt-4">
                        <div class="info-card border-l-4 border-green-500 bg-green-50">
                            <h4 class="head4 text-green-800 mb-3">Promise.all(iterable)</h4>
                            <p class="text-sm text-gray-700 mb-3">æ¥æ”¶ä¸€ä¸ª Promise è¿­ä»£å™¨ï¼ˆå¦‚æ•°ç»„ï¼‰ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œè¯¥ Promise ä¼šåœ¨è¿­ä»£å™¨ä¸­<b>æ‰€æœ‰</b> Promise éƒ½æˆåŠŸ (fulfilled) åæ‰æˆåŠŸï¼Œå¹¶å°†æ‰€æœ‰æˆåŠŸçš„ç»“æœæŒ‰åŸå§‹é¡ºåºç»„æˆä¸€ä¸ªæ•°ç»„ä¼ é€’ç»™ <code>.then</code>ã€‚å¦‚æœè¿­ä»£å™¨ä¸­<b>ä»»ä½•ä¸€ä¸ª</b> Promise å¤±è´¥ (rejected)ï¼Œ<code>Promise.all</code> è¿”å›çš„ Promise ä¼š<b>ç«‹å³å¤±è´¥</b>ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªå¤±è´¥çš„åŸå› ä¼ é€’ç»™ <code>.catch</code>ã€‚</p>
                            <pre class="my-code-block"><code class="language-javascript" id="code-promise-all">// Get values from playground controls specific to this container
const delayP1 = parseInt(playgroundContainer.querySelector('#all-delay-p1').value) || 50;
const delayP2 = parseInt(playgroundContainer.querySelector('#all-delay-p2').value) || 100;
const rejectP3 = playgroundContainer.querySelector('#all-reject-p3').checked;

const p1 = createPromise('P1', delayP1); // createPromise is passed in
const p2 = createPromise('P2', delayP2);
const p3 = createPromise('P3', 75, rejectP3); // P3 uses a fixed delay (75ms)

console.log(`Starting Promise.all with P1(${delayP1}ms), P2(${delayP2}ms), P3(75ms, reject=${rejectP3})...`);

Promise.all([p1, p2, p3])
  .then(results => { console.log('%cAll succeeded:', 'color: green; font-weight: bold;', results); })
  .catch(error => { console.error('%cAt least one failed:', 'color: red; font-weight: bold;', error); });</code></pre>
                            <p class="text-xs text-gray-600 mt-2"><strong>åœºæ™¯:</strong> éœ€è¦ç­‰å¾…å¤šä¸ªç‹¬ç«‹çš„å¼‚æ­¥æ“ä½œå…¨éƒ¨æˆåŠŸå®Œæˆæ‰èƒ½ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œä¾‹å¦‚å¹¶è¡ŒåŠ è½½å¤šä¸ªèµ„æºã€‚</p>
                            <div class="playground-card" data-code-id="code-promise-all"> <p class="playground-title">â–¶ï¸ Playground: Promise.all å®éªŒ</p>
                                <p class="text-sm text-gray-600 mb-4">è°ƒæ•´ä¸‹é¢ Promise çš„å»¶è¿Ÿæ—¶é—´å’Œ P3 æ˜¯å¦å¤±è´¥ï¼Œç„¶åè¿è¡Œä»£ç è§‚å¯Ÿ <code>Promise.all</code> çš„è¡Œä¸ºã€‚</p>
                                <div class="playground-options">
                                    <label>P1 å»¶è¿Ÿ (ms): <input type="number" id="all-delay-p1" value="50" min="0"></label>
                                    <label>P2 å»¶è¿Ÿ (ms): <input type="number" id="all-delay-p2" value="100" min="0"></label>
                                    <label>è®© P3 (75ms) å¤±è´¥? <input type="checkbox" id="all-reject-p3"></label>
                                </div>
                                <div class="playground-controls"> <button class="playground-run-btn">è¿è¡Œä»£ç </button> </div>
                                <div class="playground-output">ç‚¹å‡» "è¿è¡Œä»£ç " æŸ¥çœ‹è¾“å‡º...</div>
                            </div>
                        </div>

                        <div class="info-card border-l-4 border-blue-500 bg-blue-50">
                            <h4 class="head4 text-blue-800 mb-3">Promise.race(iterable)</h4>
                            <p class="text-sm text-gray-700 mb-3">æ¥æ”¶ä¸€ä¸ª Promise è¿­ä»£å™¨ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œè¯¥ Promise çš„çŠ¶æ€ä¼š<b>é•œåƒ</b>è¿­ä»£å™¨ä¸­<b>ç¬¬ä¸€ä¸ª</b> settled (æ— è®ºæ˜¯ fulfilled è¿˜æ˜¯ rejected) çš„ Promise çš„çŠ¶æ€ã€‚</p>
                            <pre class="my-code-block"><code class="language-javascript" id="code-promise-race">// Get values from playground controls specific to this container
const delayFast = parseInt(playgroundContainer.querySelector('#race-delay-fast').value) || 50;
const delaySlow = parseInt(playgroundContainer.querySelector('#race-delay-slow').value) || 200;
const rejectError = playgroundContainer.querySelector('#race-reject-error').checked;
const delayError = parseInt(playgroundContainer.querySelector('#race-delay-error').value) || 100;

const fastPromise = createPromise('Fast', delayFast); // createPromise is passed in
const slowPromise = createPromise('Slow', delaySlow);
const errorPromise = createPromise('Error', delayError, rejectError);

console.log(`Starting Promise.race with Fast(${delayFast}ms), Slow(${delaySlow}ms), Error(${delayError}ms, reject=${rejectError})...`);

Promise.race([fastPromise, slowPromise, errorPromise])
  .then(result => { console.log('%cFirst settled (fulfilled):', 'color: green; font-weight: bold;', result); })
  .catch(error => { console.error('%cFirst settled (rejected):', 'color: red; font-weight: bold;', error); });</code></pre>
                            <p class="text-xs text-gray-600 mt-2"><strong>åœºæ™¯:</strong> å–å¤šä¸ªæºä¸­æœ€å¿«è¿”å›çš„ç»“æœï¼Œæˆ–è€…å®ç°è¶…æ—¶æ§åˆ¶ã€‚</p>
                            <div class="playground-card" data-code-id="code-promise-race">
                                <p class="playground-title">â–¶ï¸ Playground: Promise.race å®éªŒ</p>
                                <p class="text-sm text-gray-600 mb-4">è°ƒæ•´ä¸‹é¢ä¸‰ä¸ª Promise çš„å»¶è¿Ÿæ—¶é—´ï¼Œå¹¶é€‰æ‹© Error Promise æ˜¯å¦å¤±è´¥ï¼Œè§‚å¯Ÿå“ªä¸ª Promise æœ€å…ˆ "èƒœå‡º"ã€‚</p>
                                <div class="playground-options">
                                    <label>Fast å»¶è¿Ÿ (ms): <input type="number" id="race-delay-fast" value="50" min="0"></label>
                                    <label>Slow å»¶è¿Ÿ (ms): <input type="number" id="race-delay-slow" value="200" min="0"></label>
                                    <label>Error å»¶è¿Ÿ (ms): <input type="number" id="race-delay-error" value="100" min="0"></label>
                                    <label>è®© Error å¤±è´¥? <input type="checkbox" id="race-reject-error"></label>
                                </div>
                                <div class="playground-controls"> <button class="playground-run-btn">è¿è¡Œä»£ç </button> </div>
                                <div class="playground-output">ç‚¹å‡» "è¿è¡Œä»£ç " æŸ¥çœ‹è¾“å‡º...</div>
                            </div>
                        </div>

                        <div class="info-card border-l-4 border-yellow-500 bg-yellow-50">
                             <h4 class="head4 text-yellow-800 mb-3">Promise.allSettled(iterable)</h4>
                             <p class="text-sm text-gray-700 mb-3">æ¥æ”¶ä¸€ä¸ª Promise è¿­ä»£å™¨ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œè¯¥ Promise <b>æ€»ä¼šæˆåŠŸ</b> (fulfilled)ï¼Œåœ¨è¿­ä»£å™¨ä¸­<b>æ‰€æœ‰</b> Promise éƒ½ settled (æ— è®ºæˆåŠŸæˆ–å¤±è´¥) åï¼Œå…¶è§£å†³å€¼ä¸ºä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡æè¿°äº†å¯¹åº” Promise çš„æœ€ç»ˆçŠ¶æ€ (<code>{status: 'fulfilled', value: ...}</code> æˆ– <code>{status: 'rejected', reason: ...}</code>)ã€‚</p>
                             <pre class="my-code-block"><code class="language-javascript" id="code-promise-allsettled">// Get values from playground controls specific to this container
const delaySettle1 = parseInt(playgroundContainer.querySelector('#settled-delay-1').value) || 50;
const delaySettle2 = parseInt(playgroundContainer.querySelector('#settled-delay-2').value) || 150;
const rejectSettle2 = playgroundContainer.querySelector('#settled-reject-2').checked;
const delaySettle3 = parseInt(playgroundContainer.querySelector('#settled-delay-3').value) || 100;

const pSettle1 = createPromise('P1', delaySettle1); // createPromise is passed in
const pSettle2 = createPromise('P2', delaySettle2, rejectSettle2);
const pSettle3 = createPromise('P3', delaySettle3);

console.log(`Starting Promise.allSettled with P1(${delaySettle1}ms), P2(${delaySettle2}ms, reject=${rejectSettle2}), P3(${delaySettle3}ms)...`);

Promise.allSettled([pSettle1, pSettle2, pSettle3])
  .then(results => {
    console.log('%cAll settled results:', 'color: blue; font-weight: bold;');
    console.log(JSON.stringify(results, null, 2)); // Compact view
  });</code></pre>
                             <p class="text-xs text-gray-600 mt-2"><strong>åœºæ™¯:</strong> å½“ä½ éœ€è¦çŸ¥é“ä¸€ç»„ç‹¬ç«‹å¼‚æ­¥æ“ä½œå„è‡ªçš„å®Œæˆæƒ…å†µï¼Œè€Œä¸å…³å¿ƒå®ƒä»¬æ˜¯å¦å…¨éƒ¨æˆåŠŸæ—¶ã€‚</p>
                            <div class="playground-card" data-code-id="code-promise-allsettled">
                                <p class="playground-title">â–¶ï¸ Playground: Promise.allSettled å®éªŒ</p>
                                <p class="text-sm text-gray-600 mb-4">è°ƒæ•´å»¶è¿Ÿå’Œ P2 æ˜¯å¦å¤±è´¥ã€‚æ³¨æ„ <code>Promise.allSettled</code> æœ¬èº«æ€»æ˜¯æˆåŠŸï¼Œå¹¶è¿”å›æ¯ä¸ª Promise çš„çŠ¶æ€å’Œç»“æœ/åŸå› ã€‚</p>
                                <div class="playground-options">
                                    <label>P1 å»¶è¿Ÿ (ms): <input type="number" id="settled-delay-1" value="50" min="0"></label>
                                    <label>P2 å»¶è¿Ÿ (ms): <input type="number" id="settled-delay-2" value="150" min="0"></label>
                                    <label>è®© P2 å¤±è´¥? <input type="checkbox" id="settled-reject-2" checked></label>
                                    <label>P3 å»¶è¿Ÿ (ms): <input type="number" id="settled-delay-3" value="100" min="0"></label>
                                </div>
                                <div class="playground-controls"> <button class="playground-run-btn">è¿è¡Œä»£ç </button> </div>
                                <div class="playground-output">ç‚¹å‡» "è¿è¡Œä»£ç " æŸ¥çœ‹è¾“å‡º...</div>
                            </div>
                        </div>

                        <div class="info-card border-l-4 border-purple-500 bg-purple-50">
                            <h4 class="head4 text-purple-800 mb-3">Promise.any(iterable)</h4>
                            <p class="text-sm text-gray-700 mb-3">æ¥æ”¶ä¸€ä¸ª Promise è¿­ä»£å™¨ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œè¯¥ Promise ä¼šåœ¨è¿­ä»£å™¨ä¸­<b>ä»»ä½•ä¸€ä¸ª</b> Promise æˆåŠŸ (fulfilled) å<b>ç«‹å³æˆåŠŸ</b>ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªæˆåŠŸçš„ç»“æœä¼ é€’ç»™ <code>.then</code>ã€‚åªæœ‰å½“è¿­ä»£å™¨ä¸­<b>æ‰€æœ‰</b> Promise éƒ½å¤±è´¥ (rejected) æ—¶ï¼Œ<code>Promise.any</code> è¿”å›çš„ Promise æ‰ä¼šå¤±è´¥ï¼Œå…¶å¤±è´¥åŸå› æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¤±è´¥åŸå› çš„ <code>AggregateError</code>ã€‚</p>
                            <pre class="my-code-block"><code class="language-javascript" id="code-promise-any">// Get values from playground controls specific to this container
const rejectAny1 = playgroundContainer.querySelector('#any-reject-1').checked;
const delayAny1 = parseInt(playgroundContainer.querySelector('#any-delay-1').value) || 150;
const rejectAny2 = playgroundContainer.querySelector('#any-reject-2').checked;
const delayAny2 = parseInt(playgroundContainer.querySelector('#any-delay-2').value) || 200;
const rejectAny3 = playgroundContainer.querySelector('#any-reject-3').checked;
const delayAny3 = parseInt(playgroundContainer.querySelector('#any-delay-3').value) || 50;

const pAny1 = createPromise('P1', delayAny1, rejectAny1); // createPromise is passed in
const pAny2 = createPromise('P2', delayAny2, rejectAny2);
const pAny3 = createPromise('P3', delayAny3, rejectAny3);

console.log(`Starting Promise.any with P1(${delayAny1}ms, reject=${rejectAny1}), P2(${delayAny2}ms, reject=${rejectAny2}), P3(${delayAny3}ms, reject=${rejectAny3})...`);

Promise.any([pAny1, pAny2, pAny3])
  .then(firstSuccess => { console.log('%cFirst fulfilled:', 'color: green; font-weight: bold;', firstSuccess); })
  .catch(aggregateError => {
    if (aggregateError instanceof AggregateError) {
      const errorMessages = aggregateError.errors.map(e => (e instanceof Error ? e.message : String(e)));
      console.error('%cAll promises rejected:', 'color: red; font-weight: bold;', errorMessages);
    } else { console.error('%cCaught unexpected error:', 'color: red; font-weight: bold;', aggregateError); }
  });</code></pre>
                            <p class="text-xs text-gray-600 mt-2"><strong>åœºæ™¯:</strong> åªè¦å¤šä¸ªæºä¸­æœ‰ä¸€ä¸ªæˆåŠŸå³å¯ï¼Œä¾‹å¦‚ä»å¤šä¸ªé•œåƒæœåŠ¡å™¨è·å–èµ„æºï¼Œå–æœ€å¿«æˆåŠŸçš„é‚£ä¸ªã€‚</p>
                            <div class="playground-card" data-code-id="code-promise-any">
                                <p class="playground-title">â–¶ï¸ Playground: Promise.any å®éªŒ</p>
                                <p class="text-sm text-gray-600 mb-4">è°ƒæ•´å»¶è¿Ÿå’Œæ¯ä¸ª Promise æ˜¯å¦å¤±è´¥ã€‚<code>Promise.any</code> ä¼šè¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„ Promise çš„ç»“æœã€‚åªæœ‰å½“æ‰€æœ‰ Promise éƒ½å¤±è´¥æ—¶ï¼Œå®ƒæ‰ä¼šå¤±è´¥ã€‚</p>
                                <div class="playground-options">
                                    <label>P1 å»¶è¿Ÿ (ms): <input type="number" id="any-delay-1" value="150" min="0"></label>
                                    <label>è®© P1 å¤±è´¥? <input type="checkbox" id="any-reject-1" checked></label>
                                    <label>P2 å»¶è¿Ÿ (ms): <input type="number" id="any-delay-2" value="200" min="0"></label>
                                    <label>è®© P2 å¤±è´¥? <input type="checkbox" id="any-reject-2"></label>
                                    <label>P3 å»¶è¿Ÿ (ms): <input type="number" id="any-delay-3" value="50" min="0"></label>
                                    <label>è®© P3 å¤±è´¥? <input type="checkbox" id="any-reject-3"></label>
                                </div>
                                <div class="playground-controls"> <button class="playground-run-btn">è¿è¡Œä»£ç </button> </div>
                                <div class="playground-output">ç‚¹å‡» "è¿è¡Œä»£ç " æŸ¥çœ‹è¾“å‡º...</div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="async-await" class="content-section fade-in-section">
                    <h2 class="head2 flex items-center"><span class="material-icons mr-2 text-blue-600">auto_awesome</span>async/await è¯­æ³•ç³–</h2>
                    <div class="content-card" id="async-await-basics"> <h3 class="head3">èƒŒæ™¯ï¼šPromise é“¾çš„æ”¹è¿›ç©ºé—´</h3>
                        <p>è™½ç„¶ Promise è§£å†³äº†å›è°ƒåœ°ç‹±ï¼Œå¹¶ä¸”é“¾å¼è°ƒç”¨æ¯”åµŒå¥—å›è°ƒæ¸…æ™°å¾—å¤šï¼Œä½†å½“å¼‚æ­¥æ­¥éª¤å¾ˆå¤šæ—¶ï¼Œ<code>.then</code> é“¾æœ‰æ—¶ä»ç„¶æ˜¾å¾—æœ‰äº›å†—é•¿å’Œåˆ†ç¦»ã€‚<code>async/await</code> (ES2017) æä¾›äº†ä¸€ç§æ›´ç®€æ´ã€æ›´åƒåŒæ­¥ä»£ç çš„æ–¹å¼æ¥ç¼–å†™å’Œç†è§£åŸºäº Promise çš„å¼‚æ­¥é€»è¾‘ã€‚</p>

                        <h3 class="head3">æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼šasync/await æ ¸å¿ƒ</h3>
                        <div class="info-card accent-blue"> <ul class="list-none space-y-5">
                                <li class="flex items-start gap-4">
                                    <span class="material-icons text-purple-600 mt-1">functions</span>
                                    <div>
                                        <strong class="text-purple-700"><code>async</code> å…³é”®å­—:</strong>
                                        <p class="text-sm text-gray-600 mt-1">ç”¨äºå£°æ˜ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ã€‚<code>async</code> å‡½æ•°<strong class="text-red-600">è‡ªåŠ¨è¿”å›ä¸€ä¸ª Promise</strong>ã€‚<br>- å¦‚æœå‡½æ•°å†…éƒ¨æ˜¾å¼ <code>return</code> ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼ä¼šè¢« <code>Promise.resolve()</code> åŒ…è£…ã€‚<br>- å¦‚æœå‡½æ•°å†…éƒ¨æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯ä¼šè¢« <code>Promise.reject()</code> åŒ…è£…ã€‚</p>
                                    </div>
                                </li>
                                <li class="flex items-start gap-4">
                                    <span class="material-icons text-teal-600 mt-1">timer</span>
                                    <div>
                                        <strong class="text-teal-700"><code>await</code> å…³é”®å­—:</strong>
                                        <p class="text-sm text-gray-600 mt-1"><strong class="text-red-600">åªèƒ½</strong>åœ¨ <code>async</code> å‡½æ•°å†…éƒ¨ä½¿ç”¨ã€‚å®ƒä¼š<strong class="text-red-600">æš‚åœ</strong> <code>async</code> å‡½æ•°çš„æ‰§è¡Œï¼Œç­‰å¾… <code>await</code> å³ä¾§çš„è¡¨è¾¾å¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª Promiseï¼‰è§£æå®Œæˆã€‚<br>- å¦‚æœå³ä¾§æ˜¯ Promiseï¼Œ<code>await</code> ç­‰å¾…å…¶ settledã€‚æˆåŠŸåˆ™è¿”å›è§£å†³å€¼ï¼Œå¤±è´¥åˆ™<strong class="text-red-600">æŠ›å‡º</strong>é”™è¯¯ã€‚<br>- å¦‚æœå³ä¾§ä¸æ˜¯ Promiseï¼Œ<code>await</code> ä¼šå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª resolved Promiseï¼Œå¹¶ç«‹å³è¿”å›è¯¥å€¼ã€‚</p>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <h3 class="head3">æ€ä¹ˆè§£å†³é—®é¢˜ï¼šä½¿ç”¨ async/await ç®€åŒ–å¼‚æ­¥</h3>
                        <p>ä½¿ç”¨ <code>async/await</code> å¯ä»¥å°†ä¹‹å‰çš„ Promise é“¾ç¤ºä¾‹æ”¹å†™å¾—æ›´åƒä¼ ç»Ÿçš„åŒæ­¥ä»£ç ï¼Œæé«˜äº†å¯è¯»æ€§ï¼Œå¹¶ä¸”é”™è¯¯å¤„ç†å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ <code>try...catch</code> ç»“æ„ã€‚</p>
                        <pre class="my-code-block"><code class="language-javascript">// å‡è®¾ step1(), step2() è¿”å› Promise
async function performSteps() {
  console.log("Async function started...");
  try {
    const result1 = await step1(); // ç­‰å¾… step1 å®Œæˆ
    console.log('Step 1 completed with:', result1);
    const result2 = await step2(result1); // ç­‰å¾… step2 å®Œæˆ
    console.log('Step 2 completed with:', result2);
    return result2; // æœ€ç»ˆç»“æœ
  } catch (error) {
    console.error('An error occurred during steps:', error.message);
    throw error; // é‡æ–°æŠ›å‡ºï¼Œè®©å¤–éƒ¨å¯ä»¥æ•è·
  } finally {
      console.log("Async function finished attempt (finally).");
  }
}

performSteps()
  .then(finalResult => { console.log('Async function succeeded:', finalResult); })
  .catch(error => { console.error('Async function failed:', error.message); });

// --- Helper functions (example) ---
function step1() { /* ... returns a Promise ... */ }
function step2(input) { /* ... returns a Promise ... */ }</code></pre>
                        <p class="mt-4"><strong>ä¼˜ç‚¹:</strong></p>
                        <ul class="list-disc pl-5 space-y-1 text-sm">
                            <li><b>ä»£ç ç»“æ„æ¸…æ™°:</b> å¼‚æ­¥ä»£ç çœ‹èµ·æ¥æ›´åƒåŒæ­¥ä»£ç ã€‚</li>
                            <li><b>é”™è¯¯å¤„ç†ç›´è§‚:</b> ä½¿ç”¨ <code>try...catch...finally</code>ã€‚</li>
                            <li><b>è°ƒè¯•æ–¹ä¾¿:</b> æ›´å®¹æ˜“å•æ­¥æ‰§è¡Œã€‚</li>
                        </ul>
                        <p class="mt-2"><strong>é‡è¦æé†’:</strong> <code>async/await</code> æœ¬è´¨ä¸Šæ˜¯ Promise çš„è¯­æ³•ç³–ã€‚<code>await</code> <strong class="text-red-600">ä¸ä¼šé˜»å¡</strong>æ•´ä¸ª JS çº¿ç¨‹ï¼Œä»…æš‚åœå½“å‰ <code>async</code> å‡½æ•°ï¼Œå…è®¸äº‹ä»¶å¾ªç¯å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚</p>

                        <h3 class="head3">é¢è¯•é«˜é¢‘ï¼šasync/await ä¸äº‹ä»¶å¾ªç¯</h3>
                        <div class="explanation-box">
                            <strong><code>await</code> çš„çœŸæ­£å«ä¹‰:</strong>
                            <ol class="list-decimal pl-5 space-y-1.5 mt-2 text-sm">
                                <li>é‡åˆ° <code>await expression;</code>ï¼šç«‹å³æ‰§è¡Œ <code>expression</code>ã€‚</li>
                                <li>å¦‚æœ <code>expression</code> è¿”å› Promiseï¼Œ<code>async</code> å‡½æ•°æš‚åœï¼Œå¼•æ“è·³å‡ºï¼Œæ‰§è¡Œåç»­åŒæ­¥ä»£ç ã€‚</li>
                                <li>å½“ Promise settled åï¼š<code>async</code> å‡½æ•°<strong class="text-red-600">å‰©ä½™éƒ¨åˆ†</strong>çš„ä»£ç è¢«åŒ…è£…æˆä¸€ä¸ª<strong class="text-red-600">å¾®ä»»åŠ¡</strong>ï¼Œæ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
                                <li>äº‹ä»¶å¾ªç¯åœ¨æ¸…ç©ºå½“å‰å¾®ä»»åŠ¡é˜Ÿåˆ—æ—¶ï¼Œä¼šæ‰§è¡Œè¿™ä¸ªå¾®ä»»åŠ¡ï¼Œæ¢å¤ <code>async</code> å‡½æ•°ã€‚</li>
                            </ol>
                            <p class="mt-2 text-sm">è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨äº‹ä»¶å¾ªç¯çš„ Quiz ä¸­ï¼Œ<code>await</code> åé¢çš„ä»£ç ï¼ˆå¦‚ <code>async1 end</code>ï¼‰ä¼šåœ¨åŒæ­¥ä»£ç ä¹‹åã€<code>setTimeout</code> ä¹‹å‰ä½œä¸ºå¾®ä»»åŠ¡æ‰§è¡Œã€‚</p>
                        </div>
                        <div class="quiz-card" id="quiz-async-basic">
                            <p class="quiz-question">ğŸ§  Quiz: è°ƒç”¨ä¸€ä¸ª <code>async</code> å‡½æ•°ä¼šç«‹å³è¿”å›ä»€ä¹ˆï¼Ÿ</p>
                            <div class="quiz-options">
                                <button class="button button-secondary w-full text-left justify-start" data-option="A" onclick="checkAnswer('quiz-async-basic', 'A', 'C')">A) å‡½æ•°å†…éƒ¨ <code>return</code> çš„å€¼</button>
                                <button class="button button-secondary w-full text-left justify-start" data-option="B" onclick="checkAnswer('quiz-async-basic', 'B', 'C')">B) <code>undefined</code></button>
                                <button class="button button-secondary w-full text-left justify-start" data-option="C" onclick="checkAnswer('quiz-async-basic', 'C', 'C')">C) ä¸€ä¸ª Promise</button>
                                <button class="button button-secondary w-full text-left justify-start" data-option="D" onclick="checkAnswer('quiz-async-basic', 'D', 'C')">D) ç¬¬ä¸€ä¸ª <code>await</code> è¡¨è¾¾å¼çš„ç»“æœ</button>
                            </div>
                            <div class="quiz-feedback mt-4" style="display: none;"></div>
                            <div class="explanation-box mt-4 text-xs" style="display: none;">
                                <code>async</code> å‡½æ•°çš„æ ¸å¿ƒç‰¹æ€§å°±æ˜¯å®ƒæ€»æ˜¯ç«‹å³è¿”å›ä¸€ä¸ª Promiseã€‚å¦‚æœå‡½æ•°å†…éƒ¨æœ‰ <code>return value;</code>ï¼Œè¿”å›çš„ Promise ä¼š resolve è¿™ä¸ª <code>value</code>ã€‚å¦‚æœå‡½æ•°å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼Œè¿”å›çš„ Promise ä¼š reject è¿™ä¸ªé”™è¯¯ã€‚
                            </div>
                        </div>
                    </div>
                </section>

                <section id="event-loop-details" class="content-section fade-in-section">
                    <h2 class="head2 flex items-center"><span class="material-icons mr-2 text-blue-600">sync</span>äº‹ä»¶å¾ªç¯è¯¦è§£ (å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡)</h2>

                    <div class="content-card">
                         <div class="info-card accent-blue shadow-lg">
                             <h4 class="head4 text-blue-800 mb-3">å›é¡¾ï¼šJS å¼•æ“ä¸å®¿ä¸»ç¯å¢ƒ</h4>
                             <p class="text-sm text-blue-700">JavaScript å¼•æ“ï¼ˆå¦‚ V8ï¼‰æœ¬èº«æ˜¯å•çº¿ç¨‹æ‰§è¡Œä»£ç çš„ã€‚æµè§ˆå™¨æˆ– Node.js ç­‰â€œå®¿ä¸»ç¯å¢ƒâ€æä¾›äº†é¢å¤–çš„å¼‚æ­¥ APIï¼ˆå¦‚ <code>setTimeout</code>ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰ï¼Œè¿™äº› API ç”±ç¯å¢ƒåœ¨åå°å¤„ç†ã€‚äº‹ä»¶å¾ªç¯æ˜¯å®¿ä¸»ç¯å¢ƒç®¡ç†è¿™äº›å¼‚æ­¥æ“ä½œç»“æœå¹¶è°ƒåº¦å› JS å¼•æ“æ‰§è¡Œçš„æœºåˆ¶ã€‚</p>
                         </div>

                         <h3 class="head3">æ ¸å¿ƒæ¦‚å¿µå›é¡¾</h3>
                         <div class="info-card">
                             <ul class="list-none space-y-5">
                                 <li class="flex items-start gap-4"> <span class="material-icons text-red-500 mt-1">layers</span> <div> <strong class="text-red-700">è°ƒç”¨æ ˆ (Call Stack):</strong> <p class="text-sm text-gray-600 mt-1">LIFO ç»“æ„ï¼Œè¿½è¸ªå‡½æ•°è°ƒç”¨ï¼Œæ‰§è¡ŒåŒæ­¥ä»£ç ã€‚</p> </div> </li>
                                 <li class="flex items-start gap-4"> <span class="material-icons text-green-500 mt-1">settings_ethernet</span> <div> <strong class="text-green-700">ç¯å¢ƒ APIs:</strong> <p class="text-sm text-gray-600 mt-1">å®¿ä¸»æä¾›çš„å¼‚æ­¥æ¥å£ (<code>setTimeout</code>, <code>fetch</code> ç­‰)ï¼Œåå°æ‰§è¡Œã€‚</p> </div> </li>
                                 <li class="flex items-start gap-4"> <span class="material-icons text-indigo-500 mt-1">queue</span> <div> <strong class="text-indigo-700">å®ä»»åŠ¡é˜Ÿåˆ— (Task Queue):</strong> <p class="text-sm text-gray-600 mt-1">FIFO é˜Ÿåˆ—ï¼Œå­˜æ”¾å®ä»»åŠ¡å›è°ƒ (<code>setTimeout</code>, I/O ç­‰)ã€‚</p> </div> </li>
                                 <li class="flex items-start gap-4"> <span class="material-icons text-yellow-500 mt-1">flash_on</span> <div> <strong class="text-yellow-700">å¾®ä»»åŠ¡é˜Ÿåˆ— (Microtask Queue):</strong> <p class="text-sm text-gray-600 mt-1">æ›´é«˜ä¼˜å…ˆçº§çš„ FIFO é˜Ÿåˆ—ï¼Œå­˜æ”¾å¾®ä»»åŠ¡å›è°ƒ (Promise, <code>queueMicrotask</code>)ã€‚</p> </div> </li>
                                 <li class="flex items-start gap-4"> <span class="material-icons text-orange-500 mt-1">loop</span> <div> <strong class="text-orange-700">äº‹ä»¶å¾ªç¯ (Event Loop):</strong> <p class="text-sm text-gray-600 mt-1">æŒç»­ç›‘æ§è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—çš„è¿›ç¨‹ã€‚</p> </div> </li>
                             </ul>
                         </div>

                         <h3 class="head3">äº‹ä»¶å¾ªç¯æµç¨‹å›¾</h3>
                         <div class="diagram-container">
                             <p class="diagram-title">äº‹ä»¶å¾ªç¯æ ¸å¿ƒæµç¨‹ç¤ºæ„å›¾</p>
                             <div class="mermaid">
                                graph TD
                                subgraph "JavaScript Engine"
                                A[è°ƒç”¨æ ˆ Call Stack]
                                end
    
                                subgraph "Host Environment"
                                B(Web/Node APIs) -- å¼‚æ­¥æ“ä½œå®Œæˆ --> C{å®ä»»åŠ¡é˜Ÿåˆ— Macrotask};
                                B -- å¼‚æ­¥æ“ä½œå®Œæˆ --> D{å¾®ä»»åŠ¡é˜Ÿåˆ— Microtask};
                                end
    
                                E((äº‹ä»¶å¾ªç¯ Event Loop))
    
                                A -- åŒæ­¥æ‰§è¡Œ --> A;
                                A -- æ ˆç©º --> E;
                                E -- æ£€æŸ¥å¾®ä»»åŠ¡ --> D;
                                D -- å–å‡ºæ‰€æœ‰å¾®ä»»åŠ¡ --> A;
                                E -- æ£€æŸ¥å®ä»»åŠ¡ --> C;
                                C -- å–å‡º1ä¸ªå®ä»»åŠ¡ --> A;
    
                                %% Styling (optional, Mermaid handles defaults)
                                style A fill:#fff1f2,stroke:#fda4af,stroke-width:2px;
                                style B fill:#f0fdf4,stroke:#86efac,stroke-width:2px;
                                style C fill:#eef2ff,stroke:#a5b4fc,stroke-width:2px;
                                style D fill:#fefce8,stroke:#fcd34d,stroke-width:2px;
                                style E fill:#fff7ed,stroke:#fb923c,stroke-width:3px,font-weight:bold;
    
    
                             </div>
                             <div class="explanation-box mt-8">
                                 <strong class="text-gray-700">æ‰§è¡Œæ­¥éª¤ (Tick):</strong>
                                 <ol class="list-decimal pl-5 text-sm mt-2 space-y-1.5">
                                     <li>æ‰§è¡Œè°ƒç”¨æ ˆä¸­çš„åŒæ­¥ä»£ç ï¼Œç›´åˆ°æ ˆç©ºã€‚</li>
                                     <li>æ£€æŸ¥<strong class="text-yellow-700">å¾®ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼Œæ‰§è¡Œå¹¶<strong class="text-red-600">æ¸…ç©ºæ‰€æœ‰</strong>å¾®ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ‰§è¡ŒæœŸé—´æ–°åŠ å…¥çš„ï¼‰ã€‚</li>
                                     <li>ï¼ˆæµè§ˆå™¨å¯é€‰ï¼‰æ£€æŸ¥æ˜¯å¦éœ€è¦<strong class="text-sky-600">æ¸²æŸ“ UI</strong>ã€‚</li>
                                     <li>æ£€æŸ¥<strong class="text-indigo-700">å®ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå–å‡º<strong class="text-red-600">ä¸€ä¸ª</strong>å®ä»»åŠ¡æ‰§è¡Œã€‚</li>
                                     <li>é‡å¤æ­¥éª¤ 2-4ï¼Œå¼€å§‹æ–°çš„å¾ªç¯ tickã€‚</li>
                                 </ol>
                             </div>
                         </div>
                    </div>

                    <div class="content-card mt-6">
                        <h3 class="head3">å®ä»»åŠ¡ vs å¾®ä»»åŠ¡ è¯¦è§£</h3>
                        <p>ç†è§£å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡çš„åŒºåˆ«ä»¥åŠå®ƒä»¬çš„æ‰§è¡Œé¡ºåºï¼Œå¯¹äºé¢„æµ‹å’Œæ§åˆ¶å¼‚æ­¥ä»£ç çš„è¡Œä¸ºè‡³å…³é‡è¦ã€‚</p>

                        <div class="grid md:grid-cols-2 gap-6 mt-4"> <div class="info-card accent-indigo border-l-4"> <h4 class="head4 text-indigo-800 mb-3">å®ä»»åŠ¡ (MacroTask / Task)</h4>
                                <p class="text-sm text-indigo-700 mb-4">ç”±äº‹ä»¶å¾ªç¯æœºåˆ¶è°ƒåº¦ï¼Œæ¯æ¬¡å¾ªç¯åªæ‰§è¡Œ<strong class="text-red-600">ä¸€ä¸ª</strong>ã€‚</p>
                                <ul class="list-disc pl-5 text-sm space-y-1.5 text-indigo-900">
                                    <li><code>script</code> (æ•´ä½“ä»£ç å—)</li>
                                    <li><code>setTimeout</code>, <code>setInterval</code></li>
                                    <li><code>setImmediate</code> (Node.js ç¯å¢ƒ)</li>
                                    <li>I/O æ“ä½œ (æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚å›è°ƒç­‰)</li>
                                    <li>UI æ¸²æŸ“ (æµè§ˆå™¨ç¯å¢ƒ)</li>
                                    <li><code>postMessage</code>, MessageChannel</li>
                                    <li>ç”¨æˆ·äº¤äº’äº‹ä»¶å›è°ƒ (click, keydown ç­‰)</li>
                                </ul>
                            </div>
                            <div class="info-card accent-yellow border-l-4"> <h4 class="head4 text-yellow-800 mb-3">å¾®ä»»åŠ¡ (MicroTask / Job)</h4>
                                <p class="text-sm text-yellow-700 mb-4">åœ¨å½“å‰å®ä»»åŠ¡æ‰§è¡Œç»“æŸåã€ä¸‹ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹å‰ï¼Œéœ€è¦è¢«<strong class="text-red-600">å…¨éƒ¨</strong>æ¸…ç©ºçš„é˜Ÿåˆ—ã€‚</p>
                                <ul class="list-disc pl-5 text-sm space-y-1.5 text-yellow-900">
                                    <li><code>Promise.then/catch/finally</code> çš„å›è°ƒ</li>
                                    <li><code>async/await</code> ä¸­ <code>await</code> åé¢çš„ä»£ç </li>
                                    <li><code>queueMicrotask()</code></li>
                                    <li><code>MutationObserver</code> å›è°ƒ</li>
                                    <li><code>process.nextTick</code> (Node.js, <strong class="text-red-600">ç‰¹æ®Šï¼Œä¼˜å…ˆçº§æœ€é«˜</strong>ï¼Œä¸¥æ ¼è¯´æ¯”å¾®ä»»åŠ¡è¿˜ä¼˜å…ˆ)</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="head3 mt-6">æ‰§è¡Œé¡ºåºç¤ºä¾‹åˆ†æ</h3>
                        <p>å›é¡¾ä¹‹å‰çš„ä¾‹å­ï¼Œå¹¶æ ‡æ³¨ä»»åŠ¡ç±»å‹ï¼š</p>
                        <pre class="my-code-block"><code class="language-javascript">console.log('script start'); // 1. åŒæ­¥ (å±äº script å®ä»»åŠ¡)

setTimeout(function() {        // æ³¨å†Œå®ä»»åŠ¡ (A)
  console.log('setTimeout'); // 5. å®ä»»åŠ¡ (A) çš„æ‰§è¡Œ
}, 0);

Promise.resolve()
  .then(function() {         // æ³¨å†Œå¾®ä»»åŠ¡ (a)
    console.log('promise1'); // 3. å¾®ä»»åŠ¡ (a) çš„æ‰§è¡Œ
  })
  .then(function() {         // å¾®ä»»åŠ¡ (a) æ‰§è¡Œæ—¶æ³¨å†Œå¾®ä»»åŠ¡ (b)
    console.log('promise2'); // 4. å¾®ä»»åŠ¡ (b) çš„æ‰§è¡Œ
  });

console.log('script end');   // 2. åŒæ­¥ (å±äº script å®ä»»åŠ¡)</code></pre>
                        <div class="explanation-box">
                            <strong>æ‰§è¡Œæµç¨‹:</strong>
                            <ol class="list-decimal pl-4 space-y-1.5 text-sm mt-2">
                                <li><strong>å®ä»»åŠ¡ (script):</strong>
                                    <ul>
                                        <li>æ‰§è¡ŒåŒæ­¥ä»£ç : è¾“å‡º 'script start' (1)ã€‚</li>
                                        <li>é‡åˆ° <code>setTimeout</code>ï¼Œå°†å…¶å›è°ƒæ³¨å†Œä¸ºæ–°çš„å®ä»»åŠ¡ (A)ï¼Œæ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
                                        <li>é‡åˆ° <code>Promise.resolve().then()</code>ï¼Œå°†ç¬¬ä¸€ä¸ª <code>.then</code> çš„å›è°ƒæ³¨å†Œä¸ºå¾®ä»»åŠ¡ (a)ï¼Œæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
                                        <li>æ‰§è¡ŒåŒæ­¥ä»£ç : è¾“å‡º 'script end' (2)ã€‚</li>
                                    </ul>
                                </li>
                                <li><strong>script å®ä»»åŠ¡ç»“æŸï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—:</strong>
                                    <ul>
                                        <li>å¾®ä»»åŠ¡é˜Ÿåˆ—: [(a)]ã€‚</li>
                                        <li>æ‰§è¡Œå¾®ä»»åŠ¡ (a): è¾“å‡º 'promise1' (3)ã€‚é‡åˆ°ç¬¬äºŒä¸ª <code>.then</code>ï¼Œå°†å…¶å›è°ƒæ³¨å†Œä¸ºæ–°çš„å¾®ä»»åŠ¡ (b)ï¼Œæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
                                        <li>å¾®ä»»åŠ¡é˜Ÿåˆ—: [(b)]ã€‚</li>
                                        <li>æ‰§è¡Œå¾®ä»»åŠ¡ (b): è¾“å‡º 'promise2' (4)ã€‚</li>
                                        <li>å¾®ä»»åŠ¡é˜Ÿåˆ—: [] (å·²æ¸…ç©º)ã€‚</li>
                                    </ul>
                                </li>
                                <li><strong>(å¯é€‰æ¸²æŸ“)</strong></li>
                                <li><strong>æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—:</strong>
                                    <ul>
                                        <li>å®ä»»åŠ¡é˜Ÿåˆ—: [(A)]ã€‚</li>
                                        <li>å–å‡ºå®ä»»åŠ¡ (A) æ‰§è¡Œ: è¾“å‡º 'setTimeout' (5)ã€‚</li>
                                    </ul>
                                </li>
                                <li><strong>å®ä»»åŠ¡ (A) ç»“æŸï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ— (ç©º)ã€‚</strong></li>
                                <li><strong>æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ— (ç©º)ã€‚</strong> äº‹ä»¶å¾ªç¯å¯èƒ½è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</li>
                            </ol>
                             <strong>æœ€ç»ˆè¾“å‡º:</strong> <code>script start</code>, <code>script end</code>, <code>promise1</code>, <code>promise2</code>, <code>setTimeout</code>
                        </div>

                        <div class="quiz-card" id="quiz-macro-micro-recap">
                             <p class="quiz-question">ğŸ§  Quiz Recap: ä¸‹é¢ä»£ç çš„è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ</p>
                             <pre class="my-code-block"><code class="language-javascript">async function async1() { console.log('async1 start'); await async2(); console.log('async1 end'); }
async function async2() { console.log('async2'); }
console.log('script start');
setTimeout(function() { console.log('setTimeout'); }, 0);
async1();
new Promise(function(resolve) { console.log('promise1'); resolve(); }).then(function() { console.log('promise2'); });
console.log('script end');</code></pre>
                             <div class="quiz-options">
                                 <button class="button button-secondary w-full text-left justify-start" data-option="A" onclick="checkAnswer('quiz-macro-micro-recap', 'A', 'C')">A) script start, async1 start, async2, promise1, script end, promise2, async1 end, setTimeout</button>
                                 <button class="button button-secondary w-full text-left justify-start" data-option="B" onclick="checkAnswer('quiz-macro-micro-recap', 'B', 'C')">B) script start, async1 start, async2, promise1, script end, promise2, setTimeout, async1 end</button>
                                 <button class="button button-secondary w-full text-left justify-start" data-option="C" onclick="checkAnswer('quiz-macro-micro-recap', 'C', 'C')">C) script start, async1 start, async2, promise1, script end, async1 end, promise2, setTimeout</button>
                                 <button class="button button-secondary w-full text-left justify-start" data-option="D" onclick="checkAnswer('quiz-macro-micro-recap', 'D', 'C')">D) script start, async1 start, async2, script end, promise1, async1 end, promise2, setTimeout</button>
                             </div>
                             <div class="quiz-feedback mt-4" style="display: none;"></div>
                             <div class="explanation-box mt-4 text-xs" style="display: none;">
                                 <strong>è¯¦ç»†æ­¥éª¤:</strong>
                                 <ol class="list-decimal pl-4 mt-1 space-y-0.5">
                                     <li>åŒæ­¥: è¾“å‡º 'script start' (1)</li>
                                     <li>è°ƒç”¨ async1(): è¾“å‡º 'async1 start' (2)</li>
                                     <li>é‡åˆ° await async2(): ç«‹å³æ‰§è¡Œ async2(), è¾“å‡º 'async2' (3). await æš‚åœ async1, å°† 'async1 end' æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ— (m1)</li>
                                     <li>ç»§ç»­åŒæ­¥: æ‰§è¡Œ new Promise(), è¾“å‡º 'promise1' (4). resolve() å°† .then() å›è°ƒ (è¾“å‡º 'promise2') æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ— (m2)</li>
                                     <li>ç»§ç»­åŒæ­¥: è¾“å‡º 'script end' (5)</li>
                                     <li>åŒæ­¥ç»“æŸ, æ‰§è¡Œå¾®ä»»åŠ¡: å…ˆæ‰§è¡Œ m1 ('async1 end') (6), å†æ‰§è¡Œ m2 ('promise2') (7)</li>
                                     <li>å¾®ä»»åŠ¡æ¸…ç©º, æ‰§è¡Œå®ä»»åŠ¡: æ‰§è¡Œ setTimeout å›è°ƒ, è¾“å‡º 'setTimeout' (8)</li>
                                 </ol> æ‰€ä»¥é¡ºåºæ˜¯: script start, async1 start, async2, promise1, script end, async1 end, promise2, setTimeout. (é€‰é¡¹ C æ­£ç¡®)
                             </div>
                         </div>
                    </div>
                </section>

                <section id="playground" class="content-section fade-in-section">
                      <h2 class="head2 flex items-center"><span class="material-icons mr-2 text-blue-600">science</span>äº¤äº’å¼æ¼”ç»ƒåœº (Playground)</h2>
                      <p>é€šè¿‡ä¸‹é¢çš„ç»ƒä¹ ï¼Œå°è¯•é¢„æµ‹ä»£ç çš„è¾“å‡ºé¡ºåºï¼ŒåŠ æ·±å¯¹äº‹ä»¶å¾ªç¯çš„ç†è§£ã€‚</p>

                      <div class="playground-card" id="playground-1">
                          <p class="playground-title">ç»ƒä¹  1: é¢„æµ‹è¾“å‡ºé¡ºåº</p>
                          <p class="mb-4">è€ƒè™‘ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p>
                          <pre class="my-code-block"><code class="language-javascript">
console.log('A');

setTimeout(() => console.log('B'), 0);

Promise.resolve().then(() => console.log('C'));

console.log('D');
                          </code></pre>
                          <p class="mb-3">è¯·åœ¨ä¸‹é¢çš„è¾“å…¥æ¡†ä¸­æŒ‰æ‰§è¡Œé¡ºåºåˆ—å‡ºé¢„æœŸçš„è¾“å‡ºå­—æ¯ (A, B, C, D)ï¼š</p>
                          <div class="flex items-center flex-wrap gap-2">
                              <span>è¾“å‡º:</span>
                              <input type="text" class="playground-input" data-index="0" maxlength="1">
                              <input type="text" class="playground-input" data-index="1" maxlength="1">
                              <input type="text" class="playground-input" data-index="2" maxlength="1">
                              <input type="text" class="playground-input" data-index="3" maxlength="1">
                              <button class="playground-check-btn"
                                  onclick="checkPlaygroundOrder('playground-1', ['A', 'D', 'C', 'B'])">æ£€æŸ¥ç­”æ¡ˆ</button>
                          </div>
                          <div class="playground-feedback text-sm mt-4" style="display: none;"></div>
                          <div class="explanation-box mt-4 text-xs" style="display: none;">
                              <strong>è§£é‡Š:</strong>
                              <ol class="list-decimal pl-4 mt-1 space-y-0.5">
                                  <li>åŒæ­¥ä»£ç ä¼˜å…ˆæ‰§è¡Œ: è¾“å‡º 'A' å’Œ 'D'ã€‚</li>
                                  <li><code>setTimeout</code> å›è°ƒ ('B') æ˜¯å®ä»»åŠ¡ï¼Œæ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
                                  <li><code>Promise.then</code> å›è°ƒ ('C') æ˜¯å¾®ä»»åŠ¡ï¼Œæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
                                  <li>åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—: è¾“å‡º 'C'ã€‚</li>
                                  <li>å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡: è¾“å‡º 'B'ã€‚</li>
                              </ol> å› æ­¤æ­£ç¡®é¡ºåºæ˜¯ A, D, C, Bã€‚
                          </div>
                      </div>

                      

                  </section>

                 <section id="simulator" class="content-section fade-in-section">
                      <h2 class="head2 flex items-center"><span class="material-icons mr-2 text-blue-600">visibility</span>äº‹ä»¶å¾ªç¯æ¨¡æ‹Ÿå™¨ (å¯è§†åŒ–)</h2>
                      <p>é€šè¿‡é€æ­¥æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œè§‚å¯Ÿè°ƒç”¨æ ˆã€Web APIsã€ä»»åŠ¡é˜Ÿåˆ—å’Œè¾“å‡ºçš„å˜åŒ–ï¼Œç›´è§‚æ„Ÿå—äº‹ä»¶å¾ªç¯çš„è¿‡ç¨‹ã€‚</p>
                      <div class="simulator-container" id="event-loop-simulator">
                          <p class="simulator-title">æ¨¡æ‹Ÿæ‰§è¡Œç¤ºä¾‹</p>
                          <div class="simulator-layout">
                              <div class="sim-panel sim-code-panel">
                                  <h4 class="sim-panel-title">ä»£ç </h4>
                                  <div class="sim-code">
                                      <pre class="my-code-block"><code id="sim-code-display" class="language-javascript"></code></pre>
                                  </div>
                              </div>
                              <div class="sim-panel sim-queues-panel">
                                  <h4 class="sim-panel-title">çŠ¶æ€</h4>
                                  <div>
                                      <p class="text-xs font-semibold mb-1" style="color: var(--stack-text)">è°ƒç”¨æ ˆ (Call Stack)</p>
                                      <div class="sim-queue sim-call-stack" id="sim-call-stack"></div>
                                  </div>
                                  <div>
                                      <p class="text-xs font-semibold mb-1" style="color: var(--api-text)">Web APIs (æ¨¡æ‹Ÿ)</p>
                                      <div class="sim-queue sim-web-apis" id="sim-web-apis"></div>
                                  </div>
                                  <div>
                                      <p class="text-xs font-semibold mb-1" style="color: var(--micro-text)">å¾®ä»»åŠ¡é˜Ÿåˆ— (Microtask Queue)</p>
                                      <div class="sim-queue sim-micro-queue" id="sim-micro-queue"></div>
                                  </div>
                                  <div>
                                      <p class="text-xs font-semibold mb-1" style="color: var(--macro-text)">å®ä»»åŠ¡é˜Ÿåˆ— (Macrotask Queue)</p>
                                      <div class="sim-queue sim-macro-queue" id="sim-macro-queue">[script]</div>
                                  </div>
                              </div>
                              <div class="sim-panel sim-output-panel">
                                  <h4 class="sim-panel-title">è¾“å‡º & è§£é‡Š</h4>
                                  <div class="sim-output-log" id="sim-output-log"></div>
                                  <div class="sim-explanation" id="sim-explanation">ç‚¹å‡» "ä¸‹ä¸€æ­¥" å¼€å§‹æ¨¡æ‹Ÿã€‚</div>
                              </div>
                              <div class="sim-controls">
                                  <button id="sim-step-btn" class="sim-btn">ä¸‹ä¸€æ­¥ (Step)</button>
                                  <button id="sim-reset-btn" class="sim-btn">é‡ç½® (Reset)</button>
                              </div>
                          </div>
                      </div>
                  </section>

                <section id="async-interview-prep" class="content-section fade-in-section">
                     <h2 class="head2 flex items-center"><span class="material-icons mr-2 text-blue-600">question_answer</span>å¼‚æ­¥ç¼–ç¨‹é¢è¯•é¢˜</h2>
                     <p class="mb-6">ä»¥ä¸‹æ˜¯ä¸€äº›åœ¨é¢è¯•ä¸­ï¼Œå…³äºå¼‚æ­¥ç¼–ç¨‹å’Œäº‹ä»¶å¾ªç¯å¸¸è¢«é—®åˆ°çš„é—®é¢˜åŠå…¶å›ç­”è¦ç‚¹ï¼š</p>
                     <div class="space-y-6"> <div class="interview-card">
                             <h4>1. è¯·è§£é‡Šä¸€ä¸‹ JavaScript çš„äº‹ä»¶å¾ªç¯ (Event Loop) æœºåˆ¶ã€‚</h4>
                             <div class="answer-points">
                                 <strong>å›ç­”è¦ç‚¹:</strong>
                                 <ul class="list-disc">
                                     <li><b>ç›®çš„:</b> è§£é‡Š JS å¦‚ä½•åœ¨å•çº¿ç¨‹æ¨¡å‹ä¸‹å®ç°å¼‚æ­¥éé˜»å¡ I/Oã€‚</li>
                                     <li><b>å…³é”®ç»„ä»¶:</b> è°ƒç”¨æ ˆ, ç¯å¢ƒ API, å®ä»»åŠ¡é˜Ÿåˆ—, å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
                                     <li><b>æ ¸å¿ƒæµç¨‹:</b> åŒæ­¥ä»£ç  -> æ¸…ç©ºå¾®ä»»åŠ¡ -> (æ¸²æŸ“) -> æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ -> æ¸…ç©ºå¾®ä»»åŠ¡ -> ...</li>
                                     <li><b>å¼ºè°ƒ:</b> å¾®ä»»åŠ¡ä¼˜å…ˆçº§é«˜äºå®ä»»åŠ¡ï¼Œå¹¶åœ¨æ¯æ¬¡å®ä»»åŠ¡åå®Œæ•´æ¸…ç©ºã€‚</li>
                                 </ul>
                                 <a href="#event-loop-details" class="review-link">â¤´ï¸ å›é¡¾äº‹ä»¶å¾ªç¯è¯¦è§£</a>
                             </div>
                         </div>
                         <div class="interview-card">
                             <h4>2. å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚</h4>
                             <div class="answer-points">
                                 <strong>å›ç­”è¦ç‚¹:</strong>
                                 <ul class="list-disc">
                                     <li><b>æ¥æº:</b> å®ä»»åŠ¡é€šå¸¸ç”±å®¿ä¸»ç¯å¢ƒå‘èµ·ï¼›å¾®ä»»åŠ¡é€šå¸¸ç”± JS è‡ªèº«æˆ–ç‰¹å®š API (Promise) äº§ç”Ÿã€‚</li>
                                     <li><b>æ‰§è¡Œæ—¶æœº:</b> æ¯æ¬¡äº‹ä»¶å¾ªç¯ tick åªæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼›åœ¨æ¯ä¸ªå®ä»»åŠ¡åä¼šæ¸…ç©ºæ‰€æœ‰å¾®ä»»åŠ¡ã€‚</li>
                                     <li><b>ä¼˜å…ˆçº§:</b> å¾®ä»»åŠ¡ > å®ä»»åŠ¡ã€‚</li>
                                     <li><b>ä¾‹å­:</b> (å®: <code>setTimeout</code>, I/O; å¾®: <code>Promise.then</code>, <code>await</code> åç»­)</li>
                                 </ul>
                                 <a href="#event-loop-details" class="review-link">â¤´ï¸ å›é¡¾å®ä»»åŠ¡ vs å¾®ä»»åŠ¡</a>
                             </div>
                         </div>
                         <div class="interview-card">
                             <h4>3. Promise æœ‰å“ªå‡ ç§çŠ¶æ€ï¼ŸçŠ¶æ€æ”¹å˜çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</h4>
                             <div class="answer-points">
                                 <strong>å›ç­”è¦ç‚¹:</strong>
                                 <ul class="list-disc">
                                     <li><b>ä¸‰ç§çŠ¶æ€:</b> Pending, Fulfilled, Rejectedã€‚</li>
                                     <li><b>çŠ¶æ€æ”¹å˜:</b> Pending -> Fulfilled (via <code>resolve</code>), Pending -> Rejected (via <code>reject</code>)ã€‚</li>
                                     <li><b>å…³é”®ç‰¹æ€§:</b> çŠ¶æ€ä¸€æ—¦ settled (Fulfilled æˆ– Rejected)ï¼Œå°±ä¸å¯å†å˜ã€‚</li>
                                 </ul>
                                 <a href="#promise-basics" class="review-link">â¤´ï¸ å›é¡¾ Promise åŸºç¡€</a>
                             </div>
                         </div>
                         <div class="interview-card">
                             <h4>4. <code>async/await</code> æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿå®ƒå’Œ Promise æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</h4>
                             <div class="answer-points">
                                 <strong>å›ç­”è¦ç‚¹:</strong>
                                 <ul class="list-disc">
                                     <li><b>å…³ç³»:</b> <code>async/await</code> æ˜¯ Promise çš„è¯­æ³•ç³–ã€‚</li>
                                     <li><b><code>async</code>:</b> æ ‡è®°å‡½æ•°ï¼Œä½¿å…¶æ€»è¿”å› Promiseã€‚</li>
                                     <li><b><code>await</code>:</b> æš‚åœ <code>async</code> å‡½æ•°ï¼Œç­‰å¾… Promise è§£å†³ã€‚æˆåŠŸè¿”å›å€¼ï¼Œå¤±è´¥æŠ›é”™ã€‚</li>
                                     <li><b>æ‰§è¡Œæœºåˆ¶:</b> <code>await</code> æš‚åœåï¼Œå‡½æ•°å‰©ä½™éƒ¨åˆ†ä½œä¸ºå¾®ä»»åŠ¡è°ƒåº¦ã€‚</li>
                                     <li><b>é”™è¯¯å¤„ç†:</b> ä½¿ç”¨ <code>try...catch</code>ã€‚</li>
                                 </ul>
                                 <a href="#async-await" class="review-link">â¤´ï¸ å›é¡¾ async/await</a>
                             </div>
                         </div>
                         <div class="interview-card">
                             <h4>5. <code>Promise.all</code>, <code>Promise.race</code>, <code>Promise.allSettled</code>, <code>Promise.any</code> çš„åŒºåˆ«å’Œåº”ç”¨åœºæ™¯ï¼Ÿ</h4>
                             <div class="answer-points">
                                 <strong>å›ç­”è¦ç‚¹:</strong>
                                 <ul class="list-disc">
                                     <li><b><code>all</code>:</b> å…¨éƒ¨æˆåŠŸæ‰æˆåŠŸï¼Œä»»ä¸€å¤±è´¥å³å¤±è´¥ã€‚(åœºæ™¯: æ‰€æœ‰ä¾èµ–éƒ½éœ€å®Œæˆ)</li>
                                     <li><b><code>race</code>:</b> è¿”å›ç¬¬ä¸€ä¸ª settled çš„ç»“æœ (æˆåŠŸæˆ–å¤±è´¥)ã€‚(åœºæ™¯: å–æœ€å¿«å“åº”, è¶…æ—¶)</li>
                                     <li><b><code>allSettled</code>:</b> ç­‰å¾…æ‰€æœ‰éƒ½ settledï¼Œè¿”å›å„è‡ªçŠ¶æ€å’Œç»“æœ/åŸå› ã€‚(åœºæ™¯: éœ€çŸ¥é“æ‰€æœ‰æ“ä½œçš„æœ€ç»ˆçŠ¶æ€)</li>
                                     <li><b><code>any</code>:</b> è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„ï¼Œæ‰€æœ‰éƒ½å¤±è´¥æ‰å¤±è´¥ã€‚(åœºæ™¯: ä»»ä¸€æˆåŠŸå³å¯)</li>
                                 </ul>
                                 <a href="#promise-methods" class="review-link">â¤´ï¸ å›é¡¾ Promise é™æ€æ–¹æ³•</a>
                             </div>
                         </div>
                         <div class="interview-card">
                             <h4>6. (ä»£ç é¢˜) åˆ†æç»™å®šåŒ…å« <code>setTimeout</code>, <code>Promise</code>, <code>async/await</code> çš„å¤æ‚ä»£ç ç‰‡æ®µçš„è¾“å‡ºé¡ºåºã€‚</h4>
                             <div class="answer-points">
                                 <strong>å›ç­”è¦ç‚¹:</strong> (éœ€è¦ç»“åˆå…·ä½“é¢˜ç›®åˆ†æ)
                                 <ul class="list-disc">
                                     <li><b>æ ¸å¿ƒåŸåˆ™:</b> åŒæ­¥ -> æ¸…ç©ºå¾®ä»»åŠ¡ -> (æ¸²æŸ“) -> ä¸€ä¸ªå®ä»»åŠ¡ã€‚</li>
                                     <li><b>è¯†åˆ«ä»»åŠ¡ç±»å‹:</b> åŒºåˆ†åŒæ­¥ã€å®ä»»åŠ¡ã€å¾®ä»»åŠ¡ã€‚</li>
                                     <li><b>è¿½è¸ªé˜Ÿåˆ—:</b> æ¨¡æ‹Ÿè°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—å˜åŒ–ã€‚</li>
                                     <li><b>æ³¨æ„ç»†èŠ‚:</b> <code>new Promise</code> æ‰§è¡Œå™¨åŒæ­¥æ‰§è¡Œ, <code>await</code> åç»­æ˜¯å¾®ä»»åŠ¡, Node.js <code>nextTick</code> æœ€é«˜ä¼˜å…ˆçº§ã€‚</li>
                                     <li><b>é€æ­¥æ¨å¯¼:</b> è®°å½•è¾“å‡ºå’Œé˜Ÿåˆ—çŠ¶æ€ã€‚</li>
                                 </ul>
                                 <a href="#event-loop-details" class="review-link">â¤´ï¸ å›é¡¾äº‹ä»¶å¾ªç¯ Quiz</a>
                             </div>
                         </div>
                     </div>
                 </section>

            </article>
        </main>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
         mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
    <script>
        // --- Quiz Answer Checking Logic ---
        function checkAnswer(quizId, selectedOption, correctOption) {
            const quizCard = document.getElementById(quizId);
            if (!quizCard) return;
            const feedbackEl = quizCard.querySelector('.quiz-feedback');
            const explanationEl = quizCard.querySelector('.explanation-box');
            const buttons = quizCard.querySelectorAll('.quiz-options button');

            buttons.forEach(button => {
                button.disabled = true;
                button.classList.remove('button-correct', 'button-incorrect', 'button-dimmed');
                // Reset base styles if needed, assuming Tailwind/global handles this mostly
                button.classList.add('button-secondary'); // Re-apply base button style if necessary
            });

            const correctButton = quizCard.querySelector(`button[data-option="${correctOption}"]`);
            const selectedButton = quizCard.querySelector(`button[data-option="${selectedOption}"]`);

            if (selectedOption === correctOption) {
                feedbackEl.textContent = 'âœ… å›ç­”æ­£ç¡®ï¼';
                feedbackEl.className = 'quiz-feedback feedback-correct'; // Use classes from global.css
                if (selectedButton) {
                    selectedButton.classList.remove('button-secondary'); // Remove base before adding specific
                    selectedButton.classList.add('button-correct');
                }
                buttons.forEach(button => {
                    if (button !== selectedButton) button.classList.add('button-dimmed');
                });
            } else {
                feedbackEl.textContent = `âŒ å›ç­”é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ ${correctOption}ã€‚`;
                feedbackEl.className = 'quiz-feedback feedback-incorrect'; // Use classes from global.css
                if (selectedButton) {
                    selectedButton.classList.remove('button-secondary');
                    selectedButton.classList.add('button-incorrect');
                }
                if (correctButton) {
                     correctButton.classList.remove('button-secondary');
                    correctButton.classList.add('button-correct'); // Highlight correct one
                }
                buttons.forEach(button => {
                    if (button !== selectedButton && button !== correctButton) {
                        button.classList.add('button-dimmed');
                    }
                });
            }
            feedbackEl.style.display = 'block';
            if (explanationEl) {
                explanationEl.style.display = 'block';
            }
        }

         // --- Simple Playground Logic ---
         function checkPlaygroundOrder(playgroundId, correctOrder) {
             const playgroundCard = document.getElementById(playgroundId);
             if (!playgroundCard) return;
             const inputs = playgroundCard.querySelectorAll('.playground-input');
             const feedbackEl = playgroundCard.querySelector('.playground-feedback');
             const explanationEl = playgroundCard.querySelector('.explanation-box');
             const checkBtn = playgroundCard.querySelector('.playground-check-btn');

             let userOrder = Array.from(inputs).map(input => input.value.trim().toUpperCase());

             const isCorrect = JSON.stringify(userOrder) === JSON.stringify(correctOrder);

             if (isCorrect) {
                 feedbackEl.textContent = 'âœ… å®Œå…¨æ­£ç¡®ï¼é¡ºåºæ˜¯: ' + correctOrder.join(', ');
                 feedbackEl.className = 'playground-feedback text-green-700 font-medium'; // Added font-medium
             } else {
                 feedbackEl.textContent = 'âŒ é¡ºåºä¸å®Œå…¨æ­£ç¡®ã€‚ä½ çš„ç­”æ¡ˆ: ' + userOrder.join(', ') + 'ã€‚ æ­£ç¡®ç­”æ¡ˆæ˜¯: ' + correctOrder.join(', ');
                 feedbackEl.className = 'playground-feedback text-red-700 font-medium'; // Added font-medium
             }
             feedbackEl.style.display = 'block';
             if (explanationEl) {
                 explanationEl.style.display = 'block';
             }
             if (checkBtn) {
                 checkBtn.disabled = true;
             }
             inputs.forEach(input => input.disabled = true);
         }


         // --- Advanced Playground Execution Logic ---
         function setupAdvancedAsyncPlaygrounds() {
             const playgroundContainers = document.querySelectorAll('.playground-card[data-code-id]'); // Select only advanced playgrounds

             // Helper function to create a promise (used by playground code)
             // Ensure this function is accessible in the scope where playground code runs
             window.createPromise = function(value, delay, shouldReject = false) {
                 return new Promise((resolve, reject) => {
                     setTimeout(() => {
                         if (shouldReject) {
                             console.log(`Promise rejecting after ${delay}ms with: ${value}`);
                             reject(`Error: ${value}`); // Reject with a string or Error object
                         } else {
                             console.log(`Promise resolving after ${delay}ms with: ${value}`);
                             resolve(value); // Resolve with the original value for simplicity
                         }
                     }, delay);
                 });
             };


             function escapeHtml(unsafe) { if(typeof unsafe!=="string")return unsafe; return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;"); }
             function formatArg(arg) { if(arg instanceof Error){if(arg instanceof AggregateError){const e=arg.errors.map(r=>r instanceof Error?r.message:String(r)).join(", ");return`AggregateError: [${e}]`}return`${arg.name||"Error"}: ${arg.message}`}if(typeof arg=="object"&&arg!==null){try{return JSON.stringify(arg)}catch(e){return String(arg)}}if(typeof arg=="undefined"){return"undefined"}return String(arg)}

             playgroundContainers.forEach(container => {
                 const runBtn = container.querySelector('.playground-run-btn');
                 const outputEl = container.querySelector('.playground-output');
                 const codeId = container.dataset.codeId;
                 const codeEl = document.getElementById(codeId);

                 if (!runBtn || !outputEl || !codeEl) { console.warn('Playground container missing elements:', container); return; }

                 runBtn.addEventListener('click', async () => {
                     const codeToRun = codeEl.textContent || codeEl.innerText;
                     outputEl.innerHTML = '<span class="log-info">æ‰§è¡Œä¸­...</span>';
                     runBtn.disabled = true;

                     const originalConsoleLog = console.log;
                     const originalConsoleError = console.error;
                     let logs = [];

                     // Override console methods
                     console.log = (...args) => { logs.push({ type: 'log', content: args.map(arg => formatArg(arg)).join(' ') }); originalConsoleLog.apply(console, args); };
                     console.error = (...args) => { const f=args.map(arg => formatArg(arg)).join(' '); logs.push({ type: 'error', content: f }); originalConsoleError.apply(console, args); };

                     // Use Async Function constructor
                     const AsyncFunction = Object.getPrototypeOf(async function () { }).constructor;
                     try {
                         // Pass the playground container and createPromise helper
                         // IMPORTANT FIX: Pass 'createPromise' which refers to window.createPromise
                         const func = new AsyncFunction('playgroundContainer', 'createPromise', codeToRun);
                         await func(container, window.createPromise); // Pass container and helper

                         // Add a small delay to allow async operations within the code to potentially log
                         await new Promise(resolve => setTimeout(resolve, 200)); // Increased delay slightly

                     } catch (error) {
                         originalConsoleError('Playground execution error:', error);
                         logs.push({ type: 'error', content: `æ‰§è¡Œé”™è¯¯: ${formatArg(error)}` });
                     } finally {
                         // Restore console methods
                         console.log = originalConsoleLog;
                         console.error = originalConsoleError;

                         // Display logs
                         if (logs.length === 0) { outputEl.innerHTML = '<span class="log-info">ä»£ç å·²æ‰§è¡Œï¼Œæ— æ§åˆ¶å°è¾“å‡ºã€‚</span>'; }
                         else {
                             outputEl.innerHTML = logs.map(log => {
                                 let className = '';
                                 if (log.type === 'error' || log.content?.toLowerCase().includes('error') || log.content?.toLowerCase().includes('failed') || log.content?.toLowerCase().includes('rejected')) { className = 'log-error'; }
                                 else if (log.type === 'info') { className = 'log-info'; }
                                 else if (log.content?.toLowerCase().includes('success') || log.content?.toLowerCase().includes('fulfilled') || log.content?.toLowerCase().includes('succeeded')) { className = 'log-success'; }
                                 return `<div class="${className}">${escapeHtml(log.content)}</div>`;
                             }).join('');
                         }
                         runBtn.disabled = false;
                     }
                 });
             });
         }

        // --- Sidebar Active Link Logic ---
        function setupSidebarHighlighting() {
            const sections = document.querySelectorAll('section[id]');
            const tocLinks = document.querySelectorAll('#local-toc a');
            let lastActiveTocLink = document.querySelector('#local-toc a.current'); // Start with current if set

            const observerOptions = { root: null, rootMargin: '-20% 0px -60% 0px', threshold: 0 };

            const observerCallback = (entries) => {
                let bestVisibleEntry = null;
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        if (!bestVisibleEntry || entry.boundingClientRect.top < bestVisibleEntry.boundingClientRect.top) {
                            bestVisibleEntry = entry;
                        }
                    }
                });

                if (bestVisibleEntry) {
                    const id = bestVisibleEntry.target.getAttribute('id');
                    // Adjust selector to handle potential differences in href vs id
                    const activeLink = document.querySelector(`#local-toc a[href="#${id}"], #local-toc a[href$="${id}"]`);
                    if (activeLink && activeLink !== lastActiveTocLink) {
                        if (lastActiveTocLink) lastActiveTocLink.classList.remove('current'); // Use 'current' class
                        activeLink.classList.add('current');
                        lastActiveTocLink = activeLink;
                    }
                }
            };

            const observer = new IntersectionObserver(observerCallback, observerOptions);
            sections.forEach(section => { if (section.id) observer.observe(section); }); // Observe only sections with IDs

            // Initial check in case the initial link wasn't set correctly
             if (!lastActiveTocLink && tocLinks.length > 0) {
                 const currentHash = window.location.hash;
                 let initialLink = currentHash ? document.querySelector(`#local-toc a[href="${currentHash}"]`) : null;
                 if (!initialLink) initialLink = tocLinks[0]; // Default to first if no hash or match
                 if (initialLink) {
                     initialLink.classList.add('current');
                     lastActiveTocLink = initialLink;
                 }
             }
        }

        // --- Event Loop Simulator Logic ---
        function setupEventLoopSimulator() {
             const simulatorEl = document.getElementById('event-loop-simulator');
             if (!simulatorEl) return; // Exit if simulator element not found

             const codeDisplay = document.getElementById('sim-code-display');
             const callStackDisplay = document.getElementById('sim-call-stack');
             const webApisDisplay = document.getElementById('sim-web-apis');
             const microQueueDisplay = document.getElementById('sim-micro-queue');
             const macroQueueDisplay = document.getElementById('sim-macro-queue');
             const outputLogDisplay = document.getElementById('sim-output-log');
             const explanationDisplay = document.getElementById('sim-explanation');
             const stepBtn = document.getElementById('sim-step-btn');
             const resetBtn = document.getElementById('sim-reset-btn');

             // --- Simulation Definition ---
             const simulationCode = [ // Array of code lines
                 "console.log('Start');", // 0
                 "setTimeout(() => {",   // 1
                 "  console.log('Timeout Callback');", // 2
                 "}, 10);",               // 3 (Simulated delay)
                 "Promise.resolve().then(() => {", // 4
                 "  console.log('Promise 1');",    // 5
                 "});",                   // 6
                 "console.log('End');"     // 7
             ];

             const simulationSteps = [
                 { line: 0, explanation: "å¼€å§‹æ‰§è¡Œ script (å®ä»»åŠ¡)ã€‚åŒæ­¥ä»£ç  console.log('Start') å…¥æ ˆå¹¶æ‰§è¡Œã€‚", stack: ["console.log('Start')"], microQ: [], macroQ: ['script'], webApis: [], output: "Start", highlightLine: 0 },
                 { line: 1, explanation: "setTimeout è¢«è°ƒç”¨ï¼Œè®¡æ—¶å™¨ (10ms) äº¤ç»™ Web API å¤„ç†ã€‚", stack: [], microQ: [], macroQ: ['script'], webApis: ['Timer (10ms) for Timeout Callback'], output: "Start", highlightLine: 1 },
                 { line: 4, explanation: "Promise.resolve().then() è¢«è°ƒç”¨ï¼Œå…¶å›è°ƒæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚", stack: [], microQ: ['Promise 1 Callback'], macroQ: ['script'], webApis: ['Timer (10ms) for Timeout Callback'], output: "Start", highlightLine: 4 },
                 { line: 7, explanation: "åŒæ­¥ä»£ç  console.log('End') å…¥æ ˆå¹¶æ‰§è¡Œã€‚", stack: ["console.log('End')"], microQ: ['Promise 1 Callback'], macroQ: ['script'], webApis: ['Timer (10ms) for Timeout Callback'], output: "Start\nEnd", highlightLine: 7 },
                 { line: -1, explanation: "å½“å‰å®ä»»åŠ¡ (script) æ‰§è¡Œå®Œæ¯•ã€‚æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚", stack: [], microQ: ['Promise 1 Callback'], macroQ: [], webApis: ['Timer (10ms) for Timeout Callback'], output: "Start\nEnd", highlightLine: -1 },
                 { line: 5, explanation: "æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ 'Promise 1 Callback'ã€‚", stack: ["Promise 1 Callback"], microQ: [], macroQ: [], webApis: ['Timer (10ms) for Timeout Callback'], output: "Start\nEnd\nPromise 1", highlightLine: 5 },
                 { line: -1, explanation: "å¾®ä»»åŠ¡é˜Ÿåˆ—å·²æ¸…ç©ºã€‚(å‡è®¾æ­¤æ—¶ 10ms å·²åˆ°) è®¡æ—¶å™¨å®Œæˆï¼ŒTimeout Callback æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—ã€‚", stack: [], microQ: [], macroQ: ['Timeout Callback'], webApis: [], output: "Start\nEnd\nPromise 1", highlightLine: -1 },
                 { line: 2, explanation: "ä»å®ä»»åŠ¡é˜Ÿåˆ—å–å‡º 'Timeout Callback' æ‰§è¡Œã€‚", stack: ["Timeout Callback"], microQ: [], macroQ: [], webApis: [], output: "Start\nEnd\nPromise 1\nTimeout Callback", highlightLine: 2 },
                 { line: -1, explanation: "å½“å‰å®ä»»åŠ¡ ('Timeout Callback') æ‰§è¡Œå®Œæ¯•ã€‚æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ— (ç©º)ã€‚", stack: [], microQ: [], macroQ: [], webApis: [], output: "Start\nEnd\nPromise 1\nTimeout Callback", highlightLine: -1 },
                 { line: -1, explanation: "å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡é˜Ÿåˆ—éƒ½ä¸ºç©ºã€‚æ¨¡æ‹Ÿç»“æŸã€‚", stack: [], microQ: [], macroQ: [], webApis: [], output: "Start\nEnd\nPromise 1\nTimeout Callback", highlightLine: -1, finished: true },
             ];

             let currentStepIndex = -1;

             function formatQueue(queueArray) { /* ... (same as before) ... */ if(!Array.isArray(queueArray)||queueArray.length===0){return'<span class="text-gray-400 italic text-xs">[ç©º]</span>'}return queueArray.map(item=>`<div class="sim-queue-item">${escapeHtml(item)}</div>`).join('')}
             function escapeHtml(unsafe) { /* ... (same as before) ... */ if(typeof unsafe!=="string")return unsafe;return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}

             function renderCode(highlightLine = -1) { codeDisplay.innerHTML = simulationCode.map((line, index) => { const escapedLine = escapeHtml(line); return index === highlightLine ? `<span class="line-highlight">${escapedLine}</span>` : escapedLine; }).join('\n'); }

             function renderState(step) {
                 callStackDisplay.innerHTML = formatQueue(step.stack);
                 webApisDisplay.innerHTML = formatQueue(step.webApis);
                 microQueueDisplay.innerHTML = formatQueue(step.microQ);
                 macroQueueDisplay.innerHTML = formatQueue(step.macroQ);
                 outputLogDisplay.textContent = step.output;
                 explanationDisplay.textContent = step.explanation;
                 renderCode(step.highlightLine);
                 stepBtn.disabled = !!step.finished;
             }

             function resetSimulator() {
                 currentStepIndex = -1;
                 callStackDisplay.innerHTML = '<span class="text-gray-400 italic text-xs">[ç©º]</span>';
                 webApisDisplay.innerHTML = '<span class="text-gray-400 italic text-xs">[ç©º]</span>';
                 microQueueDisplay.innerHTML = '<span class="text-gray-400 italic text-xs">[ç©º]</span>';
                 macroQueueDisplay.innerHTML = formatQueue(['script']);
                 outputLogDisplay.textContent = '';
                 explanationDisplay.textContent = 'ç‚¹å‡» "ä¸‹ä¸€æ­¥" å¼€å§‹æ¨¡æ‹Ÿã€‚';
                 renderCode();
                 stepBtn.disabled = false;
             }

             stepBtn.addEventListener('click', () => { currentStepIndex++; if (currentStepIndex < simulationSteps.length) { renderState(simulationSteps[currentStepIndex]); } });
             resetBtn.addEventListener('click', resetSimulator);
             resetSimulator(); // Initial setup
         }


        // --- DOMContentLoaded Handler ---
        document.addEventListener('DOMContentLoaded', () => {
             // Initialize Mermaid if elements exist
             if (typeof mermaid !== 'undefined' && document.querySelector('.mermaid')) {
                 try { mermaid.initialize({ startOnLoad: true, theme: 'neutral' }); } catch (e) { console.error("Mermaid initialization failed:", e); }
             } else if (!document.querySelector('.mermaid')) { /* No mermaid elements */ } else { console.warn("Mermaid library not found."); }

            // Setup playgrounds if they exist
            if (document.querySelector('.playground-card')) {
                setupAdvancedAsyncPlaygrounds();
            }
            // Enable simple playground specifically if it exists
            if (document.getElementById('playground-1')) {
                document.querySelectorAll('#playground-1 input, #playground-1 button').forEach(el => el.disabled = false);
            }

            // Setup simulator if it exists
            if (document.getElementById('event-loop-simulator')) {
                setupEventLoopSimulator();
            }

             // Setup sidebar highlighting
             setupSidebarHighlighting();

            // Activate Prism highlighting
            if (typeof Prism !== 'undefined') { Prism.highlightAll(); } else { console.warn("Prism library not found."); }

            // Add basic interaction for checkboxes (could be saved to localStorage)
            const checkboxes = document.querySelectorAll('.knowledge-list input[type="checkbox"]');
            checkboxes.forEach(cb => { cb.addEventListener('change', (event) => { console.log(`Checkbox ${event.target.dataset.id} changed to ${event.target.checked}`); }); });

            // Add fade-in animation to sections
             const mainContentSections = document.querySelectorAll('.content-section');
             const fadeObserverOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
             const fadeObserverCallback = (entries, observer) => {
                 entries.forEach((entry, index) => { // Use index for staggered delay
                     if (entry.isIntersecting) {
                         entry.target.style.animationDelay = `${index * 0.08}s`; // Stagger delay
                         entry.target.classList.add('fade-in-section');
                         observer.unobserve(entry.target);
                     }
                 });
             };
             const fadeObserver = new IntersectionObserver(fadeObserverCallback, fadeObserverOptions);
             mainContentSections.forEach(section => fadeObserver.observe(section));

        });
    </script>

</body>
</html>
